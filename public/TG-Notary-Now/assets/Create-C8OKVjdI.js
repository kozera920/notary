import{r as o,j as e,W as M,q as V,a as P}from"./app-pje9ZYFb.js";import{M as O}from"./MainLayout-T1wetyz_.js";import{L as k}from"./LoadingButton-CVllF8Q3.js";import{F as z}from"./FileInput-BV7r9-XM.js";import{F as B}from"./FieldGroup-BwdRW71v.js";import"./index-BLHj9aKh.js";const U=({firstName:n,lastName:c,setIsIDVerified:j})=>{const[l,v]=o.useState(null),[u,y]=o.useState(null),[b,f]=o.useState(!1),[t,I]=o.useState(null),[p,i]=o.useState(null),g=a=>{const s=a.target.files[0];if(s){v(s);const r=new FileReader;r.onloadend=()=>{y(r.result)},r.readAsDataURL(s),I(null),i(null)}},A=async a=>{var s;if(a.preventDefault(),!l){i("Please select an image of an Arizona ID");return}f(!0);try{const r=await F(l),d=new FormData;d.append("base64Image",r),d.append("language","eng"),d.append("ocrengine","2"),d.append("scale","true"),d.append("isOverlayRequired","false");const x=await(await fetch("https://api.ocr.space/parse/image",{method:"POST",headers:{apikey:"K81876378388957"},body:d})).json();if(x.IsErroredOnProcessing)throw new Error(x.ErrorMessage||"Failed to process the image");const m=((s=x.ParsedResults[0])==null?void 0:s.ParsedText)||"",h=T(m),D=q(m),w=D.name&&D.name.toLowerCase()===`${n} ${c}`.toLowerCase(),E=D.expirationDate,_=!!E,S=_&&new Date(E)<new Date,R=C(m),L=["Driver's License","State ID Card","Passport"].includes(R);I({isValid:h,confidence:h?"High":"Low",idType:R,extractedInfo:D,isNameMatch:w,isExpirationDateFound:_,isExpired:S,rawText:m}),j(h&&w&&L&&_&&!S)}catch(r){i(r.message||"An error occurred during verification"),console.error(r)}finally{f(!1)}},F=a=>new Promise((s,r)=>{const d=new FileReader;d.readAsDataURL(a),d.onload=()=>s(d.result),d.onerror=N=>r(N)}),T=a=>["ARIZONA","AZ","MOTOR VEHICLE DIVISION","DRIVER LICENSE","IDENTIFICATION CARD","CLASS"].filter(r=>a.toUpperCase().includes(r)).length>=2,C=a=>{const s=a.toUpperCase();return s.includes("DRIVER LICENSE")||s.includes("DRIVER'S LICENSE")?"Driver's License":s.includes("IDENTIFICATION CARD")||s.includes("ID CARD")?"State ID Card":s.includes("PASSPORT")?"Passport":"Unknown"},q=a=>{const s={},r=a.match(/DOB:?\s*(\d{2}\/\d{2}\/\d{4})/i)||a.match(/BIRTH\s*DATE:?\s*(\d{2}\/\d{2}\/\d{4})/i);r&&(s.dateOfBirth=r[1]);const d=a.match(/EXP:?\s*(\d{2}\/\d{2}\/\d{4})/i)||a.match(/EXPIRATION:?\s*(\d{2}\/\d{2}\/\d{4})/i);d&&(s.expirationDate=d[1]);const N=a.match(/([A-Z]\d{8})/);N&&(s.idNumber=N[1]);const x=a.match(/1\s+([A-Z]+)/i),m=a.match(/2\s+([A-Z]+)/i);if(x&&m)s.name=`${x[1]} ${m[1]}`;else{const h=a.match(/\b([A-Z][a-z]+)\s([A-Z][a-z]+)\b/);h&&(s.name=h[0])}return s};return e.jsxs("div",{className:"max-w-xl p-4",children:[e.jsxs("form",{onSubmit:A,className:"mb-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Upload Arizona ID Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:g,className:"block w-full text-sm border border-gray-300 rounded p-2"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Supported types: Driver's License, State ID, Passport"})]}),u&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Preview:"}),e.jsx("img",{src:u,alt:"ID Preview",className:"max-h-60 object-contain border rounded"})]}),e.jsx("button",{type:"submit",disabled:b||!l,className:`px-4 py-2 rounded font-medium ${b||!l?"bg-gray-300 text-gray-500":"bg-blue-600 text-white hover:bg-blue-700"}`,children:b?"Verifying...":"Verify ID"})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded p-4 mb-4",children:e.jsx("p",{className:"text-red-700",children:p})}),t&&e.jsxs("div",{className:`border rounded p-4 mb-4 ${t.isValid?"bg-green-50 border-green-200":"bg-yellow-50 border-yellow-200"}`,children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Verification Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[e.jsx("div",{className:"text-sm font-medium",children:"Status:"}),e.jsx("div",{className:t.isValid?"text-green-600 font-medium":"text-red-600 font-medium",children:t.isValid?"Verified ✓":"Not Verified ✗"}),e.jsx("div",{className:"text-sm font-medium",children:"ID Type:"}),e.jsx("div",{children:t.idType||"Unknown"}),e.jsx("div",{className:"text-sm font-medium",children:"Confidence:"}),e.jsx("div",{children:t.confidence}),e.jsx("div",{className:"text-sm font-medium",children:"Name Match:"}),e.jsx("div",{className:t.isNameMatch?"text-green-600 font-medium":"text-red-600 font-medium",children:t.isNameMatch?"Match ✓":"No Match ✗"}),e.jsx("div",{className:"text-sm font-medium",children:"Expiration Date:"}),e.jsx("div",{className:t.isExpired||!t.isExpirationDateFound?"text-red-600 font-medium":"text-green-600 font-medium",children:t.isExpirationDateFound?t.isExpired?"Expired ✗":"Valid ✓":"Not Found ✗"})]}),Object.keys(t.extractedInfo).length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{className:"text-md font-medium mb-1",children:"Extracted Information:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[t.extractedInfo.name&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium",children:"Name:"}),e.jsx("div",{children:t.extractedInfo.name})]}),t.extractedInfo.idNumber&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium",children:"ID Number:"}),e.jsx("div",{children:t.extractedInfo.idNumber})]}),t.extractedInfo.dateOfBirth&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium",children:"Date of Birth:"}),e.jsx("div",{children:t.extractedInfo.dateOfBirth})]}),t.extractedInfo.expirationDate&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-sm font-medium",children:"Expiration Date:"}),e.jsx("div",{children:t.extractedInfo.expirationDate})]})]})]}),e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-sm text-gray-600 cursor-pointer",children:"Show Raw Text"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-100 text-xs rounded overflow-x-auto",children:t.rawText||"No text extracted"})]})]}),e.jsxs("div",{className:"text-xs text-gray-500 mt-6",children:[e.jsx("p",{children:"Before you submit your document you must verify government-issued ID, make sure:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-1",children:[e.jsx("li",{children:"Uploaded image is clearly readable"}),e.jsxs("li",{children:["The names on that ID match the names you use on ",e.jsx("b",{children:"TG Notary Now"})]}),e.jsx("li",{children:"Expire date must still be valid"}),e.jsx("li",{children:"ID type must be one of supported types(Driver's License, State ID, Passport)"})]})]})]})},Z=()=>{const{data:n,setData:c,errors:j,post:l,processing:v}=M({document_name:"",document_unique_name:"",_method:"put"}),[u,y]=o.useState(!1);o.useEffect(()=>{n.document_unique_name&&typeof n.document_unique_name=="object"&&"name"in n.document_unique_name&&c("document_name",n.document_unique_name.name)},[n.document_unique_name]);const[b,f]=o.useState("");function t(i){i.preventDefault(),!(!n.document_unique_name||n.document_unique_name==="")&&l(route("documents.store"))}const{auth:I}=V().props,p=I.user;return console.log(u),e.jsxs("div",{children:[e.jsxs("h1",{className:"mb-8 text-3xl font-bold",children:[e.jsx(P,{href:route("documents"),className:"text-indigo-600 hover:text-indigo-700",children:"Documents"}),e.jsx("span",{className:"font-medium text-indigo-600",children:" /"})," Create"]}),e.jsxs("div",{className:"max-w-3xl overflow-hidden bg-white rounded shadow",children:[e.jsx("div",{className:"grid gap-8 p-8",children:e.jsx(U,{firstName:p.first_name,lastName:p.last_name,setIsIDVerified:y})}),e.jsxs("form",{onSubmit:t,children:[e.jsx("div",{className:"grid gap-8 p-8",children:e.jsx(B,{label:"Document File you want to notarize(images, .pdf, .doc, .docx)",name:"document_name",error:j.document_unique_name,children:e.jsx(z,{name:"document_unique_name",accept:"image/*,.pdf,.doc,.docx",required:!0,error:j.document_unique_name,value:n.document_unique_name,onChange:i=>{if(i&&i.target&&i.target.files&&i.target.files.length>0){const g=i.target.files[0];f(g.name),c("document_name",g.name),c("document_unique_name",g)}else i&&i.name&&(f(i.name),c("document_name",i.name),c("document_unique_name",i))}})})}),e.jsx("div",{className:"flex items-center justify-end px-8 py-4 bg-gray-100 border-t border-gray-200",children:e.jsx(k,{loading:v,type:"submit",className:`btn-indigo ${!n.document_unique_name||n.document_unique_name===""||u==!1?"cursor-not-allowed disabled:opacity-60":""}`,disabled:!n.document_unique_name||n.document_unique_name===""||u==!1,children:"Upload Document"})})]})]})]})};Z.layout=n=>e.jsx(O,{title:"Create Document",children:n});export{Z as default};
