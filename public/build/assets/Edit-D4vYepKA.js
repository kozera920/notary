const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/YouTube-a-iDKmwF.js","assets/app-BZPrvwDB.js","assets/app-BzT06lua.css","assets/SoundCloud-D5cgOI83.js","assets/Vimeo-tFmzsaND.js","assets/Mux-BbhaNBzS.js","assets/Facebook-CZdm6hlR.js","assets/Streamable-DaeD0XHf.js","assets/Wistia-DWa24UNs.js","assets/Twitch-CvDXnEh-.js","assets/DailyMotion-J0XSTiQc.js","assets/Mixcloud-DA2Nz_g4.js","assets/Vidyard-kp68x3Yc.js","assets/Kaltura-2FqlPxlO.js","assets/FilePlayer-B2gAAkE-.js","assets/Preview-bWhTgdhE.js"])))=>i.map(i=>d[i]);
import{g as Do,r as Dt,R as Mc,c as xo,_ as ha,b as Ac,d as Ji,j as tr,q as yo,W as Lc,Y as Nc,a as jc,y as bo}from"./app-BZPrvwDB.js";import{c as Io,M as Bc}from"./MainLayout-EqO4-vJ-.js";import{T as Fc,D as Uc}from"./TrashedMessage-DpbD-zQ8.js";import{L as Mo}from"./LoadingButton-CJ4JGZyv.js";import{T as Wc}from"./Table-pRA-uK3C.js";import{F as Vc}from"./FieldGroup-q9e-zh90.js";import{F as qc}from"./FileInput-B712SLOr.js";import{p as Hc,R as zc,C as wo}from"./Row-B6FmnXaj.js";import{T as $c}from"./trash-2-DdVdcAVP.js";/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Gc=Io("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.378.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Kc=Io("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);var no={exports:{}},As=typeof Reflect=="object"?Reflect:null,So=As&&typeof As.apply=="function"?As.apply:function(U,J,se){return Function.prototype.apply.call(U,J,se)},Bi;As&&typeof As.ownKeys=="function"?Bi=As.ownKeys:Object.getOwnPropertySymbols?Bi=function(U){return Object.getOwnPropertyNames(U).concat(Object.getOwnPropertySymbols(U))}:Bi=function(U){return Object.getOwnPropertyNames(U)};function Jc(N){console&&console.warn&&console.warn(N)}var Ao=Number.isNaN||function(U){return U!==U};function qr(){qr.init.call(this)}no.exports=qr;no.exports.once=Zc;qr.EventEmitter=qr;qr.prototype._events=void 0;qr.prototype._eventsCount=0;qr.prototype._maxListeners=void 0;var Ro=10;function Ui(N){if(typeof N!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof N)}Object.defineProperty(qr,"defaultMaxListeners",{enumerable:!0,get:function(){return Ro},set:function(N){if(typeof N!="number"||N<0||Ao(N))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+N+".");Ro=N}});qr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};qr.prototype.setMaxListeners=function(U){if(typeof U!="number"||U<0||Ao(U))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+U+".");return this._maxListeners=U,this};function Lo(N){return N._maxListeners===void 0?qr.defaultMaxListeners:N._maxListeners}qr.prototype.getMaxListeners=function(){return Lo(this)};qr.prototype.emit=function(U){for(var J=[],se=1;se<arguments.length;se++)J.push(arguments[se]);var fe=U==="error",De=this._events;if(De!==void 0)fe=fe&&De.error===void 0;else if(!fe)return!1;if(fe){var Pt;if(J.length>0&&(Pt=J[0]),Pt instanceof Error)throw Pt;var G=new Error("Unhandled error."+(Pt?" ("+Pt.message+")":""));throw G.context=Pt,G}var C=De[U];if(C===void 0)return!1;if(typeof C=="function")So(C,this,J);else for(var l=C.length,k=Uo(C,l),se=0;se<l;++se)So(k[se],this,J);return!0};function No(N,U,J,se){var fe,De,Pt;if(Ui(J),De=N._events,De===void 0?(De=N._events=Object.create(null),N._eventsCount=0):(De.newListener!==void 0&&(N.emit("newListener",U,J.listener?J.listener:J),De=N._events),Pt=De[U]),Pt===void 0)Pt=De[U]=J,++N._eventsCount;else if(typeof Pt=="function"?Pt=De[U]=se?[J,Pt]:[Pt,J]:se?Pt.unshift(J):Pt.push(J),fe=Lo(N),fe>0&&Pt.length>fe&&!Pt.warned){Pt.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+Pt.length+" "+String(U)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=N,G.type=U,G.count=Pt.length,Jc(G)}return N}qr.prototype.addListener=function(U,J){return No(this,U,J,!1)};qr.prototype.on=qr.prototype.addListener;qr.prototype.prependListener=function(U,J){return No(this,U,J,!0)};function Yc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function jo(N,U,J){var se={fired:!1,wrapFn:void 0,target:N,type:U,listener:J},fe=Yc.bind(se);return fe.listener=J,se.wrapFn=fe,fe}qr.prototype.once=function(U,J){return Ui(J),this.on(U,jo(this,U,J)),this};qr.prototype.prependOnceListener=function(U,J){return Ui(J),this.prependListener(U,jo(this,U,J)),this};qr.prototype.removeListener=function(U,J){var se,fe,De,Pt,G;if(Ui(J),fe=this._events,fe===void 0)return this;if(se=fe[U],se===void 0)return this;if(se===J||se.listener===J)--this._eventsCount===0?this._events=Object.create(null):(delete fe[U],fe.removeListener&&this.emit("removeListener",U,se.listener||J));else if(typeof se!="function"){for(De=-1,Pt=se.length-1;Pt>=0;Pt--)if(se[Pt]===J||se[Pt].listener===J){G=se[Pt].listener,De=Pt;break}if(De<0)return this;De===0?se.shift():Qc(se,De),se.length===1&&(fe[U]=se[0]),fe.removeListener!==void 0&&this.emit("removeListener",U,G||J)}return this};qr.prototype.off=qr.prototype.removeListener;qr.prototype.removeAllListeners=function(U){var J,se,fe;if(se=this._events,se===void 0)return this;if(se.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):se[U]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete se[U]),this;if(arguments.length===0){var De=Object.keys(se),Pt;for(fe=0;fe<De.length;++fe)Pt=De[fe],Pt!=="removeListener"&&this.removeAllListeners(Pt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(J=se[U],typeof J=="function")this.removeListener(U,J);else if(J!==void 0)for(fe=J.length-1;fe>=0;fe--)this.removeListener(U,J[fe]);return this};function Bo(N,U,J){var se=N._events;if(se===void 0)return[];var fe=se[U];return fe===void 0?[]:typeof fe=="function"?J?[fe.listener||fe]:[fe]:J?Xc(fe):Uo(fe,fe.length)}qr.prototype.listeners=function(U){return Bo(this,U,!0)};qr.prototype.rawListeners=function(U){return Bo(this,U,!1)};qr.listenerCount=function(N,U){return typeof N.listenerCount=="function"?N.listenerCount(U):Fo.call(N,U)};qr.prototype.listenerCount=Fo;function Fo(N){var U=this._events;if(U!==void 0){var J=U[N];if(typeof J=="function")return 1;if(J!==void 0)return J.length}return 0}qr.prototype.eventNames=function(){return this._eventsCount>0?Bi(this._events):[]};function Uo(N,U){for(var J=new Array(U),se=0;se<U;++se)J[se]=N[se];return J}function Qc(N,U){for(;U+1<N.length;U++)N[U]=N[U+1];N.pop()}function Xc(N){for(var U=new Array(N.length),J=0;J<U.length;++J)U[J]=N[J].listener||N[J];return U}function Zc(N,U){return new Promise(function(J,se){function fe(Pt){N.removeListener(U,De),se(Pt)}function De(){typeof N.removeListener=="function"&&N.removeListener("error",fe),J([].slice.call(arguments))}Wo(N,U,De,{once:!0}),U!=="error"&&ed(N,fe,{once:!0})})}function ed(N,U,J){typeof N.on=="function"&&Wo(N,"error",U,J)}function Wo(N,U,J,se){if(typeof N.on=="function")se.once?N.once(U,J):N.on(U,J);else if(typeof N.addEventListener=="function")N.addEventListener(U,function fe(De){se.once&&N.removeEventListener(U,fe),J(De)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof N)}var td=no.exports;const rd=Do(td);var Vo={exports:{}};(function(N,U){var J={};/*! For license information please see videosdk.js.LICENSE.txt */(function(se,fe){N.exports=fe()})(self,()=>(()=>{var se={5414:G=>{G.exports=(()=>{var C={43:function(d,u,f){var o,c;(function(){o=function(){var e=function(){},g="undefined",h=typeof window!==g&&typeof window.navigator!==g&&/Trident\/|MSIE /.test(window.navigator.userAgent),v=["trace","debug","info","warn","error"];function _(r,a){var y=r[a];if(typeof y.bind=="function")return y.bind(r);try{return Function.prototype.bind.call(y,r)}catch{return function(){return Function.prototype.apply.apply(y,[r,arguments])}}}function b(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function p(r,a){for(var y=0;y<v.length;y++){var P=v[y];this[P]=y<r?e:this.methodFactory(P,r,a)}this.log=this.debug}function m(r,a,y){return function(){typeof console!==g&&(p.call(this,a,y),this[r].apply(this,arguments))}}function E(r,a,y){return function(P){return P==="debug"&&(P="log"),typeof console!==g&&(P==="trace"&&h?b:console[P]!==void 0?_(console,P):console.log!==void 0?_(console,"log"):e)}(r)||m.apply(this,arguments)}function s(r,a,y){var P,O=this,M="loglevel";function j(){var Q;if(typeof window!==g&&M){try{Q=window.localStorage[M]}catch{}if(typeof Q===g)try{var re=window.document.cookie,oe=re.indexOf(encodeURIComponent(M)+"=");oe!==-1&&(Q=/^([^;]+)/.exec(re.slice(oe))[1])}catch{}return O.levels[Q]===void 0&&(Q=void 0),Q}}typeof r=="string"?M+=":"+r:typeof r=="symbol"&&(M=void 0),O.name=r,O.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},O.methodFactory=y||E,O.getLevel=function(){return P},O.setLevel=function(Q,re){if(typeof Q=="string"&&O.levels[Q.toUpperCase()]!==void 0&&(Q=O.levels[Q.toUpperCase()]),!(typeof Q=="number"&&Q>=0&&Q<=O.levels.SILENT))throw"log.setLevel() called with invalid level: "+Q;if(P=Q,re!==!1&&function(oe){var le=(v[oe]||"silent").toUpperCase();if(typeof window!==g&&M){try{return void(window.localStorage[M]=le)}catch{}try{window.document.cookie=encodeURIComponent(M)+"="+le+";"}catch{}}}(Q),p.call(O,Q,r),typeof console===g&&Q<O.levels.SILENT)return"No console available for logging"},O.setDefaultLevel=function(Q){j()||O.setLevel(Q,!1)},O.enableAll=function(Q){O.setLevel(O.levels.TRACE,Q)},O.disableAll=function(Q){O.setLevel(O.levels.SILENT,Q)};var B=j();B==null&&(B=a??"WARN"),O.setLevel(B,!1)}var i=new s,t={};i.getLogger=function(r){if(typeof r!="symbol"&&typeof r!="string"||r==="")throw new TypeError("You must supply a name when creating a logger.");var a=t[r];return a||(a=t[r]=new s(r,i.getLevel(),i.methodFactory)),a};var n=typeof window!==g?window.log:void 0;return i.noConflict=function(){return typeof window!==g&&window.log===i&&(window.log=n),i},i.getLoggers=function(){return t},i.default=i,i},(c=o.call(u,f,u,d))===void 0||(d.exports=c)})()}},l={};function k(d){var u=l[d];if(u!==void 0)return u.exports;var f=l[d]={exports:{}};return C[d].call(f.exports,f,f.exports,k),f.exports}k.d=(d,u)=>{for(var f in u)k.o(u,f)&&!k.o(d,f)&&Object.defineProperty(d,f,{enumerable:!0,get:u[f]})},k.o=(d,u)=>Object.prototype.hasOwnProperty.call(d,u),k.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})};var S={};return(()=>{k.r(S),k.d(S,{VideoSDKMetrics:()=>ba});const d="inbound",u="outbound",f={codec_id_in:"",codec_in:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_in:0,delta_rtt_ms_out:null,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,timestamp_in:null,ssrc:"",total_concealment_events:0,delta_concealment_events:0,total_inserted_samples_for_decelaration:0,delta_inserted_samples_for_decelaration:0,total_removed_samples_for_accelaration:0,delta_removed_samples_for_accelaration:0,direction:d},o={codec_id_out:"",codec_out:{mime_type:null,clock_rate:null,sdp_fmtp_line:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,timestamp_out:null,ssrc:"",direction:u},c={codec_id_in:"",size_in:{width:null,height:null,framerate:null},codec_in:{mime_type:null,clock_rate:null},delta_jitter_ms_in:0,percent_packets_lost_in:0,delta_packets_in:0,delta_packets_lost_in:0,total_packets_in:0,total_packets_lost_in:0,total_KBytes_in:0,delta_KBytes_in:0,delta_kbs_in:0,ssrc:"",direction:d},e={codec_id_out:"",size_out:{width:null,height:null,framerate:null},codec_out:{mime_type:null,clock_rate:null},delta_jitter_ms_out:0,delta_rtt_ms_out:null,percent_packets_lost_out:0,delta_packets_out:0,delta_packets_lost_out:0,total_packets_out:0,total_packets_lost_out:0,total_KBytes_out:0,delta_KBytes_out:0,delta_kbs_out:0,limitation_out:{reason:null,durations:null,resolutionChanges:0},timestamp_out:null,ssrc:"",direction:u},g="inbound-rtp",h="bytesReceived",v="bytesSent",_="clockRate",b="codecId",p="currentRoundTripTime",m="roundTripTime",E="fractionLost",s="frameHeight",i="frameWidth",t="qualityLimitationReason",n="qualityLimitationDurations",r="qualityLimitationResolutionChanges",a="id",y="jitter",P="kind",O="mimeType",M="packetsLost",j="packetsReceived",B="packetsSent",Q="responsesReceived",re="ssrc",oe="selected",le="timestamp",ve="totalRoundTripTime",ke="roundTripTimeMeasurements",ce="type",te="framesDecoded",ue="framesEncoded",pe="totalDecodeTime",he="totalEncodeTime",Ze="pliCount",Ot="nackCount",Ht="trackId",st="trackIdentifier",_r="mediaSourceId",jt="audio",_t="video",vr={0:"ETHERNET",2:"CELLULAR_5G",3:"WIFI",5:"CELLULAR_4G",10:"CELLULAR"},ft="audio",xt="video",$r="network",cr="data";var yr=k(43);const Jr=()=>`${new Date().toISOString()} | metrics`,Gt=(wt,je,Qe)=>`${wt} | ${je} | ${Qe}`;yr.setDefaultLevel(yr.levels.TRACE);const Ke=(wt,je,Qe)=>{Qe?yr.debug(Gt(Jr(),wt,je),Qe):yr.debug(Gt(Jr(),wt,je))},Ct=(wt,je)=>{yr.warn(Gt(Jr(),wt,je))},dr=(wt,je)=>{yr.error(Gt(Jr(),wt,je))},xe="extractor   ",Ye=(wt,je,Qe)=>{if(!je)return null;const Ve={};let Ce=je[jt][wt];Ce||(Ce=Qe===d?{...f}:{...o}),Ve[jt]=Ce;let ur=je[_t][wt];return ur||(ur=Qe===d?{...c}:{...e}),Ve[_t]=ur,Ve},zt=(wt,je,Qe,Ve)=>{let Ce=!1;const ur=Ve[je].total_rtt_ms_out,we=Ve[je].total_rtt_measure_out,er=Qe?Qe[je].total_rtt_ms_out:0,fr=Qe?Qe[je].total_rtt_measure_out:0,br={rtt:null,totalRTT:ur,totalRTTMeasurements:we};if(wt[le]===Ve[je].timestamp_out||!Object.prototype.hasOwnProperty.call(wt,m)||Object.prototype.hasOwnProperty.call(wt,ke)&&(Ce=!0,Number(wt[ke])===0||Number(wt[ke])-fr===we))return br;const gr=1e3*Number(wt[m]);let tn=ur+gr,Ie=we+1;return Ce&&(tn=1e3*Number(wt[ve])-er,Ie=Number(wt[ke])-fr),{rtt:gr,totalRTT:tn,totalRTTMeasurements:Ie}},pt=(wt,je,Qe)=>wt[le]===Qe[je].timestamp_out?null:Object.prototype.hasOwnProperty.call(wt,y)?1e3*(Number(wt[y])||0):null,rr=(wt,je,Qe,Ve)=>{if(!Object.prototype.hasOwnProperty.call(wt,B)||!Object.prototype.hasOwnProperty.call(wt,v))return{packetsSent:Qe[je].total_packets_out,packetsLost:Qe[je].total_packets_lost_out,bytesSent:Qe[je].total_KBytes_out};const Ce=Number(wt[B])||0-(Ve?Ve[je].total_packets_out:0),ur=Ce-Qe[je].total_packets_out,we=Number(wt[v])/1024-(Ve?Ve[je].total_KBytes_out:0),er=we-Qe[je].total_KBytes_out,fr=wt[le]||Date.now(),br=Ve?Ve.timestamp:null;let gr=Qe.timestamp;!gr&&br&&(gr=br);const tn=gr?fr-gr:0;return{packetsSent:Ce,deltaPacketsSent:ur,KBytesSent:we,deltaKBytesSent:er,kbsSent:tn>0?.008*er*1024/tn*1e3:0}},jr=(wt,je,Qe,Ve)=>{let Ce=Qe[je].total_packets_lost_out,ur=0,we=0;return Object.prototype.hasOwnProperty.call(wt,M)&&(Ce=Number(wt[M])||0-(Ve?Ve[je].total_packets_lost_out:0),ur=Ce-Qe[je].total_packets_lost_out),Object.prototype.hasOwnProperty.call(wt,E)&&(we=Number(100*wt[E])),{packetsLost:Ce,deltaPacketsLost:ur,fractionLost:we}},Hr=(wt,je,Qe,Ve)=>{if(!Object.prototype.hasOwnProperty.call(wt,j)||!Object.prototype.hasOwnProperty.call(wt,M)||!Object.prototype.hasOwnProperty.call(wt,h))return{percent_packets_lost:Qe[je].percent_packets_lost_in,packetsReceived:Qe[je].total_packets_in,packetsLost:Qe[je].total_packets_lost_in,bytesReceived:Qe[je].total_KBytes_in};const Ce=(Number(wt[j])||0)-(Ve?Ve[je].total_packets_in:0),ur=(Number(wt[M])||0)-(Ve?Ve[je].total_packets_lost_in:0),we=ur-Qe[je].total_packets_lost_in,er=Ce-Qe[je].total_packets_in,fr=Ce!==Qe[je].total_packets_in?100*we/(we+er):0,br=Number(wt[h])/1024-(Ve?Ve[je].total_KBytes_in:0),gr=br-Qe[je].total_KBytes_in,tn=wt[le]||Date.now(),Ie=Ve?Ve.timestamp:null;let yt=Qe.timestamp;!yt&&Ie&&(yt=Ie);const gt=yt?tn-yt:0;return{percentPacketsLost:fr,packetsReceived:Ce,deltaPacketsReceived:er,packetsLost:ur,deltaPacketsLost:we,KBytesReceived:br,deltaKBytesReceived:gr,kbsReceived:gt>0?.008*gr*1024/gt*1e3:0}},vt=wt=>wt.candidateType!=="relay"?"":wt.relayProtocol||"",zn=wt=>Object.prototype.hasOwnProperty.call(wt,s)&&Object.prototype.hasOwnProperty.call(wt,i)?{width:wt[i]||null,height:wt[s]||null,framerate:wt.framesPerSecond}:{width:null,height:null,framerate:null};class oa{constructor(je,Qe){this._callbacks={onStatsCollected:null},this._id=`collector-${Qe}`,this._moduleName=this._id,this._probeId=Qe,this._config=je,this._state="idle",this._statsReports=[]}registerCallback(je,Qe,Ve){je in this._callbacks?(this._callbacks[je]={callback:Qe,context:Ve},Ke(this._moduleName,`registered callback '${je}'`)):dr(this._moduleName,`can't register callback for '${je}' - not found`)}unregisterCallback(je){je in this._callbacks?(this._callbacks[je]=null,delete this._callbacks[je],Ke(this._moduleName,`unregistered callback '${je}'`)):dr(this._moduleName,`can't unregister callback for '${je}' - not found`)}analyze(je,Qe){const Ve=(ur=>{const we={name:"",meetingId:"",peerId:"",timestamp:null,count:0,audio:{},video:{},network:{infrastructure:3},data:{delta_kbs_bandwidth_in:0,delta_kbs_bandwidth_out:0,delta_rtt_connectivity_ms:null,total_rtt_connectivity_ms:0}};if(ur){const er={...ur,audio:{},video:{},data:{...ur.data},network:{...ur.network}};return Object.keys(ur.audio).forEach(fr=>{er.audio[fr]={...ur.audio[fr]}}),Object.keys(ur.video).forEach(fr=>{er.video[fr]={...ur.video[fr]}}),er}return{...we,audio:{},video:{},data:{...we.data},network:{...we.network}}})(Qe);Ve.name=this._config.name,Ve.meetingId=this._config.meetingId,Ve.peerId=this._config.peerId,Ve.count=Qe?Qe.count+1:1;let Ce=null;return je.forEach(ur=>{!Ce&&ur.timestamp&&(Ce=ur.timestamp),((we,er,fr,br)=>{if(!we)return[];switch(we[ce]){case"candidate-pair":let gr=!1;if(we.nominated&&we.state==="succeeded"&&(gr=!0,Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we),oe in we&&!we[oe]&&(gr=!1)),gr){we.localCandidateId,we.remoteCandidateId;const Ie=((gt,ht,Pr)=>{const Cr=(gt[h]||0)/1024-0,Ar=(gt[v]||0)/1024-0,Yt=gt[le]||Date.now(),ar=Cr-ht.data.total_KBytes_in,Tr=Ar-ht.data.total_KBytes_out,kn=null;let rn=ht.timestamp;!rn&&kn&&(rn=kn);const na=rn?Yt-rn:0;return{total_KBytes_received:Cr,total_KBytes_sent:Ar,delta_KBytes_received:ar,delta_KBytes_sent:Tr,kbs_speed_received:na>0?.008*ar*1024/na*1e3:0,kbs_speed_sent:na>0?.008*Tr*1024/na*1e3:0}})(we,er),yt=((gt=>{gt.availableIncomingBitrate,gt.availableOutgoingBitrate})(we),((gt,ht,Pr,Cr)=>{if(!Object.prototype.hasOwnProperty.call(gt,p))return{rtt:null,totalRTT:Cr[ht].total_rtt_connectivity_ms,totalRTTMeasurements:Cr[ht].total_rtt_connectivity_measure};const Ar=1e3*Number(gt[p]);let Yt=Cr[ht].total_rtt_connectivity_ms+Ar,ar=Cr[ht].total_rtt_connectivity_measure+1;return Object.prototype.hasOwnProperty.call(gt,ve)&&(Yt=1e3*Number(gt[ve])-0),Object.prototype.hasOwnProperty.call(gt,Q)&&(ar=Number(gt[Q])-0),{rtt:Ar,totalRTT:Yt,totalRTTMeasurements:ar}})(we,"data",br,er));return[{type:cr,value:{total_KBytes_in:Ie.total_KBytes_received}},{type:cr,value:{total_KBytes_out:Ie.total_KBytes_sent}},{type:cr,value:{delta_KBytes_in:Ie.delta_KBytes_received}},{type:cr,value:{delta_KBytes_out:Ie.delta_KBytes_sent}},{type:cr,value:{delta_kbs_in:Ie.kbs_speed_received}},{type:cr,value:{delta_kbs_out:Ie.kbs_speed_sent}},{type:cr,value:{delta_rtt_connectivity_ms:yt.rtt}}]}break;case"local-candidate":if(we[a]===er.network.local_candidate_id)return[{type:$r,value:{infrastructure:we.networkType}},{type:$r,value:{local_candidate_protocol:we.protocol||""}},{type:$r,value:{local_candidate_relay_protocol:vt(we)}}];break;case g:{Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const Ie=we[re],yt=Ye(Ie,er,d);yt&&(yt.timestamp=er.timestamp);const gt=Ye(Ie,br,d);if(gt&&(gt.timestamp=br.timestamp),we[P]===jt){const ht=Hr(we,jt,yt,gt),Pr=pt(we,jt,yt),Cr=we[b]||"",Ar=((Yt,ar,Tr)=>{const kn=Number(Yt.concealmentEvents)||0,rn=kn-(Tr[ar].total_concealment_events||0),na=Number(Yt.insertedSamplesForDeceleration)||0,Aa=na-(Tr[ar].total_inserted_samples_for_decelaration||0),Gr=Number(Yt.removedSamplesForAcceleration)||0;return{totalConcealmentEvents:kn,deltaConcealmentEvents:rn,totalInsertedSamplesForDecelaration:na,deltaInsertedSamplesForDecelaration:Aa,totalRemovedSamplesForAccelaration:Gr,deltaRemovedSampleForAccelaration:Gr-(Tr[ar].total_removed_samples_for_accelaration||0)}})(we,jt,yt);return[{ssrc:Ie,type:ft,value:{codec_id_in:Cr}},{ssrc:Ie,type:ft,value:{total_packets_in:ht.packetsReceived}},{ssrc:Ie,type:ft,value:{delta_packets_in:ht.deltaPacketsReceived}},{ssrc:Ie,type:ft,value:{total_packets_lost_in:ht.packetsLost}},{ssrc:Ie,type:ft,value:{delta_packets_lost_in:ht.deltaPacketsLost}},{ssrc:Ie,type:ft,value:{percent_packets_lost_in:ht.percentPacketsLost}},{ssrc:Ie,type:ft,value:{total_KBytes_in:ht.KBytesReceived}},{ssrc:Ie,type:ft,value:{delta_KBytes_in:ht.deltaKBytesReceived}},{ssrc:Ie,type:ft,value:{delta_kbs_in:ht.kbsReceived}},{ssrc:Ie,type:ft,value:{delta_jitter_ms_in:Pr}},{ssrc:Ie,type:ft,value:{total_concealment_events:Ar.totalConcealmentEvents}},{ssrc:Ie,type:ft,value:{delta_concealment_events:Ar.deltaConcealmentEvents}},{ssrc:Ie,type:ft,value:{total_inserted_samples_for_decelaration:Ar.totalInsertedSamplesForDecelaration}},{ssrc:Ie,type:ft,value:{delta_inserted_samples_for_decelaration:Ar.deltaInsertedSamplesForDecelaration}},{ssrc:Ie,type:ft,value:{total_removed_samples_for_accelaration:Ar.totalRemovedSamplesForAccelaration}},{ssrc:Ie,type:ft,value:{delta_removed_samples_for_accelaration:Ar.deltaRemovedSampleForAccelaration}},{ssrc:Ie,type:ft,value:{track_in:we[Ht]}},{ssrc:Ie,type:ft,value:{track_id_in:we[st]}},{ssrc:Ie,type:ft,value:{media_source_id:we[_r]}}]}if(we[P]===_t){((Yt,ar)=>{if(!Object.prototype.hasOwnProperty.call(Yt,te)||!Object.prototype.hasOwnProperty.call(Yt,pe))return{delta_ms_decode_frame:ar[_t].delta_ms_decode_frame_in,frames_decoded:ar[_t].total_frames_decoded_in,total_decode_time:ar[_t].total_time_decoded_in};Yt[te],Yt[pe],ar[_t].total_time_decoded_in,ar[_t].total_frames_decoded_in})(we,yt);const ht=Hr(we,_t,yt,gt),Pr=pt(we,_t,yt),Cr=(we.decoderImplementation,we[b]||null),Ar=zn(we);return((Yt,ar,Tr)=>{if(!Object.prototype.hasOwnProperty.call(Yt,Ze)||!Object.prototype.hasOwnProperty.call(Yt,Ot))return{pliCount:ar.total_pli_sent_in,nackCount:ar.total_nack_sent_in,deltaPliCount:0,deltaNackCount:0};Yt[Ze],Tr&&Tr[_t].total_pli_sent_in,Yt[Ot],Tr&&Tr[_t].total_nack_sent_in,ar[_t].total_pli_sent_in,ar[_t].total_nack_sent_in})(we,yt,gt),[{ssrc:Ie,type:xt,value:{codec_id_in:Cr}},{ssrc:Ie,type:xt,value:{total_packets_in:ht.packetsReceived}},{ssrc:Ie,type:xt,value:{delta_packets_in:ht.deltaPacketsReceived}},{ssrc:Ie,type:xt,value:{total_packets_lost_in:ht.packetsLost}},{ssrc:Ie,type:xt,value:{delta_packets_lost_in:ht.deltaPacketsLost}},{ssrc:Ie,type:xt,value:{percent_packets_lost_in:ht.percentPacketsLost}},{ssrc:Ie,type:xt,value:{total_KBytes_in:ht.KBytesReceived}},{ssrc:Ie,type:xt,value:{delta_KBytes_in:ht.deltaKBytesReceived}},{ssrc:Ie,type:xt,value:{delta_kbs_in:ht.kbsReceived}},{ssrc:Ie,type:xt,value:{delta_jitter_ms_in:Pr}},{ssrc:Ie,type:xt,value:{size_in:Ar}},{ssrc:Ie,type:xt,value:{track_in:we[Ht]}},{ssrc:Ie,type:xt,value:{track_id_in:we[st]}},{ssrc:Ie,type:xt,value:{media_source_id:we[_r]}},{ssrc:Ie,type:xt,value:{pause_count:we.pauseCount}},{ssrc:Ie,type:xt,value:{total_pauses_duration:we.totalPausesDuration}},{ssrc:Ie,type:xt,value:{freeze_count:we.freezeCount}},{ssrc:Ie,type:xt,value:{total_freezes_duration:we.totalFreezesDuration}}]}break}case"outbound-rtp":{Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const Ie=we[re],yt=Ye(Ie,er,u);yt&&(yt.timestamp=er.timestamp);const gt=Ye(Ie,br,u);if(gt&&(gt.timestamp=br.timestamp),we[P]===jt){const ht=we[b]||null,Pr=rr(we,jt,yt,gt);return[{ssrc:Ie,type:ft,value:{codec_id_out:ht}},{ssrc:Ie,type:ft,value:{total_packets_out:Pr.packetsSent}},{ssrc:Ie,type:ft,value:{delta_packets_out:Pr.deltaPacketsSent}},{ssrc:Ie,type:ft,value:{total_KBytes_out:Pr.KBytesSent}},{type:ft,value:{delta_KBytes_out:Pr.deltaKBytesSent}},{ssrc:Ie,type:ft,value:{delta_kbs_out:Pr.kbsSent}},{ssrc:Ie,type:ft,value:{track_out:we[Ht]}},{ssrc:Ie,type:ft,value:{track_id_out:we[st]}},{ssrc:Ie,type:ft,value:{media_source_id:we[_r]}}]}if(we[P]===_t){we.encoderImplementation;const ht=we[b]||null,Pr=(((Yt,ar)=>{if(!Object.prototype.hasOwnProperty.call(Yt,ue)||!Object.prototype.hasOwnProperty.call(Yt,he))return{delta_ms_encode_frame:ar[_t].delta_ms_encode_frame_out,frames_encoded:ar[_t].total_frames_encoded_out,total_encode_time:ar[_t].total_time_encoded_out};Yt[ue],Yt[he],ar[_t].total_time_encoded_out,ar[_t].total_frames_encoded_out})(we,yt),zn(we)),Cr=(Yt=>{const ar=Object.prototype.hasOwnProperty.call(Yt,t)?Yt[t]:null,Tr=Object.prototype.hasOwnProperty.call(Yt,r)?Yt[r]:null,kn=Object.prototype.hasOwnProperty.call(Yt,n)?Yt[n]:null;return kn&&Object.keys(kn).forEach(rn=>{kn[rn]>1e3&&(kn[rn]=Number(kn[rn]/1e3))}),{reason:ar,durations:kn,resolutionChanges:Tr}})(we),Ar=(((Yt,ar,Tr)=>{if(!Object.prototype.hasOwnProperty.call(Yt,Ze)||!Object.prototype.hasOwnProperty.call(Yt,Ot))return{pliCount:ar.total_pli_received_out,nackCount:ar.total_nack_received_out,deltaPliCount:0,deltaNackCount:0};Yt[Ze],Tr&&Tr[_t].total_pli_received_out,Yt[Ot],Tr&&Tr[_t].total_nack_received_out,ar[_t].total_pli_received_out,ar[_t].total_nack_received_out})(we,yt,gt),rr(we,_t,yt,gt));return[{ssrc:Ie,type:xt,value:{codec_id_out:ht}},{ssrc:Ie,type:xt,value:{total_packets_out:Ar.packetsSent}},{ssrc:Ie,type:xt,value:{delta_packets_out:Ar.deltaPacketsSent}},{ssrc:Ie,type:xt,value:{total_KBytes_out:Ar.KBytesSent}},{ssrc:Ie,type:xt,value:{delta_KBytes_out:Ar.deltaKBytesSent}},{ssrc:Ie,type:xt,value:{delta_kbs_out:Ar.kbsSent}},{ssrc:Ie,type:xt,value:{size_out:Pr}},{ssrc:Ie,type:xt,value:{limitation_out:Cr}},{ssrc:Ie,type:xt,value:{track_out:we[Ht]}},{ssrc:Ie,type:xt,value:{track_id_out:we[st]}},{ssrc:Ie,type:xt,value:{media_source_id:we[_r]}}]}break}case"media-source":{Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const Ie=[];return Object.keys(er[jt]).forEach(yt=>{const gt=er[jt][yt];if(gt.media_source_id===we[a]){var ht=we[st];Ie.push({ssrc:gt.ssrc,type:ft,value:{track_id_out:ht}})}}),Object.keys(er[_t]).forEach(yt=>{const gt=er[_t][yt];if(gt.media_source_id===we[a]){var ht=we[st];Ie.push({ssrc:gt.ssrc,type:xt,value:{track_id_out:ht}})}}),Ie}case"track":{Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const Ie=[];return Object.keys(er[jt]).forEach(yt=>{const gt=er[jt][yt];if(gt.track_in===we[a]||gt.track_out===we[a]){Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);var ht=we[st];we[a]===gt.track_in?Ie.push({ssrc:gt.ssrc,type:ft,value:{track_id_in:ht}}):Ie.push({ssrc:gt.ssrc,type:ft,value:{track_id_out:ht}})}}),Object.keys(er[_t]).forEach(yt=>{const gt=er[_t][yt];if(gt.track_in===we[a]||gt.track_out===we[a]){Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);var ht=we[st];we[a]===gt.track_in?Ie.push({ssrc:gt.ssrc,type:xt,value:{track_id_in:ht}}):Ie.push({ssrc:gt.ssrc,type:xt,value:{track_id_out:ht}})}}),Ie}case"codec":const tn=[];return Object.keys(er[jt]).forEach(Ie=>{const yt=er[jt][Ie];if(yt.codec_id_in===we[a]||yt.codec_id_out===we[a]){Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const gt=(ht=>({channels:ht.channels||null,clock_rate:ht[_]||null,mime_type:ht[O]||null,sdp_fmtp_line:ht.sdpFmtpLine||null}))(we);we[a]===yt.codec_id_in?tn.push({ssrc:yt.ssrc,type:ft,value:{codec_in:gt}}):tn.push({ssrc:yt.ssrc,type:ft,value:{codec_out:gt}})}}),Object.keys(er[_t]).forEach(Ie=>{const yt=er[_t][Ie];if(yt.codec_id_in===we[a]||yt.codec_id_out===we[a]){Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const gt=(ht=>({clock_rate:ht[_]||null,mime_type:ht[O]||null}))(we);we[a]===yt.codec_id_in?tn.push({ssrc:yt.ssrc,type:xt,value:{codec_in:gt}}):tn.push({ssrc:yt.ssrc,type:xt,value:{codec_out:gt}})}}),tn;case"remote-inbound-rtp":{Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const Ie=we[re],yt=Ye(Ie,er,u),gt=Ye(Ie,br,u);if(we[P]===jt){const ht=zt(we,jt,gt,yt),Pr=pt(we,jt,yt),Cr=jr(we,jt,yt,gt);return[{ssrc:Ie,type:ft,value:{delta_rtt_ms_out:ht.rtt}},{ssrc:Ie,type:ft,value:{delta_jitter_ms_out:Pr}},{ssrc:Ie,type:ft,value:{timestamp_out:we[le]}},{ssrc:Ie,type:ft,value:{total_packets_lost_out:Cr.packetsLost}},{ssrc:Ie,type:ft,value:{delta_packets_lost_out:Cr.deltaPacketsLost}},{ssrc:Ie,type:ft,value:{percent_packets_lost_out:Cr.fractionLost}}]}if(we[P]===_t){const ht=zt(we,_t,gt,yt),Pr=pt(we,_t,yt),Cr=jr(we,_t,yt,gt);return[{ssrc:Ie,type:xt,value:{delta_rtt_ms_out:ht.rtt}},{ssrc:Ie,type:xt,value:{delta_jitter_ms_out:Pr}},{ssrc:Ie,type:xt,value:{timestamp_out:we[le]}},{ssrc:Ie,type:xt,value:{total_packets_lost_out:Cr.packetsLost}},{ssrc:Ie,type:xt,value:{delta_packets_lost_out:Cr.deltaPacketsLost}}]}break}case"remote-outbound-rtp":{Ke(xe,`analyze() - got stats ${we[ce]} for ${fr}`,we);const Ie=we[re],yt=Ye(Ie,er,u),gt=Ye(Ie,br,u);if(we[P]===jt){const ht=zt(we,jt,gt,yt);return[{ssrc:Ie,type:ft,value:{delta_rtt_ms_in:ht.rtt}},{ssrc:Ie,type:ft,value:{timestamp_in:we[le]}}]}break}}return[]})(ur,Ve,Ve.name,null).forEach(we=>{if(we.value&&we.type)if(we.ssrc){let br=Ve[we.type][we.ssrc];br||(er=we.type,fr=ur.type,br=er===jt?fr===g?{...f}:{...o}:fr===g?{...c}:{...e},br.ssrc=we.ssrc,Ve[we.type][we.ssrc]=br),Object.keys(we.value).forEach(gr=>{we.value[gr]!==void 0&&(br[gr]=we.value[gr])})}else Object.keys(we.value).forEach(br=>{we.value[br]!==void 0&&(Ve[we.type][br]=we.value[br])});var er,fr})}),Ve.timestamp=Ce,Ve}async collectStats(){try{const je=await this._config.monitoringObject.getStats(),Qe=this.analyze(je,this._statsReports.slice().pop()||null);return this._statsReports.push(Qe),this.fireOnStatsCollected(Qe),je}catch(je){return dr(this._moduleName,`got error ${je}`),null}}fireOnStatsCollected(je){if(this._callbacks.onStatsCollected){const Qe={};Qe.meetingId=je.meetingId,Qe.peerId=je.peerId,Qe.name=je.name,Qe.audio=[],Qe.video=[],Object.values(je.audio).forEach(Ve=>{const Ce={};if(Ce.network=vr[je.network.infrastructure],Ce.timestamp=je.timestamp,Ve.direction==d){Ce.codec=Ve.codec_in.mime_type,Ce.jitter=Ve.delta_jitter_ms_in,Ce.bitrate=Ve.delta_kbs_in,Ce.packetsLost=Ve.delta_packets_lost_in,Ce.rtt=je.data.delta_rtt_connectivity_ms||0,Ce.totalPackets=Ve.delta_packets_in,Ce.concealmentEvents=Ve.delta_concealment_events,Ce.removedSampleForAccelaration=Ve.delta_removed_samples_for_accelaration,Ce.insertedSamplesForDecelaration=Ve.delta_inserted_samples_for_decelaration;const ur=JSON.stringify(Ve.track_id_in).replace(/[{}"]/g,"");Ce.trackId=ur}else Ve.direction==u&&(Ce.codec=Ve.codec_out.mime_type,Ce.jitter=Ve.delta_jitter_ms_out,Ce.bitrate=Ve.delta_kbs_out,Ce.packetsLost=Ve.delta_packets_lost_out,Ce.rtt=je.data.delta_rtt_connectivity_ms||0,Ce.totalPackets=Ve.delta_packets_out,Ce.trackId=Ve.track_id_out);Qe.audio.push(Ce)}),Object.values(je.video).forEach(Ve=>{const Ce={};if(Ce.network=vr[je.network.infrastructure],Ce.timestamp=je.timestamp,Ve.direction==d){Ce.codec=Ve.codec_in.mime_type,Ce.jitter=Ve.delta_jitter_ms_in,Ce.bitrate=Ve.delta_kbs_in,Ce.packetsLost=Ve.delta_packets_lost_in,Ce.rtt=je.data.delta_rtt_connectivity_ms||0,Ce.totalPackets=Ve.delta_packets_in,Ce.size=Ve.size_in,Ce.pauseCount=Ve.pause_count,Ce.totalPausesDuration=Ve.total_pauses_duration,Ce.freezeCount=Ve.freeze_count,Ce.totalFreezesDuration=Ve.total_freezes_duration;const ur=JSON.stringify(Ve.track_id_in).replace(/[{}"]/g,"");Ce.trackId=ur}else Ve.direction==u&&(Ce.codec=Ve.codec_out.mime_type,Ce.jitter=Ve.delta_jitter_ms_out,Ce.bitrate=Ve.delta_kbs_out,Ce.packetsLost=Ve.delta_packets_lost_out,Ce.rtt=je.data.delta_rtt_connectivity_ms||0,Ce.totalPackets=Ve.delta_packets_out,Ce.limitation=Ve.limitation_out,Ce.size=Ve.size_out,Ce.trackId=Ve.track_id_out);Qe.video.push(Ce)}),this._callbacks.onStatsCollected.callback(Qe)}}}class ca{constructor(je){this._id=je.name&&je.name.substr(0,12).padEnd(12," "),this._moduleName=this._id,this._config=je,this._collector=new oa(this._config,this._id)}get id(){return this._id}start(){this._collectorIntervalId?Ct("Probe already started."):(Ke(this._moduleName,"Probe Started"),this._collectorIntervalId=setInterval(()=>{Ke(this._moduleName,"Collector collecting stats"),this._collector.collectStats()},this._config.refreshEvery))}stop(){this._collectorIntervalId?(clearInterval(this._collectorIntervalId),Ke(this._moduleName,"Probe Stopped")):Ct("Probe not running, Please start first.")}set onStatsCollected(je){je?this._collector.registerCallback("onStatsCollected",je):this._collector.unregisterCallback("onStatsCollected")}}const pn={refreshEvery:2e3,startAfter:0,stopAfter:-1,verbose:!1,peerId:"peerId",meetingId:"meetingId",name:"name"};class ba{constructor(je){var Qe;this._config={defaultConfig:pn,...je},this._probes=[],Qe=this._config.verbose||!1,yr.setLevel(Qe?yr.levels.TRACE:yr.levels.INFO),Ke("VideoSDKMetrics","VideoSDKMetrics initialized")}get probes(){return this._probes}addNewProbe(je,Qe){if(!je)throw new Error("undefined monitoring object");const Ve={monitoringObject:je,...Qe,...this._config},Ce=new ca(Ve);return this._probes.push(Ce),Ce}removeExistingProbe(je){if(!je)throw new Error("undefined probe");je.stop(),this._probes=this._probes.filter(Qe=>je.id!==Qe.id)}getProbe(je){for(let Qe of this.probes)if(Qe.id==je)return Qe}startAllProbes(){this._probes.forEach((je,Qe)=>{je.start()})}stopAllProbes(){this._probes.forEach(je=>je.stop())}}})(),S})()},8274:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.Logger=void 0;const k=l(7833),S="awaitqueue";C.Logger=class{constructor(d){d?(this._debug=(0,k.default)(`${S}:${d}`),this._warn=(0,k.default)(`${S}:WARN:${d}`),this._error=(0,k.default)(`${S}:ERROR:${d}`)):(this._debug=(0,k.default)(S),this._warn=(0,k.default)(`${S}:WARN`),this._error=(0,k.default)(`${S}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},8876:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.AwaitQueue=C.AwaitQueueRemovedTaskError=C.AwaitQueueStoppedError=void 0;const k=new(l(8274)).Logger;class S extends Error{constructor(f){super(f??"AwaitQueue stopped"),this.name="AwaitQueueStoppedError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,S)}}C.AwaitQueueStoppedError=S;class d extends Error{constructor(f){super(f??"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,d)}}C.AwaitQueueRemovedTaskError=d,C.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(u,f){if(f=f??u.name,k.debug(`push() [name:${f}]`),typeof u!="function")throw new TypeError("given task is not a function");if(f)try{Object.defineProperty(u,"name",{value:f})}catch{}return new Promise((o,c)=>{const e={id:this.nextTaskId++,task:u,name:f,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:g=>{if(e.completed)return;e.completed=!0,this.pendingTasks.delete(e.id),k.debug(`resolving task [name:${e.name}]`),o(g);const[h]=this.pendingTasks.values();h&&!h.executedAt&&this.execute(h)},reject:g=>{if(!e.completed&&(e.completed=!0,this.pendingTasks.delete(e.id),k.debug(`rejecting task [name:${e.name}]: %s`,String(g)),c(g),!this.stopping)){const[h]=this.pendingTasks.values();h&&!h.executedAt&&this.execute(h)}}};this.pendingTasks.set(e.id,e),this.pendingTasks.size===1&&this.execute(e)})}stop(){k.debug("stop()"),this.stopping=!0;for(const u of this.pendingTasks.values())k.debug(`stop() | stopping task [name:${u.name}]`),u.reject(new S);this.stopping=!1}remove(u){k.debug(`remove() [taskIdx:${u}]`);const f=Array.from(this.pendingTasks.values())[u];f?f.reject(new d):k.debug(`stop() | no task with given idx [taskIdx:${u}]`)}dump(){const u=Date.now();let f=0;return Array.from(this.pendingTasks.values()).map(o=>({idx:f++,task:o.task,name:o.name,enqueuedTime:o.executedAt?o.executedAt-o.enqueuedAt:u-o.enqueuedAt,executionTime:o.executedAt?u-o.executedAt:0}))}async execute(u){if(k.debug(`execute() [name:${u.name}]`),u.executedAt)throw new Error("task already being executed");u.executedAt=Date.now();try{const f=await u.task();u.resolve(f)}catch(f){u.reject(f)}}}},9027:(G,C,l)=>{l.d(C,{$:()=>k});var k={networkPriorities:{audio:"high",dominatingVideo:"high",otherVideos:"medium",screenShare:"medium"},aspectRatios:{fourThree:{label:"fourThree",value:1.333},oneSixNine:{label:"oneSixNine",value:1.777}},audioProfiles:{speech_low_quality:{sampleRate:16e3,bitRate:24,sampleSize:16,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:16e3,packetTime:20,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},speech_standard:{sampleRate:32e3,bitRate:24,sampleSize:24,stereo:!1,dtx:!0,fec:!0,maxPlaybackRate:32e3,packetTime:30,autoGainControl:!0,echoCancellation:!0,noiseSuppression:!0,channelCount:1},music_standard:{sampleRate:48e3,bitRate:40,sampleSize:32,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},standard_stereo:{sampleRate:48e3,sampleSize:32,bitRate:64,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:40,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2},high_quality:{sampleRate:48e3,sampleSize:32,bitRate:128,stereo:!1,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:1},high_quality_stereo:{sampleRate:48e3,sampleSize:32,bitRate:192,stereo:!0,dtx:!1,fec:!0,maxPlaybackRate:48e3,packetTime:60,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,channelCount:2}},videoProfiles:{h90p_w160p:{width:160,height:90,bitRate:6e4,frameRate:15,aspectRatio:"oneSixNine"},h180p_w320p:{width:320,height:180,bitRate:12e4,frameRate:15,aspectRatio:"oneSixNine"},h216p_w384p:{width:384,height:216,bitRate:18e4,frameRate:15,aspectRatio:"oneSixNine"},h360p_w640p:{width:640,height:360,bitRate:3e5,frameRate:20,aspectRatio:"oneSixNine"},h540p_w960p:{width:960,height:540,bitRate:6e5,frameRate:25,aspectRatio:"oneSixNine"},h720p_w1280p:{width:1280,height:720,bitRate:2e6,frameRate:30,aspectRatio:"oneSixNine"},h1080p_w1920p:{width:1920,height:1080,bitRate:3e6,frameRate:30,aspectRatio:"oneSixNine"},h1440p_w2560p:{width:2560,height:1440,bitRate:5e6,frameRate:30,aspectRatio:"oneSixNine"},h2160p_w3840p:{width:3840,height:2160,bitRate:8e6,frameRate:30,aspectRatio:"oneSixNine"},h120p_w160p:{width:160,height:120,bitRate:8e4,frameRate:15,aspectRatio:"fourThree"},h180p_w240p:{width:240,height:180,bitRate:1e5,frameRate:15,aspectRatio:"fourThree"},h240p_w320p:{width:320,height:240,bitRate:15e4,frameRate:15,aspectRatio:"fourThree"},h360p_w480p:{width:480,height:360,bitRate:225e3,frameRate:20,aspectRatio:"fourThree"},h480p_w640p:{width:640,height:480,bitRate:3e5,frameRate:25,aspectRatio:"fourThree"},h540p_w720p:{width:720,height:540,bitRate:45e4,frameRate:30,aspectRatio:"fourThree"},h720p_w960p:{width:960,height:720,bitRate:15e5,frameRate:30,aspectRatio:"fourThree"},h1080p_w1440p:{width:1440,height:1080,bitRate:25e5,frameRate:30,aspectRatio:"fourThree"},h1440p_w1920p:{width:1920,height:1440,bitRate:35e5,frameRate:30,aspectRatio:"fourThree"}},screenShareProfiles:{h360p_30fps:{width:640,height:360,bitRate:2e5,frameRate:30},h720p_5fps:{width:1280,height:720,bitRate:4e5,frameRate:5},h720p_15fps:{width:1280,height:720,bitRate:1e6,frameRate:15},h1080p_15fps:{width:1920,height:1080,bitRate:15e5,frameRate:15},h1080p_30fps:{width:1920,height:1080,bitRate:1e6,frameRate:30}},simulcastProfiles:{3840:[{scaleResolutionDownBy:12,maxBitRate:15e4},{scaleResolutionDownBy:6,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:1e7}],1920:[{scaleResolutionDownBy:6,maxBitRate:15e4},{scaleResolutionDownBy:3,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:35e5}],1280:[{scaleResolutionDownBy:4,maxBitRate:15e4},{scaleResolutionDownBy:2,maxBitRate:5e5},{scaleResolutionDownBy:1,maxBitRate:12e5}],640:[{scaleResolutionDownBy:2,maxBitRate:15e4},{scaleResolutionDownBy:1,maxBitRate:5e5}],320:[{scaleResolutionDownBy:1,maxBitRate:15e4}]},requestTimeout:2e4,requestRetries:3,transportOptions:{tcp:!0},videoKSVCEncodings:[{scalabilityMode:"S3T3_KEY"}],videoSVCEncodings:[{scalabilityMode:"S3T3",dtx:!0}]}},7080:(G,C,l)=>{l.d(C,{q:()=>S,s:()=>k});var k={INVALID_API_KEY:4001,INVALID_TOKEN:4002,INVALID_MEETING_ID:4003,INVALID_PARTICIPANT_ID:4004,DUPLICATE_PARTICIPANT:4005,ACCOUNT_DEACTIVATED:4006,ACCOUNT_DISCONTINUED:4007,INVALID_PERMISSIONS:4008,MAX_PARTCIPANT_REACHED:4009,MAX_SPEAKER_REACHED:4010,START_RECORDING_FAILED:4011,STOP_RECORDING_FAILED:4012,START_LIVESTREAM_FAILED:4013,STOP_LIVESTREAM_FAILED:4014,INVALID_LIVESTREAM_CONFIG:4015,START_HLS_FAILED:4016,STOP_HLS_FAILED:4017,START_TRANSCRIPTION_FAILED:4031,STOP_TRANSCRIPTION_FAILED:4032,RECORDING_FAILED:5001,LIVESTREAM_FAILED:5002,HLS_FAILED:5003,TRANSCRIPTION_FAILED:5007,ERROR_GET_VIDEO_MEDIA:3011,ERROR_GET_AUDIO_MEDIA:3012,ERROR_GET_DISPLAY_MEDIA:3013,ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:3014,ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:3015,ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:3016,ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:3017,ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:3018,ERROR_CAMERA_PERMISSION_DENIED_BY_OS:3019,ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:3020,ERROR_CAMERA_NOT_FOUND:3021,ERROR_MICROPHONE_NOT_FOUND:3022,ERROR_CAMERA_IN_USE:3023,ERROR_MICROPHONE_IN_USE:3024,ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:3025,ERROR_VIDEO_SOURCE_INITIATION_FAILED:3026,ERROR_WEBCAM_TRACK_ENDED:3027,ERROR_MICROPHONE_TRACK_ENDED:3028,ERROR_INVALID_CUSTOM_VIDEO_TRACK:3029,ERROR_INVALID_CUSTOM_AUDIO_TRACK:3030,ERROR_CUSTOM_VIDEO_TRACK_ENDED:3031,ERROR_CUSTOM_AUDIO_TRACK_ENDED:3032,ERROR_CAMERA_ACCESS_UNAVAILABLE:3033,ERROR_MICROPHONE_ACCESS_UNAVAILABLE:3034,ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED:3035,ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED:3036,ERROR_RN_CAMERA_NOT_FOUND:3037,ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED:3038,ERROR_RN_MIC_NOT_FOUND:3039,ERROR_RN_CAMERA_ACCESS_UNAVAILABLE:3040,ERROR_RN_MIC_ACCESS_UNAVAILABLE:3041,ERROR_RN_CAMERA_TRACK_ENDED:3042,ERROR_RN_MIC_TRACK_ENDED:3043},S={ERROR_GET_VIDEO_MEDIA:{code:3011,message:"Your browser/Device does not support Video."},ERROR_GET_AUDIO_MEDIA:{code:3012,message:"Your browser/Device does not support Audio."},ERROR_GET_DISPLAY_MEDIA:{code:3013,message:"Your browser/Device does not support Screen Sharing."},ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:{code:3014,message:"Video capture permission denied."},ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED:{code:3015,message:"Audio capture permission denied."},ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED:{code:3016,message:"Screen sharing permission denied."},ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:{code:3017,message:"Oops! It seems like camera access was denied or dismissed. To proceed, kindly grant access through your browser settings."},ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:{code:3018,message:"Oops! It seems like microphone access was denied or dismissed. To proceed, kindly grant access through your browser settings."},ERROR_CAMERA_PERMISSION_DENIED_BY_OS:{code:3019,message:"Camera permission denied by OS system settings. Please check the system settings and grant permission for this browser."},ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:{code:3020,message:"Microphone permission denied by OS system settings. Please check the system settings and grant permission for this browser."},ERROR_CAMERA_NOT_FOUND:{code:3021,message:"Please ensure your camera is connected and turned on, and that the camera driver is installed and up-to-date."},ERROR_MICROPHONE_NOT_FOUND:{code:3022,message:"Please ensure your microphone is connected and turned on."},ERROR_CAMERA_IN_USE:{code:3023,message:"The camera is being used by another application. Please close any programs utilizing the camera, such as video conferencing tools, screen recording software, or other browsers. Restart your browser and attempt again."},ERROR_MICROPHONE_IN_USE:{code:3024,message:"The microphone is being used by another application. Please close any programs utilizing the microphone, such as video conferencing tools, screen recording software, or other browsers. Restart your browser and attempt again."},ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:{code:3025,message:"It seems like there's an issue with camera permission or video autoplay, you can check out this link for details: http://tinyurl.com/autoplay-issue"},ERROR_VIDEO_SOURCE_INITIATION_FAILED:{code:3026,message:"Unable to initiate video source. Please verify browser settings for video permissions."},ERROR_WEBCAM_TRACK_ENDED:{code:3027,message:"Webcam track has ended or the webcam is disconnected. Please ensure your webcam is properly connected and try restarting it."},ERROR_MICROPHONE_TRACK_ENDED:{code:3028,message:"Microphone track has ended or the microphone is disconnected. Please check your microphone connection and try again."},ERROR_INVALID_CUSTOM_VIDEO_TRACK:{code:3029,message:"The provided custom video track is invalid; reverting to the default video track. Please ensure that the video track meets the required specifications."},ERROR_INVALID_CUSTOM_AUDIO_TRACK:{code:3030,message:"The provided custom audio track is invalid; reverting to the default audio track. Please ensure that the audio track meets the required specifications."},ERROR_CUSTOM_VIDEO_TRACK_ENDED:{code:3031,message:"The provided custom video track is in an ended state. Please verify the video track's status, and try again."},ERROR_CUSTOM_AUDIO_TRACK_ENDED:{code:3032,message:"The provided custom audio track is in an ended state. Please verify the audio track's status, and try again."},ERROR_CAMERA_ACCESS_UNAVAILABLE:{code:3033,message:"Camera access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)."},ERROR_MICROPHONE_ACCESS_UNAVAILABLE:{code:3034,message:"Microphone access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)."},ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED:{code:3035,message:"Oops! Something went wrong. The room was in a connecting state, and during that time, an action encountered an issue. Please try again after joining a meeting."},ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED:{code:3036,message:"Oops! It seems like camera access was denied or dismissed. To proceed, kindly grant access through your App settings."},ERROR_RN_CAMERA_NOT_FOUND:{code:3037,message:"Please ensure your camera is connected and turned on"},ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED:{code:3038,message:"Oops! It seems like mic access was denied or dismissed. To proceed, kindly grant access through your App settings."},ERROR_RN_MIC_NOT_FOUND:{code:3039,message:"Please ensure your mic is connected and turned on"},ERROR_RN_CAMERA_ACCESS_UNAVAILABLE:{code:3040,message:"Camera access unavailable: Please ensure your device is compatible."},ERROR_RN_MIC_ACCESS_UNAVAILABLE:{code:3041,message:"Microphone access unavailable: Please ensure your device is compatible."},ERROR_RN_CAMERA_TRACK_ENDED:{code:3042,message:"Camera track has ended. Please make sure your camera is turned on or try restarting it."},ERROR_RN_MIC_TRACK_ENDED:{code:3043,message:"Microphone track has ended or the microphone is disconnected. Please check your microphone connection and try again."}}},5071:(G,C,l)=>{l.d(C,{V:()=>k});var k={HLS_STARTING:"HLS_STARTING",HLS_STARTED:"HLS_STARTED",HLS_PLAYABLE:"HLS_PLAYABLE",HLS_STOPPING:"HLS_STOPPING",HLS_STOPPED:"HLS_STOPPED"}},2107:(G,C,l)=>{l.d(C,{kR:()=>S,nI:()=>k,wZ:()=>d});var k={CONFERENCE:"CONFERENCE",VIEWER:"VIEWER",SEND_AND_RECV:"SEND_AND_RECV",SIGNALLING_ONLY:"SIGNALLING_ONLY",RECV_ONLY:"RECV_ONLY"};function S(u){return u===k.CONFERENCE||u===k.SEND_AND_RECV}function d(u){return u===k.VIEWER||u===k.SIGNALLING_ONLY}},8049:(G,C,l)=>{l.r(C),l.d(C,{default:()=>ja});var k=l(296),S=l(2284),d=l(467),u=l(3029),f=l(2901),o=l(4467),c=l(4756),e=l.n(c),g=l(9566),h=l(76),v=l(7833),_=l.n(v),b="mediasoup-demo",p=function(){return(0,f.A)(function ge(Oe){(0,u.A)(this,ge),Oe?(this._debug=_()("".concat(b,":").concat(Oe)),this._warn=_()("".concat(b,":WARN:").concat(Oe)),this._error=_()("".concat(b,":ERROR:").concat(Oe))):(this._debug=_()(b),this._warn=_()("".concat(b,":WARN")),this._error=_()("".concat(b,":ERROR"))),_().disable(),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)},[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}])}(),m=l(1396),E=m.enc.Latin1.parse("6gf9Oz5Y(6fOWPP@3XPv0Mwp51yfJ0HiZW^0*!9NdUuZ*VdKmRC@f))&^!Iriw)q"),s=m.enc.Latin1.parse("BHrabik^$W^y*HL@A*$4YKj(");function i(ge){return t.apply(this,arguments)}function t(){return(t=(0,d.A)(e().mark(function ge(Oe){var Me,rt,Lt,Bt,ir,Qt,Tt,wr,It,lr,Or,Lr,Yr;return e().wrap(function(Qr){for(;;)switch(Qr.prev=Qr.next){case 0:return Me=Oe.roomId,rt=Oe.secret,Lt=Oe.signalingBaseUrl,Bt="call-api.videosdk.live",ir=[],Qt=null,Tt={},wr={},It={},lr=null,Qr.next=10,fetch("https://".concat(Lt,"/infra/v1/meetings/init-config"),{method:"POST",headers:{Authorization:rt,"Content-Type":"application/json"},body:JSON.stringify({roomId:Me})}).then(function(Mn){return Mn.json()}).catch(function(Mn){return{}});case 10:return Or=Qr.sent,(Lr=Or.data)&&(Bt=Lr.baseUrl,Yr=Lr.observability,ir=n(Lr.iceServers),Qt=Yr.jwt,Tt=Yr.traces,wr=Yr.logs,It=Yr.metaData,lr=Lr.signalingUrl),Qr.abrupt("return",{baseUrl:Bt,iceServers:ir,observabilityJwt:Qt,traces:Tt,logs:wr,metaData:It,signalingUrl:lr});case 14:case"end":return Qr.stop()}},ge)}))).apply(this,arguments)}function n(ge){try{var Oe=m.AES.decrypt(ge,E,{iv:s,mode:m.mode.CBC,padding:m.pad.ZeroPadding}).toString(m.enc.Utf8);return JSON.parse(Oe)}catch{return[]}}var r=l(2215),a=l.n(r),y="mediasoup-demo.user",P="mediasoup-demo.devices";function O(ge){var Oe=ge.displayName;a().set(y,{displayName:Oe})}function M(){return a().getJSON(P)}var j=l(2211),B=l.n(j),Q=function(ge){return{type:"SET_ROOM_STATE",payload:{state:ge}}},re=function(ge){return{type:"SET_ROOM_ACTIVE_SPEAKER",payload:{peerId:ge}}},oe=function(ge){return{type:"SET_ROOM_STATS_PEER_ID",payload:{peerId:ge}}},le=function(ge){return{type:"SET_MEDIA_CAPABILITIES",payload:{canSendMic:ge.canSendMic,canSendWebcam:ge.canSendWebcam}}},ve=function(ge){return{type:"SET_DISPLAY_NAME",payload:{displayName:ge}}},ke=function(ge){return{type:"SET_AUDIO_ONLY_STATE",payload:{enabled:ge}}},ce=function(ge){return{type:"SET_AUDIO_ONLY_IN_PROGRESS",payload:{flag:ge}}},te=function(ge){return{type:"SET_AUDIO_MUTED_STATE",payload:{enabled:ge}}},ue=function(ge){return{type:"SET_RESTART_ICE_IN_PROGRESS",payload:{flag:ge}}},pe=function(ge){return{type:"ADD_PRODUCER",payload:{producer:ge}}},he=function(ge){return{type:"REMOVE_PRODUCER",payload:{producerId:ge}}},Ze=function(ge,Oe){return{type:"SET_PRODUCER_TRACK",payload:{producerId:ge,track:Oe}}},Ot=function(ge,Oe){return{type:"SET_PRODUCER_SCORE",payload:{producerId:ge,score:Oe}}},Ht=function(ge){return{type:"ADD_DATA_PRODUCER",payload:{dataProducer:ge}}},st=function(ge){return{type:"SET_WEBCAM_IN_PROGRESS",payload:{flag:ge}}},_r=function(ge){return{type:"SET_SHARE_IN_PROGRESS",payload:{flag:ge}}},jt=function(ge){return{type:"ADD_PEER",payload:{peer:ge}}},_t=function(ge){return{type:"REMOVE_PEER",payload:{peerId:ge}}},vr=function(ge,Oe){return{type:"SET_PEER_DISPLAY_NAME",payload:{displayName:ge,peerId:Oe}}},ft=function(ge,Oe){return{type:"ADD_CONSUMER",payload:{consumer:ge,peerId:Oe}}},xt=function(ge,Oe){return{type:"REMOVE_CONSUMER",payload:{consumerId:ge,peerId:Oe}}},$r=function(ge,Oe){return{type:"SET_CONSUMER_PAUSED",payload:{consumerId:ge,originator:Oe}}},cr=function(ge,Oe){return{type:"SET_CONSUMER_RESUMED",payload:{consumerId:ge,originator:Oe}}},yr=function(ge,Oe,Me){return{type:"SET_CONSUMER_CURRENT_LAYERS",payload:{consumerId:ge,spatialLayer:Oe,temporalLayer:Me}}},Jr=function(ge,Oe,Me){return{type:"SET_CONSUMER_PREFERRED_LAYERS",payload:{consumerId:ge,spatialLayer:Oe,temporalLayer:Me}}},Gt=function(ge,Oe){return{type:"SET_CONSUMER_PRIORITY",payload:{consumerId:ge,priority:Oe}}},Ke=function(ge,Oe){return{type:"SET_CONSUMER_SCORE",payload:{consumerId:ge,score:Oe}}},Ct=function(ge,Oe){return{type:"ADD_DATA_CONSUMER",payload:{dataConsumer:ge,peerId:Oe}}},dr=function(ge,Oe){return{type:"REMOVE_DATA_CONSUMER",payload:{dataConsumerId:ge,peerId:Oe}}},xe=function(ge){var Oe=ge.type,Me=Oe===void 0?"info":Oe,rt=ge.text,Lt=ge.title,Bt=ge.timeout;if(!Bt)switch(Me){case"info":Bt=3e3;break;case"error":Bt=5e3}var ir={id:B()({length:6}).toLowerCase(),type:Me,title:Lt,text:rt,timeout:Bt};return function(Qt){Qt(function(Tt){return{type:"ADD_NOTIFICATION",payload:{notification:Tt}}}(ir)),setTimeout(function(){Qt({type:"REMOVE_NOTIFICATION",payload:{notificationId:ir.id}})},Bt)}},Ye=l(7007),zt=l(9027);function pt(ge,Oe){var Me=Object.keys(ge);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(ge);Oe&&(rt=rt.filter(function(Lt){return Object.getOwnPropertyDescriptor(ge,Lt).enumerable})),Me.push.apply(Me,rt)}return Me}var rr={},jr={},Hr={};for(var vt in zt.$.videoProfiles)zt.$.videoProfiles[vt].aspectRatio=="oneSixNine"&&(rr[vt]=zt.$.videoProfiles[vt],rr[vt].encoding={maxBitrate:rr[vt].bitRate,maxFramerate:rr[vt].frameRate}),zt.$.videoProfiles[vt].aspectRatio=="fourThree"&&(jr[vt]=zt.$.videoProfiles[vt],jr[vt].encoding={maxBitrate:jr[vt].bitRate,maxFramerate:jr[vt].frameRate});for(var vt in zt.$.screenShareProfiles)Hr[vt]=zt.$.screenShareProfiles[vt],Hr[vt].encoding={maxBitrate:Hr[vt].bitRate,maxFramerate:Hr[vt].frameRate};var zn=Object.values(rr),oa=Object.values(jr),ca=[rr.h180p_w320p,rr.h360p_w640p],pn=[jr.h180p_w240p,jr.h360p_w480p],ba=["q","h","f"];function wt(ge,Oe,Me,rt,Lt){var Bt=rt&&rt.videoEncoding,ir=rt==null?void 0:rt.simulcast;if(Bt||(Bt=function(Lr,Yr,Qr){for(var Mn=function(ma,aa,wa){var Ea=aa>wa?aa/wa:wa/aa;return Math.abs(Ea-1.7777777777777777)<Math.abs(Ea-1.3333333333333333)?zn:oa}(Lr,Yr,Qr),An=Mn[0].encoding,Vn=Math.max(Yr,Qr),$n=0;$n<Mn.length;$n+=1){var da=Mn[$n];if(An=da.encoding,da.width>=Vn)break}return An}(ge,Oe,Me)),!ir)return[Bt];var Qt,Tt={width:Oe,height:Me,encoding:{maxBitrate:Bt.maxBitrate,maxFramerate:Bt.maxFramerate}},wr=[],It=(wr=je(ge,Tt))[0];if(wr.length>1){var lr=wr;Qt=(0,k.A)(lr,2)[1]}var Or=Math.max(Oe,Me);return Qe(Oe,Me,Or>=960&&Qt?[It,Qt,Tt]:Or>=480?[It,Tt]:[Tt],Lt)}function je(ge,Oe){var Me=Oe.width,rt=Oe.height,Lt=Me>rt?Me/rt:rt/Me;return Math.abs(Lt-1.7777777777777777)<Math.abs(Lt-1.3333333333333333)?ca:pn}function Qe(ge,Oe,Me,rt){var Lt=[];return Me.forEach(function(Bt,ir){if(!(ir>=ba.length)){var Qt=rt?null:{maxFramerate:Bt.encoding.maxFramerate},Tt=Math.min(ge,Oe),wr=function(It){for(var lr=1;lr<arguments.length;lr++){var Or=arguments[lr]!=null?arguments[lr]:{};lr%2?pt(Object(Or),!0).forEach(function(Lr){(0,o.A)(It,Lr,Or[Lr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(It,Object.getOwnPropertyDescriptors(Or)):pt(Object(Or)).forEach(function(Lr){Object.defineProperty(It,Lr,Object.getOwnPropertyDescriptor(Or,Lr))})}return It}({rid:ba[ir],scaleResolutionDownBy:Tt/Math.min(Bt.width,Bt.height),maxBitrate:Bt.encoding.maxBitrate},Qt);Lt.push(wr)}}),Lt}function Ve(ge,Oe,Me){if(!ge)return{};var rt=ge.id,Lt=(ge.preferredSpatialLayer,ge.preferredTemporalLayer,ge.appData),Bt=Lt.width,ir=Lt.height,Qt=Lt.encodings;try{var Tt=function(An){var Vn=[];if(An&&An.length!=0){if(An.length===1){for(var $n=0;$n<3;$n++)Vn.push(Math.pow(2,3-$n-1));return Vn}var da=!1;return An.forEach(function(ma){ma.scaleResolutionDownBy!==void 0?(da=!0,Vn.push(Math.max(1,ma.scaleResolutionDownBy))):Vn.push(1)}),da||An.forEach(function(ma,aa){Vn[aa]=Math.pow(2,An.length-aa-1)}),Vn}}(Qt);if(!Tt)return{};for(var wr=Math.min(Math.max(zt.$.adaptiveScalingFactor||.75,.5),1),It=0,lr=0;lr<Tt.length;lr++){var Or=wr*Bt/Tt[lr],Lr=wr*ir/Tt[lr];if(!(Oe>=Or&&Me>=Lr))break;It=lr}var Yr=(ge.temporalLayers?ge.temporalLayers:3)-1;if(It===0&&Yr>0){var Qr=Bt/Tt[0],Mn=ir/Tt[0];Oe<.5*Qr&&Me<.5*Mn&&(Yr-=1),Yr>0&&Oe<.25*Qr&&Me<.25*Mn&&(Yr-=1)}return{consumerId:rt,newPreferredSpatialLayer:It,newPreferredTemporalLayer:Yr}}catch{return{}}}var Ce=l(7080),ur="CONNECTING",we="CONNECTED",er="RECONNECTING",fr="DISCONNECTED",br=l(5414),gr=l(2107),tn=l(5071),Ie=l(5458),yt=Array(32);function gt(){for(var ge=0;ge<16;ge++)yt[ge]=Math.floor(16*Math.random())+48,yt[ge]>=58&&(yt[ge]+=39);return String.fromCharCode.apply(null,yt.slice(0,16))}function ht(){var ge=(1e6*new Date().getTime()).toString().padEnd(19,"0");return Number(ge)}function Pr(ge,Oe){var Me=Object.keys(ge);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(ge);Oe&&(rt=rt.filter(function(Lt){return Object.getOwnPropertyDescriptor(ge,Lt).enumerable})),Me.push.apply(Me,rt)}return Me}function Cr(ge){for(var Oe=1;Oe<arguments.length;Oe++){var Me=arguments[Oe]!=null?arguments[Oe]:{};Oe%2?Pr(Object(Me),!0).forEach(function(rt){(0,o.A)(ge,rt,Me[rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ge,Object.getOwnPropertyDescriptors(Me)):Pr(Object(Me)).forEach(function(rt){Object.defineProperty(ge,rt,Object.getOwnPropertyDescriptor(Me,rt))})}return ge}var Ar=function(){return(0,f.A)(function ge(Oe){var Me=this,rt=Oe.roomId,Lt=Oe.peerId,Bt=Oe.sdkName,ir=Oe.observabilityJwt,Qt=Oe.metaData,Tt=Oe.traces;(0,u.A)(this,ge),this._traceId=function(){for(var It=0;It<32;It++)yt[It]=Math.floor(16*Math.random())+48,yt[It]>=58&&(yt[It]+=39);return String.fromCharCode.apply(null,yt.slice(0,32))}(),this._rootSpanId=gt(),this._observabilityJwt=ir,this._tracesEnabled=Tt.enabled,this._tracesEndpoint=Tt.endPoint;var wr=function(It){for(var lr="0123456789abcdefghijklmnopqrstuvwxyz",Or="",Lr=It;Lr>0;Lr--)Or+=lr[Math.floor(36*Math.random())];return Or}(8);this._spans=[],this._traceJSON={resourceSpans:[{resource:{attributes:[{key:"service.name",value:{stringValue:"videosdk-otel"}},{key:"telemetry.sdk.language",value:{stringValue:"webjs"}},{key:"telemetry.sdk.name",value:{stringValue:"opentelemetry"}},{key:"telemetry.sdk.version",value:{stringValue:"1.14.0"}},{key:"sdk-version",value:{stringValue:"0.0.1"}}],droppedAttributesCount:0},scopeSpans:[{scope:{name:wr},spans:[]}]}]},this._tracesEnabled&&(this.addRootSpan(rt,Lt,Bt,Qt),setInterval(function(){Me.processQueue()},4e3))},[{key:"addRootSpan",value:function(ge,Oe,Me,rt){var Lt={traceId:this._traceId,spanId:this._rootSpanId,name:"room_".concat(ge,"_peer_").concat(Oe,"_sdk_").concat(Me),kind:1,startTimeUnixNano:ht(),endTimeUnixNano:ht(),attributes:[{key:"roomId",value:{stringValue:ge}},{key:"peerId",value:{stringValue:Oe}},{key:"sdkName",value:{stringValue:Me}},{key:"userId",value:{stringValue:rt.userId}},{key:"email",value:{stringValue:rt.email}}],droppedAttributesCount:0,events:[],droppedEventsCount:0,status:{code:0},links:[],droppedLinksCount:0};this._spans.push(Lt)}},{key:"addSpanToTrace",value:function(ge){this._spans.push(ge)}},{key:"trace",value:function(ge){var Oe=ge.spanName,Me=ge.attributes,rt=Me===void 0?{}:Me,Lt=ge.span,Bt=Lt===void 0?void 0:Lt;if(this._tracesEnabled){var ir=gt(),Qt=ht(),Tt={traceId:this._traceId,spanId:ir,parentSpanId:Bt||this._rootSpanId,name:Oe,kind:1,startTimeUnixNano:Qt,droppedAttributesCount:0,events:[],droppedEventsCount:0,links:[],droppedLinksCount:0};return Object.keys(rt).length>0&&(Tt.attributes=Object.entries(rt).map(function(wr){var It=(0,k.A)(wr,2);return{key:It[0],value:{stringValue:It[1]}}})),this.addSpanToTrace(Tt),ir}}},{key:"traceAutoComplete",value:function(ge){var Oe=ge.spanName,Me=ge.attributes,rt=Me===void 0?{}:Me,Lt=ge.status,Bt=Lt===void 0?1:Lt,ir=ge.span,Qt=ir===void 0?void 0:ir,Tt=ge.message,wr=Tt===void 0?"SUCCESS":Tt;if(this._tracesEnabled){var It=gt(),lr=ht(),Or=ht(),Lr={traceId:this._traceId,spanId:It,parentSpanId:Qt||this._rootSpanId,name:Oe,kind:1,startTimeUnixNano:lr,endTimeUnixNano:Or,droppedAttributesCount:0,events:[],droppedEventsCount:0,links:[],droppedLinksCount:0,status:{code:Bt,message:wr}};Object.keys(rt).length>0&&(Lr.attributes=Object.entries(rt).map(function(Yr){var Qr=(0,k.A)(Yr,2);return{key:Qr[0],value:{stringValue:Qr[1]}}})),this.addSpanToTrace(Lr)}}},{key:"completeSpan",value:function(ge){var Oe=ge.span,Me=ge.status,rt=ge.message,Lt=ge.attributes,Bt=Lt===void 0?{}:Lt;if(this._tracesEnabled){var ir=ht();this._spans=this._spans.map(function(Qt){if(Qt.spanId!==Oe)return Qt;var Tt=Object.entries(Bt).map(function(wr){var It=(0,k.A)(wr,2);return{key:It[0],value:{stringValue:It[1]}}});return Qt.attributes=Qt.attributes?[].concat((0,Ie.A)(Qt.attributes),(0,Ie.A)(Tt)):Tt,Cr(Cr({},Qt),{},{status:{code:Me,message:rt},endTimeUnixNano:ir})})}}},{key:"processQueue",value:function(){var ge=this;if(this._spans.length>0){this._traceJSON.resourceSpans[0].scopeSpans[0].spans=this._spans,this._spans=[];var Oe={method:"POST",headers:{Authorization:this._observabilityJwt,"Content-Type":"application/json"},body:JSON.stringify(this._traceJSON)};fetch(this._tracesEndpoint,Oe).then(function(){var Me=(0,d.A)(e().mark(function rt(Lt){return e().wrap(function(Bt){for(;;)switch(Bt.prev=Bt.next){case 0:return ge._traceJSON.resourceSpans[0].scopeSpans[0].spans=[],Bt.next=3,Lt.text();case 3:return Bt.abrupt("return",Bt.sent);case 4:case"end":return Bt.stop()}},rt)}));return function(rt){return Me.apply(this,arguments)}}()).then(function(Me){}).catch(function(Me){ge._spans=ge._traceJSON.resourceSpans[0].scopeSpans[0].spans,console.error("There was a problem with the POST request:",Me)})}}}])}();function Yt(ge,Oe){var Me=Object.keys(ge);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(ge);Oe&&(rt=rt.filter(function(Lt){return Object.getOwnPropertyDescriptor(ge,Lt).enumerable})),Me.push.apply(Me,rt)}return Me}function ar(ge){for(var Oe=1;Oe<arguments.length;Oe++){var Me=arguments[Oe]!=null?arguments[Oe]:{};Oe%2?Yt(Object(Me),!0).forEach(function(rt){(0,o.A)(ge,rt,Me[rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ge,Object.getOwnPropertyDescriptors(Me)):Yt(Object(Me)).forEach(function(rt){Object.defineProperty(ge,rt,Object.getOwnPropertyDescriptor(Me,rt))})}return ge}var Tr=function(){return(0,f.A)(function Oe(Me){var rt=Me.roomId,Lt=Me.peerId,Bt=Me.logs,ir=Me.observabilityJwt,Qt=Me.deviceInfo,Tt=Me.sessionId,wr=Me.debugMode;(0,u.A)(this,Oe);var It=Qt.browserUserAgent,lr=Qt.deviceUserAgent,Or=Qt.platform;this._peerId=Lt,this._roomId=rt,this._logs=Bt,this._observabilityJwt=ir,this._deviceInfo=Qt,this._sessionId=Tt,this._debugMode=wr,this.browserOrDeviceInfo=It?{browserName:It.browser.name,browserVersion:It.browser.version,osName:It.os.name,osVersion:It.os.version,platform:Or}:lr?ar({platform:Or},lr):null},[{key:"pushLogs",value:(ge=(0,d.A)(e().mark(function Oe(Me){var rt,Lt,Bt,ir,Qt,Tt,wr,It;return e().wrap(function(lr){for(;;)switch(lr.prev=lr.next){case 0:if(rt=Me.logType,Lt=Me.logText,Bt=Me.attributes,ir=Me.dashboardLog,Qt=ir!==void 0&&ir,Tt=this._logs,wr=Tt.enabled,It=Tt.endPoint,!wr){lr.next=8;break}return lr.next=5,fetch(It,{method:"POST",headers:{Authorization:this._observabilityJwt,"Content-Type":"application/json"},body:JSON.stringify({logType:rt,logText:Lt,attributes:ar(ar({},Bt),{},{roomId:this._roomId,peerId:this._peerId,SDK:"".concat(this._deviceInfo.sdkType,"-sdk"),SDK_VERSION:this._deviceInfo.sdkVersion,sessionId:this._sessionId},this.browserOrDeviceInfo),debugMode:this._debugMode,dashboardLog:Qt})}).then(function(Or){return Or.json()}).catch(function(Or){return console.log("error",Or),{}});case 5:return lr.abrupt("return",lr.sent);case 8:return lr.abrupt("return",null);case 9:case"end":return lr.stop()}},Oe,this)})),function(Oe){return ge.apply(this,arguments)})}]);var ge}(),kn=l(4973);function rn(ge,Oe){var Me=typeof Symbol<"u"&&ge[Symbol.iterator]||ge["@@iterator"];if(!Me){if(Array.isArray(ge)||(Me=function(Tt,wr){if(Tt){if(typeof Tt=="string")return na(Tt,wr);var It={}.toString.call(Tt).slice(8,-1);return It==="Object"&&Tt.constructor&&(It=Tt.constructor.name),It==="Map"||It==="Set"?Array.from(Tt):It==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(It)?na(Tt,wr):void 0}}(ge))||Oe){Me&&(ge=Me);var rt=0,Lt=function(){};return{s:Lt,n:function(){return rt>=ge.length?{done:!0}:{done:!1,value:ge[rt++]}},e:function(Tt){throw Tt},f:Lt}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Bt,ir=!0,Qt=!1;return{s:function(){Me=Me.call(ge)},n:function(){var Tt=Me.next();return ir=Tt.done,Tt},e:function(Tt){Qt=!0,Bt=Tt},f:function(){try{ir||Me.return==null||Me.return()}finally{if(Qt)throw Bt}}}}function na(ge,Oe){(Oe==null||Oe>ge.length)&&(Oe=ge.length);for(var Me=0,rt=Array(Oe);Me<Oe;Me++)rt[Me]=ge[Me];return rt}function Aa(ge,Oe){var Me=Object.keys(ge);if(Object.getOwnPropertySymbols){var rt=Object.getOwnPropertySymbols(ge);Oe&&(rt=rt.filter(function(Lt){return Object.getOwnPropertyDescriptor(ge,Lt).enumerable})),Me.push.apply(Me,rt)}return Me}function Gr(ge){for(var Oe=1;Oe<arguments.length;Oe++){var Me=arguments[Oe]!=null?arguments[Oe]:{};Oe%2?Aa(Object(Me),!0).forEach(function(rt){(0,o.A)(ge,rt,Me[rt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ge,Object.getOwnPropertyDescriptors(Me)):Aa(Object(Me)).forEach(function(rt){Object.defineProperty(ge,rt,Object.getOwnPropertyDescriptor(Me,rt))})}return ge}var Pe,La={sd:{low:{s:0,t:2},med:{s:0,t:2},high:{s:1,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}},hd:{low:{s:0,t:2},med:{s:1,t:2},high:{s:2,t:2},s0t0:{s:0,t:0},s0t1:{s:0,t:1},s0t2:{s:0,t:2},s1t0:{s:1,t:0},s1t1:{s:1,t:1},s1t2:{s:1,t:2},s2t0:{s:2,t:0},s2t1:{s:2,t:1},s2t2:{s:2,t:2}}},Da={qvga:{width:{ideal:320},height:{ideal:240}},vga:{width:{ideal:640},height:{ideal:480}},sd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}},hd:{width:{ideal:1280},height:{ideal:720},frameRate:{ideal:24}}},Ua={sd:[{scaleResolutionDownBy:6},{scaleResolutionDownBy:4},{scaleResolutionDownBy:2}],hd:[{scaleResolutionDownBy:4},{scaleResolutionDownBy:2},{scaleResolutionDownBy:1}]},Na=[{scalabilityMode:"S3T3_KEY"}],gs=[{dtx:!0,maxFramerate:30}],ss=[{scalabilityMode:"S3T3",dtx:!0}],Se=new p("RoomClient"),ja=function(){return(0,f.A)(function V(D){var x,I,A=D.roomId,K=D.peerId,X=D.secret,Re=D.displayName,me=D.device,it=D.handlerName,Ue=D.useSimulcast,et=D.useSharingSimulcast,Z=D.forceTcp,Xe=D.mode,Le=D.forceH264,Ge=D.forceVP9,de=D.svc,Ne=D.datachannel,Mt=D.externalVideo,Ut=D.micEnabled,ut=D.webcamEnabled,Vt=D.maxResolution,Nt=D.useSpartialLayerAnalytics,Kt=D._deviceInfo,At=D.customCameraVideoTrack,Et=D.customMicrophoneAudioTrack,Sr=D.autoConsume,qt=D.preferredProtocol,Xt=D.signalingBaseUrl,Ir=D.metaData,on=D.defaultCameraIndex,nn=D.debugMode;switch((0,u.A)(this,V),(0,o.A)(this,"delay",function(hr){return new Promise(function(Xr){return setTimeout(Xr,hr)})}),Se.debug('constructor() [roomId:"%s", peerId:"%s", displayName:"%s", device:%s]',A,K,Re,me.flag),this.useSpartialLayerAnalytics=Nt||!1,this._deviceInfo=Kt,this._eventEmitter=new Ye.EventEmitter,this._closed=!1,this._displayName=Re,this._device=me,this._forceTcp=Z,this._preferredProtocol=qt,Xe){case gr.nI.CONFERENCE:case gr.nI.SEND_AND_RECV:x=!0,I=!0;break;case gr.nI.RECV_ONLY:x=!1,I=!0;break;default:x=!1,I=!1}this._mode=Xe,this._produce=x,this._consume=I,this._useDataChannel=Ne,this._forceH264=!!Le,this._forceVP9=!!Ge,this._micEnabled=!!Ut,this._webcamEnabled=!!ut,this._externalVideo=null,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,Mt&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=Mt,this._externalVideo.play().catch(function(hr){return Se.warn("externalVideo.play() failed:%o",hr)})),this._handlerName=it,this._useSimulcast=Ue,this._useSharingSimulcast=et,this._protooUrl="",this._secret=X,this._peerId=K,this._roomId=A,this._baseUrl="",this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._shareAudioProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._mics=new Map,this._mic={device:null},this._webcams=new Map,this._webcam={device:null,resolution:Vt||"hd"},this._pinnedParticipants=new Map,de&&(Na[0].scalabilityMode="".concat(de,"_KEY"),ss[0].scalabilityMode=de),this.customCameraVideoTrack=At,this.customMicrophoneAudioTrack=Et,this._autoConsume=Sr,this._iceServers=[],this._metrics=new br.VideoSDKMetrics({refreshEvery:1e3,startAfter:1e3,verbose:!1}),this._stats={},this._latestStats={},this._isWebsocketAlive=!1,this._pingWebsocketInterval=null,this._pingInternetInterval=null,this._pingWebsocketFailedCounter=0,this._pongInternetCounter=0,this._transportState="",this._openTelemetry=null,this._videosdkLogs=null,this._signalingBaseUrl=Xt||"api.videosdk.live",this._metaData=Ir,this._defaultCameraIndex=on,this._debugMode=!!nn,this._meetingConnectionState=null},[{key:"on",value:function(V,D){this._eventEmitter.on(V,D)}},{key:"close",value:function(V){var D,x,I,A,K,X=V.sendLeft,Re=X===void 0||X;if(Re&&((K=this._openTelemetry)===null||K===void 0||K.traceAutoComplete({spanName:"Meeting is in CLOSING State",status:1})),!this._closed){this._closed=!0,this._pingWebsocketInterval&&clearInterval(this._pingWebsocketInterval),this._pingWebsocketInterval=null,this._pingInternetInterval&&clearInterval(this._pingInternetInterval),this._pingInternetInterval=null,this._protoo.close(),this._metrics.running&&this._metrics.stopAllProbes(),Se.debug("close()");var me=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"Closing Trasnport"});this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close(),(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:me,status:1,message:"Closed Trasnport"}),Pe.dispatch(Q("closed")),Re&&this.emitMeetingStateChange(fr),(I=this._openTelemetry)===null||I===void 0||I.traceAutoComplete({spanName:"Meeting is in CLOSED State",status:1}),Re&&this._eventEmitter.emit("MEETING_LEFT"),(A=this._openTelemetry)===null||A===void 0||A.traceAutoComplete({spanName:"Emitted MEETING_LEFT Event",status:1})}}},{key:"join",value:(ls=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z=this;return e().wrap(function(Xe){for(;;)switch(Xe.prev=Xe.next){case 0:return Xe.next=2,i({roomId:this._roomId,secret:this._secret,signalingBaseUrl:this._signalingBaseUrl});case 2:I=Xe.sent,A=I.baseUrl,K=I.iceServers,X=I.logs,Re=I.observabilityJwt,me=I.traces,it=I.metaData,Ue=I.signalingUrl,this._baseUrl=A,this._protooUrl="".concat(Ue||"wss://".concat(this._baseUrl),"/?roomId=").concat(this._roomId,"&peerId=").concat(this._peerId,"&secret=").concat(this._secret,"&mode=").concat(this._mode),this._iceServers=K,this._tracesEnabled=me.enabled,this._openTelemetry=new Ar((0,o.A)({roomId:this._roomId,peerId:this._peerId,sdkName:"".concat(this._deviceInfo.sdkType,"-sdk"),traces:me,logs:X,observabilityJwt:Re,metaData:it},"traces",me)),this._joinSpan=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"Join() Calling",attributes:{DeviceInfo:JSON.stringify(this._deviceInfo),mode:this._mode,displayName:this._displayName,multiStream:this._useSimulcast,micEnabled:this._micEnabled,webcamEnabled:this._webcamEnabled,CustomVideoTrack:!!this.customCameraVideoTrack,CustomMicTrack:!!this.customMicrophoneAudioTrack,signalingUrl:Ue||"signalingUrl not specify"}}),et=new g.TJ(this._protooUrl),this._protoo=new g.xM(et),this.emitMeetingStateChange(ur),Pe.dispatch(Q("connecting")),(x=this._openTelemetry)===null||x===void 0||x.traceAutoComplete({spanName:"Meeting is in CONNECTING State",span:this._joinSpan,status:1}),this._protoo.on("open",function(){var Le;Z._isWebsocketAlive=!0,Z._closed=!1,Z.startPingPong(),Z._mode===(gr.nI.RECV_ONLY||gr.nI.SIGNALLING_ONLY)&&Z.emitMeetingStateChange(we),(Le=Z._openTelemetry)===null||Le===void 0||Le.traceAutoComplete({spanName:"Meeting is in CONNECTED State",span:Z._joinSpan,status:1}),Z.requestEntry()}),this._protoo.on("failed",function(){var Le;Z.emitMeetingStateChange(fr),(Le=Z._openTelemetry)===null||Le===void 0||Le.traceAutoComplete({spanName:"Meeting is in FAILED State",span:Z._joinSpan,status:2}),Pe.dispatch(xe({type:"error",text:"WebSocket connection failed"}))}),this._protoo.on("disconnected",function(){var Le;Z.emitMeetingStateChange(fr),(Le=Z._openTelemetry)===null||Le===void 0||Le.traceAutoComplete({spanName:"Meeting is in DISCONNECTED State",span:Z._joinSpan,status:1}),Pe.dispatch(xe({type:"error",text:"WebSocket disconnected"})),Z._sendTransport&&(Z._sendTransport.close(),Z._sendTransport=null),Z._recvTransport&&(Z._recvTransport.close(),Z._recvTransport=null),Pe.dispatch(Q("closed"))}),this._protoo.on("close",function(){Z._closed||Z.close({sendLeft:!0})}),this._protoo.on("request",function(){var Le=(0,d.A)(e().mark(function Ge(de,Ne,Mt){var Ut,ut,Vt,Nt,Kt,At,Et,Sr,qt,Xt,Ir,on,nn,hr,Xr,mn,vn,fn,sr,Zr,Rt,Wr,mt,Zt,xr,Vr,Br,Mr,Nn,Zn,jn,yn,Bn,la,Yn,Nr,ea,en,Tn,On,gn,Dn,Fn,bn,xn,wn,Kr,cn,an,dn,Rr,Un,Er,mr,qe,We,or,Dr,_n,un,fa,Fa;return e().wrap(function(dt){for(;;)switch(dt.prev=dt.next){case 0:Se.debug('proto "request" event [method:%s, data:%o]',de.method,de.data),dt.t0=de.method,dt.next=dt.t0==="close"?4:dt.t0==="newConsumer"?7:dt.t0==="newDataConsumer"?45:dt.t0==="enableMic"?72:dt.t0==="disableMic"?74:dt.t0==="enableWebcam"?88:dt.t0==="disableWebcam"?90:dt.t0==="pinStateChanged"?104:dt.t0==="switchRoom"?124:dt.t0==="statsData"?127:130;break;case 4:return Ne(),Z.close({sendLeft:!0}),dt.abrupt("break",130);case 7:if(Vt=(Ut=Z._openTelemetry)===null||Ut===void 0?void 0:Ut.trace({spanName:"Protoo REQ: newConsumer",attributes:{request:JSON.stringify(de)}}),Z._consume){dt.next=12;break}return Mt(403,"I do not want to consume"),(Nt=Z._openTelemetry)===null||Nt===void 0||Nt.completeSpan({span:Vt,status:2,message:"I do not want to consume"}),dt.abrupt("break",130);case 12:return Kt=de.data,At=Kt.peerId,Et=Kt.producerId,Sr=Kt.id,qt=Kt.kind,Xt=Kt.rtpParameters,Ir=Kt.type,on=Kt.appData,nn=Kt.producerPaused,hr=(ut=Z._openTelemetry)===null||ut===void 0?void 0:ut.trace({spanName:"Creating Consumer",span:Vt}),dt.prev=14,dt.next=17,Z._recvTransport.consume({id:Sr,producerId:Et,kind:qt,rtpParameters:Xt,appData:Gr(Gr({},on),{},{peerId:At})});case 17:sr=dt.sent,Zr=h.parseScalabilityMode(sr.rtpParameters.encodings[0].scalabilityMode),Rt=Zr.spatialLayers,Wr=Zr.temporalLayers,sr.spatialLayers=Rt,sr.temporalLayers=Wr,sr.currentSpatialLayers=Rt-1,sr.currentTemporalLayers=Wr-1,Z._consumers.set(sr.id,sr),sr.on("transportclose",function(){Z._consumers.delete(sr.id);var Fr=xt(sr.id,At);Pe.dispatch(Fr),Z._eventEmitter.emit(Fr.type,Fr.payload)}),(Xr=Z._openTelemetry)===null||Xr===void 0||Xr.completeSpan({span:hr,status:1,message:"Consumer Created"}),hr=(mn=Z._openTelemetry)===null||mn===void 0?void 0:mn.trace({spanName:"Sending Stream Enabled Event",span:Vt}),mt=ft({id:sr.id,type:Ir,locallyPaused:!1,remotelyPaused:nn,rtpParameters:sr.rtpParameters,spatialLayers:Rt,temporalLayers:Wr,currentSpatialLayer:Rt-1,currentTemporalLayer:Wr-1,preferredSpatialLayer:Rt-1,preferredTemporalLayer:Wr-1,priority:1,codec:sr.rtpParameters.codecs[0].mimeType.split("/")[1],track:sr.track,appData:on,instance:sr},At),Pe.dispatch(mt),Z._eventEmitter.emit(mt.type,mt.payload),Ne(),sr.kind==="video"&&Pe.getState().me.audioOnly&&Z._pauseConsumer(sr),(vn=Z._openTelemetry)===null||vn===void 0||vn.completeSpan({span:hr,status:1,message:"Event Send Successfully"}),(fn=Z._openTelemetry)===null||fn===void 0||fn.completeSpan({span:Vt,status:1,message:"New Consumer Created Successfully",attributes:{"consumer.consumerId":sr.id}}),sr.kind=="video"&&sr.appData.share&&((Zt=Z._openTelemetry)===null||Zt===void 0||Zt.traceAutoComplete({spanName:"Presenter Changed",span:Vt,attributes:{"peer.id":At}})),dt.next=44;break;case 37:throw dt.prev=37,dt.t1=dt.catch(14),(xr=Z._openTelemetry)===null||xr===void 0||xr.completeSpan({span:hr,status:2,message:"Error creating a Consumer: ".concat(dt.t1)}),(Vr=Z._openTelemetry)===null||Vr===void 0||Vr.completeSpan({span:Vt,status:2,message:"Error creating a Consumer: ".concat(dt.t1)}),Pe.dispatch(xe({type:"error",text:"Error creating a Consumer: ".concat(dt.t1)})),(Br=Z._videosdkLogs)===null||Br===void 0||Br.pushLogs({logText:"Error creating a Consumer",logType:"ERROR",attributes:{error:dt.t1.message}}),dt.t1;case 44:return dt.abrupt("break",130);case 45:if(Z._consume){dt.next=48;break}return Mt(403,"I do not want to data consume"),dt.abrupt("break",130);case 48:if(Z._useDataChannel){dt.next=51;break}return Mt(403,"I do not want DataChannels"),dt.abrupt("break",130);case 51:return Mr=de.data,Nn=Mr.peerId,Zn=Mr.dataProducerId,jn=Mr.id,yn=Mr.sctpStreamParameters,Bn=Mr.label,la=Mr.protocol,Yn=Mr.appData,dt.prev=52,dt.next=55,Z._recvTransport.consumeData({id:jn,dataProducerId:Zn,sctpStreamParameters:yn,label:Bn,protocol:la,appData:Gr(Gr({},Yn),{},{peerId:Nn})});case 55:Nr=dt.sent,Z._dataConsumers.set(Nr.id,Nr),Nr.on("transportclose",function(){Z._dataConsumers.delete(Nr.id)}),Nr.on("open",function(){Se.debug('DataConsumer "open" event')}),Nr.on("close",function(){Se.warn('DataConsumer "close" event'),Z._dataConsumers.delete(Nr.id),Pe.dispatch(xe({type:"error",text:"DataConsumer closed"}))}),Nr.on("error",function(Fr){Se.error('DataConsumer "error" event:%o',Fr),Pe.dispatch(xe({type:"error",text:"DataConsumer error: ".concat(Fr)}))}),Nr.on("message",function(Fr){if(Se.debug('DataConsumer "message" event [streamId:%d]',Nr.sctpStreamParameters.streamId),window.DC_MESSAGE=Fr,Fr instanceof ArrayBuffer){var Ta=new DataView(Fr).getUint32();return Ta==Math.pow(2,32)-1?(Se.warn("dataChannelTest finished!"),void(Z._nextDataChannelTestNumber=0)):(Ta>Z._nextDataChannelTestNumber&&Se.warn("dataChannelTest: %s packets missing",Ta-Z._nextDataChannelTestNumber),void(Z._nextDataChannelTestNumber=Ta+1))}if(typeof Fr=="string")switch(Nr.label){case"chat":var Oa=Pe.getState().peers,rs=Object.keys(Oa).map(function(ga){return Oa[ga]}).find(function(ga){return ga.dataConsumers.includes(Nr.id)});if(!rs){Se.warn('DataConsumer "message" from unknown peer');break}Pe.dispatch(xe({title:"".concat(rs.displayName," says:"),text:Fr,timeout:5e3})),Z._eventEmitter.emit("CHAT_MESSAGE",{text:Fr,senderId:rs.id,timestamp:new Date().getTime()});break;case"bot":Pe.dispatch(xe({title:"Message from Bot:",text:Fr,timeout:5e3}))}else Se.warn('ignoring DataConsumer "message" (not a string)')}),window.DC=Nr,Pe.dispatch(Ct({id:Nr.id,sctpStreamParameters:Nr.sctpStreamParameters,label:Nr.label,protocol:Nr.protocol},Nn)),Ne(),dt.next=71;break;case 67:dt.prev=67,dt.t2=dt.catch(52),Se.error('"newDataConsumer" request failed:%o',dt.t2),Pe.dispatch(xe({type:"error",text:"Error creating a DataConsumer: ".concat(dt.t2)}));case 71:return dt.abrupt("break",130);case 72:try{en=de.data.peerId,(ea=Z._openTelemetry)===null||ea===void 0||ea.traceAutoComplete({spanName:"Emitting MIC_REQUESTED & Protoo REQ: enableMic for ".concat(en),status:1}),Z._eventEmitter.emit("MIC_REQUESTED",{peerId:en}),Ne()}catch(Fr){Se.error('"enableMic" request failed:%o',Fr),(Tn=Z._videosdkLogs)===null||Tn===void 0||Tn.pushLogs({logText:"Error enableMic request failed",logType:"ERROR",attributes:{error:Fr.message}}),Z._emitError({code:3027,message:Fr.message})}return dt.abrupt("break",130);case 74:return dt.prev=74,On=(gn=Z._openTelemetry)===null||gn===void 0?void 0:gn.trace({spanName:"Protoo REQ: disableMic"}),dt.next=78,Z.disableMic(!1,On);case 78:(Dn=Z._openTelemetry)===null||Dn===void 0||Dn.completeSpan({span:On,status:1,message:"Request Completed"}),Ne(),dt.next=87;break;case 82:dt.prev=82,dt.t3=dt.catch(74),(Fn=Z._openTelemetry)===null||Fn===void 0||Fn.completeSpan({span:On,status:2,message:"disableMic request failed ".concat(dt.t3)}),(bn=Z._videosdkLogs)===null||bn===void 0||bn.pushLogs({logText:"Error disableMic request failed",logType:"ERROR",attributes:{error:dt.t3.message}}),Z._emitError({code:3028,message:dt.t3.message});case 87:return dt.abrupt("break",130);case 88:try{wn=de.data.peerId,(xn=Z._openTelemetry)===null||xn===void 0||xn.traceAutoComplete({spanName:"Emitting WEBCAM_REQUESTED & Protoo REQ: enableWebcam for ".concat(wn),status:1}),Z._eventEmitter.emit("WEBCAM_REQUESTED",{peerId:wn}),Ne()}catch(Fr){Se.error('"enableWebcam" request failed:%o',Fr),(Kr=Z._videosdkLogs)===null||Kr===void 0||Kr.pushLogs({logText:"Error enableWebcam request failed",logType:"ERROR",attributes:{error:Fr.message}}),Z._emitError({code:3029,message:Fr.message})}return dt.abrupt("break",130);case 90:return dt.prev=90,cn=(an=Z._openTelemetry)===null||an===void 0?void 0:an.trace({spanName:"Protoo REQ: disableWebcam"}),dt.next=94,Z.disableWebcam(cn);case 94:(dn=Z._openTelemetry)===null||dn===void 0||dn.completeSpan({span:cn,status:1,message:"Request Completed"}),Ne(),dt.next=103;break;case 98:dt.prev=98,dt.t4=dt.catch(90),(Rr=Z._openTelemetry)===null||Rr===void 0||Rr.completeSpan({span:cn,status:2,message:"disableWebcam request failed ".concat(dt.t4)}),(Un=Z._videosdkLogs)===null||Un===void 0||Un.pushLogs({logText:"Error disableWebcam request failed",logType:"ERROR",attributes:{error:dt.t4.message}}),Z._emitError({code:3030,message:dt.t4.message});case 103:return dt.abrupt("break",130);case 104:dt.prev=104,We=de.data,or=We.peerId,Dr=We.state,_n=We.pinnedBy,Er=(mr=Z._openTelemetry)===null||mr===void 0?void 0:mr.trace({spanName:"Protoo REQ: pinStateChanged",attributes:{requestData:JSON.stringify({peerId:or,state:Dr,pinnedBy:_n})}}),Z._pinnedParticipants.has(or)||Z._pinnedParticipants.set(or,{cam:!1,share:!1}),un=Z._pinnedParticipants.get(or),Dr.cam!=null&&(un.cam=Dr.cam),Dr.share!=null&&(un.share=Dr.share),Z._pinnedParticipants.set(or,un),Z._eventEmitter.emit("PIN_STATE_CHANGED",{peerId:or,state:Dr,pinnedBy:_n}),un.share==0&&un.cam==0&&Z._pinnedParticipants.delete(or),(qe=Z._openTelemetry)===null||qe===void 0||qe.completeSpan({span:Er,status:1,message:"Request Completed",attributes:{_pinnedParticipants:JSON.stringify(Z._pinnedParticipants)}}),Ne(),dt.next=123;break;case 118:throw dt.prev=118,dt.t5=dt.catch(104),(fa=Z._openTelemetry)===null||fa===void 0||fa.completeSpan({span:Er,status:2,message:"pinStateChanged request failed"}),(Fa=Z._videosdkLogs)===null||Fa===void 0||Fa.pushLogs({logText:"Error pinStateChanged request failed",logType:"ERROR",attributes:{error:dt.t5.message}}),dt.t5;case 123:return dt.abrupt("break",130);case 124:return Z._eventEmitter.emit("SWITCH_ROOM",de.data),Ne(),dt.abrupt("break",130);case 127:return Ne({peerId:Z._peerId,statsData:Z._stats}),Z._stats={},dt.abrupt("break",130);case 130:case"end":return dt.stop()}},Ge,null,[[14,37],[52,67],[74,82],[90,98],[104,118]])}));return function(Ge,de,Ne){return Le.apply(this,arguments)}}()),this._protoo.on("notification",function(){var Le=(0,d.A)(e().mark(function Ge(de){var Ne,Mt,Ut,ut,Vt,Nt,Kt,At,Et,Sr,qt,Xt,Ir,on,nn,hr,Xr,mn,vn,fn,sr,Zr,Rt,Wr,mt,Zt,xr,Vr,Br,Mr,Nn,Zn,jn,yn,Bn,la,Yn,Nr,ea,en,Tn,On,gn,Dn,Fn,bn,xn,wn,Kr,cn,an,dn,Rr,Un,Er,mr,qe,We,or,Dr,_n,un,fa,Fa,dt,Fr,Ta,Oa,rs,ga,ps,hs,sn,$s,Pi,Es,Ci,Ti,ms,ks,Ps,Gs,Ks,Js,Ys,Oi;return e().wrap(function(Fe){for(;;)switch(Fe.prev=Fe.next){case 0:Se.debug('proto "notification" event [method:%s, data:%o]',de.method,de.data),Fe.t0=de.method,Fe.next=Fe.t0==="error"?4:Fe.t0==="participantMediaStateChanged"?9:Fe.t0==="producerScore"?10:Fe.t0==="entryRequested"?13:Fe.t0==="entryResponded"?17:Fe.t0==="newPeer"?23:Fe.t0==="peerClosed"?30:Fe.t0==="peerDisplayNameChanged"?36:Fe.t0==="downlinkBwe"?40:Fe.t0==="consumerClosed"?42:Fe.t0==="consumerPaused"?54:Fe.t0==="consumerResumed"?61:Fe.t0==="consumerLayersChanged"?68:Fe.t0==="consumerScore"?79:Fe.t0==="dataConsumerClosed"?82:Fe.t0==="activeSpeaker"?91:Fe.t0==="transcriptionStateChanged"?96:Fe.t0==="transcriptionText"?99:Fe.t0==="recordingStateChanged"?101:Fe.t0==="recordingStarted"?104:Fe.t0==="recordingStopped"?106:Fe.t0==="livestreamStateChanged"?108:Fe.t0==="livestreamStarted"?111:Fe.t0==="livestreamStopped"?113:Fe.t0==="hlsStateChanged"?115:Fe.t0==="hlsPlayableStateChanged"?118:Fe.t0==="hlsStarted"?120:Fe.t0==="hlsStopped"?123:Fe.t0==="whiteboardStarted"?125:Fe.t0==="whiteboardStopped"?128:Fe.t0==="addCharacter"?130:Fe.t0==="removeCharacter"?136:Fe.t0==="characterStateChanged"?142:Fe.t0==="characterMessage"?145:Fe.t0==="userMessage"?147:Fe.t0==="characterData"?149:Fe.t0==="videoStatusChanged"?151:Fe.t0==="videoSeeked"?153:Fe.t0==="connectionOpen"?156:Fe.t0==="connectionClose"?158:Fe.t0==="connectionChatMessage"?160:Fe.t0==="connectionParticipantJoined"?162:Fe.t0==="connectionParticipantLeft"?164:Fe.t0==="pubsubMessage"?166:Fe.t0==="peerModeChanged"?168:Fe.t0==="restartIce"?171:175;break;case 4:return Ut=de.data,Z._eventEmitter.emit("ERROR",Ut),(Ne=Z._videosdkLogs)===null||Ne===void 0||Ne.pushLogs({logText:"Error in Meeting Session",logType:"ERROR",attributes:{error:Ut.message}}),(Mt=Z._openTelemetry)===null||Mt===void 0||Mt.traceAutoComplete({spanName:"Emitted `ERROR` Event",attributes:{error:Ut.message},status:2}),Fe.abrupt("break",176);case 9:try{ut=de.data,Vt=ut.peerId,Nt=ut.kind,Kt=ut.newState,Z._eventEmitter.emit("PARTICIPANT_MEDIA_STATE_CHANGED",{peerId:Vt,kind:Nt,newState:Kt}),Nt=="video"&&((At=Z._openTelemetry)===null||At===void 0||At.traceAutoComplete({spanName:"".concat(Vt," has ").concat(Kt?"enable":"disable"," ").concat(Nt),status:1}))}catch(ns){Se.error('"newProducer" request failed:%o',ns),(Et=Z._videosdkLogs)===null||Et===void 0||Et.pushLogs({logText:"Error newProducer request failed",logType:"ERROR",attributes:{error:ns.message}})}case 10:return Sr=de.data,qt=Sr.producerId,Xt=Sr.score,Pe.dispatch(Ot(qt,Xt)),Fe.abrupt("break",176);case 13:return on=de.data,nn=on.id,hr=on.name,Xr=(Ir=Z._openTelemetry)===null||Ir===void 0?void 0:Ir.trace({spanName:"Protoo Noti: entryRequested",span:Z._joinSpan,attributes:{data:JSON.stringify({id:nn,name:hr})}}),nn!==Z._peerId?(Z._eventEmitter.emit("ENTRY_REQUESTED",{id:nn,name:hr}),(mn=Z._openTelemetry)===null||mn===void 0||mn.completeSpan({span:Xr,status:1,message:"EntryResponded Recieved"})):(vn=Z._openTelemetry)===null||vn===void 0||vn.completeSpan({span:Xr,status:2,message:"Entry Request Failed"}),Fe.abrupt("break",176);case 17:return sr=de.data,Zr=sr.id,Rt=sr.decision,Wr=sr.sessionId,Z._videosdkLogs=new Tr({roomId:Z._roomId,peerId:Z._peerId,logs:X,observabilityJwt:Re,deviceInfo:Z._deviceInfo,sessionId:Wr,debugMode:Z._debugMode}),Z._eventEmitter.emit("ENTRY_RESPONDED",{id:Zr,decision:Rt}),mt=(fn=Z._openTelemetry)===null||fn===void 0?void 0:fn.trace({spanName:"Protoo Noti: entryResponded",attributes:{data:JSON.stringify({id:Zr,decision:Rt}),sessionId:Wr},span:Z._joinSpan}),Zr===Z._peerId&&Rt==="allowed"?(Z.joinRoom(),(Zt=Z._openTelemetry)===null||Zt===void 0||Zt.completeSpan({span:mt,status:1,message:"EntryResponded Recieved"})):(xr=Z._openTelemetry)===null||xr===void 0||xr.completeSpan({span:Z._joinSpan,status:2,message:"Join Request Denied"}),Fe.abrupt("break",176);case 23:Vr=de.data,Br=jt(Gr(Gr({},Vr),{},{consumers:[],dataConsumers:[]})),Pe.dispatch(Br),Z._eventEmitter.emit(Br.type,Br.payload),Pe.dispatch(xe({text:"".concat(Vr.displayName," has joined the room")}));try{(Mr=Z._openTelemetry)===null||Mr===void 0||Mr.traceAutoComplete({spanName:"Protoo Noti: newPeer ".concat(Vr.displayName),attributes:{peerData:JSON.stringify(Vr)}})}catch(ns){(Nn=Z._videosdkLogs)===null||Nn===void 0||Nn.pushLogs({logText:"Error Protoo Noti: newPeer",logType:"ERROR",attributes:{error:ns.message}}),console.error(ns)}return Fe.abrupt("break",176);case 30:return jn=de.data.peerId,yn=_t(jn),Pe.dispatch(yn),Z._eventEmitter.emit(yn.type,yn.payload),(Zn=Z._openTelemetry)===null||Zn===void 0||Zn.traceAutoComplete({spanName:"Protoo Noti: peerClosed for ".concat(jn)}),Fe.abrupt("break",176);case 36:return Bn=de.data,la=Bn.peerId,Yn=Bn.displayName,Nr=Bn.oldDisplayName,Pe.dispatch(vr(Yn,la)),Pe.dispatch(xe({text:"".concat(Nr," is now ").concat(Yn)})),Fe.abrupt("break",176);case 40:return Se.debug("'downlinkBwe' event:%o",de.data),Fe.abrupt("break",176);case 42:if(en=de.data.consumerId,Tn=Z._consumers.get(en)){Fe.next=46;break}return Fe.abrupt("break",176);case 46:return Tn.close(),Z._consumers.delete(en),On=Tn.appData.peerId,gn=xt(en,On),Pe.dispatch(gn),Z._eventEmitter.emit(gn.type,gn.payload),(ea=Z._openTelemetry)===null||ea===void 0||ea.traceAutoComplete({spanName:"Protoo Noti: consumerClosed for id ".concat(en),attributes:{consumerData:JSON.stringify(Tn)}}),Fe.abrupt("break",176);case 54:if(Dn=de.data.consumerId,Fn=Z._consumers.get(Dn)){Fe.next=58;break}return Fe.abrupt("break",176);case 58:return Fn.pause(),Pe.dispatch($r(Dn,"remote")),Fe.abrupt("break",176);case 61:if(bn=de.data.consumerId,xn=Z._consumers.get(bn)){Fe.next=65;break}return Fe.abrupt("break",176);case 65:return xn.resume(),Pe.dispatch(cr(bn,"remote")),Fe.abrupt("break",176);case 68:if(Kr=de.data,cn=Kr.consumerId,an=Kr.spatialLayer,dn=Kr.temporalLayer,(Rr=Z._consumers.get(cn)).currentSpatialLayer=an,Rr.currentTemporalLayer=dn,Rr){Fe.next=74;break}return Fe.abrupt("break",176);case 74:return((wn=Rr.appData)===null||wn===void 0||(wn=wn.encodings)===null||wn===void 0?void 0:wn.length)>1?(Z._eventEmitter.emit("VIDEO_QUALITY_CHANGED",{peerId:Rr.appData.peerId,prevQuality:Rr.spatialLayers-1-Rr.currentSpatialLayer==0?"HIGH":Rr.spatialLayers-1-Rr.currentSpatialLayer==1?"MEDIUM":"LOW",currentQuality:Rr.spatialLayers-1-an==0?"HIGH":Rr.spatialLayers-1-an==1?"MEDIUM":"LOW"}),(Un=Z._videosdkLogs)===null||Un===void 0||Un.pushLogs({logText:"Consumer Peer ".concat(Rr.appData.peerId," changed to ").concat(Rr.spatialLayers-1-an==0?"HIGH":Rr.spatialLayers-1-an==1?"MEDIUM":"LOW",", previous quality was ").concat(Rr.spatialLayers-1-Rr.currentSpatialLayer==0?"HIGH":Rr.spatialLayers-1-Rr.currentSpatialLayer==1?"MEDIUM":"LOW"),logType:"INFO",attributes:{consumerId:cn}})):(Z._eventEmitter.emit("VIDEO_QUALITY_CHANGED",{peerId:Rr.appData.peerId,prevQuality:"HIGH",currentQuality:"HIGH"}),(Er=Z._videosdkLogs)===null||Er===void 0||Er.pushLogs({logText:"Consumer Peer ".concat(Rr.appData.peerId," changed to HIGH, previous quality was HIGH"),logType:"INFO",attributes:{consumerId:cn}})),Rr.currentSpatialLayer=an,Rr.currentTemporalLayer=dn,Pe.dispatch(yr(cn,an,dn)),Fe.abrupt("break",176);case 79:return mr=de.data,qe=mr.consumerId,We=mr.score,Pe.dispatch(Ke(qe,We)),Fe.abrupt("break",176);case 82:if(or=de.data.dataConsumerId,Dr=Z._dataConsumers.get(or)){Fe.next=86;break}return Fe.abrupt("break",176);case 86:return Dr.close(),Z._dataConsumers.delete(or),_n=Dr.appData.peerId,Pe.dispatch(dr(or,_n)),Fe.abrupt("break",176);case 91:return un=de.data.peerId,fa=re(un),Pe.dispatch(fa),Z._eventEmitter.emit(fa.type,fa.payload),Fe.abrupt("break",176);case 96:return Z._eventEmitter.emit("TRANSCRIPTION_STATE_CHANGED",de.data),(Fa=Z._openTelemetry)===null||Fa===void 0||Fa.traceAutoComplete({spanName:"Emitted TRANSCRIPTION_STATE_CHANGED, status : ".concat(de.data.status),attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 99:return Z._eventEmitter.emit("TRANSCRIPTION_TEXT",de.data),Fe.abrupt("break",176);case 101:return Z._eventEmitter.emit("RECORDING_STATE_CHANGED",de.data),(dt=Z._openTelemetry)===null||dt===void 0||dt.traceAutoComplete({spanName:"Emitted RECORDING_STATE_CHANGED, status : ".concat(de.data.status),attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 104:return Z._eventEmitter.emit("RECORDING_STARTED",{}),Fe.abrupt("break",176);case 106:return Z._eventEmitter.emit("RECORDING_STOPPED",{}),Fe.abrupt("break",176);case 108:return Z._eventEmitter.emit("LIVESTREAM_STATE_CHANGED",de.data),(Fr=Z._openTelemetry)===null||Fr===void 0||Fr.traceAutoComplete({spanName:"Emitted LIVESTREAM_STATE_CHANGED, status : ".concat(de.data.status),attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 111:return Z._eventEmitter.emit("LIVESTREAM_STARTED",{}),Fe.abrupt("break",176);case 113:return Z._eventEmitter.emit("LIVESTREAM_STOPPED",{}),Fe.abrupt("break",176);case 115:return Z._eventEmitter.emit("HLS_STATE_CHANGED",de.data),(Ta=Z._openTelemetry)===null||Ta===void 0||Ta.traceAutoComplete({spanName:"Emitted HLS_STATE_CHANGED, status : ".concat(de.data.status),attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 118:return de.data.isPlayable&&(Z._eventEmitter.emit("HLS_STATE_CHANGED",Gr(Gr({},de.data),{},{status:tn.V.HLS_PLAYABLE})),(Oa=Z._openTelemetry)===null||Oa===void 0||Oa.traceAutoComplete({spanName:"Protoo Noti: hlsPlayableStateChanged",status:1})),Fe.abrupt("break",176);case 120:return rs=de.data.downstreamUrl,Z._eventEmitter.emit("HLS_STARTED",rs),Fe.abrupt("break",176);case 123:return Z._eventEmitter.emit("HLS_STOPPED",{}),Fe.abrupt("break",176);case 125:return ga=de.data,ps=ga.state,hs=ga.url,ps?Z._eventEmitter.emit("WHITEBOARD_STARTED",{state:ps}):hs&&Z._eventEmitter.emit("WHITEBOARD_STARTED",{url:hs}),Fe.abrupt("break",176);case 128:return Z._eventEmitter.emit("WHITEBOARD_STOPPED",{}),Fe.abrupt("break",176);case 130:return $s=de.data,Pi=jt(Gr(Gr({},$s),{},{consumers:[],dataConsumers:[]})),Pe.dispatch(Pi),Z._eventEmitter.emit("ADD_CHARACTER",de.data),(sn=Z._openTelemetry)===null||sn===void 0||sn.traceAutoComplete({spanName:"Emitted ADD_CHARACTER : ".concat(de.data),attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 136:return Ci=de.data.id,Ti=_t(Ci),Pe.dispatch(Ti),Z._eventEmitter.emit("REMOVE_CHARACTER",de.data),(Es=Z._openTelemetry)===null||Es===void 0||Es.traceAutoComplete({spanName:"Emitted REMOVE_CHARACTER : ".concat(de.data),attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 142:return Z._eventEmitter.emit("CHARACTER_STATE_CHANGED",de.data),(ms=Z._openTelemetry)===null||ms===void 0||ms.traceAutoComplete({spanName:"Emitted CHARACTER_STATE_CHANGED, status : ".concat(de.data.status),attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 145:return Z._eventEmitter.emit("CHARACTER_MESSAGE",de.data),Fe.abrupt("break",176);case 147:return Z._eventEmitter.emit("USER_MESSAGE",de.data),Fe.abrupt("break",176);case 149:return Z._eventEmitter.emit("CHARACTER_DATA",de.data),Fe.abrupt("break",176);case 151:return Z._eventEmitter.emit("VIDEO_STATE_CHANGED",de.data),Fe.abrupt("break",176);case 153:return ks=de.data.currentTime,Z._eventEmitter.emit("VIDEO_SEEKED",{currentTime:ks}),Fe.abrupt("break",176);case 156:return Z._eventEmitter.emit("CONNECTION_OPEN",de.data),Fe.abrupt("break",176);case 158:return Z._eventEmitter.emit("CONNECTION_CLOSE",de.data),Fe.abrupt("break",176);case 160:return Z._eventEmitter.emit("CONNECTION_CHAT_MESSAGE",de.data),Fe.abrupt("break",176);case 162:return Z._eventEmitter.emit("CONNECTION_PARTICIPANT_JOIN",de.data),Fe.abrupt("break",176);case 164:return Z._eventEmitter.emit("CONNECTION_PARTICIPANT_LEFT",de.data),Fe.abrupt("break",176);case 166:return Z._eventEmitter.emit("PUBSUB_MESSAGE",de.data),Fe.abrupt("break",176);case 168:return Z._eventEmitter.emit("PEER_MODE_CHANGED",de.data),(Ps=Z._openTelemetry)===null||Ps===void 0||Ps.traceAutoComplete({spanName:"Emitted PEER_MODE_CHANGED",attributes:{data:JSON.stringify(de.data)},status:1}),Fe.abrupt("break",176);case 171:return Ks=de.data,Js=Ks.transportId,Ys=Ks.iceParameters,Oi=(Gs=Z._openTelemetry)===null||Gs===void 0?void 0:Gs.trace({spanName:"Protoo Noti: restartIce for transportId :".concat(Js),attributes:{iceParameters:JSON.stringify(Ys)}}),Z.handleRemoteRestartIce({transportId:Js,iceParameters:Ys,internalSpan:Oi}),Fe.abrupt("break",176);case 175:Se.error('unknown protoo notification.method "%s"',de.method);case 176:case"end":return Fe.stop()}},Ge)}));return function(Ge){return Le.apply(this,arguments)}}());case 27:case"end":return Xe.stop()}},V,this)})),function(){return ls.apply(this,arguments)})},{key:"requestEntry",value:(ki=(0,d.A)(e().mark(function V(){var D,x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"Requesting Entry",span:this._joinSpan}),A.next=3,this._protoo.request("requestEntry",{name:this._displayName});case 3:(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:I,status:1,message:"Entry Requested Successfully"});case 4:case"end":return A.stop()}},V,this)})),function(){return ki.apply(this,arguments)})},{key:"respondEntry",value:(Ei=(0,d.A)(e().mark(function V(D,x){var I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return K=(I=this._openTelemetry)===null||I===void 0?void 0:I.trace({spanName:"Responding Entry",attributes:{peerId:D,decision:x},span:this._joinSpan}),X.next=3,this._protoo.request("respondEntry",{id:D,decision:x});case 3:(A=this._openTelemetry)===null||A===void 0||A.completeSpan({message:"Entry Responded Successfully",span:K,status:1});case 4:case"end":return X.stop()}},V,this)})),function(V,D){return Ei.apply(this,arguments)})},{key:"startTranscription",value:(Ri=(0,d.A)(e().mark(function V(D){var x,I,A,K,X;return e().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Se.debug("startTranscription()"),A=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"startTranscription() Start",attributes:{config:D?JSON.stringify(D):"config Not Specify"}}),Re.prev=2,Re.next=5,this._protoo.request("startTranscription",{config:D});case 5:Re.next=13;break;case 7:Re.prev=7,Re.t0=Re.catch(2),Se.error("startTranscription() | failed:%o",Re.t0),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:A,status:2,message:"startTranscription() failed"}),(X=this._videosdkLogs)===null||X===void 0||X.pushLogs({logText:"Error startTranscription() failed",logType:"ERROR",attributes:{error:Re.t0.message}}),this._emitError({code:4031,message:Re.t0.message});case 13:(I=this._openTelemetry)===null||I===void 0||I.completeSpan({span:A,status:1,message:"startTranscription() End"});case 14:case"end":return Re.stop()}},V,this,[[2,7]])})),function(V){return Ri.apply(this,arguments)})},{key:"stopTranscription",value:(Si=(0,d.A)(e().mark(function V(){var D,x,I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return Se.debug("stopTranscription()"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"stopTranscription() Start"}),X.prev=2,X.next=5,this._protoo.request("stopTranscription",{});case 5:X.next=12;break;case 7:X.prev=7,X.t0=X.catch(2),(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:I,status:2,message:"stopTranscription() failed"}),(K=this._videosdkLogs)===null||K===void 0||K.pushLogs({logText:"Error stopTranscription() failed",logType:"ERROR",attributes:{error:X.t0.message}}),this._emitError({code:4032,message:X.t0.message});case 12:(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:I,status:1,message:"stopTranscription() End"});case 13:case"end":return X.stop()}},V,this,[[2,7]])})),function(){return Si.apply(this,arguments)})},{key:"startRecording",value:(wi=(0,d.A)(e().mark(function V(D,x,I,A){var K,X,Re,me,it;return e().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return Se.debug("startRecording()"),Re=(K=this._openTelemetry)===null||K===void 0?void 0:K.trace({spanName:"startRecording() Start",attributes:{webhookUrl:D||"webhookUrl Not Specify",awsDirPath:x||"awsDirPath Not Specify",config:I?JSON.stringify(I):"config Not Specify",transcription:A?JSON.stringify(A):"transcription Not Specify"}}),Ue.prev=2,Ue.next=5,this._protoo.request("startRecording",{webhookUrl:D,awsDirPath:x,config:I,transcription:A});case 5:Ue.next=13;break;case 7:Ue.prev=7,Ue.t0=Ue.catch(2),Se.error("startRecording() | failed:%o",Ue.t0),(me=this._openTelemetry)===null||me===void 0||me.completeSpan({span:Re,status:2,message:"startRecording() failed"}),(it=this._videosdkLogs)===null||it===void 0||it.pushLogs({logText:"Error startRecording() failed",logType:"ERROR",attributes:{error:Ue.t0.message}}),this._emitError({code:4011,message:Ue.t0.message});case 13:(X=this._openTelemetry)===null||X===void 0||X.completeSpan({span:Re,status:1,message:"startRecording() End"});case 14:case"end":return Ue.stop()}},V,this,[[2,7]])})),function(V,D,x,I){return wi.apply(this,arguments)})},{key:"stopRecording",value:(bi=(0,d.A)(e().mark(function V(){var D,x,I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:if(!this._closed){X.next=2;break}return X.abrupt("return");case 2:return Se.debug("stopRecording()"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"stopRecording() Start"}),X.prev=4,X.next=7,this._protoo.request("stopRecording",{});case 7:X.next=14;break;case 9:X.prev=9,X.t0=X.catch(4),(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:I,status:2,message:"stopRecording() failed"}),(K=this._videosdkLogs)===null||K===void 0||K.pushLogs({logText:"Error stopRecording() failed",logType:"ERROR",attributes:{error:X.t0.message}}),this._emitError({code:4012,message:X.t0.message});case 14:(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:I,status:1,message:"stopRecording() End"});case 15:case"end":return X.stop()}},V,this,[[4,9]])})),function(){return bi.apply(this,arguments)})},{key:"startLivestream",value:(yi=(0,d.A)(e().mark(function V(D,x){var I,A,K,X,Re;return e().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return Se.debug("startLivestream()"),K=(I=this._openTelemetry)===null||I===void 0?void 0:I.trace({spanName:"startLivestream() Start",attributes:{outputs:D?JSON.stringify(D):"outputs Not Specify",config:x?JSON.stringify(x):"config Not Specify"}}),me.prev=2,me.next=5,this._protoo.request("startLivestream",{outputs:D,config:x});case 5:me.next=12;break;case 7:me.prev=7,me.t0=me.catch(2),(X=this._openTelemetry)===null||X===void 0||X.completeSpan({span:K,status:1,message:"startLivestream() End"}),(Re=this._videosdkLogs)===null||Re===void 0||Re.pushLogs({logText:"Error startLivestream() failed",logType:"ERROR",attributes:{error:me.t0.message}}),this._emitError({code:4013,message:me.t0.message});case 12:(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:K,status:1,message:"startLivestream() End"});case 13:case"end":return me.stop()}},V,this,[[2,7]])})),function(V,D){return yi.apply(this,arguments)})},{key:"stopLivestream",value:(vi=(0,d.A)(e().mark(function V(){var D,x,I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return Se.debug("stopLivestream()"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"stopLivestream() Start"}),X.prev=2,X.next=5,this._protoo.request("stopLivestream",{});case 5:X.next=12;break;case 7:X.prev=7,X.t0=X.catch(2),(A=this._videosdkLogs)===null||A===void 0||A.pushLogs({logText:"Error stopLivestream() failed",logType:"ERROR",attributes:{error:X.t0.message}}),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:I,status:2,message:"Error stopLivestream() failed"}),this._emitError({code:4014,message:X.t0.message});case 12:(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:I,status:1,message:"stopLivestream() End"});case 13:case"end":return X.stop()}},V,this,[[2,7]])})),function(){return vi.apply(this,arguments)})},{key:"startHls",value:(zs=(0,d.A)(e().mark(function V(D,x){var I,A,K,X,Re;return e().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:return D=D||{},x=x||{},Se.debug("startHls()"),K=(I=this._openTelemetry)===null||I===void 0?void 0:I.trace({spanName:"startHls() Start",attributes:{config:D?JSON.stringify(D):"config Not Specify",transcription:x?JSON.stringify(x):"transcription Not Specify"}}),me.prev=4,me.next=7,this._protoo.request("startHls",{config:D,transcription:x});case 7:me.next=15;break;case 9:me.prev=9,me.t0=me.catch(4),(X=this._videosdkLogs)===null||X===void 0||X.pushLogs({logText:"Error startHls() failed",logType:"ERROR",attributes:{error:me.t0.message}}),(Re=this._openTelemetry)===null||Re===void 0||Re.completeSpan({span:K,status:2,message:"Error startHls() failed"}),this._emitError({code:4016,message:me.t0.message}),Se.error("startHls() | failed:%o",me.t0);case 15:(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:K,status:1,message:"startHlsSpan() End"});case 16:case"end":return me.stop()}},V,this,[[4,9]])})),function(V,D){return zs.apply(this,arguments)})},{key:"stopHls",value:(Hs=(0,d.A)(e().mark(function V(){var D,x,I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return Se.debug("stopHls()"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"stopHls() Start"}),X.prev=2,X.next=5,this._protoo.request("stopHls",{});case 5:X.next=12;break;case 7:X.prev=7,X.t0=X.catch(2),(A=this._videosdkLogs)===null||A===void 0||A.pushLogs({logText:"Error stopHls() failed",logType:"ERROR",attributes:{error:X.t0.message}}),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:I,status:2,message:"Error stopHls() failed"}),this._emitError({code:4017,message:X.t0.message});case 12:(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:I,status:1,message:"stopHls() End"});case 13:case"end":return X.stop()}},V,this,[[2,7]])})),function(){return Hs.apply(this,arguments)})},{key:"startWhiteboard",value:(us=(0,d.A)(e().mark(function V(){var D,x,I,A;return e().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return Se.debug("startWhiteboard()"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"startWhiteboard() Start"}),K.prev=2,K.next=5,this._protoo.request("startWhiteboard",{version:"v2"});case 5:K.next=12;break;case 7:K.prev=7,K.t0=K.catch(2),Se.error("startWhiteboard() | failed:%o",K.t0),(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:I,status:2,message:"Error startWhiteboard() failed"}),this._emitError({code:3021,message:K.t0.message});case 12:(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:I,status:1,message:"startWhiteboard() End"});case 13:case"end":return K.stop()}},V,this,[[2,7]])})),function(){return us.apply(this,arguments)})},{key:"stopWhiteboard",value:(Cn=(0,d.A)(e().mark(function V(){var D,x,I,A;return e().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return Se.debug("stopWhiteboard()"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"stopWhiteboard() Start"}),K.prev=2,K.next=5,this._protoo.request("stopWhiteboard",{});case 5:K.next=12;break;case 7:K.prev=7,K.t0=K.catch(2),Se.error("stopWhiteboard() | failed:%o",K.t0),(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:I,status:2,message:"Error stopWhiteboard() failed"}),this._emitError({code:3022,message:K.t0.message});case 12:(x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:I,status:1,message:"stopWhiteboard() End"});case 13:case"end":return K.stop()}},V,this,[[2,7]])})),function(){return Cn.apply(this,arguments)})},{key:"joinCharacter",value:(bt=(0,d.A)(e().mark(function V(D){var x,I,A,K,X;return e().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Se.debug("joinCharacter()"),A=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"joinCharacter() Start",attributes:{config:D?JSON.stringify(D):"config Not Specify"}}),Re.prev=2,Re.next=5,this._protoo.request("joinCharacter",{config:D});case 5:return Re.abrupt("return",Re.sent);case 8:Re.prev=8,Re.t0=Re.catch(2),Se.error("joinCharacter() | failed:%o",Re.t0),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:A,status:2,message:"joinCharacter() failed"}),(X=this._videosdkLogs)===null||X===void 0||X.pushLogs({logText:"Error joinCharacter() failed",logType:"ERROR",attributes:{error:Re.t0.message}}),this._emitError({code:4033,message:Re.t0.message});case 14:return(I=this._openTelemetry)===null||I===void 0||I.completeSpan({span:A,status:1,message:"joinCharacter() End"}),Re.abrupt("return",!1);case 16:case"end":return Re.stop()}},V,this,[[2,8]])})),function(V){return bt.apply(this,arguments)})},{key:"removeCharacter",value:(qs=(0,d.A)(e().mark(function V(D){var x,I,A,K,X;return e().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return Se.debug("removeCharacter()"),A=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"removeCharacter() Start"}),Re.prev=2,Re.next=5,this._protoo.request("leaveCharacter",{config:D});case 5:Re.next=14;break;case 7:return Re.prev=7,Re.t0=Re.catch(2),Se.error("removeCharacter() | failed:%o",Re.t0),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:A,status:2,message:"removeCharacter() failed"}),(X=this._videosdkLogs)===null||X===void 0||X.pushLogs({logText:"Error removeCharacter() failed",logType:"ERROR",attributes:{error:Re.t0.message}}),this._emitError({code:4034,message:Re.t0.message}),Re.abrupt("return",!1);case 14:return(I=this._openTelemetry)===null||I===void 0||I.completeSpan({span:A,status:1,message:"removeCharacter() End"}),Re.abrupt("return",!0);case 16:case"end":return Re.stop()}},V,this,[[2,7]])})),function(V){return qs.apply(this,arguments)})},{key:"sendCharacterMessage",value:(Ft=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return x=D.interactionId,I=D.text,Se.debug("sendCharacterMessage()"),A.prev=2,A.next=5,this._protoo.request("sendCharacterMessage",{interactionId:x,text:I});case 5:A.next=11;break;case 7:A.prev=7,A.t0=A.catch(2),Se.error("sendCharacterMessage() | failed:%o",A.t0),this._emitError({code:4035,message:A.t0.message});case 11:case"end":return A.stop()}},V,this,[[2,7]])})),function(V){return Ft.apply(this,arguments)})},{key:"interruptCharacter",value:(Vs=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return x=D.interactionId,Se.debug("interruptCharacter()"),I.prev=2,I.next=5,this._protoo.request("interruptCharacter",{interactionId:x});case 5:I.next=11;break;case 7:I.prev=7,I.t0=I.catch(2),Se.error("interruptCharacter() | failed:%o",I.t0),this._emitError({code:4036,message:I.t0.message});case 11:case"end":return I.stop()}},V,this,[[2,7]])})),function(V){return Vs.apply(this,arguments)})},{key:"pinStateChange",value:(St=(0,d.A)(e().mark(function V(D){var x,I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return I=D.peerId,A=D.state,(x=this._openTelemetry)===null||x===void 0||x.traceAutoComplete({spanName:"Pin state Change for ".concat(I),attributes:{state:A?JSON.stringify(A):null},status:1}),X.prev=2,X.next=5,this._protoo.request("pinStateChanged",{peerId:I,state:A});case 5:X.next=11;break;case 7:X.prev=7,X.t0=X.catch(2),(K=this._videosdkLogs)===null||K===void 0||K.pushLogs({logText:"Error pinStateChange() failed",logType:"ERROR",attributes:{error:X.t0.message}}),Se.error("pinStateChange() | failed");case 11:case"end":return X.stop()}},V,this,[[2,7]])})),function(V){return St.apply(this,arguments)})},{key:"startVideo",value:(ie=(0,d.A)(e().mark(function V(D){var x,I,A;return e().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return I=D.link,Se.debug("startVideo()"),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"startVideo() Calling",logType:"INFO"}),K.prev=3,K.next=6,this._protoo.request("startVideo",{link:I});case 6:K.next=13;break;case 8:K.prev=8,K.t0=K.catch(3),(A=this._videosdkLogs)===null||A===void 0||A.pushLogs({logText:"Error startVideo() failed",logType:"ERROR",attributes:{error:K.t0.message}}),Se.error("startVideo() | failed:%o",K.t0),this._emitError({code:3023,message:K.t0.message});case 13:case"end":return K.stop()}},V,this,[[3,8]])})),function(V){return ie.apply(this,arguments)})},{key:"stopVideo",value:(Ws=(0,d.A)(e().mark(function V(){var D,x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return Se.debug("stopVideo()"),(D=this._videosdkLogs)===null||D===void 0||D.pushLogs({logText:"stopVideo() Calling",logType:"INFO"}),I.prev=2,I.next=5,this._protoo.request("stopVideo",{});case 5:I.next=12;break;case 7:I.prev=7,I.t0=I.catch(2),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"Error stopVideo() failed",logType:"ERROR",attributes:{error:I.t0.message}}),Se.error("stopVideo() | failed:%o",I.t0),this._emitError({code:3024,message:I.t0.message});case 12:case"end":return I.stop()}},V,this,[[2,7]])})),function(){return Ws.apply(this,arguments)})},{key:"pauseVideo",value:(Rs=(0,d.A)(e().mark(function V(D){return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return Se.debug("pauseVideo()"),x.prev=1,x.next=4,this._protoo.request("pauseVideo",{currentTime:D});case 4:x.next=10;break;case 6:x.prev=6,x.t0=x.catch(1),Se.error("pauseVideo() | failed:%o",x.t0),this._emitError({code:3025,message:x.t0.message});case 10:case"end":return x.stop()}},V,this,[[1,6]])})),function(V){return Rs.apply(this,arguments)})},{key:"resumeVideo",value:(Us=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return Se.debug("resumeVideo()"),D.prev=1,D.next=4,this._protoo.request("resumeVideo",{});case 4:D.next=10;break;case 6:D.prev=6,D.t0=D.catch(1),Se.error("resumeVideo() | failed:%o",D.t0),this._emitError({code:3026,message:D.t0.message});case 10:case"end":return D.stop()}},V,this,[[1,6]])})),function(){return Us.apply(this,arguments)})},{key:"seekVideo",value:(Ca=(0,d.A)(e().mark(function V(D){return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return Se.debug("seekVideo()"),x.prev=1,x.next=4,this._protoo.request("seekVideo",{currentTime:D});case 4:x.next=10;break;case 6:x.prev=6,x.t0=x.catch(1),Se.error("seekVideo() | failed:%o",x.t0),this._emitError({code:3031,message:x.t0.message});case 10:case"end":return x.stop()}},V,this,[[1,6]])})),function(V){return Ca.apply(this,arguments)})},{key:"enablePeerMic",value:(Jn=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return(x=this._openTelemetry)===null||x===void 0||x.traceAutoComplete({spanName:"Enabling peer ".concat(D," Mic"),status:1}),Se.debug("enablePeerMic()"),A.prev=2,A.next=5,this._protoo.request("enablePeerMic",{peerId:D});case 5:A.next=11;break;case 7:A.prev=7,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error enablePeerMic() failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("enablePeerMic() | failed:%o",A.t0);case 11:case"end":return A.stop()}},V,this,[[2,7]])})),function(V){return Jn.apply(this,arguments)})},{key:"disablePeerMic",value:(hn=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return(x=this._openTelemetry)===null||x===void 0||x.traceAutoComplete({spanName:"Disabling peer ".concat(D," Mic"),status:1}),Se.debug("disablePeerMic()"),A.prev=2,A.next=5,this._protoo.request("disablePeerMic",{peerId:D});case 5:A.next=11;break;case 7:A.prev=7,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error disablePeerMic() failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("disablePeerMic() | failed:%o",A.t0);case 11:case"end":return A.stop()}},V,this,[[2,7]])})),function(V){return hn.apply(this,arguments)})},{key:"consumeWebcamStreams",value:(Ss=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!this._closed){A.next=2;break}return A.abrupt("return");case 2:return Se.debug("consumeWebcamStreams()"),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"consumeWebcamStreams() Calling",logType:"INFO",attributes:{peerId:D}}),A.prev=4,A.next=7,this._protoo.request("consumeVideoStreams",{peerId:D});case 7:A.next=13;break;case 9:A.prev=9,A.t0=A.catch(4),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error consumeWebcamStreams() failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("consumeWebcamStreams() | failed:%o",A.t0);case 13:case"end":return A.stop()}},V,this,[[4,9]])})),function(V){return Ss.apply(this,arguments)})},{key:"consumeMicStreams",value:(ws=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return Se.debug("consumeMicStreams()"),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"consumeMicStreams() Calling",logType:"INFO",attributes:{peerId:D}}),A.prev=2,A.next=5,this._protoo.request("consumeAudioStreams",{peerId:D});case 5:A.next=11;break;case 7:A.prev=7,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error consumeMicStreams() failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("consumeMicStreams() | failed:%o",A.t0);case 11:case"end":return A.stop()}},V,this,[[2,7]])})),function(V){return ws.apply(this,arguments)})},{key:"stopConsumingMicStreams",value:(Fs=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!this._closed){A.next=2;break}return A.abrupt("return");case 2:return Se.debug("stopConsumingAudioStreams()"),A.prev=3,A.next=6,this._protoo.request("stopConsumingAudioStreams",{peerId:D});case 6:(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"stopConsumingAudioStreams() Calling",logType:"INFO",attributes:{peerId:D}}),A.next=13;break;case 9:A.prev=9,A.t0=A.catch(3),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error stopConsumingMicStreams() failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("stopConsumingMicStreams() | failed:%o",A.t0);case 13:case"end":return A.stop()}},V,this,[[3,9]])})),function(V){return Fs.apply(this,arguments)})},{key:"stopConsumingWebcamStreams",value:(ds=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return Se.debug("stopConsumingWebcamStreams()"),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"stopConsumingWebcamStreams() Calling",logType:"INFO",attributes:{peerId:D}}),A.prev=2,A.next=5,this._protoo.request("stopConsumingVideoStreams",{peerId:D});case 5:A.next=11;break;case 7:A.prev=7,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error stopConsumingWebcamStreams() failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("stopConsumingWebcamStreams() | failed:%o",A.t0);case 11:case"end":return A.stop()}},V,this,[[2,7]])})),function(V){return ds.apply(this,arguments)})},{key:"changeMode",value:(pr=(0,d.A)(e().mark(function V(D){var x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de,Ne,Mt,Ut=this;return e().wrap(function(ut){for(;;)switch(ut.prev=ut.next){case 0:if(I=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"changeMode() Calling with mode: ".concat(D)}),A=this._mode,ut.prev=2,A!==D){ut.next=7;break}throw(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:I,status:2,message:"changeMode() Ending"}),(X=this._videosdkLogs)===null||X===void 0||X.pushLogs({logText:"You are already in ".concat(D," mode"),logType:"INFO"}),new Error("You are already in ".concat(D," mode"));case 7:if(Re=function(){var Vt=(0,d.A)(e().mark(function Nt(Kt,At){return e().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Et.next=2,Ut._protoo.request("createWebRtcTransport",{preferredProtocol:Ut._preferredProtocol,producing:Kt,consuming:At,sctpCapabilities:Ut._useDataChannel?Ut._mediasoupDevice.sctpCapabilities:void 0});case 2:return Et.abrupt("return",Et.sent);case 3:case"end":return Et.stop()}},Nt)}));return function(Nt,Kt){return Vt.apply(this,arguments)}}(),!(0,gr.kR)(D)){ut.next=36;break}return this._consume=!0,this._produce=!0,this._mode=D,this._mediasoupDevice=new h.Device({handlerName:this._handlerName}),ut.next=15,this._protoo.request("getRouterRtpCapabilities");case 15:return it=ut.sent,this._deviceInfo.sdkType!=="react-native"&&navigator.userAgent.includes("Firefox")&&(it.headerExtensions=(Ue=it.headerExtensions)===null||Ue===void 0?void 0:Ue.filter(function(Vt){return Vt.uri!="urn:3gpp:video-orientation"})),ut.next=19,this._mediasoupDevice.load({routerRtpCapabilities:it});case 19:if(!this._produce){ut.next=24;break}return ut.next=22,Re(!0,!1);case 22:et=ut.sent,this.createProducerTransport(et,I);case 24:if(A===gr.nI.RECV_ONLY||!this._consume){ut.next=29;break}return ut.next=27,Re(!1,!0);case 27:Z=ut.sent,this.createConsumerTransport(Z,I);case 29:return(me=this._openTelemetry)===null||me===void 0||me.traceAutoComplete({spanName:"Sending changeMode request to server",span:I,status:1}),ut.next=32,this._protoo.request("changeMode",{mode:D});case 32:this._produce&&(Pe.dispatch(le({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled&&this.enableMic(this.customMicrophoneAudioTrack),this._webcamEnabled&&this.enableWebcam(this.customCameraVideoTrack,I)),window.SHOW_INFO&&(Xe=Pe.getState(),Le=Xe.me,Pe.dispatch(oe(Le.id))),ut.next=62;break;case 36:if(!(0,gr.kR)(A)||D!==gr.nI.RECV_ONLY){ut.next=44;break}return this._produce=!1,this._mode=D,this._closeProducersAndTransport(),ut.next=42,this._protoo.request("changeMode",{mode:D});case 42:ut.next=62;break;case 44:if(!(0,gr.wZ)(A)||D!==gr.nI.RECV_ONLY){ut.next=54;break}return this._consume=!0,this._mode=D,ut.next=49,this._setupWebrtcTransport(I);case 49:return ut.next=51,this._protoo.request("changeMode",{mode:D});case 51:window.SHOW_INFO&&(Ge=Pe.getState(),de=Ge.me,Pe.dispatch(oe(de.id))),ut.next=62;break;case 54:if(!(0,gr.wZ)(D)){ut.next=62;break}return ut.next=57,this._protoo.request("changeMode",{mode:D});case 57:this._consume=!1,this._produce=!1,this._mode=D,this._dataConsumers.clear(),this._closeTransports();case 62:ut.next=68;break;case 64:ut.prev=64,ut.t0=ut.catch(2),(Ne=this._videosdkLogs)===null||Ne===void 0||Ne.pushLogs({logText:"Error changeMode(".concat(D,") | failed"),logType:"ERROR",attributes:{error:ut.t0.message}}),(Mt=this._openTelemetry)===null||Mt===void 0||Mt.completeSpan({span:I,status:2,message:"changeMode(".concat(D,") | failed")});case 68:case"end":return ut.stop()}},V,this,[[2,64]])})),function(V){return pr.apply(this,arguments)})},{key:"_closeProducersAndTransport",value:function(){var V;this._webcamProducer&&(this._webcamProducer.close(),this._webcamProducer=null),this._micProducer&&(this._micProducer.close(),this._micProducer=null),this._shareProducer&&(this._shareProducer.close(),this._shareProducer=null),this._shareAudioProducer&&(this._shareAudioProducer.close(),this._shareAudioProducer=null),(V=this._sendTransport)===null||V===void 0||V.close(),this._sendTransport=null}},{key:"_closeTransports",value:function(){var V,D;this._sendTransport&&((V=this._sendTransport)===null||V===void 0||V.close(),this._sendTransport=null),this._recvTransport&&((D=this._recvTransport)===null||D===void 0||D.close(),this._recvTransport=null)}},{key:"_setupWebrtcTransport",value:(Pa=(0,d.A)(e().mark(function V(D){var x,I,A;return e().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return this._mediasoupDevice=new h.Device({handlerName:this._handlerName}),K.next=3,this._protoo.request("getRouterRtpCapabilities");case 3:return x=K.sent,this._deviceInfo.sdkType!=="react-native"&&navigator.userAgent.includes("Firefox")&&(x.headerExtensions=(I=x.headerExtensions)===null||I===void 0?void 0:I.filter(function(X){return X.uri!="urn:3gpp:video-orientation"})),K.next=7,this._mediasoupDevice.load({routerRtpCapabilities:x});case 7:return K.next=9,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 9:A=K.sent,this.createConsumerTransport(A,D);case 11:case"end":return K.stop()}},V,this)})),function(V){return Pa.apply(this,arguments)})},{key:"enablePeerWebcam",value:(bs=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return(x=this._openTelemetry)===null||x===void 0||x.traceAutoComplete({spanName:"Enabling peer ".concat(D," Webcam"),status:1}),Se.debug("enablePeerWebcam()"),A.prev=2,A.next=5,this._protoo.request("enablePeerWebcam",{peerId:D});case 5:A.next=11;break;case 7:A.prev=7,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error enablePeerWebcam | failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("enablePeerWebcam() | failed:%o",A.t0);case 11:case"end":return A.stop()}},V,this,[[2,7]])})),function(V){return bs.apply(this,arguments)})},{key:"disablePeerWebcam",value:(Ur=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return(x=this._openTelemetry)===null||x===void 0||x.traceAutoComplete({spanName:"Disabling peer ".concat(D," Webcam"),status:1}),Se.debug("disablePeerWebcam()"),A.prev=2,A.next=5,this._protoo.request("disablePeerWebcam",{peerId:D});case 5:A.next=10;break;case 7:A.prev=7,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error disablePeerWebcam | failed",logType:"ERROR",attributes:{error:A.t0.message}});case 10:case"end":return A.stop()}},V,this,[[2,7]])})),function(V){return Ur.apply(this,arguments)})},{key:"getMicStats",value:function(V){var D=this;if(this._micProducer){var x=0;V.onStatsCollected=function(I){var A;D._stats.producerStats||(D._stats.producerStats={}),D._stats.producerStats.audio||(D._stats.producerStats.audio=[]),D._micProducer&&(D._latestStats[(A=D._micProducer)===null||A===void 0?void 0:A.id]=[]),I.audio.forEach(function(K){var X;D._micProducer&&D._latestStats[(X=D._micProducer)===null||X===void 0?void 0:X.id].push(K)}),x%5==0&&D._micProducer!=null&&D._stats.producerStats.audio.push(Gr({timestamp:new Date},D._latestStats[D._micProducer.id]?D._latestStats[D._micProducer.id][0]:{})),x++}}}},{key:"enableMic",value:(cs=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de,Ne,Mt,Ut,ut,Vt,Nt,Kt,At,Et,Sr,qt,Xt,Ir,on,nn,hr,Xr,mn,vn,fn,sr,Zr,Rt,Wr,mt,Zt,xr,Vr,Br,Mr,Nn,Zn,jn,yn,Bn,la,Yn,Nr,ea,en,Tn,On,gn,Dn,Fn,bn,xn,wn,Kr,cn,an,dn,Rr,Un,Er,mr=this,qe=arguments;return e().wrap(function(We){for(;;)switch(We.prev=We.next){case 0:if(X=qe.length>0&&qe[0]!==void 0?qe[0]:void 0,Re=qe.length>1&&qe[1]!==void 0?qe[1]:void 0,me=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"enableMic() Calling ".concat(X?"With Custom Audio Track":"Without Custom Audio Track "),attributes:{customAudioConfig:X?JSON.stringify(X):"Not Specify Custom Track"},span:Re||null}),Se.debug("enableMic()"),this._micEnabled=!0,!this._micProducer){We.next=27;break}if(et=(it=this._openTelemetry)===null||it===void 0?void 0:it.trace({spanName:"Mic Producer found",span:me}),X&&((Z=this._openTelemetry)===null||Z===void 0||Z.traceAutoComplete({spanName:"Stopping customAudioTrack",span:me,status:1}),X.getTracks().forEach(function(or){or.stop()})),(Ue=this._openTelemetry)===null||Ue===void 0||Ue.completeSpan({span:et,status:1,message:"Resuming Mic Producer"}),this._micProducer.resume(),Xe=this._micProducer,!this._sendTransport){We.next=18;break}return We.next=14,this._sendTransport.produce({track:this._micProducer.track,encodings:this._micProducer._appData.encodings,codecOptions:this._micProducer._appData.codecOptions});case 14:this._micProducer=We.sent,this._micProducer?(Ge=pe({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],encodings:Xe._appData.encodings,codecOptions:Xe._appData.codecOptions,instance:this._micProducer}),this._micProducer.track.getConstraints().deviceId&&(this._mic.device=this._mics.get(this._micProducer.track.getConstraints().deviceId)),Pe.dispatch(Ge),this._eventEmitter.emit(Ge.type,Ge.payload),(Le=this._openTelemetry)===null||Le===void 0||Le.completeSpan({span:me,status:1,message:"Enable Mic Successful"})):(de=this._openTelemetry)===null||de===void 0||de.completeSpan({span:me,status:2,message:"Error in enableMic() :: micProducer null"}),We.next=21;break;case 18:return(Ne=this._videosdkLogs)===null||Ne===void 0||Ne.pushLogs({logText:Ce.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED.message,attributes:{error:"Error in enableMic() :: Transport is not setup"},logType:"ERROR",dashboardLog:!0}),this._emitError(Ce.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),We.abrupt("return");case 21:return Mt=this._metrics.addNewProbe(this._micProducer,{name:"mic_producer"}),this._micProducer.observer.on("pause",function(){Mt==null||Mt.stop(),mr._latestStats[mr._micProducer.id]=[],mr._metrics.removeExistingProbe(Mt)}),this._micProducer.observer.on("close",function(){Mt==null||Mt.stop(),mr._latestStats[mr._micProducer.id]=[],mr._metrics.removeExistingProbe(Mt)}),this.getMicStats(Mt),Mt.start(),We.abrupt("return");case 27:if(!this._mediasoupDevice){We.next=36;break}if(this._mediasoupDevice.canProduce("audio")){We.next=34;break}return Vt=this._deviceInfo.sdkType=="react-native"?Ce.q.ERROR_RN_MIC_ACCESS_UNAVAILABLE.message:Ce.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message,(Ut=this._videosdkLogs)===null||Ut===void 0||Ut.pushLogs({logText:Vt,attributes:{error:"Error in enableMic() :: Microphone access unavailable"},logType:"ERROR",dashboardLog:!0}),Se.error("enableMic() | cannot produce audio"),(ut=this._openTelemetry)===null||ut===void 0||ut.completeSpan({span:me,status:2,message:"Error in enableMic() :: ".concat(Vt)}),We.abrupt("return");case 34:We.next=39;break;case 36:return(Nt=this._videosdkLogs)===null||Nt===void 0||Nt.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the mic. Please try again.",logType:"ERROR",attributes:{error:"Error in enableMic(): Something went wrong."},dashboardLog:!0}),(Kt=this._openTelemetry)===null||Kt===void 0||Kt.completeSpan({span:me,status:2,message:"Error in enableMic() :: mediasoupDevice is undefined"}),We.abrupt("return");case 39:if(We.prev=39,this._externalVideo){We.next=106;break}return Se.debug("enableMic() | calling getUserMedia()"),We.next=44,this._updateMics(me);case 44:if(this._mic.device){We.next=47;break}throw new Error("Whoops! No Microphone Found: We couldn't find your microphone. Is it plugged in and turned on? If so, try restarting your computer or checking your device settings. Also, ensure you're on a secure website (https://).");case 47:try{X&&(At=X.getAudioTracks()[0]).readyState=="ended"&&(At=null,hr=Ce.q.ERROR_CUSTOM_AUDIO_TRACK_ENDED,(nn=this._videosdkLogs)===null||nn===void 0||nn.pushLogs({logText:hr.message,logType:"INFO",attributes:{error:"In enableMic() :: Invalid Custom Track Passed"},dashboardLog:!0}),this._emitError(hr))}catch(or){mn=Ce.q.ERROR_INVALID_CUSTOM_AUDIO_TRACK,(Xr=this._videosdkLogs)===null||Xr===void 0||Xr.pushLogs({logText:mn.message,logType:"INFO",attributes:{error:"In enableMic() :: Invalid Custom Track Passed"}}),this._emitError(mn),console.log("Invalid Custom Audio Track Passed. Reverting to default Error: ".concat(or))}if(At){We.next=104;break}return sr=(vn=this._openTelemetry)===null||vn===void 0?void 0:vn.trace({spanName:"Creating Track",span:me}),We.prev=50,We.next=53,navigator.mediaDevices.getUserMedia({audio:{deviceId:{ideal:this._mic.device.deviceId},channelCount:1,noiseSuppression:!0,echoCancellation:!0,googEchoCancellation:!0,googEchoCancellation2:!0,googAutoGainControl:!0,googAutoGainControl2:!0,googNoiseSuppression:!0,googNoiseSuppression2:!0,googHighpassFilter:!0}});case 53:Zr=We.sent,We.next=102;break;case 56:if(We.prev=56,We.t0=We.catch(50),(Rt=this._openTelemetry)===null||Rt===void 0||Rt.completeSpan({message:"Error in enableMic() :: ".concat(We.t0.message),span:sr,status:2}),We.t0.name!=="SecurityError"){We.next=67;break}Zt=Ce.q.ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED,xr=Zt.message,this._emitError(Zt),(Wr=this._videosdkLogs)===null||Wr===void 0||Wr.pushLogs({logText:xr,logType:"ERROR",attributes:{error:"Error in enableMic() :: Microphone Permission Denied or Dismissed"},dashboardLog:!0}),(mt=this._openTelemetry)===null||mt===void 0||mt.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(xr),span:me,status:2}),We.next=101;break;case 67:if(We.t0.name!=="DOMException"){We.next=75;break}Mr=Ce.q.ERROR_RN_MIC_NOT_FOUND,Nn=Mr.message,this._emitError(Mr),(Vr=this._videosdkLogs)===null||Vr===void 0||Vr.pushLogs({logText:Nn,logType:"ERROR",attributes:{error:"Error in enableMic() :: No Microphone Device Found"},dashboardLog:!0}),(Br=this._openTelemetry)===null||Br===void 0||Br.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(Nn),span:me,status:2}),We.next=101;break;case 75:if(!(We.t0 instanceof DOMException)){We.next=98;break}We.t1=We.t0.name,We.next=We.t1==="NotAllowedError"?79:We.t1==="NotReadableError"?82:We.t1==="NotFoundError"?85:92;break;case 79:return Zn=this.handleNotAllowedError(We.t0,this._openTelemetry,this._videosdkLogs,me,"audio"),this._emitError(Zn),We.abrupt("break",96);case 82:return jn=this.handleNotReadableError(We.t0,this._openTelemetry,this._videosdkLogs,me,"audio"),this._emitError(jn),We.abrupt("break",96);case 85:return yn=Ce.q.ERROR_MICROPHONE_NOT_FOUND,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(yn=Ce.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS),Bn=yn.message,this._emitError(yn),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:Bn,logType:"ERROR",attributes:{error:"Error in enableMic() :: No Microphone Device Found"},dashboardLog:!0}),(I=this._openTelemetry)===null||I===void 0||I.completeSpan({message:"Error in enableMic() :: occurred in creating audio track, ".concat(Bn),span:me,status:2}),We.abrupt("break",96);case 92:return la="An error occurred in creating audio track, ".concat(We.t0.message),(A=this._videosdkLogs)===null||A===void 0||A.pushLogs({logText:We.t0.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(la)},dashboardLog:!0}),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({message:"Error in enableMic() :: ".concat(la),span:me,status:2}),We.abrupt("break",96);case 96:We.next=101;break;case 98:ea="An error occurred in creating audio track, ".concat(We.t0.message),(Yn=this._videosdkLogs)===null||Yn===void 0||Yn.pushLogs({logText:We.t0.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(ea)},dashboardLog:!0}),(Nr=this._openTelemetry)===null||Nr===void 0||Nr.completeSpan({message:"Error in enableMic() :: ".concat(ea),span:me,status:2});case 101:return We.abrupt("return");case 102:At=Zr.getAudioTracks()[0],(fn=this._openTelemetry)===null||fn===void 0||fn.completeSpan({message:"Audio Track Generated",span:sr,status:1});case 104:We.next=110;break;case 106:return We.next=108,this._getExternalVideoStream();case 108:en=We.sent,At=en.getAudioTracks()[0].clone();case 110:if(Et=(Sr=this._openTelemetry)===null||Sr===void 0?void 0:Sr.trace({spanName:"Generating Producer Configuration",span:me}),Tn={opusStereo:1,opusDtx:1},X&&(On=X.encoderConfig?zt.$.audioProfiles[X.encoderConfig]:zt.$.audioProfiles.speech_standard,Tn={opusStereo:On.stereo?1:0,opusFec:On.fec?1:0,opusDtx:On.dtx?1:0,opusMaxPlaybackRate:On.maxPlaybackRate,opusPtime:On.packetTime}),Dn={encodings:gn=[{networkPriority:"high"}],codecOptions:Tn},(qt=this._openTelemetry)===null||qt===void 0||qt.traceAutoComplete({spanName:"Generated AppData",span:Et,attributes:{appData:JSON.stringify(Dn)},status:1}),(Xt=this._openTelemetry)===null||Xt===void 0||Xt.completeSpan({span:Et,status:1,message:"Producer Configuration Generated"}),Et=(Ir=this._openTelemetry)===null||Ir===void 0?void 0:Ir.trace({spanName:"Creating Mic Producer",span:me}),(on=At)===null||on===void 0||on.addEventListener("ended",function(){console.log("Track Ended Error");try{var or,Dr,_n=mr._deviceInfo.sdkType=="react-native"?Ce.q.ERROR_RN_MIC_TRACK_ENDED:Ce.q.ERROR_MICROPHONE_TRACK_ENDED;(or=mr._videosdkLogs)===null||or===void 0||or.pushLogs({logText:_n.message,logType:"ERROR",attributes:{error:"Error Track Ended :: ".concat(_n.message)},dashboardLog:!0}),(Dr=mr._openTelemetry)===null||Dr===void 0||Dr.traceAutoComplete({spanName:"this._micProducer trackended or Microphone disconnected!",span:me,message:_n.message,status:2}),Pe.dispatch(xe({type:"error",text:"Microphone disconnected!"})),mr.disableMic(!0,me).catch(function(){})}catch(un){console.error(un)}}),!this._sendTransport){We.next=126;break}return We.next=123,this._sendTransport.produce({track:At,encodings:gn,codecOptions:Tn,appData:Dn});case 123:this._micProducer=We.sent,We.next=129;break;case 126:return(Fn=this._videosdkLogs)===null||Fn===void 0||Fn.pushLogs({logText:Ce.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED.message,attributes:{error:"Error in enableMic() :: Transport is not setup"},logType:"ERROR",dashboardLog:!0}),this._emitError(Ce.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),We.abrupt("return");case 129:this._micProducer?(At.getConstraints().deviceId&&(this._mic.device=this._mics.get(At.getConstraints().deviceId)),wn=pe({id:this._micProducer.id,paused:this._micProducer.paused,track:this._micProducer.track,rtpParameters:this._micProducer.rtpParameters,codec:this._micProducer.rtpParameters.codecs[0].mimeType.split("/")[1],encodings:gn,codecOptions:Tn,instance:this._micProducer}),Pe.dispatch(wn),this._eventEmitter.emit(wn.type,wn.payload),(Kr=this._metrics.addNewProbe(this._micProducer,{name:"mic_producer"})).start(),this.getMicStats(Kr),this._micProducer.on("transportclose",function(){var or,Dr=he(mr._micProducer.id);Pe.dispatch(Dr),mr._eventEmitter.emit(Dr.type,Dr.payload),(or=mr._micProducer)===null||or===void 0||or.close(),mr._micProducer=null}),this._micProducer.observer.on("pause",function(){Kr==null||Kr.stop(),mr._latestStats[mr._micProducer.id]=[],mr._metrics.removeExistingProbe(Kr)}),this._micProducer.observer.on("close",function(){Kr==null||Kr.stop(),mr._latestStats[mr._micProducer.id]=[],mr._metrics.removeExistingProbe(Kr)}),this._micProducer.on("trackended",function(){var or,Dr,_n=mr._deviceInfo.sdkType=="react-native"?Ce.q.ERROR_RN_MIC_TRACK_ENDED:Ce.q.ERROR_MICROPHONE_TRACK_ENDED;(or=mr._videosdkLogs)===null||or===void 0||or.pushLogs({logText:_n.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(_n.message)},dashboardLog:!0}),(Dr=mr._openTelemetry)===null||Dr===void 0||Dr.traceAutoComplete({spanName:"this._micProducer trackended or Microphone disconnected!",span:me,message:_n.message,status:2}),Pe.dispatch(xe({type:"error",text:"Microphone disconnected!"})),mr.disableMic(!0,me).catch(function(){})}),(bn=this._openTelemetry)===null||bn===void 0||bn.completeSpan({span:Et,status:1,message:"Mic Producer Created"}),(xn=this._openTelemetry)===null||xn===void 0||xn.completeSpan({span:me,status:1,message:"Enable Mic Successful"})):((cn=this._videosdkLogs)===null||cn===void 0||cn.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the mic. Please try again.",logType:"ERROR",attributes:{error:"Error in enableMic(): Something went wrong."},dashboardLog:!0}),(an=this._openTelemetry)===null||an===void 0||an.completeSpan({span:Et,status:2,message:"Error in enableMic() :: micProducer null"}),(dn=this._openTelemetry)===null||dn===void 0||dn.completeSpan({span:me,status:2,message:"Error in enableMic() :: micProducer null"})),We.next=142;break;case 132:return We.prev=132,We.t2=We.catch(39),(Rr=this._openTelemetry)===null||Rr===void 0||Rr.completeSpan({span:Et,status:2,message:"Error in enableMic() :: occurred in creating mic producer, ".concat(We.t2.message)}),(Un=this._openTelemetry)===null||Un===void 0||Un.completeSpan({span:me,status:2,message:"Error in enableMic :: ".concat(We.t2.message)}),(Er=this._videosdkLogs)===null||Er===void 0||Er.pushLogs({logText:We.t2.message,logType:"ERROR",attributes:{error:"Error in enableMic() :: ".concat(We.t2.message)},dashboardLog:!0}),Se.error("enableMic() | failed:%o",We.t2),Pe.dispatch(xe({type:"error",text:"Error enabling microphone: ".concat(We.t2)})),We.next=141,this._protoo.request("produceError",{mediaType:"audio",message:We.t2.message});case 141:At&&At.stop();case 142:case"end":return We.stop()}},V,this,[[39,132],[50,56]])})),function(){return cs.apply(this,arguments)})},{key:"disableMic",value:($t=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de,Ne,Mt,Ut,ut,Vt,Nt,Kt,At,Et,Sr=arguments;return e().wrap(function(qt){for(;;)switch(qt.prev=qt.next){case 0:if(I=Sr.length>0&&Sr[0]!==void 0&&Sr[0],A=Sr.length>1&&Sr[1]!==void 0?Sr[1]:void 0,Se.debug("disableMic()"),K=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"disableMic() Calling",status:1,span:A||null}),this._micProducer){qt.next=8;break}return(X=this._openTelemetry)===null||X===void 0||X.completeSpan({span:K,status:2,message:"Error in disableMic() :: Mic Producer Not found"}),(Re=this._videosdkLogs)===null||Re===void 0||Re.pushLogs({logText:"Attempted to call disableMic() multiple times",attributes:{error:"Error in disableMic() :: Microphone is already disabled"},logType:"ERROR",dashboardLog:!0}),qt.abrupt("return");case 8:if(me=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"Closing Mic Producer",span:K,status:1}),this._micEnabled=!1,!this._micProducer||I){qt.next=32;break}return Z=(it=this._openTelemetry)===null||it===void 0?void 0:it.trace({spanName:"Pausing Mic Producer",span:me,status:1}),this._micProducer.pause(),Xe=he(this._micProducer.id),(Ue=this._openTelemetry)===null||Ue===void 0||Ue.completeSpan({span:Z,status:1,message:"Pause Mic Successfully"}),Pe.dispatch(Xe),this._eventEmitter.emit(Xe.type,Xe.payload),qt.prev=17,qt.next=20,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 20:(Le=this._openTelemetry)===null||Le===void 0||Le.completeSpan({span:me,status:1,message:"Requested Server to Close Producer"}),qt.next=30;break;case 23:qt.prev=23,qt.t0=qt.catch(17),Pe.dispatch(xe({type:"error",text:"Error closing server-side mic Producer: ".concat(qt.t0)})),Mt="Error in disableMic() :: Failed to close server-side microphone producer. closeProducer status: ".concat(I),(Ge=this._openTelemetry)===null||Ge===void 0||Ge.completeSpan({span:me,status:2,message:"Error in disableMic() :: ".concat(qt.t0.message)}),(de=this._openTelemetry)===null||de===void 0||de.completeSpan({span:K,status:2,message:Mt}),(Ne=this._videosdkLogs)===null||Ne===void 0||Ne.pushLogs({logText:Mt,logType:"ERROR",attributes:{error:qt.t0.message},dashboardLog:!0});case 30:return(et=this._openTelemetry)===null||et===void 0||et.completeSpan({span:K,status:1,message:"Mic Disabled Successfully"}),qt.abrupt("return");case 32:return this._micProducer.close(),Ut=he(this._micProducer.id),Pe.dispatch(Ut),this._eventEmitter.emit(Ut.type,Ut.payload),qt.prev=36,qt.next=39,this._protoo.request("closeProducer",{producerId:this._micProducer.id});case 39:(ut=this._openTelemetry)===null||ut===void 0||ut.completeSpan({span:me,status:1,message:"Requested Server to Close Producer"}),(Vt=this._openTelemetry)===null||Vt===void 0||Vt.completeSpan({span:K,status:1,message:"Mic Disabled Successfully"}),qt.next=50;break;case 43:qt.prev=43,qt.t1=qt.catch(36),Pe.dispatch(xe({type:"error",text:"Error closing server-side mic Producer: ".concat(qt.t1)})),Et="Error in disableMic() :: Failed to close server-side microphone producer. closeProducer status: ".concat(I),(Nt=this._openTelemetry)===null||Nt===void 0||Nt.completeSpan({span:me,status:2,message:"Error in disableMic() :: ".concat(qt.t1.message)}),(Kt=this._openTelemetry)===null||Kt===void 0||Kt.completeSpan({span:K,status:2,message:Et}),(At=this._videosdkLogs)===null||At===void 0||At.pushLogs({logText:Et,logType:"ERROR",attributes:{error:qt.t1.message},dashboardLog:!0});case 50:this._micProducer=null;case 51:case"end":return qt.stop()}},V,this,[[17,23],[36,43]])})),function(){return $t.apply(this,arguments)})},{key:"muteMic",value:(Kn=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return Se.debug("muteMic()"),this._micEnabled=!1,this._micProducer.pause(),x.prev=3,x.next=6,this._protoo.request("pauseProducer",{producerId:this._micProducer.id});case 6:Pe.dispatch({type:"SET_PRODUCER_PAUSED",payload:{producerId:this._micProducer.id}}),x.next=14;break;case 9:x.prev=9,x.t0=x.catch(3),Se.error("muteMic() | failed: %o",x.t0),(D=this._videosdkLogs)===null||D===void 0||D.pushLogs({logText:"Error pausing server-side mic Producer",logType:"ERROR",attributes:{error:x.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error pausing server-side mic Producer: ".concat(x.t0)}));case 14:case"end":return x.stop()}},V,this,[[3,9]])})),function(){return Kn.apply(this,arguments)})},{key:"unmuteMic",value:(_i=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return Se.debug("unmuteMic()"),this._micEnabled=!0,this._micProducer.resume(),x.prev=3,x.next=6,this._protoo.request("resumeProducer",{producerId:this._micProducer.id});case 6:Pe.dispatch({type:"SET_PRODUCER_RESUMED",payload:{producerId:this._micProducer.id}}),x.next=14;break;case 9:x.prev=9,x.t0=x.catch(3),Se.error("unmuteMic() | failed: %o",x.t0),(D=this._videosdkLogs)===null||D===void 0||D.pushLogs({logText:"Error resuming server-side mic Producer",logType:"ERROR",attributes:{error:x.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error resuming server-side mic Producer: ".concat(x.t0)}));case 14:case"end":return x.stop()}},V,this,[[3,9]])})),function(){return _i.apply(this,arguments)})},{key:"enableWebcam",value:(Gn=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de,Ne,Mt,Ut,ut,Vt,Nt,Kt,At,Et,Sr,qt,Xt,Ir,on,nn,hr,Xr,mn,vn,fn,sr,Zr,Rt,Wr,mt,Zt,xr,Vr,Br,Mr,Nn,Zn,jn,yn,Bn,la,Yn,Nr,ea,en,Tn,On,gn,Dn,Fn,bn,xn,wn,Kr,cn,an,dn,Rr,Un,Er=this,mr=arguments;return e().wrap(function(qe){for(;;)switch(qe.prev=qe.next){case 0:if(X=mr.length>0&&mr[0]!==void 0?mr[0]:void 0,Re=mr.length>1&&mr[1]!==void 0?mr[1]:void 0,me=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"enableWebcam() Calling ".concat(X?"With Custom Video Track":"Without Custom Video Track "),attributes:{customVideoConfig:X?JSON.stringify(X):"Not Specify Custom Track"},span:Re||null}),Se.debug("enableWebcam()"),this._webcamEnabled=!0,!this._webcamProducer){qe.next=9;break}return(it=this._openTelemetry)===null||it===void 0||it.completeSpan({span:me,status:2,message:"Error in enableWebcam() :: Webcam Producer found"}),(Ue=this._videosdkLogs)===null||Ue===void 0||Ue.pushLogs({logText:"Attempted to call enableWebcam() multiple times",attributes:{error:"Error in enableWebcam() :: Webcam is already enabled"},logType:"ERROR",dashboardLog:!0}),qe.abrupt("return");case 9:if(!this._mediasoupDevice){qe.next=18;break}if(this._mediasoupDevice.canProduce("video")){qe.next=16;break}return Xe=this._deviceInfo.sdkType=="react-native"?Ce.q.ERROR_RN_CAMERA_ACCESS_UNAVAILABLE.message:Ce.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message,(et=this._openTelemetry)===null||et===void 0||et.completeSpan({span:me,status:2,message:"Error in enableWebcam() :: ".concat(Xe)}),(Z=this._videosdkLogs)===null||Z===void 0||Z.pushLogs({logText:Xe,attributes:{error:"Error in enableWebcam() :: Camera access unavailable"},logType:"ERROR",dashboardLog:!0}),Se.error("enableWebcam() | cannot produce video"),qe.abrupt("return");case 16:qe.next=21;break;case 18:return(Le=this._videosdkLogs)===null||Le===void 0||Le.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the webcam. Please try again.",logType:"ERROR",attributes:{error:"Error in enableWebcam(): Something went wrong."}}),(Ge=this._openTelemetry)===null||Ge===void 0||Ge.completeSpan({span:me,status:2,message:"Error in enableWebcam() :: mediasoupDevice is undefined"}),qe.abrupt("return");case 21:if(Pe.dispatch(st(!0)),Mt=this._webcam.resolution,qe.prev=23,this._externalVideo){qe.next=100;break}return qe.next=27,this._updateWebcams(me);case 27:if(Ne=this._webcam.device){qe.next=31;break}throw new Error("Whoops! No Webcam Found: We couldn't find your camera. Is it plugged in and turned on? If so, try restarting your computer or checking your device settings. If you need help, check out troubleshooter at https://test.8x8.vc/. Also, ensure you're on a secure website (https://).");case 31:Se.debug("enableWebcam() | calling getUserMedia()");try{X&&(de=X.getVideoTracks()[0]).readyState=="ended"&&(de=null,At=Ce.q.ERROR_CUSTOM_VIDEO_TRACK_ENDED,(Kt=this._videosdkLogs)===null||Kt===void 0||Kt.pushLogs({logText:At.message,logType:"INFO",attributes:{error:"In enableWebcam() :: Invalid Custom Track Passed"},dashboardLog:!0}),this._emitError(At))}catch(We){Sr=Ce.q.ERROR_INVALID_CUSTOM_VIDEO_TRACK,(Et=this._videosdkLogs)===null||Et===void 0||Et.pushLogs({logText:Sr.message,logType:"INFO",attributes:{error:"In enableWebcam() :: Invalid Custom Track Passed"}}),this._emitError(Sr),console.log("Invalid Custom Video Track Passed. Reverting to default Error: ".concat(We))}if(de){qe.next=98;break}if(Xt=(qt=this._openTelemetry)===null||qt===void 0?void 0:qt.trace({spanName:"Creating Track",span:me}),Ir=null,qe.prev=36,this._webcam.resolution!="hd"){qe.next=44;break}return qe.next=40,this.createCameraVideoTrack({cameraId:Ne.deviceId,encoderConfig:"h720p_w1280p",multiStream:this._useSimulcast,facingMode:Ne.facing});case 40:X=qe.sent,Ir=JSON.stringify({encoderConfig:"h720p_w1280p",multiStream:this._useSimulcast}),qe.next=48;break;case 44:return qe.next=46,this.createCameraVideoTrack({cameraId:Ne.deviceId,encoderConfig:"h540p_w960p",multiStream:this._useSimulcast,facingMode:Ne.facing});case 46:X=qe.sent,Ir=JSON.stringify({encoderConfig:"h540p_w960p",multiStream:this._useSimulcast});case 48:de=X.getVideoTracks()[0],(on=this._openTelemetry)===null||on===void 0||on.completeSpan({message:"Video Track Generated",span:Xt,attributes:{customVideoTrackConfig:Ir},status:1}),qe.next=98;break;case 52:if(qe.prev=52,qe.t0=qe.catch(36),(nn=this._openTelemetry)===null||nn===void 0||nn.completeSpan({message:"Error in enableWebcam() :: ".concat(qe.t0.message),span:Xt,status:2}),qe.t0.name!=="SecurityError"){qe.next=63;break}mn=Ce.q.ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED,vn=mn.message,this._emitError(mn),(hr=this._videosdkLogs)===null||hr===void 0||hr.pushLogs({logText:vn,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: Camera Permission Denied or Dismissed"},dashboardLog:!0}),(Xr=this._openTelemetry)===null||Xr===void 0||Xr.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(vn),span:enableMicSpan,status:2}),qe.next=97;break;case 63:if(qe.t0.name!=="DOMException"){qe.next=71;break}Zr=Ce.q.ERROR_RN_CAMERA_NOT_FOUND,Rt=Zr.message,this._emitError(Zr),(fn=this._videosdkLogs)===null||fn===void 0||fn.pushLogs({logText:Rt,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: No Camra Device Found"},dashboardLog:!0}),(sr=this._openTelemetry)===null||sr===void 0||sr.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(Rt),span:enableMicSpan,status:2}),qe.next=97;break;case 71:if(!(qe.t0 instanceof DOMException)){qe.next=94;break}qe.t1=qe.t0.name,qe.next=qe.t1==="NotAllowedError"?75:qe.t1==="NotReadableError"?78:qe.t1==="NotFoundError"?81:88;break;case 75:return Wr=this.handleNotAllowedError(qe.t0,this._openTelemetry,this._videosdkLogs,me,"video"),this._emitError(Wr),qe.abrupt("break",92);case 78:return mt=this.handleNotReadableError(qe.t0,this._openTelemetry,this._videosdkLogs,me,"video"),this._emitError(mt),qe.abrupt("break",92);case 81:return Zt=Ce.q.ERROR_CAMERA_NOT_FOUND,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(Zt=Ce.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS),xr=Zt.message,this._emitError(Zt),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:xr,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: No Webcam Device Found"},dashboardLog:!0}),(I=this._openTelemetry)===null||I===void 0||I.completeSpan({message:"Error in enableWebcam() :: occurred in creating video track, ".concat(xr),span:me,status:2}),qe.abrupt("break",92);case 88:return Vr="An error occurred in creating video track, ".concat(qe.t0.message),(A=this._videosdkLogs)===null||A===void 0||A.pushLogs({logText:qe.t0.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(Vr)},dashboardLog:!0}),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({message:"Error in enableWebcam() :: ".concat(Vr),span:me,status:2}),qe.abrupt("break",92);case 92:qe.next=97;break;case 94:Nn="An error occurred in creating video track, ".concat(qe.t0.message),(Br=this._videosdkLogs)===null||Br===void 0||Br.pushLogs({logText:qe.t0.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(Nn)},dashboardLog:!0}),(Mr=this._openTelemetry)===null||Mr===void 0||Mr.completeSpan({message:"Error in enableWebcam() :: ".concat(Nn),span:me,status:2});case 97:return qe.abrupt("return");case 98:qe.next=105;break;case 100:return Ne={label:"external video"},qe.next=103,this._getExternalVideoStream();case 103:Zn=qe.sent,de=Zn.getVideoTracks()[0].clone();case 105:if(jn=(Ut=this._openTelemetry)===null||Ut===void 0?void 0:Ut.trace({spanName:"Generating Producer Configuration",span:me}),la={videoGoogleStartBitrate:1e3},!this._forceH264){qe.next=114;break}if(Bn=this._mediasoupDevice.rtpCapabilities.codecs.find(function(We){return We.mimeType.toLowerCase()==="video/h264"})){qe.next=112;break}throw new Error("The desired H.264 codec and configuration are not supported");case 112:qe.next=119;break;case 114:if(!this._forceVP9){qe.next=119;break}if(Bn=this._mediasoupDevice.rtpCapabilities.codecs.find(function(We){return We.mimeType.toLowerCase()==="video/vp9"})){qe.next=119;break}throw new Error("The desired VP9 codec and configuration are not supported");case 119:de?(Yn=de.getConstraints(),Nr=this._deviceInfo.sdkType=="react-native"&&this._deviceInfo.platform=="ios",yn=wt(!1,Yn.width,Yn.height,{simulcast:X.multiStream},Nr)):this._useSimulcast&&(ea=this._mediasoupDevice.rtpCapabilities.codecs.find(function(We){return We.kind==="video"}),yn=this._forceVP9&&Bn||ea.mimeType.toLowerCase()==="video/vp9"?Na:Ua[this._webcam.resolution]),en={};try{en={encodings:yn,width:X?(Tn=de)===null||Tn===void 0?void 0:Tn.getConstraints().width:Da[Mt].width.ideal,height:X?(On=de)===null||On===void 0?void 0:On.getConstraints().height:Da[Mt].height.ideal}}catch(We){(gn=this._videosdkLogs)===null||gn===void 0||gn.pushLogs({logText:We.message,logType:"INFO",attributes:{error:"In enableWebcam() :: ".concat(We.message)},dashboardLog:!0}),console.log(We)}if((ut=this._openTelemetry)===null||ut===void 0||ut.traceAutoComplete({spanName:"Track Generated with height ".concat(en.height," and width ").concat(en.width," with multiStream ").concat(this._useSimulcast),attributes:{appData:JSON.stringify(en)},span:me,status:1}),(Vt=this._openTelemetry)===null||Vt===void 0||Vt.completeSpan({span:jn,status:1,message:"Producer Configuration Generated"}),jn=(Nt=this._openTelemetry)===null||Nt===void 0?void 0:Nt.trace({spanName:"Creating Webcam Producer",span:me}),!this._sendTransport){qe.next=131;break}return qe.next=128,this._sendTransport.produce({track:de,encodings:yn,codecOptions:la,codec:Bn,appData:en});case 128:this._webcamProducer=qe.sent,qe.next=134;break;case 131:return(Dn=this._videosdkLogs)===null||Dn===void 0||Dn.pushLogs({logText:Ce.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED.message,attributes:{error:"Error in enableWebcam() :: Transport is not setup"},logType:"ERROR",dashboardLog:!0}),this._emitError(Ce.q.ERROR_ACTION_PERFORMED_BEFORE_MEETING_JOINED),qe.abrupt("return");case 134:de.getConstraints().deviceId&&(this._webcam.device=this._webcams.get(de.getConstraints().deviceId)),this._webcamProducer?(xn=pe({id:this._webcamProducer.id,deviceLabel:Ne.label,type:this._getWebcamType(Ne),paused:this._webcamProducer.paused,track:this._webcamProducer.track,rtpParameters:this._webcamProducer.rtpParameters,codec:this._webcamProducer.rtpParameters.codecs[0].mimeType.split("/")[1],instance:this._webcamProducer}),Pe.dispatch(xn),this._eventEmitter.emit(xn.type,xn.payload),wn=0,(Kr=this._metrics.addNewProbe(this._webcamProducer,"producer")).onStatsCollected=function(We){try{var or;Er._stats.producerStats||(Er._stats.producerStats={}),Er._stats.producerStats.video||(Er._stats.producerStats.video=[]),Er._webcamProducer&&(Er._latestStats[(or=Er._webcamProducer)===null||or===void 0?void 0:or.id]=[]),We.video.forEach(function(_n){var un;Er._latestStats[(un=Er._webcamProducer)===null||un===void 0?void 0:un.id].push(_n)}),wn%5==0&&Er._webcamProducer!=null&&Er._stats.producerStats.video.push({timestamp:new Date,stats:Er._latestStats[Er._webcamProducer.id]}),wn++}catch(_n){var Dr;(Dr=Er._videosdkLogs)===null||Dr===void 0||Dr.pushLogs({logText:"Error PRODUCER Stats ERROR",logType:"ERROR",attributes:{error:_n.message}}),console.log("PRODUCER ERROR",_n)}},Kr.start(),this._webcamProducer.observer.on("close",function(){Kr.stop(),Er._metrics.removeExistingProbe(Kr)}),this._webcamProducer.on("transportclose",function(){var We,or=he(Er._webcamProducer.id);Pe.dispatch(or),Er._eventEmitter.emit(or.type,or.payload),(We=Er._webcamProducer)===null||We===void 0||We.close(),Er._webcamProducer=null}),this._webcamProducer.on("trackended",function(){var We,or,Dr=Er._deviceInfo.sdkType=="react-native"?Ce.q.ERROR_RN_CAMERA_TRACK_ENDED:Ce.q.ERROR_WEBCAM_TRACK_ENDED;(We=Er._videosdkLogs)===null||We===void 0||We.pushLogs({logText:Dr.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(Dr.message)},dashboardLog:!0}),(or=Er._openTelemetry)===null||or===void 0||or.traceAutoComplete({spanName:"this._webcamProducer trackended or Webcam disconnected!",span:me,message:Dr.message,status:2}),Pe.dispatch(xe({type:"error",text:"Webcam disconnected!"})),Er.disableWebcam(me).catch(function(){})}),(Fn=this._openTelemetry)===null||Fn===void 0||Fn.completeSpan({span:jn,status:1,message:"Webcam Producer Created"}),(bn=this._openTelemetry)===null||bn===void 0||bn.completeSpan({span:me,status:1,message:"Enable Webcam Successful"})):((cn=this._videosdkLogs)===null||cn===void 0||cn.pushLogs({logText:"Oops! Something went wrong, and we're unable to enable the webcam. Please try again.",logType:"ERROR",attributes:{error:"Error in enableWebcam(): Something went wrong."},dashboardLog:!0}),(an=this._openTelemetry)===null||an===void 0||an.completeSpan({span:jn,status:2,message:"Error in enableWebcam() :: webcamProducer null"}),(dn=this._openTelemetry)===null||dn===void 0||dn.completeSpan({span:me,status:2,message:"Error in enableWebcam() :: webcamProducer null"})),qe.next=146;break;case 138:return qe.prev=138,qe.t2=qe.catch(23),(Rr=this._videosdkLogs)===null||Rr===void 0||Rr.pushLogs({logText:qe.t2.message,logType:"ERROR",attributes:{error:"Error in enableWebcam() :: ".concat(qe.t2.message)},dashboardLog:!0}),(Un=this._openTelemetry)===null||Un===void 0||Un.completeSpan({span:me,status:2,message:"Error in enableWebcam() :: ".concat(qe.t2.message)}),Pe.dispatch(xe({type:"error",text:"Error enabling webcam: ".concat(qe.t2)})),qe.next=145,this._protoo.request("produceError",{mediaType:"video",message:qe.t2.message});case 145:de&&de.stop();case 146:Pe.dispatch(st(!1));case 147:case"end":return qe.stop()}},V,this,[[23,138],[36,52]])})),function(){return Gn.apply(this,arguments)})},{key:"handleNotAllowedError",value:function(V,D,x,I,A){var K={};return K=V.message==="Permission denied"||V.message==="Permission dismissed"?A==="video"?Ce.q.ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:Ce.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:V.message.includes("The request is not allowed by the user agent")?A==="video"?Ce.q.ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:Ce.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:V.message==="Permission denied by system"?A==="video"?Ce.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS:Ce.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:A==="video"?Ce.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:Ce.q.ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED,x.pushLogs({logText:K.message,logType:"ERROR",attributes:{error:"Error in ".concat(A==="video"?"enableWebcam()":"enableMic()"," :: ").concat(V.message)},dashboardLog:!0}),D.completeSpan({message:A==="video"?"Error in enableWebcam() :: occurred in creating video track, ".concat(K.message):"Error in enableMic() :: occurred in creating audio track, ".concat(K.message),span:I,status:2}),K}},{key:"handleNotReadableError",value:function(V,D,x,I,A){var K={};return K=V.message==="Device in use"?A==="video"?Ce.q.ERROR_CAMERA_IN_USE:Ce.q.ERROR_MICROPHONE_IN_USE:A==="video"?Ce.q.ERROR_VIDEO_SOURCE_INITIATION_FAILED:Ce.q.ERROR_MICROPHONE_IN_USE,x.pushLogs({logText:K.message,logType:"ERROR",attributes:{error:"Error in ".concat(A==="video"?"enableWebcam()":"enableMic()"," :: ").concat(V.message)},dashboardLog:!0}),D.completeSpan({message:A==="video"?"Error in enableWebcam() :: occurred in creating video track, ".concat(K.message):"Error in enableMic() :: occurred in creating audio track, ".concat(K.message),span:I,status:2}),K}},{key:"createCameraVideoTrack",value:(ua=(0,d.A)(e().mark(function V(D){var x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le;return e().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:return x=D.cameraId,I=x===void 0?void 0:x,A=D.encoderConfig,K=A===void 0?void 0:A,X=D.facingMode,Re=X===void 0?void 0:X,me=D.optimizationMode,it=me===void 0?void 0:me,Ue=D.multiStream,et=Ue===void 0||Ue,Z=K?zt.$.videoProfiles[K]:zt.$.videoProfiles.h360p_w640p,Xe={video:{deviceId:I||void 0,facingMode:Re||void 0,width:Z.width,height:Z.height,frameRate:Z.frameRate}},Ge.next=5,(0,kn.lp)(Xe);case 5:return Le=Ge.sent,it&&(Le.contentHint=it),Le.encoderConfig=K||"h360p_w640p",Le.contentHint=it||"",Le.multiStream=et,Le.cameraId=I,Ge.abrupt("return",Le);case 12:case"end":return Ge.stop()}},V)})),function(V){return ua.apply(this,arguments)})},{key:"disableWebcam",value:(Bs=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le=arguments;return e().wrap(function(Ge){for(;;)switch(Ge.prev=Ge.next){case 0:if(I=Le.length>0&&Le[0]!==void 0?Le[0]:void 0,A=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"disableWebcam() Calling",status:1,span:I||null}),Se.debug("disableWebcam()"),this._webcamEnabled=!1,this._webcamProducer){Ge.next=8;break}return(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:A,status:2,message:"Error in disableWebcam() :: Webcam Producer Not found"}),(X=this._videosdkLogs)===null||X===void 0||X.pushLogs({logText:"Attempted to call disableWebcam() multiple times",attributes:{error:"Error in disableWebcam() :: Webcam is already disabled"},logType:"ERROR",dashboardLog:!0}),Ge.abrupt("return");case 8:return Re=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"Closing Webcam Producer",span:A,status:1}),this._webcamProducer.close(),me=he(this._webcamProducer.id),Pe.dispatch(me),this._eventEmitter.emit(me.type,me.payload),Ge.prev=13,Ge.next=16,this._protoo.request("closeProducer",{producerId:this._webcamProducer.id});case 16:(it=this._openTelemetry)===null||it===void 0||it.completeSpan({span:Re,status:1,message:"Requested Server to Close Producer"}),this._webcamProducer=null,(Ue=this._openTelemetry)===null||Ue===void 0||Ue.completeSpan({span:A,status:1,message:"Webcam Disabled Successfully"}),Ge.next=27;break;case 21:Ge.prev=21,Ge.t0=Ge.catch(13),(et=this._videosdkLogs)===null||et===void 0||et.pushLogs({logText:"Error in disableWebcam() :: Failed to close server-side webcam producer",logType:"ERROR",attributes:{error:Ge.t0.message},dashboardLog:!0}),(Z=this._openTelemetry)===null||Z===void 0||Z.completeSpan({span:Re,status:2,message:"Error in disableWebcam() :: closing server-side webcam Producer: ".concat(Ge.t0)}),(Xe=this._openTelemetry)===null||Xe===void 0||Xe.completeSpan({span:A,status:2,message:"Error in disableWebcam() :: closing server-side webcam Producer: ".concat(Ge.t0)}),Pe.dispatch(xe({type:"error",text:"Error closing server-side webcam Producer: ".concat(Ge.t0)}));case 27:case"end":return Ge.stop()}},V,this,[[13,21]])})),function(){return Bs.apply(this,arguments)})},{key:"getMics",value:(ka=(0,d.A)(e().mark(function V(){var D,x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return D=[],I.prev=1,I.next=4,this._updateMics();case 4:this._mics.forEach(function(A,K){D.push({deviceId:K,label:A.label})}),I.next=11;break;case 7:I.prev=7,I.t0=I.catch(1),Se.error("getMics() | Error",I.t0),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:I.t0.message,logType:"ERROR",attributes:{error:"Error in getMics() :: Not able to get Mic List"},dashboardLog:!0});case 11:return I.abrupt("return",D);case 12:case"end":return I.stop()}},V,this,[[1,7]])})),function(){return ka.apply(this,arguments)})},{key:"changeMic",value:(gi=(0,d.A)(e().mark(function V(D){var x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge;return e().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(I=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"changeMic() Calling"}),de.prev=1,(0,S.A)(D)!="object"){de.next=9;break}return de.next=5,this.disableMic(!0,I);case 5:return de.next=7,this.enableMic(D,I);case 7:de.next=27;break;case 9:return Re=D,de.next=12,this._updateMics();case 12:if(me=Array.from(this._mics.keys()),it=me.length,Ue=this._mic.device?this._mic.device.deviceId:void 0,Re!=null&&Re!=null?et=me.indexOf(Re):(et=me.indexOf(Ue))<it-1?et++:et=0,this._mic.device=this._mics.get(me[et]),Z=(A=this._openTelemetry)===null||A===void 0?void 0:A.trace({spanName:"Getting Selected Mic",span:I,attributes:{selectedWebcam:this._mic.device?JSON.stringify(this._mic.device):"No Mic devices"}}),this._mic.device){de.next=21;break}throw(Xe=this._videosdkLogs)===null||Xe===void 0||Xe.pushLogs({logText:"Error changeMic : No mic Found",logType:"ERROR"}),new Error("No mic Found");case 21:return de.next=23,this.disableMic(!0,I);case 23:return de.next=25,this.enableMic(void 0,I);case 25:(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:Z,status:1,message:"Done"}),(X=this._openTelemetry)===null||X===void 0||X.completeSpan({span:I,status:1,message:"changeMic() Ending"});case 27:de.next=33;break;case 29:de.prev=29,de.t0=de.catch(1),(Le=this._openTelemetry)===null||Le===void 0||Le.completeSpan({span:I,status:2,message:"changeMic() | Error ".concat(de.t0)}),(Ge=this._videosdkLogs)===null||Ge===void 0||Ge.pushLogs({logText:"Error changeMic() | Error",logType:"ERROR",attributes:{error:de.t0.message}});case 33:case"end":return de.stop()}},V,this,[[1,29]])})),function(V){return gi.apply(this,arguments)})},{key:"getWebcams",value:(fi=(0,d.A)(e().mark(function V(){var D,x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return D=[],I.prev=1,I.next=4,this._updateWebcams();case 4:this._webcams.forEach(function(A,K){D.push({deviceId:K,label:A.label,facingMode:A.facing||"environment"})}),I.next=11;break;case 7:I.prev=7,I.t0=I.catch(1),Se.error("getWebcams() | failed %o",I.t0),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:I.t0.message,logType:"ERROR",attributes:{error:"Error in getWebcams() :: Not able to get Webcam List"},dashboardLog:!0});case 11:return I.abrupt("return",D);case 12:case"end":return I.stop()}},V,this,[[1,7]])})),function(){return fi.apply(this,arguments)})},{key:"replaceWebcamStream",value:(mi=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!this._webcamProducer){I.next=7;break}return x=D.getVideoTracks()[0],I.next=4,this._webcamProducer.replaceTrack({track:x});case 4:this._eventEmitter.emit("UPDATE_PRODUCER",{producer:this._webcamProducer}),I.next=11;break;case 7:return I.next=9,this.disableWebcam();case 9:return I.next=11,this.enableWebcam(D);case 11:case"end":return I.stop()}},V,this)})),function(V){return mi.apply(this,arguments)})},{key:"changeWebcam",value:(hi=(0,d.A)(e().mark(function V(D){var x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge;return e().wrap(function(de){for(;;)switch(de.prev=de.next){case 0:if(I=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"changeWebcam() Calling"}),Pe.dispatch(st(!0)),(0,S.A)(D)!=="object"){de.next=17;break}return de.prev=3,de.next=6,this.disableWebcam(I);case 6:return de.next=8,this.enableWebcam(D,I);case 8:de.next=15;break;case 10:de.prev=10,de.t0=de.catch(3),Se.error("changeWebcam() | failed: %o",de.t0),(A=this._videosdkLogs)===null||A===void 0||A.pushLogs({logText:"Error Could not change webcam",logType:"ERROR",attributes:{object:JSON.stringify(D),error:de.t0.message}}),Pe.dispatch(xe({type:"error",text:"Could not change webcam: ".concat(de.t0)}));case 15:de.next=46;break;case 17:return de.prev=17,de.next=20,this._updateWebcams(I);case 20:if(me=Array.from(this._webcams.keys()),it=me.length,Ue=this._webcam.device?this._webcam.device.deviceId:void 0,D!=null&&D!=null?et=me.indexOf(D):(et=me.indexOf(Ue))<it-1?et++:et=0,this._webcam.device=this._webcams.get(me[et]),Se.debug("changeWebcam() | new selected webcam [device:%o]",this._webcam.device),this._webcam.resolution=this._webcam.resolution||"hd",Z=(K=this._openTelemetry)===null||K===void 0?void 0:K.trace({spanName:"Getting Selected Webcam",span:I,attributes:{selectedWebcam:this._webcam.device?JSON.stringify(this._webcam.device):"No webcam devices"}}),this._webcam.device){de.next=31;break}throw(Xe=this._videosdkLogs)===null||Xe===void 0||Xe.pushLogs({logText:"Error changeWebcam : No webcam Found",logType:"ERROR"}),new Error("no webcam devices");case 31:return de.next=33,this.disableWebcam(I);case 33:return de.next=35,this.enableWebcam(void 0,I);case 35:return(X=this._openTelemetry)===null||X===void 0||X.completeSpan({span:Z,status:1,message:"Done"}),(Re=this._openTelemetry)===null||Re===void 0||Re.completeSpan({span:I,status:1,message:"changeWebcam() Ending"}),de.abrupt("return");case 40:de.prev=40,de.t1=de.catch(17),Se.error("changeWebcam() | failed: %o",de.t1),(Le=this._videosdkLogs)===null||Le===void 0||Le.pushLogs({logText:"Error Could not change webcam",logType:"ERROR",attributes:{object:JSON.stringify(D),error:de.t1.message}}),(Ge=this._openTelemetry)===null||Ge===void 0||Ge.completeSpan({span:I,status:2,message:"Could not change webcam ".concat(de.t1)}),Pe.dispatch(xe({type:"error",text:"Could not change webcam: ".concat(de.t1)}));case 46:Pe.dispatch(st(!1));case 47:case"end":return de.stop()}},V,this,[[3,10],[17,40]])})),function(V){return hi.apply(this,arguments)})},{key:"changeWebcamResolution",value:(pi=(0,d.A)(e().mark(function V(){var D,x,I,A;return e().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:Se.debug("changeWebcamResolution()"),Pe.dispatch(st(!0)),K.prev=2,K.t0=this._webcam.resolution,K.next=K.t0==="qvga"?6:K.t0==="vga"?8:K.t0==="hd"?10:12;break;case 6:return this._webcam.resolution="vga",K.abrupt("break",13);case 8:return this._webcam.resolution="hd",K.abrupt("break",13);case 10:return this._webcam.resolution="qvga",K.abrupt("break",13);case 12:this._webcam.resolution="hd";case 13:return Se.debug("changeWebcamResolution() | calling getUserMedia()"),K.prev=14,K.next=17,navigator.mediaDevices.getUserMedia({video:Gr({deviceId:{exact:this._webcam.device.deviceId}},Da[this._webcam.resolution])});case 17:D=K.sent,K.next=25;break;case 20:return K.prev=20,K.t1=K.catch(14),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"Error in getUserMedia for changeWebcamResolution",logType:"ERROR",attributes:{error:JSON.stringify(K.t1)}}),K.t1.message==="Permission denied"||K.t1.name==="NotAllowedError"?this._emitError(Ce.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED):this._emitError(Ce.q.ERROR_GET_VIDEO_MEDIA),K.abrupt("return");case 25:return I=D.getVideoTracks()[0],K.next=28,this._webcamProducer.replaceTrack({track:I});case 28:Pe.dispatch(Ze(this._webcamProducer.id,I)),K.next=36;break;case 31:K.prev=31,K.t2=K.catch(2),Se.error("changeWebcamResolution() | failed: %o",K.t2),(A=this._videosdkLogs)===null||A===void 0||A.pushLogs({logText:"Error Could not change webcam resolution",logType:"ERROR",attributes:{error:K.t2.message}}),Pe.dispatch(xe({type:"error",text:"Could not change webcam resolution: ".concat(K.t2)}));case 36:Pe.dispatch(st(!1));case 37:case"end":return K.stop()}},V,this,[[2,31],[14,20]])})),function(){return pi.apply(this,arguments)})},{key:"enableShare",value:(js=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de,Ne,Mt,Ut,ut,Vt,Nt,Kt,At,Et,Sr,qt,Xt,Ir,on,nn,hr,Xr,mn,vn,fn,sr,Zr,Rt=this,Wr=arguments;return e().wrap(function(mt){for(;;)switch(mt.prev=mt.next){case 0:if(x=Wr.length>0&&Wr[0]!==void 0?Wr[0]:void 0,I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"enableShare() Calling ".concat(x?"With Custom Video Track":"Without Custom Video Track "),attributes:{customShareConfig:x?JSON.stringify(x):"Not Specify Custom Track"}}),Se.debug("enableShare()"),!this._shareProducer){mt.next=6;break}return(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:I,status:2,message:"Screen Share Producer found"}),mt.abrupt("return");case 6:if(this._mediasoupDevice.canProduce("video")){mt.next=10;break}return(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:I,status:2,message:"enableShare() | cannot produce video"}),Se.error("enableShare() | cannot produce video"),mt.abrupt("return");case 10:if(Pe.dispatch(_r(!0)),mt.prev=11,Se.debug("enableShare() | calling getUserMedia()"),Le=(me=this._openTelemetry)===null||me===void 0?void 0:me.trace({spanName:"Creating Track",span:I}),!x||!x.active){mt.next=19;break}X=x.getVideoTracks()[0],Re=x.getAudioTracks()[0],mt.next=38;break;case 19:return mt.prev=19,mt.next=22,navigator.mediaDevices.getDisplayMedia({audio:!0,video:{width:{max:1920},height:{max:1080},frameRate:{max:10}}});case 22:de=mt.sent,mt.next=31;break;case 25:return mt.prev=25,mt.t0=mt.catch(19),(Ne=this._videosdkLogs)===null||Ne===void 0||Ne.pushLogs({logText:"Error in getDisplayMedia for screen share",logType:"ERROR",attributes:{error:JSON.stringify(mt.t0)}}),(Mt=this._openTelemetry)===null||Mt===void 0||Mt.completeSpan({span:I,status:2,message:"Error in getDisplayMedia for screen share ".concat(mt.t0)}),mt.t0.message==="Permission denied"||mt.t0.name==="NotAllowedError"?this._emitError(Ce.q.ERROR_GET_DISPLAY_MEDIA_PERMISSION_DENIED):this._emitError(Ce.q.ERROR_GET_DISPLAY_MEDIA),mt.abrupt("return");case 31:if(de){mt.next=35;break}return Pe.dispatch(_r(!0)),(Ut=this._openTelemetry)===null||Ut===void 0||Ut.completeSpan({span:I,status:2,message:"Stream not found"}),mt.abrupt("return");case 35:X=de.getVideoTracks()[0],Re=de.getAudioTracks()[0],(Ge=this._openTelemetry)===null||Ge===void 0||Ge.completeSpan({message:"Track Generated with height ".concat(X.getSettings().height," and width ").concat(X.getSettings().width),span:Le,status:1});case 38:if(ut=(it=this._openTelemetry)===null||it===void 0?void 0:it.trace({spanName:"Generating Producer Configuration",span:I}),Kt={videoGoogleStartBitrate:1e3},!this._forceH264){mt.next=47;break}if(Nt=this._mediasoupDevice.rtpCapabilities.codecs.find(function(Zt){return Zt.mimeType.toLowerCase()==="video/h264"})){mt.next=45;break}throw(At=this._videosdkLogs)===null||At===void 0||At.pushLogs({logText:"Error EnableShare : desired H264 codec+configuration is not supported",logType:"ERROR"}),new Error("desired H264 codec+configuration is not supported");case 45:mt.next=52;break;case 47:if(!this._forceVP9){mt.next=52;break}if(Nt=this._mediasoupDevice.rtpCapabilities.codecs.find(function(Zt){return Zt.mimeType.toLowerCase()==="video/vp9"})){mt.next=52;break}throw(Et=this._videosdkLogs)===null||Et===void 0||Et.pushLogs({logText:"Error EnableShare :desired VP9 codec+configuration is not supported",logType:"ERROR"}),new Error("desired VP9 codec+configuration is not supported");case 52:return this._useSharingSimulcast&&(Sr=this._mediasoupDevice.rtpCapabilities.codecs.find(function(Zt){return Zt.kind==="video"}),Vt=this._forceVP9&&Nt||Sr.mimeType.toLowerCase()==="video/vp9"?ss:gs.map(function(Zt){return Gr(Gr({},Zt),{},{dtx:!0})})),(Ue=this._openTelemetry)===null||Ue===void 0||Ue.completeSpan({span:ut,status:1,message:"Producer Configuration Generated"}),ut=(et=this._openTelemetry)===null||et===void 0?void 0:et.trace({spanName:"Creating Share Producer",span:I}),mt.next=57,this._sendTransport.produce({track:X,encodings:Vt,codecOptions:Kt,codec:Nt,appData:{share:!0}});case 57:if(this._shareProducer=mt.sent,qt=pe({id:this._shareProducer.id,type:"share",paused:this._shareProducer.paused,track:this._shareProducer.track,rtpParameters:this._shareProducer.rtpParameters,codec:this._shareProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0},instance:this._shareProducer}),Pe.dispatch(qt),this._eventEmitter.emit(qt.type,qt.payload),this._shareProducer.on("transportclose",function(){var Zt,xr=he(Rt._shareProducer.id);Pe.dispatch(xr),Rt._eventEmitter.emit(xr.type,xr.payload),(Zt=Rt._shareProducer)===null||Zt===void 0||Zt.close(),Rt._shareProducer=null}),this._shareProducer.on("trackended",function(){var Zt;(Zt=Rt._openTelemetry)===null||Zt===void 0||Zt.traceAutoComplete({spanName:"this._shareProducer trackended or Share disconnected!",span:I,status:2}),Pe.dispatch(xe({type:"error",text:"Share disconnected!"})),Rt.disableShare().catch(function(){})}),(Z=this._openTelemetry)===null||Z===void 0||Z.completeSpan({span:ut,status:1,message:"Share Producer Created"}),!Re){mt.next=84;break}return mt.prev=65,on={opusStereo:1,opusDtx:1},ut=(Xt=this._openTelemetry)===null||Xt===void 0?void 0:Xt.trace({spanName:"Creating Share Audio Producer",span:I}),mt.next=70,this._sendTransport.produce({track:Re,codecOptions:on,appData:{share:!0}});case 70:this._shareAudioProducer=mt.sent,nn=pe({id:this._shareAudioProducer.id,type:"share",paused:this._shareAudioProducer.paused,track:this._shareAudioProducer.track,rtpParameters:this._shareAudioProducer.rtpParameters,codec:this._shareAudioProducer.rtpParameters.codecs[0].mimeType.split("/")[1],appData:{share:!0},instance:this._shareAudioProducer}),Pe.dispatch(nn),this._eventEmitter.emit(nn.type,nn.payload),this._shareAudioProducer.on("transportclose",function(){var Zt,xr=he(Rt._shareAudioProducer.id);Pe.dispatch(xr),Rt._eventEmitter.emit(xr.type,xr.payload),(Zt=Rt._shareAudioProducer)===null||Zt===void 0||Zt.close(),Rt._shareAudioProducer=null}),this._shareAudioProducer.on("trackended",function(){var Zt;(Zt=Rt._openTelemetry)===null||Zt===void 0||Zt.traceAutoComplete({spanName:"this._shareAudioProducer trackended",span:I,status:2}),Pe.dispatch(xe({type:"error",text:"Share disconnected!"}))}),(Ir=this._openTelemetry)===null||Ir===void 0||Ir.completeSpan({span:ut,status:1,message:"Share Audio Producer Created"}),mt.next=84;break;case 79:return mt.prev=79,mt.t1=mt.catch(65),mt.next=83,this._protoo.request("produceError",{mediaType:"shareAudio",message:mt.t1.message});case 83:(hr=this._videosdkLogs)===null||hr===void 0||hr.pushLogs({logText:"Error in shareAudio produceError",logType:"ERROR",attributes:{error:mt.t1.message}});case 84:(Xe=this._openTelemetry)===null||Xe===void 0||Xe.completeSpan({span:I,status:1,message:"Enable Share Successful"}),mt.next=98;break;case 87:return mt.prev=87,mt.t2=mt.catch(11),Se.error("enableShare() | failed:%o",mt.t2),(Xr=this._openTelemetry)===null||Xr===void 0||Xr.completeSpan({span:I,status:2,attributes:{error:mt.t2.message},message:"Error in enableShare video produceError"}),console.log("screen share catch",mt.t2.message),(mn=this._videosdkLogs)===null||mn===void 0||mn.pushLogs({logText:"Error in enableShare video produceError",logType:"ERROR",attributes:{error:mt.t2.message}}),mt.t2.name!=="NotAllowedError"&&Pe.dispatch(xe({type:"error",text:"Error sharing: ".concat(mt.t2)})),mt.next=96,this._protoo.request("produceError",{mediaType:"share",message:mt.t2.message});case 96:X&&X.stop(),Re&&Re.stop();case 98:Pe.dispatch(_r(!1)),this._shareProducer&&(vn=0,(fn=this._metrics.addNewProbe(this._shareProducer,"share_producer")).onStatsCollected=function(Zt){try{var xr;Rt._stats.producerStats||(Rt._stats.producerStats={}),Rt._stats.producerStats.share||(Rt._stats.producerStats.share=[]),Rt._shareProducer&&(Rt._latestStats[(xr=Rt._shareProducer)===null||xr===void 0?void 0:xr.id]=[]),Zt.video.forEach(function(Br){var Mr;Rt._shareProducer&&Rt._latestStats[(Mr=Rt._shareProducer)===null||Mr===void 0?void 0:Mr.id].push(Br)}),vn%5==0&&Rt._shareProducer!=null&&Rt._stats.producerStats.share.push({timestamp:new Date,stats:Rt._latestStats[Rt._shareProducer.id]}),vn++}catch(Br){var Vr;(Vr=Rt._videosdkLogs)===null||Vr===void 0||Vr.pushLogs({logText:"Error PRODUCER Stats ERROR",logType:"ERROR",attributes:{error:Br.message}}),console.log("PRODUCER ERROR",Br)}},fn.start(),this._shareProducer.observer.on("close",function(){fn.stop(),Rt._metrics.removeExistingProbe(fn)})),this._shareAudioProducer&&(sr=0,(Zr=this._metrics.addNewProbe(this._shareAudioProducer,"share_audio_producer")).onStatsCollected=function(Zt){try{var xr;Rt._stats.producerStats||(Rt._stats.producerStats={}),Rt._stats.producerStats.shareAudio||(Rt._stats.producerStats.shareAudio=[]),Rt._shareAudioProducer&&(Rt._latestStats[(xr=Rt._shareAudioProducer)===null||xr===void 0?void 0:xr.id]=[]),Zt.audio.forEach(function(Br){var Mr;Rt._shareAudioProducer&&Rt._latestStats[(Mr=Rt._shareAudioProducer)===null||Mr===void 0?void 0:Mr.id].push(Br)}),sr%5==0&&Rt._shareAudioProducer!=null&&Rt._stats.producerStats.shareAudio.push(Gr({timestamp:new Date},Rt._latestStats[Rt._shareAudioProducer.id]?Rt._latestStats[Rt._shareAudioProducer.id][0]:{})),sr++}catch(Br){var Vr;(Vr=Rt._videosdkLogs)===null||Vr===void 0||Vr.pushLogs({logText:"Error PRODUCER Stats ERROR",logType:"ERROR",attributes:{error:Br.message}}),console.log("PRODUCER ERROR",Br)}},Zr.start(),this._shareAudioProducer.observer.on("close",function(){Zr.stop(),Rt._metrics.removeExistingProbe(Zr)}));case 101:case"end":return mt.stop()}},V,this,[[11,87],[19,25],[65,79]])})),function(){return js.apply(this,arguments)})},{key:"disableShare",value:(li=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe;return e().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:if(Se.debug("disableShare()"),A=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"disableShare() Calling",status:1}),this._shareProducer){Le.next=5;break}return(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:A,status:2,message:"Share Producer Not found"}),Le.abrupt("return");case 5:return X=(x=this._openTelemetry)===null||x===void 0?void 0:x.trace({spanName:"Closing Share Producer",span:A,status:1}),this._shareProducer.close(),Re=he(this._shareProducer.id),Pe.dispatch(Re),this._eventEmitter.emit(Re.type,Re.payload),this._shareAudioProducer&&(Ue=(me=this._openTelemetry)===null||me===void 0?void 0:me.trace({spanName:"Closing Share Audio Producer",span:A,status:1}),this._shareAudioProducer.close(),Re=he(this._shareAudioProducer.id),Pe.dispatch(Re),this._eventEmitter.emit(Re.type,Re.payload),(it=this._openTelemetry)===null||it===void 0||it.completeSpan({span:Ue,status:1,message:"Closed Share Audio Producer"})),Le.prev=11,Le.next=14,this._protoo.request("closeProducer",{producerId:this._shareProducer.id});case 14:if(!this._shareAudioProducer){Le.next=17;break}return Le.next=17,this._protoo.request("closeProducer",{producerId:this._shareAudioProducer.id});case 17:(et=this._openTelemetry)===null||et===void 0||et.completeSpan({span:X,status:1,message:"Requested Server to Close Producer"}),Le.next=25;break;case 20:Le.prev=20,Le.t0=Le.catch(11),Pe.dispatch(xe({type:"error",text:"Error closing server-side share Producer: ".concat(Le.t0)})),(Z=this._openTelemetry)===null||Z===void 0||Z.completeSpan({span:A,status:2,message:"Error closing server-side share Producer ".concat(Le.t0)}),(Xe=this._videosdkLogs)===null||Xe===void 0||Xe.pushLogs({logText:"Error closing server-side share Producer",logType:"ERROR",attributes:{error:Le.t0.message}});case 25:this._shareProducer=null,this._shareAudioProducer=null,(I=this._openTelemetry)===null||I===void 0||I.completeSpan({span:A,status:1,message:"Screen Share Disabled Successfully"});case 28:case"end":return Le.stop()}},V,this,[[11,20]])})),function(){return li.apply(this,arguments)})},{key:"enableAudioOnly",value:(os=(0,d.A)(e().mark(function V(){var D,x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:Se.debug("enableAudioOnly()"),Pe.dispatch(ce(!0)),this.disableWebcam(),D=rn(this._consumers.values()),A.prev=4,D.s();case 6:if((x=D.n()).done){A.next=13;break}if((I=x.value).kind==="video"){A.next=10;break}return A.abrupt("continue",11);case 10:this._pauseConsumer(I);case 11:A.next=6;break;case 13:A.next=18;break;case 15:A.prev=15,A.t0=A.catch(4),D.e(A.t0);case 18:return A.prev=18,D.f(),A.finish(18);case 21:Pe.dispatch(ke(!0)),Pe.dispatch(ce(!1));case 23:case"end":return A.stop()}},V,this,[[4,15,18,21]])})),function(){return os.apply(this,arguments)})},{key:"disableAudioOnly",value:(ui=(0,d.A)(e().mark(function V(){var D,x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:Se.debug("disableAudioOnly()"),Pe.dispatch(ce(!0)),!this._webcamProducer&&this._produce&&(M()||{}).webcamEnabled&&this.enableWebcam(),D=rn(this._consumers.values()),A.prev=4,D.s();case 6:if((x=D.n()).done){A.next=13;break}if((I=x.value).kind==="video"){A.next=10;break}return A.abrupt("continue",11);case 10:this._resumeConsumer(I);case 11:A.next=6;break;case 13:A.next=18;break;case 15:A.prev=15,A.t0=A.catch(4),D.e(A.t0);case 18:return A.prev=18,D.f(),A.finish(18);case 21:Pe.dispatch(ke(!1)),Pe.dispatch(ce(!1));case 23:case"end":return A.stop()}},V,this,[[4,15,18,21]])})),function(){return ui.apply(this,arguments)})},{key:"muteAudio",value:(qn=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:Se.debug("muteAudio()"),Pe.dispatch(te(!0));case 2:case"end":return D.stop()}},V)})),function(){return qn.apply(this,arguments)})},{key:"unmuteAudio",value:(Ns=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:Se.debug("unmuteAudio()"),Pe.dispatch(te(!1));case 2:case"end":return D.stop()}},V)})),function(){return Ns.apply(this,arguments)})},{key:"handleRemoteRestartIce",value:(ys=(0,d.A)(e().mark(function V(D){var x,I,A,K,X,Re,me,it;return e().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return A=D.iceParameters,K=D.transportId,X=D.internalSpan,K===((x=this._sendTransport)===null||x===void 0?void 0:x.id)&&this._sendTransport.restartIce({iceParameters:A}),K===((I=this._recvTransport)===null||I===void 0?void 0:I.id)&&this._recvTransport.restartIce({iceParameters:A}),Ue.prev=3,Ue.next=6,this._protoo.request("iceRestarted",{transportId:K});case 6:(Re=this._openTelemetry)===null||Re===void 0||Re.completeSpan({span:X,status:1,message:"iceRestarted"}),Ue.next=14;break;case 9:Ue.prev=9,Ue.t0=Ue.catch(3),(me=this._openTelemetry)===null||me===void 0||me.completeSpan({span:X,status:2,message:"handleRemoteRestartIce() ICE restart failed ".concat(Ue.t0)}),(it=this._videosdkLogs)===null||it===void 0||it.pushLogs({logText:"Error handleRemoteRestartIce() ICE restart failed",logType:"ERROR",attributes:{error:Ue.t0.message}}),Pe.dispatch(xe({type:"error",text:"ICE restart failed: ".concat(Ue.t0)}));case 14:case"end":return Ue.stop()}},V,this,[[3,9]])})),function(V){return ys.apply(this,arguments)})},{key:"restartIce",value:(vs=(0,d.A)(e().mark(function V(){var D,x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(Se.debug("restartIce()"),Pe.dispatch(ue(!0)),A.prev=2,!this._sendTransport){A.next=9;break}return A.next=6,this._protoo.request("restartIce",{transportId:this._sendTransport.id});case 6:return D=A.sent,A.next=9,this._sendTransport.restartIce({iceParameters:D});case 9:if(!this._recvTransport){A.next=15;break}return A.next=12,this._protoo.request("restartIce",{transportId:this._recvTransport.id});case 12:return x=A.sent,A.next=15,this._recvTransport.restartIce({iceParameters:x});case 15:Pe.dispatch(xe({text:"ICE restarted"})),A.next=23;break;case 18:A.prev=18,A.t0=A.catch(2),Se.error("restartIce() | failed:%o",A.t0),Pe.dispatch(xe({type:"error",text:"ICE restart failed: ".concat(A.t0)})),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error restartIce() ICE restart failed",logType:"ERROR",attributes:{error:A.t0.message}});case 23:Pe.dispatch(ue(!1));case 24:case"end":return A.stop()}},V,this,[[2,18]])})),function(){return vs.apply(this,arguments)})},{key:"setMaxSendingSpatialLayer",value:(ts=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(Se.debug("setMaxSendingSpatialLayer() [spatialLayer:%s]",D),I.prev=1,!this._webcamProducer){I.next=7;break}return I.next=5,this._webcamProducer.setMaxSpatialLayer(D);case 5:I.next=10;break;case 7:if(!this._shareProducer){I.next=10;break}return I.next=10,this._shareProducer.setMaxSpatialLayer(D);case 10:I.next=17;break;case 12:I.prev=12,I.t0=I.catch(1),Se.error("setMaxSendingSpatialLayer() | failed:%o",I.t0),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"Error setting max sending video spatial layer",logType:"ERROR",attributes:{error:I.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error setting max sending video spatial layer: ".concat(I.t0)}));case 17:case"end":return I.stop()}},V,this,[[1,12]])})),function(V){return ts.apply(this,arguments)})},{key:"setWebcamQuality",value:(Ls=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(this._webcamProducer){A.next=2;break}return A.abrupt("return");case 2:if(x=this._webcam.resolution,I=La[x][D].s,this._webcamProducer.maxSpatialLayer!=I){A.next=6;break}return A.abrupt("return");case 6:return A.next=8,this._webcamProducer.setMaxSpatialLayer(I);case 8:case"end":return A.stop()}},V,this)})),function(V){return Ls.apply(this,arguments)})},{key:"setConsumerQuality",value:(is=(0,d.A)(e().mark(function V(D,x){var I,A,K,X,Re,me,it;return e().wrap(function(Ue){for(;;)switch(Ue.prev=Ue.next){case 0:return X=this._webcam.resolution,Re=(I=this._openTelemetry)===null||I===void 0?void 0:I.trace({spanName:'Setting "'.concat(x,'" Quality')}),me=La[X][x].s,it=La[X][x].t,(A=this._openTelemetry)===null||A===void 0||A.traceAutoComplete({spanName:"Getting spatial & temporal layers",span:Re,attributes:{spatialLayers:JSON.parse(me),temporalLayers:JSON.parse(it)},status:1}),Ue.next=7,this.setConsumerPreferredLayers(D,me,it);case 7:(K=this._openTelemetry)===null||K===void 0||K.completeSpan({message:"Done",span:Re,status:1});case 8:case"end":return Ue.stop()}},V,this)})),function(V,D){return is.apply(this,arguments)})},{key:"setViewPort",value:(Ba=(0,d.A)(e().mark(function V(D,x,I){var A,K,X,Re;return e().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(this._consumers.get(D.id)){me.next=2;break}return me.abrupt("return");case 2:if(A=Ve(this._consumers.get(D.id),x,I),K=A.consumerId,X=A.newPreferredSpatialLayer,Re=A.newPreferredTemporalLayer,!K){me.next=6;break}return me.next=6,this.setConsumerPreferredLayers(K,X,Re);case 6:case"end":return me.stop()}},V,this)})),function(V,D,x){return Ba.apply(this,arguments)})},{key:"setConsumerPreferredLayers",value:(_s=(0,d.A)(e().mark(function V(D,x,I){var A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return Se.debug("setConsumerPreferredLayers() [consumerId:%s, spatialLayer:%s, temporalLayer:%s]",D,x,I),X.prev=1,(A=this._consumers.get(D)).spatialLayers>1&&(A.preferredSpatialLayer=x,A.preferredTemporalLayer=I),X.next=6,this._protoo.request("setConsumerPreferredLayers",{consumerId:D,spatialLayer:x,temporalLayer:I});case 6:Pe.dispatch(Jr(D,x,I)),X.next=14;break;case 9:X.prev=9,X.t0=X.catch(1),Se.error("setConsumerPreferredLayers() | failed:%o",X.t0),(K=this._videosdkLogs)===null||K===void 0||K.pushLogs({logText:"Error setting Consumer preferred layers:",logType:"ERROR",attributes:{error:X.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error setting Consumer preferred layers: ".concat(X.t0)}));case 14:case"end":return X.stop()}},V,this,[[1,9]])})),function(V,D,x){return _s.apply(this,arguments)})},{key:"setConsumerPriority",value:(di=(0,d.A)(e().mark(function V(D,x){var I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return Se.debug("setConsumerPriority() [consumerId:%s, priority:%d]",D,x),A.prev=1,A.next=4,this._protoo.request("setConsumerPriority",{consumerId:D,priority:x});case 4:Pe.dispatch(Gt(D,x)),A.next=12;break;case 7:A.prev=7,A.t0=A.catch(1),Se.error("setConsumerPriority() | failed:%o",A.t0),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error setting Consumer priority",logType:"ERROR",attributes:{error:A.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error setting Consumer priority: ".concat(A.t0)}));case 12:case"end":return A.stop()}},V,this,[[1,7]])})),function(V,D){return di.apply(this,arguments)})},{key:"requestConsumerKeyFrame",value:(nr=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return Se.debug("requestConsumerKeyFrame() [consumerId:%s]",D),I.prev=1,I.next=4,this._protoo.request("requestConsumerKeyFrame",{consumerId:D});case 4:Pe.dispatch(xe({text:"Keyframe requested for video consumer"})),I.next=12;break;case 7:I.prev=7,I.t0=I.catch(1),Se.error("requestConsumerKeyFrame() | failed:%o",I.t0),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"Error requesting key frame for Consumer",logType:"ERROR",attributes:{error:I.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error requesting key frame for Consumer: ".concat(I.t0)}));case 12:case"end":return I.stop()}},V,this,[[1,7]])})),function(V){return nr.apply(this,arguments)})},{key:"enableChatDataProducer",value:(Ln=(0,d.A)(e().mark(function V(){var D,x=this;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(Se.debug("enableChatDataProducer()"),this._useDataChannel){I.next=3;break}return I.abrupt("return");case 3:return I.prev=3,I.next=6,this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}});case 6:this._chatDataProducer=I.sent,Pe.dispatch(Ht({id:this._chatDataProducer.id,sctpStreamParameters:this._chatDataProducer.sctpStreamParameters,label:this._chatDataProducer.label,protocol:this._chatDataProducer.protocol})),this._chatDataProducer.on("transportclose",function(){x._chatDataProducer=null}),this._chatDataProducer.on("open",function(){Se.debug('chat DataProducer "open" event')}),this._chatDataProducer.on("close",function(){Se.error('chat DataProducer "close" event'),x._chatDataProducer=null,Pe.dispatch(xe({type:"error",text:"Chat DataProducer closed"}))}),this._chatDataProducer.on("error",function(A){Se.error('chat DataProducer "error" event:%o',A),Pe.dispatch(xe({type:"error",text:"Chat DataProducer error: ".concat(A)}))}),this._chatDataProducer.on("bufferedamountlow",function(){Se.debug('chat DataProducer "bufferedamountlow" event')}),I.next=21;break;case 15:throw I.prev=15,I.t0=I.catch(3),Se.error("enableChatDataProducer() | failed:%o",I.t0),(D=this._videosdkLogs)===null||D===void 0||D.pushLogs({logText:"Error enabling chat DataProducer",logType:"ERROR",attributes:{error:I.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error enabling chat DataProducer: ".concat(I.t0)})),I.t0;case 21:case"end":return I.stop()}},V,this,[[3,15]])})),function(){return Ln.apply(this,arguments)})},{key:"enableBotDataProducer",value:(Pn=(0,d.A)(e().mark(function V(){var D,x=this;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(Se.debug("enableBotDataProducer()"),this._useDataChannel){I.next=3;break}return I.abrupt("return");case 3:return I.prev=3,I.next=6,this._sendTransport.produceData({ordered:!1,maxPacketLifeTime:2e3,label:"bot",priority:"medium",appData:{info:"my-bot-DataProducer"}});case 6:this._botDataProducer=I.sent,Pe.dispatch(Ht({id:this._botDataProducer.id,sctpStreamParameters:this._botDataProducer.sctpStreamParameters,label:this._botDataProducer.label,protocol:this._botDataProducer.protocol})),this._botDataProducer.on("transportclose",function(){x._botDataProducer=null}),this._botDataProducer.on("open",function(){Se.debug('bot DataProducer "open" event')}),this._botDataProducer.on("close",function(){Se.error('bot DataProducer "close" event'),x._botDataProducer=null,Pe.dispatch(xe({type:"error",text:"Bot DataProducer closed"}))}),this._botDataProducer.on("error",function(A){Se.error('bot DataProducer "error" event:%o',A),Pe.dispatch(xe({type:"error",text:"Bot DataProducer error: ".concat(A)}))}),this._botDataProducer.on("bufferedamountlow",function(){Se.debug('bot DataProducer "bufferedamountlow" event')}),I.next=21;break;case 15:throw I.prev=15,I.t0=I.catch(3),Se.error("enableBotDataProducer() | failed:%o",I.t0),(D=this._videosdkLogs)===null||D===void 0||D.pushLogs({logText:"Error enabling bot DataProducer",logType:"ERROR",attributes:{error:I.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error enabling bot DataProducer: ".concat(I.t0)})),I.t0;case 21:case"end":return I.stop()}},V,this,[[3,15]])})),function(){return Pn.apply(this,arguments)})},{key:"sendChatMessage",value:(Wt=(0,d.A)(e().mark(function V(D){return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug('sendChatMessage() [text:"%s]',D),this._chatDataProducer){x.next=4;break}return Pe.dispatch(xe({type:"error",text:"No chat DataProducer"})),x.abrupt("return");case 4:try{this._chatDataProducer.send(D)}catch(I){Se.error("chat DataProducer.send() failed:%o",I),Pe.dispatch(xe({type:"error",text:"chat DataProducer.send() failed: ".concat(I)}))}case 5:case"end":return x.stop()}},V,this)})),function(V){return Wt.apply(this,arguments)})},{key:"sendBotMessage",value:(ze=(0,d.A)(e().mark(function V(D){return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug('sendBotMessage() [text:"%s]',D),this._botDataProducer){x.next=4;break}return Pe.dispatch(xe({type:"error",text:"No bot DataProducer"})),x.abrupt("return");case 4:try{this._botDataProducer.send(D)}catch(I){Se.error("bot DataProducer.send() failed:%o",I),Pe.dispatch(xe({type:"error",text:"bot DataProducer.send() failed: ".concat(I)}))}case 5:case"end":return x.stop()}},V,this)})),function(V){return ze.apply(this,arguments)})},{key:"changeDisplayName",value:(H=(0,d.A)(e().mark(function V(D){return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return Se.debug('changeDisplayName() [displayName:"%s"]',D),O({displayName:D}),x.prev=2,x.next=5,this._protoo.request("changeDisplayName",{displayName:D});case 5:this._displayName=D,Pe.dispatch(ve(D)),Pe.dispatch(xe({text:"Display name changed"})),x.next=15;break;case 10:x.prev=10,x.t0=x.catch(2),Se.error("changeDisplayName() | failed: %o",x.t0),Pe.dispatch(xe({type:"error",text:"Could not change display name: ".concat(x.t0)})),Pe.dispatch(ve());case 15:case"end":return x.stop()}},V,this,[[2,10]])})),function(V){return H.apply(this,arguments)})},{key:"openConnection",value:(lt=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return x=D.roomId,I=D.payload,A.next=3,this._protoo.request("openConnection",{roomId:x,payload:I}).catch(function(K){throw new Error(K)});case 3:case"end":return A.stop()}},V,this)})),function(V){return lt.apply(this,arguments)})},{key:"closeConnection",value:(xa=(0,d.A)(e().mark(function V(D){return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this._protoo.request("closeConnection",{roomId:D});case 2:case"end":return x.stop()}},V,this)})),function(V){return xa.apply(this,arguments)})},{key:"switchTo",value:(es=(0,d.A)(e().mark(function V(D){var x,I,A;return e().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return x=D.roomId,I=D.peerIds,A=D.payload,K.next=3,this._protoo.request("requestSwitchRoom",{roomId:x,peerIds:I,payload:A});case 3:case"end":return K.stop()}},V,this)})),function(V){return es.apply(this,arguments)})},{key:"switchPeerRoom",value:(Za=(0,d.A)(e().mark(function V(D){var x,I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return x=D.peerId,I=D.roomId,A=D.payload,K=D.token,X.next=3,this._protoo.request("switchPeerRoom",{roomId:I,peerId:x,payload:A,token:K});case 3:case"end":return X.stop()}},V,this)})),function(V){return Za.apply(this,arguments)})},{key:"connectionSwitchPeerRoom",value:(Xa=(0,d.A)(e().mark(function V(D){var x,I,A,K,X;return e().wrap(function(Re){for(;;)switch(Re.prev=Re.next){case 0:return x=D.roomId,I=D.connectionRoomId,A=D.peerId,K=D.payload,X=D.token,Re.next=3,this._protoo.request("connectionSwitchPeerRoom",{roomId:x,connectionRoomId:I,peerId:A,payload:K,token:X});case 3:case"end":return Re.stop()}},V,this)})),function(V){return Xa.apply(this,arguments)})},{key:"connectionSendChatMessage",value:(Qa=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return x=D.roomId,I=D.message,A.next=3,this._protoo.request("connectionSendChatMessage",{roomId:x,message:I});case 3:case"end":return A.stop()}},V,this)})),function(V){return Qa.apply(this,arguments)})},{key:"connectionEndMeeting",value:(Ya=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:return x=D.roomId,I.next=3,this._protoo.request("connectionCloseRoom",{roomId:x});case 3:case"end":return I.stop()}},V,this)})),function(V){return Ya.apply(this,arguments)})},{key:"pubsubPublish",value:(Ja=(0,d.A)(e().mark(function V(D,x,I,A){var K,X,Re,me,it,Ue;return e().wrap(function(et){for(;;)switch(et.prev=et.next){case 0:if(et.prev=0,I!=null&&I.sendOnly){if(K=I.sendOnly,X=[],K){Re=rn(K);try{for(Re.s();!(me=Re.n()).done;)(it=me.value)&&X.push(it.toString())}catch(Z){Re.e(Z)}finally{Re.f()}}I.sendOnly=X}return et.next=4,this._protoo.request("pubsubPublish",{topic:D,message:x,options:I,payload:A});case 4:et.next=10;break;case 6:et.prev=6,et.t0=et.catch(0),(Ue=this._videosdkLogs)===null||Ue===void 0||Ue.pushLogs({logText:"Error pubsubPublish() | failed",logType:"ERROR",attributes:{error:et.t0.message}}),Se.error("pubsubPublish() | failed: %o",et.t0);case 10:case"end":return et.stop()}},V,this,[[0,6]])})),function(V,D,x,I){return Ja.apply(this,arguments)})},{key:"pubsubSubscribe",value:(Ka=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!this._closed){A.next=2;break}return A.abrupt("return");case 2:return A.prev=2,A.next=5,this._protoo.request("pubsubSubscribe",{topic:D});case 5:return x=A.sent,A.abrupt("return",x);case 9:A.prev=9,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error pubsubSubscribe() | failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("pubsubSubscribe() | failed: %o",A.t0);case 13:case"end":return A.stop()}},V,this,[[2,9]])})),function(V){return Ka.apply(this,arguments)})},{key:"pubsubUnsubscribe",value:(Ga=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(!this._closed){A.next=2;break}return A.abrupt("return");case 2:return A.prev=2,A.next=5,this._protoo.request("pubsubUnsubscribe",{topic:D});case 5:(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"Pubsub Unsubscribing Successfully for topic ".concat(D),logType:"INFO"}),A.next=12;break;case 8:A.prev=8,A.t0=A.catch(2),(I=this._videosdkLogs)===null||I===void 0||I.pushLogs({logText:"Error pubsubUnsubscribe() | failed",logType:"ERROR",attributes:{error:A.t0.message}}),Se.error("pubsubUnsubscribe() | failed: %o",A.t0);case 12:case"end":return A.stop()}},V,this,[[2,8]])})),function(V){return Ga.apply(this,arguments)})},{key:"closeRoom",value:($a=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:return D.next=2,this._protoo.request("closeRoom",{});case 2:case"end":return D.stop()}},V,this)})),function(){return $a.apply(this,arguments)})},{key:"removePeer",value:(za=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if((x=this._openTelemetry)===null||x===void 0||x.traceAutoComplete({spanName:"Removing peer ".concat(D),status:1}),D!=null){I.next=3;break}return I.abrupt("return");case 3:return I.next=5,this._protoo.request("removePeer",{peerId:D});case 5:case"end":return I.stop()}},V,this)})),function(V){return za.apply(this,arguments)})},{key:"startPingPong",value:(Ha=(0,d.A)(e().mark(function V(){var D=this;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:this._pingWebsocketInterval!=null&&clearInterval(this._pingWebsocketInterval),this._pingWebsocketInterval=setInterval(function(){D.pingWebSocket()},2e3);case 2:case"end":return x.stop()}},V,this)})),function(){return Ha.apply(this,arguments)})},{key:"pingWebSocket",value:(qa=(0,d.A)(e().mark(function V(){var D,x=this;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!this._closed){I.next=2;break}return I.abrupt("return");case 2:D=!1,this._protoo.request("ping").then(function(A){A&&(D=!0)}).catch(function(A){}),setTimeout(function(){D?(!x._isWebsocketAlive||x._pingWebsocketFailedCounter>1?(x.emitMeetingStateChange(we),x._isWebsocketAlive=!0,x._pingWebsocketFailedCounter=0,x.restartIce()):x._transportState!="failed"&&x._transportState!="disconnected"||(console.log("Calling Restart Ice based on transport state",x._transportState),x.restartIce()),x._pingWebsocketFailedCounter=0):(x._isWebsocketAlive&&x._pingWebsocketFailedCounter>1&&(x.emitMeetingStateChange(er),x._isWebsocketAlive=!1,x.startInternetPingPong()),x._pingWebsocketFailedCounter=x._pingWebsocketFailedCounter+1)},1e3);case 5:case"end":return I.stop()}},V,this)})),function(){return qa.apply(this,arguments)})},{key:"startInternetPingPong",value:(Va=(0,d.A)(e().mark(function V(){var D=this;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:this._pingInternetInterval!=null&&clearInterval(this._pingInternetInterval),this._pingInternetInterval=setInterval(function(){D.pingInternet()},2e3);case 2:case"end":return x.stop()}},V,this)})),function(){return Va.apply(this,arguments)})},{key:"pingInternet",value:(Wa=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re=this;return e().wrap(function(me){for(;;)switch(me.prev=me.next){case 0:if(!this._closed){me.next=2;break}return me.abrupt("return");case 2:return(D=this._videosdkLogs)===null||D===void 0||D.pushLogs({logText:"pinging internet",logType:"INFO"}),x=new AbortController,I=x.signal,A=setTimeout(function(){x.abort()},1e3),me.next=8,fetch("https://".concat(this._signalingBaseUrl,"/ping"),{method:"GET",signal:I}).then(function(it){return clearTimeout(A),it.text()}).catch(function(it){var Ue;return(Ue=Re._videosdkLogs)===null||Ue===void 0||Ue.pushLogs({logText:"Error pingInternet failed",logType:"ERROR",attributes:{error:it.message}}),"failed"});case 8:if(me.sent!="pong"){me.next=20;break}if((K=this._videosdkLogs)===null||K===void 0||K.pushLogs({logText:"Pong",logType:"INFO"}),!(this._pingWebsocketFailedCounter>5&&this._pongInternetCounter>3)||this._isWebsocketAlive){me.next=18;break}return this.emitMeetingStateChange(er),this._pongInternetCounter=0,this.close({sendLeft:!1}),(X=this._videosdkLogs)===null||X===void 0||X.pushLogs({logText:"Re-join the meeting, after diconnect",logType:"INFO"}),me.next=18,this.join();case 18:this._pongInternetCounter=this._pongInternetCounter+1,this._isWebsocketAlive&&(this._pongInternetCounter=0,this._pingInternetInterval!=null&&(clearInterval(this._pingInternetInterval),this._pingInternetInterval=null));case 20:case"end":return me.stop()}},V,this)})),function(){return Wa.apply(this,arguments)})},{key:"getSendTransportRemoteStats",value:(Ea=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(Se.debug("getSendTransportRemoteStats()"),this._sendTransport){D.next=3;break}return D.abrupt("return");case 3:return D.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._sendTransport.id}));case 4:case"end":return D.stop()}},V,this)})),function(){return Ea.apply(this,arguments)})},{key:"getRecvTransportRemoteStats",value:(wa=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(Se.debug("getRecvTransportRemoteStats()"),this._recvTransport){D.next=3;break}return D.abrupt("return");case 3:return D.abrupt("return",this._protoo.request("getTransportStats",{transportId:this._recvTransport.id}));case 4:case"end":return D.stop()}},V,this)})),function(){return wa.apply(this,arguments)})},{key:"getAudioRemoteStats",value:(aa=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug("getAudioRemoteStats()"),D=this._micProducer){x.next=4;break}return x.abrupt("return");case 4:return x.abrupt("return",this._latestStats[D.id]);case 5:case"end":return x.stop()}},V,this)})),function(){return aa.apply(this,arguments)})},{key:"getVideoRemoteStats",value:(ma=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug("getVideoRemoteStats()"),D=this._webcamProducer){x.next=4;break}return x.abrupt("return");case 4:return x.abrupt("return",this._latestStats[D.id]);case 5:case"end":return x.stop()}},V,this)})),function(){return ma.apply(this,arguments)})},{key:"getShareRemoteStats",value:(da=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug("getVideoRemoteStats()"),D=this._shareProducer){x.next=4;break}return x.abrupt("return");case 4:return x.abrupt("return",this._latestStats[D.id]);case 5:case"end":return x.stop()}},V,this)})),function(){return da.apply(this,arguments)})},{key:"getShareAudioRemoteStats",value:($n=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(D=this._shareAudioProducer){x.next=3;break}return x.abrupt("return");case 3:return x.abrupt("return",this._latestStats[D.id]);case 4:case"end":return x.stop()}},V,this)})),function(){return $n.apply(this,arguments)})},{key:"getConsumerRemoteStats",value:(Vn=(0,d.A)(e().mark(function V(D){var x,I;return e().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:if(Se.debug("getConsumerRemoteStats()"),x=this._consumers.get(D)){A.next=4;break}return A.abrupt("return");case 4:return this._latestStats[D]&&(this._latestStats[D][0].currentSpatialLayer=x.currentSpatialLayer,this._latestStats[D][0].currentTemporalLayer=x.currentTemporalLayer,this._latestStats[D][0].preferredSpatialLayer=x.preferredSpatialLayer,this._latestStats[D][0].preferredTemporalLayer=x.preferredTemporalLayer),I=x.track.id.replace(/[{}]/g,""),A.abrupt("return",this._latestStats[I]);case 7:case"end":return A.stop()}},V,this)})),function(V){return Vn.apply(this,arguments)})},{key:"getChatDataProducerRemoteStats",value:(An=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug("getChatDataProducerRemoteStats()"),D=this._chatDataProducer){x.next=4;break}return x.abrupt("return");case 4:return x.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:D.id}));case 5:case"end":return x.stop()}},V,this)})),function(){return An.apply(this,arguments)})},{key:"getBotDataProducerRemoteStats",value:(Mn=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug("getBotDataProducerRemoteStats()"),D=this._botDataProducer){x.next=4;break}return x.abrupt("return");case 4:return x.abrupt("return",this._protoo.request("getDataProducerStats",{dataProducerId:D.id}));case 5:case"end":return x.stop()}},V,this)})),function(){return Mn.apply(this,arguments)})},{key:"getDataConsumerRemoteStats",value:(Qr=(0,d.A)(e().mark(function V(D){return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug("getDataConsumerRemoteStats()"),this._dataConsumers.get(D)){x.next=4;break}return x.abrupt("return");case 4:return x.abrupt("return",this._protoo.request("getDataConsumerStats",{dataConsumerId:D}));case 5:case"end":return x.stop()}},V,this)})),function(V){return Qr.apply(this,arguments)})},{key:"getSendTransportLocalStats",value:(Yr=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(Se.debug("getSendTransportLocalStats()"),this._sendTransport){D.next=3;break}return D.abrupt("return");case 3:return D.abrupt("return",this._sendTransport.getStats());case 4:case"end":return D.stop()}},V,this)})),function(){return Yr.apply(this,arguments)})},{key:"getRecvTransportLocalStats",value:(Lr=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(Se.debug("getRecvTransportLocalStats()"),this._recvTransport){D.next=3;break}return D.abrupt("return");case 3:return D.abrupt("return",this._recvTransport.getStats());case 4:case"end":return D.stop()}},V,this)})),function(){return Lr.apply(this,arguments)})},{key:"getAudioLocalStats",value:(Or=(0,d.A)(e().mark(function V(){return e().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(Se.debug("getAudioLocalStats()"),this._micProducer){D.next=3;break}return D.abrupt("return");case 3:return D.abrupt("return",this._micProducer.getStats());case 4:case"end":return D.stop()}},V,this)})),function(){return Or.apply(this,arguments)})},{key:"getVideoLocalStats",value:(lr=(0,d.A)(e().mark(function V(){var D;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(Se.debug("getVideoLocalStats()"),D=this._webcamProducer||this._shareProducer){x.next=4;break}return x.abrupt("return");case 4:return x.abrupt("return",D.getStats());case 5:case"end":return x.stop()}},V,this)})),function(){return lr.apply(this,arguments)})},{key:"getConsumerLocalStats",value:(It=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(x=this._consumers.get(D)){I.next=3;break}return I.abrupt("return");case 3:return I.abrupt("return",x.getStats());case 4:case"end":return I.stop()}},V,this)})),function(V){return It.apply(this,arguments)})},{key:"applyNetworkThrottle",value:(wr=(0,d.A)(e().mark(function V(D){var x,I,A,K;return e().wrap(function(X){for(;;)switch(X.prev=X.next){case 0:return x=D.uplink,I=D.downlink,A=D.rtt,K=D.secret,Se.debug("applyNetworkThrottle() [uplink:%s, downlink:%s, rtt:%s]",x,I,A),X.prev=2,X.next=5,this._protoo.request("applyNetworkThrottle",{uplink:x,downlink:I,rtt:A,secret:K});case 5:X.next=11;break;case 7:X.prev=7,X.t0=X.catch(2),Se.error("applyNetworkThrottle() | failed:%o",X.t0),Pe.dispatch(xe({type:"error",text:"Error applying network throttle: ".concat(X.t0)}));case 11:case"end":return X.stop()}},V,this,[[2,7]])})),function(V){return wr.apply(this,arguments)})},{key:"resetNetworkThrottle",value:(Tt=(0,d.A)(e().mark(function V(D){var x,I,A;return e().wrap(function(K){for(;;)switch(K.prev=K.next){case 0:return x=D.silent,I=x!==void 0&&x,A=D.secret,Se.debug("resetNetworkThrottle()"),K.prev=2,K.next=5,this._protoo.request("resetNetworkThrottle",{secret:A});case 5:K.next=10;break;case 7:K.prev=7,K.t0=K.catch(2),I||(Se.error("resetNetworkThrottle() | failed:%o",K.t0),Pe.dispatch(xe({type:"error",text:"Error resetting network throttle: ".concat(K.t0)})));case 10:case"end":return K.stop()}},V,this,[[2,7]])})),function(V){return Tt.apply(this,arguments)})},{key:"createProducerTransport",value:(Qt=(0,d.A)(e().mark(function V(D,x){var I,A,K,X,Re,me,it,Ue,et=this;return e().wrap(function(Z){for(;;)switch(Z.prev=Z.next){case 0:K=D.id,X=D.iceParameters,Re=D.iceCandidates,me=D.dtlsParameters,it=D.sctpParameters,Ue=(I=this._openTelemetry)===null||I===void 0?void 0:I.trace({spanName:"Creating Send Transport",span:x||null}),this._sendTransport=this._mediasoupDevice.createSendTransport({id:K,iceParameters:X,iceCandidates:Re,dtlsParameters:me,sctpParameters:it,iceServers:this._iceServers}),this._sendTransport.on("connect",function(Xe,Le,Ge){var de,Ne=Xe.dtlsParameters;(de=et._openTelemetry)===null||de===void 0||de.traceAutoComplete({spanName:"this._sendTransport `connect` Event : Transport is about to establish the ICE+DTLS connection",span:Ue,status:1}),et._protoo.request("connectWebRtcTransport",{transportId:et._sendTransport.id,dtlsParameters:Ne}).then(Le).catch(Ge)}),this._sendTransport.on("produce",function(){var Xe=(0,d.A)(e().mark(function Le(Ge,de,Ne){var Mt,Ut,ut,Vt,Nt,Kt,At;return e().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Mt=Ge.kind,Ut=Ge.rtpParameters,ut=Ge.appData,Et.prev=1,(Vt=et._openTelemetry)===null||Vt===void 0||Vt.traceAutoComplete({spanName:"this._sendTransport `produce` Event : Transmit information about a new producer ",span:Ue,status:1}),Et.next=5,et._protoo.request("produce",{transportId:et._sendTransport.id,kind:Mt,rtpParameters:Ut,appData:ut});case 5:Nt=Et.sent,Kt=Nt.id,de({id:Kt}),Et.next=14;break;case 10:Et.prev=10,Et.t0=Et.catch(1),(At=et._videosdkLogs)===null||At===void 0||At.pushLogs({logText:'Error this._sendTransport "produce" Event catch',logType:"ERROR",attributes:{error:Et.t0.message}}),Ne(Et.t0);case 14:case"end":return Et.stop()}},Le,null,[[1,10]])}));return function(Le,Ge,de){return Xe.apply(this,arguments)}}()),this._sendTransport.on("producedata",function(){var Xe=(0,d.A)(e().mark(function Le(Ge,de,Ne){var Mt,Ut,ut,Vt,Nt,Kt,At;return e().wrap(function(Et){for(;;)switch(Et.prev=Et.next){case 0:return Mt=Ge.sctpStreamParameters,Ut=Ge.label,ut=Ge.protocol,Vt=Ge.appData,Et.prev=1,Et.next=4,et._protoo.request("produceData",{transportId:et._sendTransport.id,sctpStreamParameters:Mt,label:Ut,protocol:ut,appData:Vt});case 4:Nt=Et.sent,Kt=Nt.id,de({id:Kt}),Et.next=13;break;case 9:Et.prev=9,Et.t0=Et.catch(1),(At=et._videosdkLogs)===null||At===void 0||At.pushLogs({logText:"Error producedata event catch",logType:"ERROR",attributes:{error:Et.t0.message}}),Ne(Et.t0);case 13:case"end":return Et.stop()}},Le,null,[[1,9]])}));return function(Le,Ge,de){return Xe.apply(this,arguments)}}()),this._sendTransport.on("connectionstatechange",function(Xe){var Le,Ge;Xe==="connected"&&et.emitMeetingStateChange(we),(Le=et._openTelemetry)===null||Le===void 0||Le.traceAutoComplete({spanName:"_sendTransport Event connectionstatechange ".concat(Xe),span:Ue,status:1}),Xe==="failed"&&((Ge=et._videosdkLogs)===null||Ge===void 0||Ge.pushLogs({logText:"ERROR_MEETING_MEDIA_CONNECTION_FAILED",logType:"ERROR",attributes:{error:"Unable to connect to the meeting or media. Please check your network connection, ensure your firewall or security settings are not blocking the application, or try connecting using a different network."},dashboardLog:!0}),et.restartIce()),et._transportState=Xe}),(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:Ue,status:1,message:"Send Transport Created Successfully"});case 8:case"end":return Z.stop()}},V,this)})),function(V,D){return Qt.apply(this,arguments)})},{key:"createConsumerTransport",value:(ir=(0,d.A)(e().mark(function V(D,x){var I,A,K,X,Re,me,it,Ue,et,Z,Xe=this;return e().wrap(function(Le){for(;;)switch(Le.prev=Le.next){case 0:K=D.id,X=D.iceParameters,Re=D.iceCandidates,me=D.dtlsParameters,it=D.sctpParameters,Ue=(I=this._openTelemetry)===null||I===void 0?void 0:I.trace({spanName:"Creating Recieve Transport",span:x||null}),this._recvTransport=this._mediasoupDevice.createRecvTransport({id:K,iceParameters:X,iceCandidates:Re,dtlsParameters:me,sctpParameters:it,iceServers:this._iceServers}),this._recvTransport.on("connect",function(Ge,de,Ne){var Mt,Ut=Ge.dtlsParameters;(Mt=Xe._openTelemetry)===null||Mt===void 0||Mt.traceAutoComplete({spanName:"this._recvTransport `connect` Event : Recieve Transport is about to establish the ICE+DTLS connection",span:Ue,status:1}),Xe._protoo.request("connectWebRtcTransport",{transportId:Xe._recvTransport.id,dtlsParameters:Ut}).then(de).catch(Ne)}),this._recvTransport.on("connectionstatechange",function(Ge){var de;(de=Xe._openTelemetry)===null||de===void 0||de.traceAutoComplete({spanName:"_recvTransport Event connectionstatechange ".concat(Ge),span:Ue,status:1}),Ge==="failed"&&Xe.restartIce(),Xe._transportState=Ge}),et=0,(Z=this._metrics.addNewProbe(this._recvTransport,"transport")).onStatsCollected=function(Ge){try{var de=function(Ut,ut,Vt){Xe._stats.consumerStats||(Xe._stats.consumerStats={});var Nt=ut.appData.peerId;Xe._stats.consumerStats[Nt]||(Xe._stats.consumerStats[Nt]={}),Xe._stats.consumerStats[Nt][Vt]||(Xe._stats.consumerStats[Nt][Vt]=[]),Xe._latestStats[ut.track.id.replace(/[{}]/g,"")]=[Ut],et%5==0&&Xe._stats.consumerStats[Nt][Vt].push(Ut)},Ne=function(Ut){Ge[Ut].forEach(function(ut){var Vt,Nt=rn(Xe._consumers);try{for(Nt.s();!(Vt=Nt.n()).done;){var Kt=(0,k.A)(Vt.value,2),At=(Kt[0],Kt[1]);if(At.track.id.replace(/[{}]/g,"")===ut.trackId){var Et=At.appData.share?At.kind==="audio"?"shareAudio":"share":At.kind;de(ut,At,Et)}}}catch(Sr){Nt.e(Sr)}finally{Nt.f()}})};Ne("audio"),Ne("video"),et++}catch(Ut){var Mt;(Mt=Xe._videosdkLogs)===null||Mt===void 0||Mt.pushLogs({logText:"Error CONSUMER Stats ERROR",logType:"ERROR",attributes:{error:Ut.message}}),console.log("CONSUMER CATCH",Ut)}},Z.start(),this._recvTransport.observer.on("close",function(){Z.stop(),Xe._metrics.removeExistingProbe(Z)}),(A=this._openTelemetry)===null||A===void 0||A.completeSpan({span:Ue,status:1,message:"Recieve Transport Created Successfully"});case 11:case"end":return Le.stop()}},V,this)})),function(V,D){return ir.apply(this,arguments)})},{key:"emitMeetingStateChange",value:function(V){this._meetingConnectionState!==V&&(this._eventEmitter.emit("MEETING_STATE_CHANGED",{state:V}),this._meetingConnectionState=V)}},{key:"joinRoom",value:(Bt=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de,Ne,Mt,Ut,ut,Vt,Nt,Kt,At,Et,Sr,qt;return e().wrap(function(Xt){for(;;)switch(Xt.prev=Xt.next){case 0:return Se.debug("joinRoom()"),Xt.prev=1,Re=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"Loading Router Capabilities",span:this._joinSpan}),this._mediasoupDevice=new h.Device({handlerName:this._handlerName}),Xt.next=6,this._protoo.request("getRouterRtpCapabilities");case 6:return me=Xt.sent,this._deviceInfo.sdkType!="react-native"?navigator.userAgent.indexOf("Firefox")&&(me.headerExtensions=(it=me.headerExtensions)===null||it===void 0?void 0:it.filter(function(Ir){return Ir.uri!="urn:3gpp:video-orientation"})):me.headerExtensions=(Ue=me.headerExtensions)===null||Ue===void 0?void 0:Ue.filter(function(Ir){return Ir.uri!="urn:3gpp:video-orientation"}),Xt.next=10,this._mediasoupDevice.load({routerRtpCapabilities:me});case 10:if((x=this._openTelemetry)===null||x===void 0||x.completeSpan({span:Re,status:1,attributes:{routerRtpCapabilities:JSON.stringify(me).toString()},message:"Router Capabilities Loaded"}),!this._produce){Xt.next=16;break}return Xt.next=14,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 14:et=Xt.sent,this.createProducerTransport(et,this._joinSpan);case 16:if(!this._consume){Xt.next=21;break}return Xt.next=19,this._protoo.request("createWebRtcTransport",{preferredProtocol:this._preferredProtocol,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0});case 19:Z=Xt.sent,this.createConsumerTransport(Z,this._joinSpan);case 21:return Xt.next=23,this._protoo.request("join",{displayName:this._displayName,device:this._device,secret:this._secret,rtpCapabilities:(I=this._mediasoupDevice)===null||I===void 0?void 0:I.rtpCapabilities,sctpCapabilities:(A=this._mediasoupDevice)===null||A===void 0?void 0:A.sctpCapabilities,deviceInfo:this._deviceInfo,debugMode:this._debugMode,autoConsume:this._autoConsume,metaData:this._metaData});case 23:Xe=Xt.sent,Le=Xe.peers,Ge=Xe.poll,de=Xe.messages,Pe.dispatch(Q("connected")),(K=this._openTelemetry)===null||K===void 0||K.traceAutoComplete({spanName:"Emitted `MEETING_JOINED` Event",span:this._joinSpan,status:1}),this._eventEmitter.emit("MEETING_JOINED",{peers:Le,poll:Ge,messages:de,baseUrl:this._baseUrl}),Pe.dispatch({type:"REMOVE_ALL_NOTIFICATIONS"}),Pe.dispatch(xe({text:"You are in the room!",timeout:3e3})),Ne=rn(Le);try{for(Ne.s();!(Mt=Ne.n()).done;)Ut=Mt.value,ut=jt(Gr(Gr({},Ut),{},{consumers:[],dataConsumers:[]})),Pe.dispatch(ut),this._eventEmitter.emit(ut.type,ut.payload)}catch(Ir){Ne.e(Ir)}finally{Ne.f()}this._produce&&(Pe.dispatch(le({canSendMic:this._mediasoupDevice.canProduce("audio"),canSendWebcam:this._mediasoupDevice.canProduce("video")})),this._micEnabled?this.enableMic(this.customMicrophoneAudioTrack,this._joinSpan):this.customMicrophoneAudioTrack&&((Vt=this._openTelemetry)===null||Vt===void 0||Vt.traceAutoComplete({spanName:"Disposing Audio Track",span:this._joinSpan,status:2}),this.customMicrophoneAudioTrack.getTracks().forEach(function(Ir){Ir.stop()})),Nt=M(),this._webcamEnabled&&(!Nt||Nt.webcamEnabled||this._externalVideo)?this.enableWebcam(this.customCameraVideoTrack,this._joinSpan):this.customCameraVideoTrack&&((Kt=this._openTelemetry)===null||Kt===void 0||Kt.traceAutoComplete({spanName:"Disposing Video Track",span:this._joinSpan,status:2}),this.customCameraVideoTrack.getTracks().forEach(function(Ir){Ir.stop()}))),window.SHOW_INFO&&(At=Pe.getState(),Et=At.me,Pe.dispatch(oe(Et.id))),(X=this._openTelemetry)===null||X===void 0||X.completeSpan({span:this._joinSpan,status:1,message:"Room Joined"}),Xt.next=46;break;case 39:Xt.prev=39,Xt.t0=Xt.catch(1),Se.error("joinRoom() failed:%o",Xt.t0),(Sr=this._videosdkLogs)===null||Sr===void 0||Sr.pushLogs({logText:"Error Could not join the room",logType:"ERROR",attributes:{error:Xt.t0.message}}),(qt=this._openTelemetry)===null||qt===void 0||qt.completeSpan({span:this._joinSpan,status:2,message:"Could not join the room ".concat(Xt.t0)}),Pe.dispatch(xe({type:"error",text:"Could not join the room: ".concat(Xt.t0)})),this.close({sendLeft:!0});case 46:case"end":return Xt.stop()}},V,this,[[1,39]])})),function(){return Bt.apply(this,arguments)})},{key:"_updateMics",value:(Lt=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de=arguments;return e().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:return x=de.length>0&&de[0]!==void 0?de[0]:void 0,this._mics=new Map,Se.debug("_updateMics() |"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"_updateMics() Calling for Getting System Mic list",span:x||null}),Ne.prev=4,Ne.next=7,navigator.mediaDevices.enumerateDevices();case 7:X=Ne.sent,(A=this._openTelemetry)===null||A===void 0||A.traceAutoComplete({spanName:"Getting System Mic list",span:I,status:1,attributes:{systemDevice:X?JSON.stringify(X):"Device not found"}}),Re=rn(X);try{for(Re.s();!(me=Re.n()).done;)(it=me.value).kind=="audioinput"&&this._mics.set(it.deviceId,it)}catch(Mt){Re.e(Mt)}finally{Re.f()}Ue=Array.from(this._mics.values()),et=Ue.length,Z=this._mic.device?this._mic.device.deviceId:void 0,et===0?this._mic.device=null:this._mics.has(Z)||(this._mic.device=Ue[0]),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:I,status:1,message:"Update Mic"}),Ne.next=30;break;case 18:if(Ne.prev=18,Ne.t0=Ne.catch(4),!(Ne.t0 instanceof TypeError)){Ne.next=30;break}if(Ne.t0.name!=="TypeError"){Ne.next=28;break}throw Le=Ce.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE,this._emitError(Le),(Xe=this._openTelemetry)===null||Xe===void 0||Xe.completeSpan({span:I,status:2,message:"Error in updateMics() :: ".concat(Le.message)}),new Error(Le.message);case 28:throw(Ge=this._openTelemetry)===null||Ge===void 0||Ge.completeSpan({span:I,status:2,message:"Error in updateMics() :: ".concat(Ne.t0.message)}),new Error(Ne.t0.message);case 30:case"end":return Ne.stop()}},V,this,[[4,18]])})),function(){return Lt.apply(this,arguments)})},{key:"_updateWebcams",value:(rt=(0,d.A)(e().mark(function V(){var D,x,I,A,K,X,Re,me,it,Ue,et,Z,Xe,Le,Ge,de=arguments;return e().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:return x=de.length>0&&de[0]!==void 0?de[0]:void 0,Se.debug("_updateWebcams()"),this._webcams=new Map,Se.debug("_updateWebcams() | calling enumerateDevices()"),I=(D=this._openTelemetry)===null||D===void 0?void 0:D.trace({spanName:"_updateWebcams() Calling for Getting System Webcam list",span:x||null}),Ne.prev=5,Ne.next=8,navigator.mediaDevices.enumerateDevices();case 8:X=Ne.sent,(A=this._openTelemetry)===null||A===void 0||A.traceAutoComplete({spanName:"Getting System Webcam list",span:I,status:1,attributes:{systemDevice:X?JSON.stringify(X):"Device not found"}}),Re=rn(X),Ne.prev=11,Re.s();case 13:if((me=Re.n()).done){Ne.next=20;break}if((it=me.value).kind==="videoinput"){Ne.next=17;break}return Ne.abrupt("continue",18);case 17:this._webcams.set(it.deviceId,it);case 18:Ne.next=13;break;case 20:Ne.next=25;break;case 22:Ne.prev=22,Ne.t0=Ne.catch(11),Re.e(Ne.t0);case 25:return Ne.prev=25,Re.f(),Ne.finish(25);case 28:Ue=Array.from(this._webcams.values()),et=Ue.length,(Z=this._webcam.device?this._webcam.device.deviceId:void 0)&&(this._defaultCameraIndex=Z),Se.debug("_updateWebcams() [webcams:%o]",Ue),et===0?this._webcam.device=null:this._webcams.has(Z)||(this._webcam.device=Ue[this._defaultCameraIndex]),(K=this._openTelemetry)===null||K===void 0||K.completeSpan({span:I,status:1,message:"Update Webcam"}),Pe.dispatch({type:"SET_CAN_CHANGE_WEBCAM",payload:this._webcams.size>1}),Ne.next=50;break;case 38:if(Ne.prev=38,Ne.t1=Ne.catch(5),!(Ne.t1 instanceof TypeError)){Ne.next=50;break}if(Ne.t1.name!=="TypeError"){Ne.next=48;break}throw Le=Ce.q.ERROR_CAMERA_ACCESS_UNAVAILABLE,this._emitError(Le),(Xe=this._openTelemetry)===null||Xe===void 0||Xe.completeSpan({span:I,status:2,message:"Error in updateWebcams() :: ".concat(Le.message)}),new Error(Le.message);case 48:throw(Ge=this._openTelemetry)===null||Ge===void 0||Ge.completeSpan({span:I,status:2,message:"Error in updateWebcams() :: ".concat(Ne.t1.message)}),new Error(Ne.t1.message);case 50:case"end":return Ne.stop()}},V,this,[[5,38],[11,22,25,28]])})),function(){return rt.apply(this,arguments)})},{key:"_getWebcamType",value:function(V){return/(back|rear)/i.test(V.label)?(Se.debug("_getWebcamType() | it seems to be a back camera"),"back"):(Se.debug("_getWebcamType() | it seems to be a front camera"),"front")}},{key:"_pauseConsumer",value:(Me=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!D.paused){I.next=2;break}return I.abrupt("return");case 2:return I.prev=2,I.next=5,this._protoo.request("pauseConsumer",{consumerId:D.id});case 5:D.pause(),Pe.dispatch($r(D.id,"local")),I.next=14;break;case 9:I.prev=9,I.t0=I.catch(2),Se.error("_pauseConsumer() | failed:%o",I.t0),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"Error pausing Consumer",logType:"ERROR",attributes:{error:I.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error pausing Consumer: ".concat(I.t0)}));case 14:case"end":return I.stop()}},V,this,[[2,9]])})),function(V){return Me.apply(this,arguments)})},{key:"_resumeConsumer",value:(Oe=(0,d.A)(e().mark(function V(D){var x;return e().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(D.paused){I.next=2;break}return I.abrupt("return");case 2:return I.prev=2,I.next=5,this._protoo.request("resumeConsumer",{consumerId:D.id});case 5:D.resume(),Pe.dispatch(cr(D.id,"local")),I.next=14;break;case 9:I.prev=9,I.t0=I.catch(2),Se.error("_resumeConsumer() | failed:%o",I.t0),(x=this._videosdkLogs)===null||x===void 0||x.pushLogs({logText:"Error resuming Consumer",logType:"ERROR",attributes:{error:I.t0.message}}),Pe.dispatch(xe({type:"error",text:"Error resuming Consumer: ".concat(I.t0)}));case 14:case"end":return I.stop()}},V,this,[[2,9]])})),function(V){return Oe.apply(this,arguments)})},{key:"_getExternalVideoStream",value:(ge=(0,d.A)(e().mark(function V(){var D=this;return e().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!this._externalVideoStream){x.next=2;break}return x.abrupt("return",this._externalVideoStream);case 2:if(!(this._externalVideo.readyState<3)){x.next=5;break}return x.next=5,new Promise(function(I){return D._externalVideo.addEventListener("canplay",I)});case 5:if(!this._externalVideo.captureStream){x.next=9;break}this._externalVideoStream=this._externalVideo.captureStream(),x.next=14;break;case 9:if(!this._externalVideo.mozCaptureStream){x.next=13;break}this._externalVideoStream=this._externalVideo.mozCaptureStream(),x.next=14;break;case 13:throw new Error("video.captureStream() not supported");case 14:return x.abrupt("return",this._externalVideoStream);case 15:case"end":return x.stop()}},V,this)})),function(){return ge.apply(this,arguments)})},{key:"_emitError",value:function(V){this._eventEmitter.emit("ERROR",V)}}],[{key:"init",value:function(V){Pe=V.store}}]);var ge,Oe,Me,rt,Lt,Bt,ir,Qt,Tt,wr,It,lr,Or,Lr,Yr,Qr,Mn,An,Vn,$n,da,ma,aa,wa,Ea,Wa,Va,qa,Ha,za,$a,Ga,Ka,Ja,Ya,Qa,Xa,Za,es,xa,lt,H,ze,Wt,Pn,Ln,nr,di,_s,Ba,is,Ls,ts,vs,ys,Ns,qn,ui,os,li,js,pi,hi,mi,fi,gi,ka,Bs,ua,Gn,_i,Kn,$t,cs,Ur,bs,Pa,pr,ds,Fs,ws,Ss,hn,Jn,Ca,Us,Rs,Ws,ie,St,Vs,Ft,qs,bt,Cn,us,Hs,zs,vi,yi,bi,wi,Si,Ri,Ei,ki,ls}()},4973:(G,C,l)=>{l.d(C,{Zu:()=>f,lp:()=>u});var k=l(467),S=l(4756),d=l.n(S),u=(l(9027),function(){var o=(0,k.A)(d().mark(function c(e){return d().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(h){var v=navigator.webkitGetUserMedia||navigator.mozGetUserMedia;return v?new Promise(function(_,b){v.call(navigator,h,_,b)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}),g.next=4,navigator.mediaDevices.getUserMedia(e);case 4:return g.abrupt("return",g.sent);case 5:case"end":return g.stop()}},c)}));return function(c){return o.apply(this,arguments)}}()),f=function(){var o=(0,k.A)(d().mark(function c(e){return d().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getDisplayMedia===void 0&&(navigator.mediaDevices.getDisplayMedia=function(h){var v=navigator.webkitGetDisplayMedia||navigator.mozGetDisplayMedia;return v?new Promise(function(_,b){v.call(navigator,h,_,b)}):Promise.reject(new Error("getDisplayMedia is not implemented in this browser"))}),g.next=4,navigator.mediaDevices.getDisplayMedia(e);case 4:return g.abrupt("return",g.sent);case 5:case"end":return g.stop()}},c)}));return function(c){return o.apply(this,arguments)}}()},6880:function(G){G.exports=function(C){var l={};function k(S){if(l[S])return l[S].exports;var d=l[S]={i:S,l:!1,exports:{}};return C[S].call(d.exports,d,d.exports,k),d.l=!0,d.exports}return k.m=C,k.c=l,k.d=function(S,d,u){k.o(S,d)||Object.defineProperty(S,d,{enumerable:!0,get:u})},k.r=function(S){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(S,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(S,"__esModule",{value:!0})},k.t=function(S,d){if(1&d&&(S=k(S)),8&d||4&d&&typeof S=="object"&&S&&S.__esModule)return S;var u=Object.create(null);if(k.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:S}),2&d&&typeof S!="string")for(var f in S)k.d(u,f,(function(o){return S[o]}).bind(null,f));return u},k.n=function(S){var d=S&&S.__esModule?function(){return S.default}:function(){return S};return k.d(d,"a",d),d},k.o=function(S,d){return Object.prototype.hasOwnProperty.call(S,d)},k.p="",k(k.s=90)}({17:function(C,l,k){l.__esModule=!0,l.default=void 0;var S=k(18),d=function(){function u(){}return u.getFirstMatch=function(f,o){var c=o.match(f);return c&&c.length>0&&c[1]||""},u.getSecondMatch=function(f,o){var c=o.match(f);return c&&c.length>1&&c[2]||""},u.matchAndReturnConst=function(f,o,c){if(f.test(o))return c},u.getWindowsVersionName=function(f){switch(f){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},u.getMacOSVersionName=function(f){var o=f.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(o.push(0),o[0]===10)switch(o[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},u.getAndroidVersionName=function(f){var o=f.split(".").splice(0,2).map(function(c){return parseInt(c,10)||0});if(o.push(0),!(o[0]===1&&o[1]<5))return o[0]===1&&o[1]<6?"Cupcake":o[0]===1&&o[1]>=6?"Donut":o[0]===2&&o[1]<2?"Eclair":o[0]===2&&o[1]===2?"Froyo":o[0]===2&&o[1]>2?"Gingerbread":o[0]===3?"Honeycomb":o[0]===4&&o[1]<1?"Ice Cream Sandwich":o[0]===4&&o[1]<4?"Jelly Bean":o[0]===4&&o[1]>=4?"KitKat":o[0]===5?"Lollipop":o[0]===6?"Marshmallow":o[0]===7?"Nougat":o[0]===8?"Oreo":o[0]===9?"Pie":void 0},u.getVersionPrecision=function(f){return f.split(".").length},u.compareVersions=function(f,o,c){c===void 0&&(c=!1);var e=u.getVersionPrecision(f),g=u.getVersionPrecision(o),h=Math.max(e,g),v=0,_=u.map([f,o],function(b){var p=h-u.getVersionPrecision(b),m=b+new Array(p+1).join(".0");return u.map(m.split("."),function(E){return new Array(20-E.length).join("0")+E}).reverse()});for(c&&(v=h-Math.min(e,g)),h-=1;h>=v;){if(_[0][h]>_[1][h])return 1;if(_[0][h]===_[1][h]){if(h===v)return 0;h-=1}else if(_[0][h]<_[1][h])return-1}},u.map=function(f,o){var c,e=[];if(Array.prototype.map)return Array.prototype.map.call(f,o);for(c=0;c<f.length;c+=1)e.push(o(f[c]));return e},u.find=function(f,o){var c,e;if(Array.prototype.find)return Array.prototype.find.call(f,o);for(c=0,e=f.length;c<e;c+=1){var g=f[c];if(o(g,c))return g}},u.assign=function(f){for(var o,c,e=f,g=arguments.length,h=new Array(g>1?g-1:0),v=1;v<g;v++)h[v-1]=arguments[v];if(Object.assign)return Object.assign.apply(Object,[f].concat(h));var _=function(){var b=h[o];typeof b=="object"&&b!==null&&Object.keys(b).forEach(function(p){e[p]=b[p]})};for(o=0,c=h.length;o<c;o+=1)_();return f},u.getBrowserAlias=function(f){return S.BROWSER_ALIASES_MAP[f]},u.getBrowserTypeByAlias=function(f){return S.BROWSER_MAP[f]||""},u}();l.default=d,C.exports=l.default},18:function(C,l,k){l.__esModule=!0,l.ENGINE_MAP=l.OS_MAP=l.PLATFORMS_MAP=l.BROWSER_MAP=l.BROWSER_ALIASES_MAP=void 0,l.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},l.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},l.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},l.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},l.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(C,l,k){l.__esModule=!0,l.default=void 0;var S,d=(S=k(91))&&S.__esModule?S:{default:S},u=k(18);function f(c,e){for(var g=0;g<e.length;g++){var h=e[g];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(c,h.key,h)}}var o=function(){function c(){}var e,g,h;return c.getParser=function(v,_){if(_===void 0&&(_=!1),typeof v!="string")throw new Error("UserAgent should be a string");return new d.default(v,_)},c.parse=function(v){return new d.default(v).getResult()},e=c,h=[{key:"BROWSER_MAP",get:function(){return u.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return u.ENGINE_MAP}},{key:"OS_MAP",get:function(){return u.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return u.PLATFORMS_MAP}}],(g=null)&&f(e.prototype,g),h&&f(e,h),c}();l.default=o,C.exports=l.default},91:function(C,l,k){l.__esModule=!0,l.default=void 0;var S=c(k(92)),d=c(k(93)),u=c(k(94)),f=c(k(95)),o=c(k(17));function c(g){return g&&g.__esModule?g:{default:g}}var e=function(){function g(v,_){if(_===void 0&&(_=!1),v==null||v==="")throw new Error("UserAgent parameter can't be empty");this._ua=v,this.parsedResult={},_!==!0&&this.parse()}var h=g.prototype;return h.getUA=function(){return this._ua},h.test=function(v){return v.test(this._ua)},h.parseBrowser=function(){var v=this;this.parsedResult.browser={};var _=o.default.find(S.default,function(b){if(typeof b.test=="function")return b.test(v);if(b.test instanceof Array)return b.test.some(function(p){return v.test(p)});throw new Error("Browser's test function is not valid")});return _&&(this.parsedResult.browser=_.describe(this.getUA())),this.parsedResult.browser},h.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},h.getBrowserName=function(v){return v?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},h.getBrowserVersion=function(){return this.getBrowser().version},h.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},h.parseOS=function(){var v=this;this.parsedResult.os={};var _=o.default.find(d.default,function(b){if(typeof b.test=="function")return b.test(v);if(b.test instanceof Array)return b.test.some(function(p){return v.test(p)});throw new Error("Browser's test function is not valid")});return _&&(this.parsedResult.os=_.describe(this.getUA())),this.parsedResult.os},h.getOSName=function(v){var _=this.getOS().name;return v?String(_).toLowerCase()||"":_||""},h.getOSVersion=function(){return this.getOS().version},h.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},h.getPlatformType=function(v){v===void 0&&(v=!1);var _=this.getPlatform().type;return v?String(_).toLowerCase()||"":_||""},h.parsePlatform=function(){var v=this;this.parsedResult.platform={};var _=o.default.find(u.default,function(b){if(typeof b.test=="function")return b.test(v);if(b.test instanceof Array)return b.test.some(function(p){return v.test(p)});throw new Error("Browser's test function is not valid")});return _&&(this.parsedResult.platform=_.describe(this.getUA())),this.parsedResult.platform},h.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},h.getEngineName=function(v){return v?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},h.parseEngine=function(){var v=this;this.parsedResult.engine={};var _=o.default.find(f.default,function(b){if(typeof b.test=="function")return b.test(v);if(b.test instanceof Array)return b.test.some(function(p){return v.test(p)});throw new Error("Browser's test function is not valid")});return _&&(this.parsedResult.engine=_.describe(this.getUA())),this.parsedResult.engine},h.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},h.getResult=function(){return o.default.assign({},this.parsedResult)},h.satisfies=function(v){var _=this,b={},p=0,m={},E=0;if(Object.keys(v).forEach(function(P){var O=v[P];typeof O=="string"?(m[P]=O,E+=1):typeof O=="object"&&(b[P]=O,p+=1)}),p>0){var s=Object.keys(b),i=o.default.find(s,function(P){return _.isOS(P)});if(i){var t=this.satisfies(b[i]);if(t!==void 0)return t}var n=o.default.find(s,function(P){return _.isPlatform(P)});if(n){var r=this.satisfies(b[n]);if(r!==void 0)return r}}if(E>0){var a=Object.keys(m),y=o.default.find(a,function(P){return _.isBrowser(P,!0)});if(y!==void 0)return this.compareVersion(m[y])}},h.isBrowser=function(v,_){_===void 0&&(_=!1);var b=this.getBrowserName().toLowerCase(),p=v.toLowerCase(),m=o.default.getBrowserTypeByAlias(p);return _&&m&&(p=m.toLowerCase()),p===b},h.compareVersion=function(v){var _=[0],b=v,p=!1,m=this.getBrowserVersion();if(typeof m=="string")return v[0]===">"||v[0]==="<"?(b=v.substr(1),v[1]==="="?(p=!0,b=v.substr(2)):_=[],v[0]===">"?_.push(1):_.push(-1)):v[0]==="="?b=v.substr(1):v[0]==="~"&&(p=!0,b=v.substr(1)),_.indexOf(o.default.compareVersions(m,b,p))>-1},h.isOS=function(v){return this.getOSName(!0)===String(v).toLowerCase()},h.isPlatform=function(v){return this.getPlatformType(!0)===String(v).toLowerCase()},h.isEngine=function(v){return this.getEngineName(!0)===String(v).toLowerCase()},h.is=function(v,_){return _===void 0&&(_=!1),this.isBrowser(v,_)||this.isOS(v)||this.isPlatform(v)},h.some=function(v){var _=this;return v===void 0&&(v=[]),v.some(function(b){return _.is(b)})},g}();l.default=e,C.exports=l.default},92:function(C,l,k){l.__esModule=!0,l.default=void 0;var S,d=(S=k(17))&&S.__esModule?S:{default:S},u=/version\/(\d+(\.?_?\d+)+)/i,f=[{test:[/googlebot/i],describe:function(o){var c={name:"Googlebot"},e=d.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/opera/i],describe:function(o){var c={name:"Opera"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/opr\/|opios/i],describe:function(o){var c={name:"Opera"},e=d.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/SamsungBrowser/i],describe:function(o){var c={name:"Samsung Internet for Android"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/Whale/i],describe:function(o){var c={name:"NAVER Whale Browser"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/MZBrowser/i],describe:function(o){var c={name:"MZ Browser"},e=d.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/focus/i],describe:function(o){var c={name:"Focus"},e=d.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/swing/i],describe:function(o){var c={name:"Swing"},e=d.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/coast/i],describe:function(o){var c={name:"Opera Coast"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(o){var c={name:"Opera Touch"},e=d.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/yabrowser/i],describe:function(o){var c={name:"Yandex Browser"},e=d.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/ucbrowser/i],describe:function(o){var c={name:"UC Browser"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/Maxthon|mxios/i],describe:function(o){var c={name:"Maxthon"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/epiphany/i],describe:function(o){var c={name:"Epiphany"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/puffin/i],describe:function(o){var c={name:"Puffin"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/sleipnir/i],describe:function(o){var c={name:"Sleipnir"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/k-meleon/i],describe:function(o){var c={name:"K-Meleon"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/micromessenger/i],describe:function(o){var c={name:"WeChat"},e=d.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/qqbrowser/i],describe:function(o){var c={name:/qqbrowserlite/i.test(o)?"QQ Browser Lite":"QQ Browser"},e=d.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/msie|trident/i],describe:function(o){var c={name:"Internet Explorer"},e=d.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/\sedg\//i],describe:function(o){var c={name:"Microsoft Edge"},e=d.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/edg([ea]|ios)/i],describe:function(o){var c={name:"Microsoft Edge"},e=d.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/vivaldi/i],describe:function(o){var c={name:"Vivaldi"},e=d.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/seamonkey/i],describe:function(o){var c={name:"SeaMonkey"},e=d.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/sailfish/i],describe:function(o){var c={name:"Sailfish"},e=d.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,o);return e&&(c.version=e),c}},{test:[/silk/i],describe:function(o){var c={name:"Amazon Silk"},e=d.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/phantom/i],describe:function(o){var c={name:"PhantomJS"},e=d.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/slimerjs/i],describe:function(o){var c={name:"SlimerJS"},e=d.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var c={name:"BlackBerry"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var c={name:"WebOS Browser"},e=d.default.getFirstMatch(u,o)||d.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/bada/i],describe:function(o){var c={name:"Bada"},e=d.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/tizen/i],describe:function(o){var c={name:"Tizen"},e=d.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/qupzilla/i],describe:function(o){var c={name:"QupZilla"},e=d.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/firefox|iceweasel|fxios/i],describe:function(o){var c={name:"Firefox"},e=d.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/electron/i],describe:function(o){var c={name:"Electron"},e=d.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/MiuiBrowser/i],describe:function(o){var c={name:"Miui"},e=d.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/chromium/i],describe:function(o){var c={name:"Chromium"},e=d.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,o)||d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/chrome|crios|crmo/i],describe:function(o){var c={name:"Chrome"},e=d.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/GSA/i],describe:function(o){var c={name:"Google Search"},e=d.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:function(o){var c=!o.test(/like android/i),e=o.test(/android/i);return c&&e},describe:function(o){var c={name:"Android Browser"},e=d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/playstation 4/i],describe:function(o){var c={name:"PlayStation 4"},e=d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/safari|applewebkit/i],describe:function(o){var c={name:"Safari"},e=d.default.getFirstMatch(u,o);return e&&(c.version=e),c}},{test:[/.*/i],describe:function(o){var c=o.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:d.default.getFirstMatch(c,o),version:d.default.getSecondMatch(c,o)}}}];l.default=f,C.exports=l.default},93:function(C,l,k){l.__esModule=!0,l.default=void 0;var S,d=(S=k(17))&&S.__esModule?S:{default:S},u=k(18),f=[{test:[/Roku\/DVP/],describe:function(o){var c=d.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,o);return{name:u.OS_MAP.Roku,version:c}}},{test:[/windows phone/i],describe:function(o){var c=d.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,o);return{name:u.OS_MAP.WindowsPhone,version:c}}},{test:[/windows /i],describe:function(o){var c=d.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,o),e=d.default.getWindowsVersionName(c);return{name:u.OS_MAP.Windows,version:c,versionName:e}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(o){var c={name:u.OS_MAP.iOS},e=d.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,o);return e&&(c.version=e),c}},{test:[/macintosh/i],describe:function(o){var c=d.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,o).replace(/[_\s]/g,"."),e=d.default.getMacOSVersionName(c),g={name:u.OS_MAP.MacOS,version:c};return e&&(g.versionName=e),g}},{test:[/(ipod|iphone|ipad)/i],describe:function(o){var c=d.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,o).replace(/[_\s]/g,".");return{name:u.OS_MAP.iOS,version:c}}},{test:function(o){var c=!o.test(/like android/i),e=o.test(/android/i);return c&&e},describe:function(o){var c=d.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,o),e=d.default.getAndroidVersionName(c),g={name:u.OS_MAP.Android,version:c};return e&&(g.versionName=e),g}},{test:[/(web|hpw)[o0]s/i],describe:function(o){var c=d.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,o),e={name:u.OS_MAP.WebOS};return c&&c.length&&(e.version=c),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(o){var c=d.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,o)||d.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,o)||d.default.getFirstMatch(/\bbb(\d+)/i,o);return{name:u.OS_MAP.BlackBerry,version:c}}},{test:[/bada/i],describe:function(o){var c=d.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,o);return{name:u.OS_MAP.Bada,version:c}}},{test:[/tizen/i],describe:function(o){var c=d.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,o);return{name:u.OS_MAP.Tizen,version:c}}},{test:[/linux/i],describe:function(){return{name:u.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:u.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(o){var c=d.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,o);return{name:u.OS_MAP.PlayStation4,version:c}}}];l.default=f,C.exports=l.default},94:function(C,l,k){l.__esModule=!0,l.default=void 0;var S,d=(S=k(17))&&S.__esModule?S:{default:S},u=k(18),f=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(o){var c=d.default.getFirstMatch(/(can-l01)/i,o)&&"Nova",e={type:u.PLATFORMS_MAP.mobile,vendor:"Huawei"};return c&&(e.model=c),e}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:u.PLATFORMS_MAP.tablet}}},{test:function(o){var c=o.test(/ipod|iphone/i),e=o.test(/like (ipod|iphone)/i);return c&&!e},describe:function(o){var c=d.default.getFirstMatch(/(ipod|iphone)/i,o);return{type:u.PLATFORMS_MAP.mobile,vendor:"Apple",model:c}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:u.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:u.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName(!0)==="blackberry"},describe:function(){return{type:u.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(o){return o.getBrowserName(!0)==="bada"},describe:function(){return{type:u.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getBrowserName()==="windows phone"},describe:function(){return{type:u.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(o){var c=Number(String(o.getOSVersion()).split(".")[0]);return o.getOSName(!0)==="android"&&c>=3},describe:function(){return{type:u.PLATFORMS_MAP.tablet}}},{test:function(o){return o.getOSName(!0)==="android"},describe:function(){return{type:u.PLATFORMS_MAP.mobile}}},{test:function(o){return o.getOSName(!0)==="macos"},describe:function(){return{type:u.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(o){return o.getOSName(!0)==="windows"},describe:function(){return{type:u.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="linux"},describe:function(){return{type:u.PLATFORMS_MAP.desktop}}},{test:function(o){return o.getOSName(!0)==="playstation 4"},describe:function(){return{type:u.PLATFORMS_MAP.tv}}},{test:function(o){return o.getOSName(!0)==="roku"},describe:function(){return{type:u.PLATFORMS_MAP.tv}}}];l.default=f,C.exports=l.default},95:function(C,l,k){l.__esModule=!0,l.default=void 0;var S,d=(S=k(17))&&S.__esModule?S:{default:S},u=k(18),f=[{test:function(o){return o.getBrowserName(!0)==="microsoft edge"},describe:function(o){if(/\sedg\//i.test(o))return{name:u.ENGINE_MAP.Blink};var c=d.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,o);return{name:u.ENGINE_MAP.EdgeHTML,version:c}}},{test:[/trident/i],describe:function(o){var c={name:u.ENGINE_MAP.Trident},e=d.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:function(o){return o.test(/presto/i)},describe:function(o){var c={name:u.ENGINE_MAP.Presto},e=d.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:function(o){var c=o.test(/gecko/i),e=o.test(/like gecko/i);return c&&!e},describe:function(o){var c={name:u.ENGINE_MAP.Gecko},e=d.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:u.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(o){var c={name:u.ENGINE_MAP.WebKit},e=d.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,o);return e&&(c.version=e),c}}];l.default=f,C.exports=l.default}})},955:function(G,C,l){var k;G.exports=(k=l(9021),l(754),l(4636),l(9506),l(7165),function(){var S=k,d=S.lib.BlockCipher,u=S.algo,f=[],o=[],c=[],e=[],g=[],h=[],v=[],_=[],b=[],p=[];(function(){for(var s=[],i=0;i<256;i++)s[i]=i<128?i<<1:i<<1^283;var t=0,n=0;for(i=0;i<256;i++){var r=n^n<<1^n<<2^n<<3^n<<4;r=r>>>8^255&r^99,f[t]=r,o[r]=t;var a=s[t],y=s[a],P=s[y],O=257*s[r]^16843008*r;c[t]=O<<24|O>>>8,e[t]=O<<16|O>>>16,g[t]=O<<8|O>>>24,h[t]=O,O=16843009*P^65537*y^257*a^16843008*t,v[r]=O<<24|O>>>8,_[r]=O<<16|O>>>16,b[r]=O<<8|O>>>24,p[r]=O,t?(t=a^s[s[s[P^a]]],n^=s[s[n]]):t=n=1}})();var m=[0,1,2,4,8,16,32,64,128,27,54],E=u.AES=d.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var s=this._keyPriorReset=this._key,i=s.words,t=s.sigBytes/4,n=4*((this._nRounds=t+6)+1),r=this._keySchedule=[],a=0;a<n;a++)a<t?r[a]=i[a]:(O=r[a-1],a%t?t>6&&a%t==4&&(O=f[O>>>24]<<24|f[O>>>16&255]<<16|f[O>>>8&255]<<8|f[255&O]):(O=f[(O=O<<8|O>>>24)>>>24]<<24|f[O>>>16&255]<<16|f[O>>>8&255]<<8|f[255&O],O^=m[a/t|0]<<24),r[a]=r[a-t]^O);for(var y=this._invKeySchedule=[],P=0;P<n;P++){if(a=n-P,P%4)var O=r[a];else O=r[a-4];y[P]=P<4||a<=4?O:v[f[O>>>24]]^_[f[O>>>16&255]]^b[f[O>>>8&255]]^p[f[255&O]]}}},encryptBlock:function(s,i){this._doCryptBlock(s,i,this._keySchedule,c,e,g,h,f)},decryptBlock:function(s,i){var t=s[i+1];s[i+1]=s[i+3],s[i+3]=t,this._doCryptBlock(s,i,this._invKeySchedule,v,_,b,p,o),t=s[i+1],s[i+1]=s[i+3],s[i+3]=t},_doCryptBlock:function(s,i,t,n,r,a,y,P){for(var O=this._nRounds,M=s[i]^t[0],j=s[i+1]^t[1],B=s[i+2]^t[2],Q=s[i+3]^t[3],re=4,oe=1;oe<O;oe++){var le=n[M>>>24]^r[j>>>16&255]^a[B>>>8&255]^y[255&Q]^t[re++],ve=n[j>>>24]^r[B>>>16&255]^a[Q>>>8&255]^y[255&M]^t[re++],ke=n[B>>>24]^r[Q>>>16&255]^a[M>>>8&255]^y[255&j]^t[re++],ce=n[Q>>>24]^r[M>>>16&255]^a[j>>>8&255]^y[255&B]^t[re++];M=le,j=ve,B=ke,Q=ce}le=(P[M>>>24]<<24|P[j>>>16&255]<<16|P[B>>>8&255]<<8|P[255&Q])^t[re++],ve=(P[j>>>24]<<24|P[B>>>16&255]<<16|P[Q>>>8&255]<<8|P[255&M])^t[re++],ke=(P[B>>>24]<<24|P[Q>>>16&255]<<16|P[M>>>8&255]<<8|P[255&j])^t[re++],ce=(P[Q>>>24]<<24|P[M>>>16&255]<<16|P[j>>>8&255]<<8|P[255&B])^t[re++],s[i]=le,s[i+1]=ve,s[i+2]=ke,s[i+3]=ce},keySize:8});S.AES=d._createHelper(E)}(),k.AES)},3128:function(G,C,l){var k;G.exports=(k=l(9021),l(754),l(4636),l(9506),l(7165),function(){var S=k,d=S.lib.BlockCipher,u=S.algo;const f=16,o=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],c=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var e={pbox:[],sbox:[]};function g(p,m){let E=m>>24&255,s=m>>16&255,i=m>>8&255,t=255&m,n=p.sbox[0][E]+p.sbox[1][s];return n^=p.sbox[2][i],n+=p.sbox[3][t],n}function h(p,m,E){let s,i=m,t=E;for(let n=0;n<f;++n)i^=p.pbox[n],t=g(p,i)^t,s=i,i=t,t=s;return s=i,i=t,t=s,t^=p.pbox[f],i^=p.pbox[f+1],{left:i,right:t}}function v(p,m,E){let s,i=m,t=E;for(let n=f+1;n>1;--n)i^=p.pbox[n],t=g(p,i)^t,s=i,i=t,t=s;return s=i,i=t,t=s,t^=p.pbox[1],i^=p.pbox[0],{left:i,right:t}}function _(p,m,E){for(let r=0;r<4;r++){p.sbox[r]=[];for(let a=0;a<256;a++)p.sbox[r][a]=c[r][a]}let s=0;for(let r=0;r<f+2;r++)p.pbox[r]=o[r]^m[s],s++,s>=E&&(s=0);let i=0,t=0,n=0;for(let r=0;r<f+2;r+=2)n=h(p,i,t),i=n.left,t=n.right,p.pbox[r]=i,p.pbox[r+1]=t;for(let r=0;r<4;r++)for(let a=0;a<256;a+=2)n=h(p,i,t),i=n.left,t=n.right,p.sbox[r][a]=i,p.sbox[r][a+1]=t;return!0}var b=u.Blowfish=d.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var p=this._keyPriorReset=this._key,m=p.words,E=p.sigBytes/4;_(e,m,E)}},encryptBlock:function(p,m){var E=h(e,p[m],p[m+1]);p[m]=E.left,p[m+1]=E.right},decryptBlock:function(p,m){var E=v(e,p[m],p[m+1]);p[m]=E.left,p[m+1]=E.right},blockSize:2,keySize:4,ivSize:2});S.Blowfish=d._createHelper(b)}(),k.Blowfish)},7165:function(G,C,l){var k;G.exports=(k=l(9021),l(9506),void(k.lib.Cipher||function(S){var d=k,u=d.lib,f=u.Base,o=u.WordArray,c=u.BufferedBlockAlgorithm,e=d.enc,g=(e.Utf8,e.Base64),h=d.algo.EvpKDF,v=u.Cipher=c.extend({cfg:f.extend(),createEncryptor:function(r,a){return this.create(this._ENC_XFORM_MODE,r,a)},createDecryptor:function(r,a){return this.create(this._DEC_XFORM_MODE,r,a)},init:function(r,a,y){this.cfg=this.cfg.extend(y),this._xformMode=r,this._key=a,this.reset()},reset:function(){c.reset.call(this),this._doReset()},process:function(r){return this._append(r),this._process()},finalize:function(r){return r&&this._append(r),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function r(a){return typeof a=="string"?n:i}return function(a){return{encrypt:function(y,P,O){return r(P).encrypt(a,y,P,O)},decrypt:function(y,P,O){return r(P).decrypt(a,y,P,O)}}}}()}),_=(u.StreamCipher=v.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),d.mode={}),b=u.BlockCipherMode=f.extend({createEncryptor:function(r,a){return this.Encryptor.create(r,a)},createDecryptor:function(r,a){return this.Decryptor.create(r,a)},init:function(r,a){this._cipher=r,this._iv=a}}),p=_.CBC=function(){var r=b.extend();function a(y,P,O){var M,j=this._iv;j?(M=j,this._iv=S):M=this._prevBlock;for(var B=0;B<O;B++)y[P+B]^=M[B]}return r.Encryptor=r.extend({processBlock:function(y,P){var O=this._cipher,M=O.blockSize;a.call(this,y,P,M),O.encryptBlock(y,P),this._prevBlock=y.slice(P,P+M)}}),r.Decryptor=r.extend({processBlock:function(y,P){var O=this._cipher,M=O.blockSize,j=y.slice(P,P+M);O.decryptBlock(y,P),a.call(this,y,P,M),this._prevBlock=j}}),r}(),m=(d.pad={}).Pkcs7={pad:function(r,a){for(var y=4*a,P=y-r.sigBytes%y,O=P<<24|P<<16|P<<8|P,M=[],j=0;j<P;j+=4)M.push(O);var B=o.create(M,P);r.concat(B)},unpad:function(r){var a=255&r.words[r.sigBytes-1>>>2];r.sigBytes-=a}},E=(u.BlockCipher=v.extend({cfg:v.cfg.extend({mode:p,padding:m}),reset:function(){var r;v.reset.call(this);var a=this.cfg,y=a.iv,P=a.mode;this._xformMode==this._ENC_XFORM_MODE?r=P.createEncryptor:(r=P.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==r?this._mode.init(this,y&&y.words):(this._mode=r.call(P,this,y&&y.words),this._mode.__creator=r)},_doProcessBlock:function(r,a){this._mode.processBlock(r,a)},_doFinalize:function(){var r,a=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(a.pad(this._data,this.blockSize),r=this._process(!0)):(r=this._process(!0),a.unpad(r)),r},blockSize:4}),u.CipherParams=f.extend({init:function(r){this.mixIn(r)},toString:function(r){return(r||this.formatter).stringify(this)}})),s=(d.format={}).OpenSSL={stringify:function(r){var a=r.ciphertext,y=r.salt;return(y?o.create([1398893684,1701076831]).concat(y).concat(a):a).toString(g)},parse:function(r){var a,y=g.parse(r),P=y.words;return P[0]==1398893684&&P[1]==1701076831&&(a=o.create(P.slice(2,4)),P.splice(0,4),y.sigBytes-=16),E.create({ciphertext:y,salt:a})}},i=u.SerializableCipher=f.extend({cfg:f.extend({format:s}),encrypt:function(r,a,y,P){P=this.cfg.extend(P);var O=r.createEncryptor(y,P),M=O.finalize(a),j=O.cfg;return E.create({ciphertext:M,key:y,iv:j.iv,algorithm:r,mode:j.mode,padding:j.padding,blockSize:r.blockSize,formatter:P.format})},decrypt:function(r,a,y,P){return P=this.cfg.extend(P),a=this._parse(a,P.format),r.createDecryptor(y,P).finalize(a.ciphertext)},_parse:function(r,a){return typeof r=="string"?a.parse(r,this):r}}),t=(d.kdf={}).OpenSSL={execute:function(r,a,y,P,O){if(P||(P=o.random(8)),O)M=h.create({keySize:a+y,hasher:O}).compute(r,P);else var M=h.create({keySize:a+y}).compute(r,P);var j=o.create(M.words.slice(a),4*y);return M.sigBytes=4*a,E.create({key:M,iv:j,salt:P})}},n=u.PasswordBasedCipher=i.extend({cfg:i.cfg.extend({kdf:t}),encrypt:function(r,a,y,P){var O=(P=this.cfg.extend(P)).kdf.execute(y,r.keySize,r.ivSize,P.salt,P.hasher);P.iv=O.iv;var M=i.encrypt.call(this,r,a,O.key,P);return M.mixIn(O),M},decrypt:function(r,a,y,P){P=this.cfg.extend(P),a=this._parse(a,P.format);var O=P.kdf.execute(y,r.keySize,r.ivSize,a.salt,P.hasher);return P.iv=O.iv,i.decrypt.call(this,r,a,O.key,P)}})}()))},9021:function(G,C,l){var k;G.exports=(k=k||function(S,d){var u;if(typeof window<"u"&&window.crypto&&(u=window.crypto),typeof self<"u"&&self.crypto&&(u=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(u=globalThis.crypto),!u&&typeof window<"u"&&window.msCrypto&&(u=window.msCrypto),!u&&l.g!==void 0&&l.g.crypto&&(u=l.g.crypto),!u)try{u=l(477)}catch{}var f=function(){if(u){if(typeof u.getRandomValues=="function")try{return u.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof u.randomBytes=="function")try{return u.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function s(){}return function(i){var t;return s.prototype=i,t=new s,s.prototype=null,t}}(),c={},e=c.lib={},g=e.Base={extend:function(s){var i=o(this);return s&&i.mixIn(s),i.hasOwnProperty("init")&&this.init!==i.init||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var i in s)s.hasOwnProperty(i)&&(this[i]=s[i]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}},h=e.WordArray=g.extend({init:function(s,i){s=this.words=s||[],this.sigBytes=i!=d?i:4*s.length},toString:function(s){return(s||_).stringify(this)},concat:function(s){var i=this.words,t=s.words,n=this.sigBytes,r=s.sigBytes;if(this.clamp(),n%4)for(var a=0;a<r;a++){var y=t[a>>>2]>>>24-a%4*8&255;i[n+a>>>2]|=y<<24-(n+a)%4*8}else for(var P=0;P<r;P+=4)i[n+P>>>2]=t[P>>>2];return this.sigBytes+=r,this},clamp:function(){var s=this.words,i=this.sigBytes;s[i>>>2]&=4294967295<<32-i%4*8,s.length=S.ceil(i/4)},clone:function(){var s=g.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var i=[],t=0;t<s;t+=4)i.push(f());return new h.init(i,s)}}),v=c.enc={},_=v.Hex={stringify:function(s){for(var i=s.words,t=s.sigBytes,n=[],r=0;r<t;r++){var a=i[r>>>2]>>>24-r%4*8&255;n.push((a>>>4).toString(16)),n.push((15&a).toString(16))}return n.join("")},parse:function(s){for(var i=s.length,t=[],n=0;n<i;n+=2)t[n>>>3]|=parseInt(s.substr(n,2),16)<<24-n%8*4;return new h.init(t,i/2)}},b=v.Latin1={stringify:function(s){for(var i=s.words,t=s.sigBytes,n=[],r=0;r<t;r++){var a=i[r>>>2]>>>24-r%4*8&255;n.push(String.fromCharCode(a))}return n.join("")},parse:function(s){for(var i=s.length,t=[],n=0;n<i;n++)t[n>>>2]|=(255&s.charCodeAt(n))<<24-n%4*8;return new h.init(t,i)}},p=v.Utf8={stringify:function(s){try{return decodeURIComponent(escape(b.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return b.parse(unescape(encodeURIComponent(s)))}},m=e.BufferedBlockAlgorithm=g.extend({reset:function(){this._data=new h.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=p.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var i,t=this._data,n=t.words,r=t.sigBytes,a=this.blockSize,y=r/(4*a),P=(y=s?S.ceil(y):S.max((0|y)-this._minBufferSize,0))*a,O=S.min(4*P,r);if(P){for(var M=0;M<P;M+=a)this._doProcessBlock(n,M);i=n.splice(0,P),t.sigBytes-=O}return new h.init(i,O)},clone:function(){var s=g.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0}),E=(e.Hasher=m.extend({cfg:g.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){m.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){return s&&this._append(s),this._doFinalize()},blockSize:16,_createHelper:function(s){return function(i,t){return new s.init(t).finalize(i)}},_createHmacHelper:function(s){return function(i,t){return new E.HMAC.init(s,t).finalize(i)}}}),c.algo={});return c}(Math),k)},754:function(G,C,l){var k;G.exports=(k=l(9021),function(){var S=k,d=S.lib.WordArray;function u(f,o,c){for(var e=[],g=0,h=0;h<o;h++)if(h%4){var v=c[f.charCodeAt(h-1)]<<h%4*2|c[f.charCodeAt(h)]>>>6-h%4*2;e[g>>>2]|=v<<24-g%4*8,g++}return d.create(e,g)}S.enc.Base64={stringify:function(f){var o=f.words,c=f.sigBytes,e=this._map;f.clamp();for(var g=[],h=0;h<c;h+=3)for(var v=(o[h>>>2]>>>24-h%4*8&255)<<16|(o[h+1>>>2]>>>24-(h+1)%4*8&255)<<8|o[h+2>>>2]>>>24-(h+2)%4*8&255,_=0;_<4&&h+.75*_<c;_++)g.push(e.charAt(v>>>6*(3-_)&63));var b=e.charAt(64);if(b)for(;g.length%4;)g.push(b);return g.join("")},parse:function(f){var o=f.length,c=this._map,e=this._reverseMap;if(!e){e=this._reverseMap=[];for(var g=0;g<c.length;g++)e[c.charCodeAt(g)]=g}var h=c.charAt(64);if(h){var v=f.indexOf(h);v!==-1&&(o=v)}return u(f,o,e)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),k.enc.Base64)},4725:function(G,C,l){var k;G.exports=(k=l(9021),function(){var S=k,d=S.lib.WordArray;function u(f,o,c){for(var e=[],g=0,h=0;h<o;h++)if(h%4){var v=c[f.charCodeAt(h-1)]<<h%4*2|c[f.charCodeAt(h)]>>>6-h%4*2;e[g>>>2]|=v<<24-g%4*8,g++}return d.create(e,g)}S.enc.Base64url={stringify:function(f,o){o===void 0&&(o=!0);var c=f.words,e=f.sigBytes,g=o?this._safe_map:this._map;f.clamp();for(var h=[],v=0;v<e;v+=3)for(var _=(c[v>>>2]>>>24-v%4*8&255)<<16|(c[v+1>>>2]>>>24-(v+1)%4*8&255)<<8|c[v+2>>>2]>>>24-(v+2)%4*8&255,b=0;b<4&&v+.75*b<e;b++)h.push(g.charAt(_>>>6*(3-b)&63));var p=g.charAt(64);if(p)for(;h.length%4;)h.push(p);return h.join("")},parse:function(f,o){o===void 0&&(o=!0);var c=f.length,e=o?this._safe_map:this._map,g=this._reverseMap;if(!g){g=this._reverseMap=[];for(var h=0;h<e.length;h++)g[e.charCodeAt(h)]=h}var v=e.charAt(64);if(v){var _=f.indexOf(v);_!==-1&&(c=_)}return u(f,c,g)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),k.enc.Base64url)},5503:function(G,C,l){var k;G.exports=(k=l(9021),function(){var S=k,d=S.lib.WordArray,u=S.enc;function f(o){return o<<8&4278255360|o>>>8&16711935}u.Utf16=u.Utf16BE={stringify:function(o){for(var c=o.words,e=o.sigBytes,g=[],h=0;h<e;h+=2){var v=c[h>>>2]>>>16-h%4*8&65535;g.push(String.fromCharCode(v))}return g.join("")},parse:function(o){for(var c=o.length,e=[],g=0;g<c;g++)e[g>>>1]|=o.charCodeAt(g)<<16-g%2*16;return d.create(e,2*c)}},u.Utf16LE={stringify:function(o){for(var c=o.words,e=o.sigBytes,g=[],h=0;h<e;h+=2){var v=f(c[h>>>2]>>>16-h%4*8&65535);g.push(String.fromCharCode(v))}return g.join("")},parse:function(o){for(var c=o.length,e=[],g=0;g<c;g++)e[g>>>1]|=f(o.charCodeAt(g)<<16-g%2*16);return d.create(e,2*c)}}}(),k.enc.Utf16)},9506:function(G,C,l){var k,S,d,u,f,o,c,e;G.exports=(e=l(9021),l(5471),l(1025),S=(k=e).lib,d=S.Base,u=S.WordArray,f=k.algo,o=f.MD5,c=f.EvpKDF=d.extend({cfg:d.extend({keySize:4,hasher:o,iterations:1}),init:function(g){this.cfg=this.cfg.extend(g)},compute:function(g,h){for(var v,_=this.cfg,b=_.hasher.create(),p=u.create(),m=p.words,E=_.keySize,s=_.iterations;m.length<E;){v&&b.update(v),v=b.update(g).finalize(h),b.reset();for(var i=1;i<s;i++)v=b.finalize(v),b.reset();p.concat(v)}return p.sigBytes=4*E,p}}),k.EvpKDF=function(g,h,v){return c.create(v).compute(g,h)},e.EvpKDF)},25:function(G,C,l){var k,S,d,u;G.exports=(u=l(9021),l(7165),S=(k=u).lib.CipherParams,d=k.enc.Hex,k.format.Hex={stringify:function(f){return f.ciphertext.toString(d)},parse:function(f){var o=d.parse(f);return S.create({ciphertext:o})}},u.format.Hex)},1025:function(G,C,l){var k,S,d,u;G.exports=(k=l(9021),d=(S=k).lib.Base,u=S.enc.Utf8,void(S.algo.HMAC=d.extend({init:function(f,o){f=this._hasher=new f.init,typeof o=="string"&&(o=u.parse(o));var c=f.blockSize,e=4*c;o.sigBytes>e&&(o=f.finalize(o)),o.clamp();for(var g=this._oKey=o.clone(),h=this._iKey=o.clone(),v=g.words,_=h.words,b=0;b<c;b++)v[b]^=1549556828,_[b]^=909522486;g.sigBytes=h.sigBytes=e,this.reset()},reset:function(){var f=this._hasher;f.reset(),f.update(this._iKey)},update:function(f){return this._hasher.update(f),this},finalize:function(f){var o=this._hasher,c=o.finalize(f);return o.reset(),o.finalize(this._oKey.clone().concat(c))}})))},1396:function(G,C,l){var k;G.exports=(k=l(9021),l(3240),l(6440),l(5503),l(754),l(4725),l(4636),l(5471),l(3009),l(6308),l(1380),l(9557),l(5953),l(8056),l(1025),l(19),l(9506),l(7165),l(2169),l(6939),l(6372),l(3797),l(8454),l(2073),l(4905),l(482),l(2155),l(8124),l(25),l(955),l(7628),l(7193),l(6298),l(2696),l(3128),k)},6440:function(G,C,l){var k;G.exports=(k=l(9021),function(){if(typeof ArrayBuffer=="function"){var S=k.lib.WordArray,d=S.init,u=S.init=function(f){if(f instanceof ArrayBuffer&&(f=new Uint8Array(f)),(f instanceof Int8Array||typeof Uint8ClampedArray<"u"&&f instanceof Uint8ClampedArray||f instanceof Int16Array||f instanceof Uint16Array||f instanceof Int32Array||f instanceof Uint32Array||f instanceof Float32Array||f instanceof Float64Array)&&(f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength)),f instanceof Uint8Array){for(var o=f.byteLength,c=[],e=0;e<o;e++)c[e>>>2]|=f[e]<<24-e%4*8;d.call(this,c,o)}else d.apply(this,arguments)};u.prototype=S}}(),k.lib.WordArray)},4636:function(G,C,l){var k;G.exports=(k=l(9021),function(S){var d=k,u=d.lib,f=u.WordArray,o=u.Hasher,c=d.algo,e=[];(function(){for(var p=0;p<64;p++)e[p]=4294967296*S.abs(S.sin(p+1))|0})();var g=c.MD5=o.extend({_doReset:function(){this._hash=new f.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(p,m){for(var E=0;E<16;E++){var s=m+E,i=p[s];p[s]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var t=this._hash.words,n=p[m+0],r=p[m+1],a=p[m+2],y=p[m+3],P=p[m+4],O=p[m+5],M=p[m+6],j=p[m+7],B=p[m+8],Q=p[m+9],re=p[m+10],oe=p[m+11],le=p[m+12],ve=p[m+13],ke=p[m+14],ce=p[m+15],te=t[0],ue=t[1],pe=t[2],he=t[3];te=h(te,ue,pe,he,n,7,e[0]),he=h(he,te,ue,pe,r,12,e[1]),pe=h(pe,he,te,ue,a,17,e[2]),ue=h(ue,pe,he,te,y,22,e[3]),te=h(te,ue,pe,he,P,7,e[4]),he=h(he,te,ue,pe,O,12,e[5]),pe=h(pe,he,te,ue,M,17,e[6]),ue=h(ue,pe,he,te,j,22,e[7]),te=h(te,ue,pe,he,B,7,e[8]),he=h(he,te,ue,pe,Q,12,e[9]),pe=h(pe,he,te,ue,re,17,e[10]),ue=h(ue,pe,he,te,oe,22,e[11]),te=h(te,ue,pe,he,le,7,e[12]),he=h(he,te,ue,pe,ve,12,e[13]),pe=h(pe,he,te,ue,ke,17,e[14]),te=v(te,ue=h(ue,pe,he,te,ce,22,e[15]),pe,he,r,5,e[16]),he=v(he,te,ue,pe,M,9,e[17]),pe=v(pe,he,te,ue,oe,14,e[18]),ue=v(ue,pe,he,te,n,20,e[19]),te=v(te,ue,pe,he,O,5,e[20]),he=v(he,te,ue,pe,re,9,e[21]),pe=v(pe,he,te,ue,ce,14,e[22]),ue=v(ue,pe,he,te,P,20,e[23]),te=v(te,ue,pe,he,Q,5,e[24]),he=v(he,te,ue,pe,ke,9,e[25]),pe=v(pe,he,te,ue,y,14,e[26]),ue=v(ue,pe,he,te,B,20,e[27]),te=v(te,ue,pe,he,ve,5,e[28]),he=v(he,te,ue,pe,a,9,e[29]),pe=v(pe,he,te,ue,j,14,e[30]),te=_(te,ue=v(ue,pe,he,te,le,20,e[31]),pe,he,O,4,e[32]),he=_(he,te,ue,pe,B,11,e[33]),pe=_(pe,he,te,ue,oe,16,e[34]),ue=_(ue,pe,he,te,ke,23,e[35]),te=_(te,ue,pe,he,r,4,e[36]),he=_(he,te,ue,pe,P,11,e[37]),pe=_(pe,he,te,ue,j,16,e[38]),ue=_(ue,pe,he,te,re,23,e[39]),te=_(te,ue,pe,he,ve,4,e[40]),he=_(he,te,ue,pe,n,11,e[41]),pe=_(pe,he,te,ue,y,16,e[42]),ue=_(ue,pe,he,te,M,23,e[43]),te=_(te,ue,pe,he,Q,4,e[44]),he=_(he,te,ue,pe,le,11,e[45]),pe=_(pe,he,te,ue,ce,16,e[46]),te=b(te,ue=_(ue,pe,he,te,a,23,e[47]),pe,he,n,6,e[48]),he=b(he,te,ue,pe,j,10,e[49]),pe=b(pe,he,te,ue,ke,15,e[50]),ue=b(ue,pe,he,te,O,21,e[51]),te=b(te,ue,pe,he,le,6,e[52]),he=b(he,te,ue,pe,y,10,e[53]),pe=b(pe,he,te,ue,re,15,e[54]),ue=b(ue,pe,he,te,r,21,e[55]),te=b(te,ue,pe,he,B,6,e[56]),he=b(he,te,ue,pe,ce,10,e[57]),pe=b(pe,he,te,ue,M,15,e[58]),ue=b(ue,pe,he,te,ve,21,e[59]),te=b(te,ue,pe,he,P,6,e[60]),he=b(he,te,ue,pe,oe,10,e[61]),pe=b(pe,he,te,ue,a,15,e[62]),ue=b(ue,pe,he,te,Q,21,e[63]),t[0]=t[0]+te|0,t[1]=t[1]+ue|0,t[2]=t[2]+pe|0,t[3]=t[3]+he|0},_doFinalize:function(){var p=this._data,m=p.words,E=8*this._nDataBytes,s=8*p.sigBytes;m[s>>>5]|=128<<24-s%32;var i=S.floor(E/4294967296),t=E;m[15+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),m[14+(s+64>>>9<<4)]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8),p.sigBytes=4*(m.length+1),this._process();for(var n=this._hash,r=n.words,a=0;a<4;a++){var y=r[a];r[a]=16711935&(y<<8|y>>>24)|4278255360&(y<<24|y>>>8)}return n},clone:function(){var p=o.clone.call(this);return p._hash=this._hash.clone(),p}});function h(p,m,E,s,i,t,n){var r=p+(m&E|~m&s)+i+n;return(r<<t|r>>>32-t)+m}function v(p,m,E,s,i,t,n){var r=p+(m&s|E&~s)+i+n;return(r<<t|r>>>32-t)+m}function _(p,m,E,s,i,t,n){var r=p+(m^E^s)+i+n;return(r<<t|r>>>32-t)+m}function b(p,m,E,s,i,t,n){var r=p+(E^(m|~s))+i+n;return(r<<t|r>>>32-t)+m}d.MD5=o._createHelper(g),d.HmacMD5=o._createHmacHelper(g)}(Math),k.MD5)},2169:function(G,C,l){var k;G.exports=(k=l(9021),l(7165),k.mode.CFB=function(){var S=k.lib.BlockCipherMode.extend();function d(u,f,o,c){var e,g=this._iv;g?(e=g.slice(0),this._iv=void 0):e=this._prevBlock,c.encryptBlock(e,0);for(var h=0;h<o;h++)u[f+h]^=e[h]}return S.Encryptor=S.extend({processBlock:function(u,f){var o=this._cipher,c=o.blockSize;d.call(this,u,f,c,o),this._prevBlock=u.slice(f,f+c)}}),S.Decryptor=S.extend({processBlock:function(u,f){var o=this._cipher,c=o.blockSize,e=u.slice(f,f+c);d.call(this,u,f,c,o),this._prevBlock=e}}),S}(),k.mode.CFB)},6372:function(G,C,l){var k;G.exports=(k=l(9021),l(7165),k.mode.CTRGladman=function(){var S=k.lib.BlockCipherMode.extend();function d(o){if(255&~(o>>24))o+=16777216;else{var c=o>>16&255,e=o>>8&255,g=255&o;c===255?(c=0,e===255?(e=0,g===255?g=0:++g):++e):++c,o=0,o+=c<<16,o+=e<<8,o+=g}return o}function u(o){return(o[0]=d(o[0]))===0&&(o[1]=d(o[1])),o}var f=S.Encryptor=S.extend({processBlock:function(o,c){var e=this._cipher,g=e.blockSize,h=this._iv,v=this._counter;h&&(v=this._counter=h.slice(0),this._iv=void 0),u(v);var _=v.slice(0);e.encryptBlock(_,0);for(var b=0;b<g;b++)o[c+b]^=_[b]}});return S.Decryptor=f,S}(),k.mode.CTRGladman)},6939:function(G,C,l){var k,S,d;G.exports=(d=l(9021),l(7165),d.mode.CTR=(k=d.lib.BlockCipherMode.extend(),S=k.Encryptor=k.extend({processBlock:function(u,f){var o=this._cipher,c=o.blockSize,e=this._iv,g=this._counter;e&&(g=this._counter=e.slice(0),this._iv=void 0);var h=g.slice(0);o.encryptBlock(h,0),g[c-1]=g[c-1]+1|0;for(var v=0;v<c;v++)u[f+v]^=h[v]}}),k.Decryptor=S,k),d.mode.CTR)},8454:function(G,C,l){var k,S;G.exports=(S=l(9021),l(7165),S.mode.ECB=((k=S.lib.BlockCipherMode.extend()).Encryptor=k.extend({processBlock:function(d,u){this._cipher.encryptBlock(d,u)}}),k.Decryptor=k.extend({processBlock:function(d,u){this._cipher.decryptBlock(d,u)}}),k),S.mode.ECB)},3797:function(G,C,l){var k,S,d;G.exports=(d=l(9021),l(7165),d.mode.OFB=(k=d.lib.BlockCipherMode.extend(),S=k.Encryptor=k.extend({processBlock:function(u,f){var o=this._cipher,c=o.blockSize,e=this._iv,g=this._keystream;e&&(g=this._keystream=e.slice(0),this._iv=void 0),o.encryptBlock(g,0);for(var h=0;h<c;h++)u[f+h]^=g[h]}}),k.Decryptor=S,k),d.mode.OFB)},2073:function(G,C,l){var k;G.exports=(k=l(9021),l(7165),k.pad.AnsiX923={pad:function(S,d){var u=S.sigBytes,f=4*d,o=f-u%f,c=u+o-1;S.clamp(),S.words[c>>>2]|=o<<24-c%4*8,S.sigBytes+=o},unpad:function(S){var d=255&S.words[S.sigBytes-1>>>2];S.sigBytes-=d}},k.pad.Ansix923)},4905:function(G,C,l){var k;G.exports=(k=l(9021),l(7165),k.pad.Iso10126={pad:function(S,d){var u=4*d,f=u-S.sigBytes%u;S.concat(k.lib.WordArray.random(f-1)).concat(k.lib.WordArray.create([f<<24],1))},unpad:function(S){var d=255&S.words[S.sigBytes-1>>>2];S.sigBytes-=d}},k.pad.Iso10126)},482:function(G,C,l){var k;G.exports=(k=l(9021),l(7165),k.pad.Iso97971={pad:function(S,d){S.concat(k.lib.WordArray.create([2147483648],1)),k.pad.ZeroPadding.pad(S,d)},unpad:function(S){k.pad.ZeroPadding.unpad(S),S.sigBytes--}},k.pad.Iso97971)},8124:function(G,C,l){var k;G.exports=(k=l(9021),l(7165),k.pad.NoPadding={pad:function(){},unpad:function(){}},k.pad.NoPadding)},2155:function(G,C,l){var k;G.exports=(k=l(9021),l(7165),k.pad.ZeroPadding={pad:function(S,d){var u=4*d;S.clamp(),S.sigBytes+=u-(S.sigBytes%u||u)},unpad:function(S){var d=S.words,u=S.sigBytes-1;for(u=S.sigBytes-1;u>=0;u--)if(d[u>>>2]>>>24-u%4*8&255){S.sigBytes=u+1;break}}},k.pad.ZeroPadding)},19:function(G,C,l){var k,S,d,u,f,o,c,e,g;G.exports=(g=l(9021),l(3009),l(1025),S=(k=g).lib,d=S.Base,u=S.WordArray,f=k.algo,o=f.SHA256,c=f.HMAC,e=f.PBKDF2=d.extend({cfg:d.extend({keySize:4,hasher:o,iterations:25e4}),init:function(h){this.cfg=this.cfg.extend(h)},compute:function(h,v){for(var _=this.cfg,b=c.create(_.hasher,h),p=u.create(),m=u.create([1]),E=p.words,s=m.words,i=_.keySize,t=_.iterations;E.length<i;){var n=b.update(v).finalize(m);b.reset();for(var r=n.words,a=r.length,y=n,P=1;P<t;P++){y=b.finalize(y),b.reset();for(var O=y.words,M=0;M<a;M++)r[M]^=O[M]}p.concat(n),s[0]++}return p.sigBytes=4*i,p}}),k.PBKDF2=function(h,v,_){return e.create(_).compute(h,v)},g.PBKDF2)},2696:function(G,C,l){var k;G.exports=(k=l(9021),l(754),l(4636),l(9506),l(7165),function(){var S=k,d=S.lib.StreamCipher,u=S.algo,f=[],o=[],c=[],e=u.RabbitLegacy=d.extend({_doReset:function(){var h=this._key.words,v=this.cfg.iv,_=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],b=this._C=[h[2]<<16|h[2]>>>16,4294901760&h[0]|65535&h[1],h[3]<<16|h[3]>>>16,4294901760&h[1]|65535&h[2],h[0]<<16|h[0]>>>16,4294901760&h[2]|65535&h[3],h[1]<<16|h[1]>>>16,4294901760&h[3]|65535&h[0]];this._b=0;for(var p=0;p<4;p++)g.call(this);for(p=0;p<8;p++)b[p]^=_[p+4&7];if(v){var m=v.words,E=m[0],s=m[1],i=16711935&(E<<8|E>>>24)|4278255360&(E<<24|E>>>8),t=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n=i>>>16|4294901760&t,r=t<<16|65535&i;for(b[0]^=i,b[1]^=n,b[2]^=t,b[3]^=r,b[4]^=i,b[5]^=n,b[6]^=t,b[7]^=r,p=0;p<4;p++)g.call(this)}},_doProcessBlock:function(h,v){var _=this._X;g.call(this),f[0]=_[0]^_[5]>>>16^_[3]<<16,f[1]=_[2]^_[7]>>>16^_[5]<<16,f[2]=_[4]^_[1]>>>16^_[7]<<16,f[3]=_[6]^_[3]>>>16^_[1]<<16;for(var b=0;b<4;b++)f[b]=16711935&(f[b]<<8|f[b]>>>24)|4278255360&(f[b]<<24|f[b]>>>8),h[v+b]^=f[b]},blockSize:4,ivSize:2});function g(){for(var h=this._X,v=this._C,_=0;_<8;_++)o[_]=v[_];for(v[0]=v[0]+1295307597+this._b|0,v[1]=v[1]+3545052371+(v[0]>>>0<o[0]>>>0?1:0)|0,v[2]=v[2]+886263092+(v[1]>>>0<o[1]>>>0?1:0)|0,v[3]=v[3]+1295307597+(v[2]>>>0<o[2]>>>0?1:0)|0,v[4]=v[4]+3545052371+(v[3]>>>0<o[3]>>>0?1:0)|0,v[5]=v[5]+886263092+(v[4]>>>0<o[4]>>>0?1:0)|0,v[6]=v[6]+1295307597+(v[5]>>>0<o[5]>>>0?1:0)|0,v[7]=v[7]+3545052371+(v[6]>>>0<o[6]>>>0?1:0)|0,this._b=v[7]>>>0<o[7]>>>0?1:0,_=0;_<8;_++){var b=h[_]+v[_],p=65535&b,m=b>>>16,E=((p*p>>>17)+p*m>>>15)+m*m,s=((4294901760&b)*b|0)+((65535&b)*b|0);c[_]=E^s}h[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,h[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,h[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,h[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,h[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,h[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,h[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,h[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}S.RabbitLegacy=d._createHelper(e)}(),k.RabbitLegacy)},6298:function(G,C,l){var k;G.exports=(k=l(9021),l(754),l(4636),l(9506),l(7165),function(){var S=k,d=S.lib.StreamCipher,u=S.algo,f=[],o=[],c=[],e=u.Rabbit=d.extend({_doReset:function(){for(var h=this._key.words,v=this.cfg.iv,_=0;_<4;_++)h[_]=16711935&(h[_]<<8|h[_]>>>24)|4278255360&(h[_]<<24|h[_]>>>8);var b=this._X=[h[0],h[3]<<16|h[2]>>>16,h[1],h[0]<<16|h[3]>>>16,h[2],h[1]<<16|h[0]>>>16,h[3],h[2]<<16|h[1]>>>16],p=this._C=[h[2]<<16|h[2]>>>16,4294901760&h[0]|65535&h[1],h[3]<<16|h[3]>>>16,4294901760&h[1]|65535&h[2],h[0]<<16|h[0]>>>16,4294901760&h[2]|65535&h[3],h[1]<<16|h[1]>>>16,4294901760&h[3]|65535&h[0]];for(this._b=0,_=0;_<4;_++)g.call(this);for(_=0;_<8;_++)p[_]^=b[_+4&7];if(v){var m=v.words,E=m[0],s=m[1],i=16711935&(E<<8|E>>>24)|4278255360&(E<<24|E>>>8),t=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n=i>>>16|4294901760&t,r=t<<16|65535&i;for(p[0]^=i,p[1]^=n,p[2]^=t,p[3]^=r,p[4]^=i,p[5]^=n,p[6]^=t,p[7]^=r,_=0;_<4;_++)g.call(this)}},_doProcessBlock:function(h,v){var _=this._X;g.call(this),f[0]=_[0]^_[5]>>>16^_[3]<<16,f[1]=_[2]^_[7]>>>16^_[5]<<16,f[2]=_[4]^_[1]>>>16^_[7]<<16,f[3]=_[6]^_[3]>>>16^_[1]<<16;for(var b=0;b<4;b++)f[b]=16711935&(f[b]<<8|f[b]>>>24)|4278255360&(f[b]<<24|f[b]>>>8),h[v+b]^=f[b]},blockSize:4,ivSize:2});function g(){for(var h=this._X,v=this._C,_=0;_<8;_++)o[_]=v[_];for(v[0]=v[0]+1295307597+this._b|0,v[1]=v[1]+3545052371+(v[0]>>>0<o[0]>>>0?1:0)|0,v[2]=v[2]+886263092+(v[1]>>>0<o[1]>>>0?1:0)|0,v[3]=v[3]+1295307597+(v[2]>>>0<o[2]>>>0?1:0)|0,v[4]=v[4]+3545052371+(v[3]>>>0<o[3]>>>0?1:0)|0,v[5]=v[5]+886263092+(v[4]>>>0<o[4]>>>0?1:0)|0,v[6]=v[6]+1295307597+(v[5]>>>0<o[5]>>>0?1:0)|0,v[7]=v[7]+3545052371+(v[6]>>>0<o[6]>>>0?1:0)|0,this._b=v[7]>>>0<o[7]>>>0?1:0,_=0;_<8;_++){var b=h[_]+v[_],p=65535&b,m=b>>>16,E=((p*p>>>17)+p*m>>>15)+m*m,s=((4294901760&b)*b|0)+((65535&b)*b|0);c[_]=E^s}h[0]=c[0]+(c[7]<<16|c[7]>>>16)+(c[6]<<16|c[6]>>>16)|0,h[1]=c[1]+(c[0]<<8|c[0]>>>24)+c[7]|0,h[2]=c[2]+(c[1]<<16|c[1]>>>16)+(c[0]<<16|c[0]>>>16)|0,h[3]=c[3]+(c[2]<<8|c[2]>>>24)+c[1]|0,h[4]=c[4]+(c[3]<<16|c[3]>>>16)+(c[2]<<16|c[2]>>>16)|0,h[5]=c[5]+(c[4]<<8|c[4]>>>24)+c[3]|0,h[6]=c[6]+(c[5]<<16|c[5]>>>16)+(c[4]<<16|c[4]>>>16)|0,h[7]=c[7]+(c[6]<<8|c[6]>>>24)+c[5]|0}S.Rabbit=d._createHelper(e)}(),k.Rabbit)},7193:function(G,C,l){var k;G.exports=(k=l(9021),l(754),l(4636),l(9506),l(7165),function(){var S=k,d=S.lib.StreamCipher,u=S.algo,f=u.RC4=d.extend({_doReset:function(){for(var e=this._key,g=e.words,h=e.sigBytes,v=this._S=[],_=0;_<256;_++)v[_]=_;_=0;for(var b=0;_<256;_++){var p=_%h,m=g[p>>>2]>>>24-p%4*8&255;b=(b+v[_]+m)%256;var E=v[_];v[_]=v[b],v[b]=E}this._i=this._j=0},_doProcessBlock:function(e,g){e[g]^=o.call(this)},keySize:8,ivSize:0});function o(){for(var e=this._S,g=this._i,h=this._j,v=0,_=0;_<4;_++){h=(h+e[g=(g+1)%256])%256;var b=e[g];e[g]=e[h],e[h]=b,v|=e[(e[g]+e[h])%256]<<24-8*_}return this._i=g,this._j=h,v}S.RC4=d._createHelper(f);var c=u.RC4Drop=f.extend({cfg:f.cfg.extend({drop:192}),_doReset:function(){f._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)o.call(this)}});S.RC4Drop=d._createHelper(c)}(),k.RC4)},8056:function(G,C,l){var k;G.exports=(k=l(9021),function(){var S=k,d=S.lib,u=d.WordArray,f=d.Hasher,o=S.algo,c=u.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),e=u.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),g=u.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),h=u.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),v=u.create([0,1518500249,1859775393,2400959708,2840853838]),_=u.create([1352829926,1548603684,1836072691,2053994217,0]),b=o.RIPEMD160=f.extend({_doReset:function(){this._hash=u.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(n,r){for(var a=0;a<16;a++){var y=r+a,P=n[y];n[y]=16711935&(P<<8|P>>>24)|4278255360&(P<<24|P>>>8)}var O,M,j,B,Q,re,oe,le,ve,ke,ce,te=this._hash.words,ue=v.words,pe=_.words,he=c.words,Ze=e.words,Ot=g.words,Ht=h.words;for(re=O=te[0],oe=M=te[1],le=j=te[2],ve=B=te[3],ke=Q=te[4],a=0;a<80;a+=1)ce=O+n[r+he[a]]|0,ce+=a<16?p(M,j,B)+ue[0]:a<32?m(M,j,B)+ue[1]:a<48?E(M,j,B)+ue[2]:a<64?s(M,j,B)+ue[3]:i(M,j,B)+ue[4],ce=(ce=t(ce|=0,Ot[a]))+Q|0,O=Q,Q=B,B=t(j,10),j=M,M=ce,ce=re+n[r+Ze[a]]|0,ce+=a<16?i(oe,le,ve)+pe[0]:a<32?s(oe,le,ve)+pe[1]:a<48?E(oe,le,ve)+pe[2]:a<64?m(oe,le,ve)+pe[3]:p(oe,le,ve)+pe[4],ce=(ce=t(ce|=0,Ht[a]))+ke|0,re=ke,ke=ve,ve=t(le,10),le=oe,oe=ce;ce=te[1]+j+ve|0,te[1]=te[2]+B+ke|0,te[2]=te[3]+Q+re|0,te[3]=te[4]+O+oe|0,te[4]=te[0]+M+le|0,te[0]=ce},_doFinalize:function(){var n=this._data,r=n.words,a=8*this._nDataBytes,y=8*n.sigBytes;r[y>>>5]|=128<<24-y%32,r[14+(y+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n.sigBytes=4*(r.length+1),this._process();for(var P=this._hash,O=P.words,M=0;M<5;M++){var j=O[M];O[M]=16711935&(j<<8|j>>>24)|4278255360&(j<<24|j>>>8)}return P},clone:function(){var n=f.clone.call(this);return n._hash=this._hash.clone(),n}});function p(n,r,a){return n^r^a}function m(n,r,a){return n&r|~n&a}function E(n,r,a){return(n|~r)^a}function s(n,r,a){return n&a|r&~a}function i(n,r,a){return n^(r|~a)}function t(n,r){return n<<r|n>>>32-r}S.RIPEMD160=f._createHelper(b),S.HmacRIPEMD160=f._createHmacHelper(b)}(),k.RIPEMD160)},5471:function(G,C,l){var k,S,d,u,f,o,c,e;G.exports=(e=l(9021),S=(k=e).lib,d=S.WordArray,u=S.Hasher,f=k.algo,o=[],c=f.SHA1=u.extend({_doReset:function(){this._hash=new d.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(g,h){for(var v=this._hash.words,_=v[0],b=v[1],p=v[2],m=v[3],E=v[4],s=0;s<80;s++){if(s<16)o[s]=0|g[h+s];else{var i=o[s-3]^o[s-8]^o[s-14]^o[s-16];o[s]=i<<1|i>>>31}var t=(_<<5|_>>>27)+E+o[s];t+=s<20?1518500249+(b&p|~b&m):s<40?1859775393+(b^p^m):s<60?(b&p|b&m|p&m)-1894007588:(b^p^m)-899497514,E=m,m=p,p=b<<30|b>>>2,b=_,_=t}v[0]=v[0]+_|0,v[1]=v[1]+b|0,v[2]=v[2]+p|0,v[3]=v[3]+m|0,v[4]=v[4]+E|0},_doFinalize:function(){var g=this._data,h=g.words,v=8*this._nDataBytes,_=8*g.sigBytes;return h[_>>>5]|=128<<24-_%32,h[14+(_+64>>>9<<4)]=Math.floor(v/4294967296),h[15+(_+64>>>9<<4)]=v,g.sigBytes=4*h.length,this._process(),this._hash},clone:function(){var g=u.clone.call(this);return g._hash=this._hash.clone(),g}}),k.SHA1=u._createHelper(c),k.HmacSHA1=u._createHmacHelper(c),e.SHA1)},6308:function(G,C,l){var k,S,d,u,f,o;G.exports=(o=l(9021),l(3009),S=(k=o).lib.WordArray,d=k.algo,u=d.SHA256,f=d.SHA224=u.extend({_doReset:function(){this._hash=new S.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var c=u._doFinalize.call(this);return c.sigBytes-=4,c}}),k.SHA224=u._createHelper(f),k.HmacSHA224=u._createHmacHelper(f),o.SHA224)},3009:function(G,C,l){var k;G.exports=(k=l(9021),function(S){var d=k,u=d.lib,f=u.WordArray,o=u.Hasher,c=d.algo,e=[],g=[];(function(){function _(E){for(var s=S.sqrt(E),i=2;i<=s;i++)if(!(E%i))return!1;return!0}function b(E){return 4294967296*(E-(0|E))|0}for(var p=2,m=0;m<64;)_(p)&&(m<8&&(e[m]=b(S.pow(p,.5))),g[m]=b(S.pow(p,.3333333333333333)),m++),p++})();var h=[],v=c.SHA256=o.extend({_doReset:function(){this._hash=new f.init(e.slice(0))},_doProcessBlock:function(_,b){for(var p=this._hash.words,m=p[0],E=p[1],s=p[2],i=p[3],t=p[4],n=p[5],r=p[6],a=p[7],y=0;y<64;y++){if(y<16)h[y]=0|_[b+y];else{var P=h[y-15],O=(P<<25|P>>>7)^(P<<14|P>>>18)^P>>>3,M=h[y-2],j=(M<<15|M>>>17)^(M<<13|M>>>19)^M>>>10;h[y]=O+h[y-7]+j+h[y-16]}var B=m&E^m&s^E&s,Q=(m<<30|m>>>2)^(m<<19|m>>>13)^(m<<10|m>>>22),re=a+((t<<26|t>>>6)^(t<<21|t>>>11)^(t<<7|t>>>25))+(t&n^~t&r)+g[y]+h[y];a=r,r=n,n=t,t=i+re|0,i=s,s=E,E=m,m=re+(Q+B)|0}p[0]=p[0]+m|0,p[1]=p[1]+E|0,p[2]=p[2]+s|0,p[3]=p[3]+i|0,p[4]=p[4]+t|0,p[5]=p[5]+n|0,p[6]=p[6]+r|0,p[7]=p[7]+a|0},_doFinalize:function(){var _=this._data,b=_.words,p=8*this._nDataBytes,m=8*_.sigBytes;return b[m>>>5]|=128<<24-m%32,b[14+(m+64>>>9<<4)]=S.floor(p/4294967296),b[15+(m+64>>>9<<4)]=p,_.sigBytes=4*b.length,this._process(),this._hash},clone:function(){var _=o.clone.call(this);return _._hash=this._hash.clone(),_}});d.SHA256=o._createHelper(v),d.HmacSHA256=o._createHmacHelper(v)}(Math),k.SHA256)},5953:function(G,C,l){var k;G.exports=(k=l(9021),l(3240),function(S){var d=k,u=d.lib,f=u.WordArray,o=u.Hasher,c=d.x64.Word,e=d.algo,g=[],h=[],v=[];(function(){for(var p=1,m=0,E=0;E<24;E++){g[p+5*m]=(E+1)*(E+2)/2%64;var s=(2*p+3*m)%5;p=m%5,m=s}for(p=0;p<5;p++)for(m=0;m<5;m++)h[p+5*m]=m+(2*p+3*m)%5*5;for(var i=1,t=0;t<24;t++){for(var n=0,r=0,a=0;a<7;a++){if(1&i){var y=(1<<a)-1;y<32?r^=1<<y:n^=1<<y-32}128&i?i=i<<1^113:i<<=1}v[t]=c.create(n,r)}})();var _=[];(function(){for(var p=0;p<25;p++)_[p]=c.create()})();var b=e.SHA3=o.extend({cfg:o.cfg.extend({outputLength:512}),_doReset:function(){for(var p=this._state=[],m=0;m<25;m++)p[m]=new c.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(p,m){for(var E=this._state,s=this.blockSize/2,i=0;i<s;i++){var t=p[m+2*i],n=p[m+2*i+1];t=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8),n=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),(pe=E[i]).high^=n,pe.low^=t}for(var r=0;r<24;r++){for(var a=0;a<5;a++){for(var y=0,P=0,O=0;O<5;O++)y^=(pe=E[a+5*O]).high,P^=pe.low;var M=_[a];M.high=y,M.low=P}for(a=0;a<5;a++){var j=_[(a+4)%5],B=_[(a+1)%5],Q=B.high,re=B.low;for(y=j.high^(Q<<1|re>>>31),P=j.low^(re<<1|Q>>>31),O=0;O<5;O++)(pe=E[a+5*O]).high^=y,pe.low^=P}for(var oe=1;oe<25;oe++){var le=(pe=E[oe]).high,ve=pe.low,ke=g[oe];ke<32?(y=le<<ke|ve>>>32-ke,P=ve<<ke|le>>>32-ke):(y=ve<<ke-32|le>>>64-ke,P=le<<ke-32|ve>>>64-ke);var ce=_[h[oe]];ce.high=y,ce.low=P}var te=_[0],ue=E[0];for(te.high=ue.high,te.low=ue.low,a=0;a<5;a++)for(O=0;O<5;O++){var pe=E[oe=a+5*O],he=_[oe],Ze=_[(a+1)%5+5*O],Ot=_[(a+2)%5+5*O];pe.high=he.high^~Ze.high&Ot.high,pe.low=he.low^~Ze.low&Ot.low}pe=E[0];var Ht=v[r];pe.high^=Ht.high,pe.low^=Ht.low}},_doFinalize:function(){var p=this._data,m=p.words,E=(this._nDataBytes,8*p.sigBytes),s=32*this.blockSize;m[E>>>5]|=1<<24-E%32,m[(S.ceil((E+1)/s)*s>>>5)-1]|=128,p.sigBytes=4*m.length,this._process();for(var i=this._state,t=this.cfg.outputLength/8,n=t/8,r=[],a=0;a<n;a++){var y=i[a],P=y.high,O=y.low;P=16711935&(P<<8|P>>>24)|4278255360&(P<<24|P>>>8),O=16711935&(O<<8|O>>>24)|4278255360&(O<<24|O>>>8),r.push(O),r.push(P)}return new f.init(r,t)},clone:function(){for(var p=o.clone.call(this),m=p._state=this._state.slice(0),E=0;E<25;E++)m[E]=m[E].clone();return p}});d.SHA3=o._createHelper(b),d.HmacSHA3=o._createHmacHelper(b)}(Math),k.SHA3)},9557:function(G,C,l){var k,S,d,u,f,o,c,e;G.exports=(e=l(9021),l(3240),l(1380),S=(k=e).x64,d=S.Word,u=S.WordArray,f=k.algo,o=f.SHA512,c=f.SHA384=o.extend({_doReset:function(){this._hash=new u.init([new d.init(3418070365,3238371032),new d.init(1654270250,914150663),new d.init(2438529370,812702999),new d.init(355462360,4144912697),new d.init(1731405415,4290775857),new d.init(2394180231,1750603025),new d.init(3675008525,1694076839),new d.init(1203062813,3204075428)])},_doFinalize:function(){var g=o._doFinalize.call(this);return g.sigBytes-=16,g}}),k.SHA384=o._createHelper(c),k.HmacSHA384=o._createHmacHelper(c),e.SHA384)},1380:function(G,C,l){var k;G.exports=(k=l(9021),l(3240),function(){var S=k,d=S.lib.Hasher,u=S.x64,f=u.Word,o=u.WordArray,c=S.algo;function e(){return f.create.apply(f,arguments)}var g=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],h=[];(function(){for(var _=0;_<80;_++)h[_]=e()})();var v=c.SHA512=d.extend({_doReset:function(){this._hash=new o.init([new f.init(1779033703,4089235720),new f.init(3144134277,2227873595),new f.init(1013904242,4271175723),new f.init(2773480762,1595750129),new f.init(1359893119,2917565137),new f.init(2600822924,725511199),new f.init(528734635,4215389547),new f.init(1541459225,327033209)])},_doProcessBlock:function(_,b){for(var p=this._hash.words,m=p[0],E=p[1],s=p[2],i=p[3],t=p[4],n=p[5],r=p[6],a=p[7],y=m.high,P=m.low,O=E.high,M=E.low,j=s.high,B=s.low,Q=i.high,re=i.low,oe=t.high,le=t.low,ve=n.high,ke=n.low,ce=r.high,te=r.low,ue=a.high,pe=a.low,he=y,Ze=P,Ot=O,Ht=M,st=j,_r=B,jt=Q,_t=re,vr=oe,ft=le,xt=ve,$r=ke,cr=ce,yr=te,Jr=ue,Gt=pe,Ke=0;Ke<80;Ke++){var Ct,dr,xe=h[Ke];if(Ke<16)dr=xe.high=0|_[b+2*Ke],Ct=xe.low=0|_[b+2*Ke+1];else{var Ye=h[Ke-15],zt=Ye.high,pt=Ye.low,rr=(zt>>>1|pt<<31)^(zt>>>8|pt<<24)^zt>>>7,jr=(pt>>>1|zt<<31)^(pt>>>8|zt<<24)^(pt>>>7|zt<<25),Hr=h[Ke-2],vt=Hr.high,zn=Hr.low,oa=(vt>>>19|zn<<13)^(vt<<3|zn>>>29)^vt>>>6,ca=(zn>>>19|vt<<13)^(zn<<3|vt>>>29)^(zn>>>6|vt<<26),pn=h[Ke-7],ba=pn.high,wt=pn.low,je=h[Ke-16],Qe=je.high,Ve=je.low;dr=(dr=(dr=rr+ba+((Ct=jr+wt)>>>0<jr>>>0?1:0))+oa+((Ct+=ca)>>>0<ca>>>0?1:0))+Qe+((Ct+=Ve)>>>0<Ve>>>0?1:0),xe.high=dr,xe.low=Ct}var Ce,ur=vr&xt^~vr&cr,we=ft&$r^~ft&yr,er=he&Ot^he&st^Ot&st,fr=Ze&Ht^Ze&_r^Ht&_r,br=(he>>>28|Ze<<4)^(he<<30|Ze>>>2)^(he<<25|Ze>>>7),gr=(Ze>>>28|he<<4)^(Ze<<30|he>>>2)^(Ze<<25|he>>>7),tn=(vr>>>14|ft<<18)^(vr>>>18|ft<<14)^(vr<<23|ft>>>9),Ie=(ft>>>14|vr<<18)^(ft>>>18|vr<<14)^(ft<<23|vr>>>9),yt=g[Ke],gt=yt.high,ht=yt.low,Pr=Jr+tn+((Ce=Gt+Ie)>>>0<Gt>>>0?1:0),Cr=gr+fr;Jr=cr,Gt=yr,cr=xt,yr=$r,xt=vr,$r=ft,vr=jt+(Pr=(Pr=(Pr=Pr+ur+((Ce+=we)>>>0<we>>>0?1:0))+gt+((Ce+=ht)>>>0<ht>>>0?1:0))+dr+((Ce+=Ct)>>>0<Ct>>>0?1:0))+((ft=_t+Ce|0)>>>0<_t>>>0?1:0)|0,jt=st,_t=_r,st=Ot,_r=Ht,Ot=he,Ht=Ze,he=Pr+(br+er+(Cr>>>0<gr>>>0?1:0))+((Ze=Ce+Cr|0)>>>0<Ce>>>0?1:0)|0}P=m.low=P+Ze,m.high=y+he+(P>>>0<Ze>>>0?1:0),M=E.low=M+Ht,E.high=O+Ot+(M>>>0<Ht>>>0?1:0),B=s.low=B+_r,s.high=j+st+(B>>>0<_r>>>0?1:0),re=i.low=re+_t,i.high=Q+jt+(re>>>0<_t>>>0?1:0),le=t.low=le+ft,t.high=oe+vr+(le>>>0<ft>>>0?1:0),ke=n.low=ke+$r,n.high=ve+xt+(ke>>>0<$r>>>0?1:0),te=r.low=te+yr,r.high=ce+cr+(te>>>0<yr>>>0?1:0),pe=a.low=pe+Gt,a.high=ue+Jr+(pe>>>0<Gt>>>0?1:0)},_doFinalize:function(){var _=this._data,b=_.words,p=8*this._nDataBytes,m=8*_.sigBytes;return b[m>>>5]|=128<<24-m%32,b[30+(m+128>>>10<<5)]=Math.floor(p/4294967296),b[31+(m+128>>>10<<5)]=p,_.sigBytes=4*b.length,this._process(),this._hash.toX32()},clone:function(){var _=d.clone.call(this);return _._hash=this._hash.clone(),_},blockSize:32});S.SHA512=d._createHelper(v),S.HmacSHA512=d._createHmacHelper(v)}(),k.SHA512)},7628:function(G,C,l){var k;G.exports=(k=l(9021),l(754),l(4636),l(9506),l(7165),function(){var S=k,d=S.lib,u=d.WordArray,f=d.BlockCipher,o=S.algo,c=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],e=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],g=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],v=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],_=o.DES=f.extend({_doReset:function(){for(var E=this._key.words,s=[],i=0;i<56;i++){var t=c[i]-1;s[i]=E[t>>>5]>>>31-t%32&1}for(var n=this._subKeys=[],r=0;r<16;r++){var a=n[r]=[],y=g[r];for(i=0;i<24;i++)a[i/6|0]|=s[(e[i]-1+y)%28]<<31-i%6,a[4+(i/6|0)]|=s[28+(e[i+24]-1+y)%28]<<31-i%6;for(a[0]=a[0]<<1|a[0]>>>31,i=1;i<7;i++)a[i]=a[i]>>>4*(i-1)+3;a[7]=a[7]<<5|a[7]>>>27}var P=this._invSubKeys=[];for(i=0;i<16;i++)P[i]=n[15-i]},encryptBlock:function(E,s){this._doCryptBlock(E,s,this._subKeys)},decryptBlock:function(E,s){this._doCryptBlock(E,s,this._invSubKeys)},_doCryptBlock:function(E,s,i){this._lBlock=E[s],this._rBlock=E[s+1],b.call(this,4,252645135),b.call(this,16,65535),p.call(this,2,858993459),p.call(this,8,16711935),b.call(this,1,1431655765);for(var t=0;t<16;t++){for(var n=i[t],r=this._lBlock,a=this._rBlock,y=0,P=0;P<8;P++)y|=h[P][((a^n[P])&v[P])>>>0];this._lBlock=a,this._rBlock=r^y}var O=this._lBlock;this._lBlock=this._rBlock,this._rBlock=O,b.call(this,1,1431655765),p.call(this,8,16711935),p.call(this,2,858993459),b.call(this,16,65535),b.call(this,4,252645135),E[s]=this._lBlock,E[s+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function b(E,s){var i=(this._lBlock>>>E^this._rBlock)&s;this._rBlock^=i,this._lBlock^=i<<E}function p(E,s){var i=(this._rBlock>>>E^this._lBlock)&s;this._lBlock^=i,this._rBlock^=i<<E}S.DES=f._createHelper(_);var m=o.TripleDES=f.extend({_doReset:function(){var E=this._key.words;if(E.length!==2&&E.length!==4&&E.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var s=E.slice(0,2),i=E.length<4?E.slice(0,2):E.slice(2,4),t=E.length<6?E.slice(0,2):E.slice(4,6);this._des1=_.createEncryptor(u.create(s)),this._des2=_.createEncryptor(u.create(i)),this._des3=_.createEncryptor(u.create(t))},encryptBlock:function(E,s){this._des1.encryptBlock(E,s),this._des2.decryptBlock(E,s),this._des3.encryptBlock(E,s)},decryptBlock:function(E,s){this._des3.decryptBlock(E,s),this._des2.encryptBlock(E,s),this._des1.decryptBlock(E,s)},keySize:6,ivSize:2,blockSize:2});S.TripleDES=f._createHelper(m)}(),k.TripleDES)},3240:function(G,C,l){var k;G.exports=(k=l(9021),function(S){var d=k,u=d.lib,f=u.Base,o=u.WordArray,c=d.x64={};c.Word=f.extend({init:function(e,g){this.high=e,this.low=g}}),c.WordArray=f.extend({init:function(e,g){e=this.words=e||[],this.sigBytes=g!=S?g:8*e.length},toX32:function(){for(var e=this.words,g=e.length,h=[],v=0;v<g;v++){var _=e[v];h.push(_.high),h.push(_.low)}return o.create(h,this.sigBytes)},clone:function(){for(var e=f.clone.call(this),g=e.words=this.words.slice(0),h=g.length,v=0;v<h;v++)g[v]=g[v].clone();return e}})}(),k)},7833:(G,C,l)=>{C.formatArgs=function(S){if(S[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+S[0]+(this.useColors?"%c ":" ")+"+"+G.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;S.splice(1,0,d,"color: inherit");let u=0,f=0;S[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(u++,o==="%c"&&(f=u))}),S.splice(f,0,d)},C.save=function(S){try{S?C.storage.setItem("debug",S):C.storage.removeItem("debug")}catch{}},C.load=function(){let S;try{S=C.storage.getItem("debug")}catch{}return!S&&typeof process<"u"&&"env"in process&&(S=J.DEBUG),S},C.useColors=function(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let S;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(S=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(S[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},C.storage=function(){try{return localStorage}catch{}}(),C.destroy=(()=>{let S=!1;return()=>{S||(S=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),C.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],C.log=console.debug||console.log||(()=>{}),G.exports=l(736)(C);const{formatters:k}=G.exports;k.j=function(S){try{return JSON.stringify(S)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}},736:(G,C,l)=>{G.exports=function(k){function S(f){let o,c,e,g=null;function h(...v){if(!h.enabled)return;const _=h,b=Number(new Date),p=b-(o||b);_.diff=p,_.prev=o,_.curr=b,o=b,v[0]=S.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let m=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(E,s)=>{if(E==="%%")return"%";m++;const i=S.formatters[s];if(typeof i=="function"){const t=v[m];E=i.call(_,t),v.splice(m,1),m--}return E}),S.formatArgs.call(_,v),(_.log||S.log).apply(_,v)}return h.namespace=f,h.useColors=S.useColors(),h.color=S.selectColor(f),h.extend=d,h.destroy=S.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(c!==S.namespaces&&(c=S.namespaces,e=S.enabled(f)),e),set:v=>{g=v}}),typeof S.init=="function"&&S.init(h),h}function d(f,o){const c=S(this.namespace+(o===void 0?":":o)+f);return c.log=this.log,c}function u(f,o){let c=0,e=0,g=-1,h=0;for(;c<f.length;)if(e<o.length&&(o[e]===f[c]||o[e]==="*"))o[e]==="*"?(g=e,h=c,e++):(c++,e++);else{if(g===-1)return!1;e=g+1,h++,c=h}for(;e<o.length&&o[e]==="*";)e++;return e===o.length}return S.debug=S,S.default=S,S.coerce=function(f){return f instanceof Error?f.stack||f.message:f},S.disable=function(){const f=[...S.names,...S.skips.map(o=>"-"+o)].join(",");return S.enable(""),f},S.enable=function(f){S.save(f),S.namespaces=f,S.names=[],S.skips=[];const o=(typeof f=="string"?f:"").trim().replace(" ",",").split(",").filter(Boolean);for(const c of o)c[0]==="-"?S.skips.push(c.slice(1)):S.names.push(c)},S.enabled=function(f){for(const o of S.skips)if(u(f,o))return!1;for(const o of S.names)if(u(f,o))return!0;return!1},S.humanize=l(6585),S.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(k).forEach(f=>{S[f]=k[f]}),S.names=[],S.skips=[],S.formatters={},S.selectColor=function(f){let o=0;for(let c=0;c<f.length;c++)o=(o<<5)-o+f.charCodeAt(c),o|=0;return S.colors[Math.abs(o)%S.colors.length]},S.enable(S.load()),S}},4903:G=>{var C=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};G.exports=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return C()}try{return __global__||C()}finally{delete Object.prototype.__global__}}()},7007:G=>{var C,l=typeof Reflect=="object"?Reflect:null,k=l&&typeof l.apply=="function"?l.apply:function(p,m,E){return Function.prototype.apply.call(p,m,E)};C=l&&typeof l.ownKeys=="function"?l.ownKeys:Object.getOwnPropertySymbols?function(p){return Object.getOwnPropertyNames(p).concat(Object.getOwnPropertySymbols(p))}:function(p){return Object.getOwnPropertyNames(p)};var S=Number.isNaN||function(p){return p!=p};function d(){d.init.call(this)}G.exports=d,G.exports.once=function(p,m){return new Promise(function(E,s){function i(n){p.removeListener(m,t),s(n)}function t(){typeof p.removeListener=="function"&&p.removeListener("error",i),E([].slice.call(arguments))}b(p,m,t,{once:!0}),m!=="error"&&function(n,r,a){typeof n.on=="function"&&b(n,"error",r,a)}(p,i,{once:!0})})},d.EventEmitter=d,d.prototype._events=void 0,d.prototype._eventsCount=0,d.prototype._maxListeners=void 0;var u=10;function f(p){if(typeof p!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof p)}function o(p){return p._maxListeners===void 0?d.defaultMaxListeners:p._maxListeners}function c(p,m,E,s){var i,t,n,r;if(f(E),(t=p._events)===void 0?(t=p._events=Object.create(null),p._eventsCount=0):(t.newListener!==void 0&&(p.emit("newListener",m,E.listener?E.listener:E),t=p._events),n=t[m]),n===void 0)n=t[m]=E,++p._eventsCount;else if(typeof n=="function"?n=t[m]=s?[E,n]:[n,E]:s?n.unshift(E):n.push(E),(i=o(p))>0&&n.length>i&&!n.warned){n.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+n.length+" "+String(m)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=p,a.type=m,a.count=n.length,r=a,console&&console.warn&&console.warn(r)}return p}function e(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function g(p,m,E){var s={fired:!1,wrapFn:void 0,target:p,type:m,listener:E},i=e.bind(s);return i.listener=E,s.wrapFn=i,i}function h(p,m,E){var s=p._events;if(s===void 0)return[];var i=s[m];return i===void 0?[]:typeof i=="function"?E?[i.listener||i]:[i]:E?function(t){for(var n=new Array(t.length),r=0;r<n.length;++r)n[r]=t[r].listener||t[r];return n}(i):_(i,i.length)}function v(p){var m=this._events;if(m!==void 0){var E=m[p];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}function _(p,m){for(var E=new Array(m),s=0;s<m;++s)E[s]=p[s];return E}function b(p,m,E,s){if(typeof p.on=="function")s.once?p.once(m,E):p.on(m,E);else{if(typeof p.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof p);p.addEventListener(m,function i(t){s.once&&p.removeEventListener(m,i),E(t)})}}Object.defineProperty(d,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(p){if(typeof p!="number"||p<0||S(p))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+p+".");u=p}}),d.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(p){if(typeof p!="number"||p<0||S(p))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+p+".");return this._maxListeners=p,this},d.prototype.getMaxListeners=function(){return o(this)},d.prototype.emit=function(p){for(var m=[],E=1;E<arguments.length;E++)m.push(arguments[E]);var s=p==="error",i=this._events;if(i!==void 0)s=s&&i.error===void 0;else if(!s)return!1;if(s){var t;if(m.length>0&&(t=m[0]),t instanceof Error)throw t;var n=new Error("Unhandled error."+(t?" ("+t.message+")":""));throw n.context=t,n}var r=i[p];if(r===void 0)return!1;if(typeof r=="function")k(r,this,m);else{var a=r.length,y=_(r,a);for(E=0;E<a;++E)k(y[E],this,m)}return!0},d.prototype.addListener=function(p,m){return c(this,p,m,!1)},d.prototype.on=d.prototype.addListener,d.prototype.prependListener=function(p,m){return c(this,p,m,!0)},d.prototype.once=function(p,m){return f(m),this.on(p,g(this,p,m)),this},d.prototype.prependOnceListener=function(p,m){return f(m),this.prependListener(p,g(this,p,m)),this},d.prototype.removeListener=function(p,m){var E,s,i,t,n;if(f(m),(s=this._events)===void 0)return this;if((E=s[p])===void 0)return this;if(E===m||E.listener===m)--this._eventsCount==0?this._events=Object.create(null):(delete s[p],s.removeListener&&this.emit("removeListener",p,E.listener||m));else if(typeof E!="function"){for(i=-1,t=E.length-1;t>=0;t--)if(E[t]===m||E[t].listener===m){n=E[t].listener,i=t;break}if(i<0)return this;i===0?E.shift():function(r,a){for(;a+1<r.length;a++)r[a]=r[a+1];r.pop()}(E,i),E.length===1&&(s[p]=E[0]),s.removeListener!==void 0&&this.emit("removeListener",p,n||m)}return this},d.prototype.off=d.prototype.removeListener,d.prototype.removeAllListeners=function(p){var m,E,s;if((E=this._events)===void 0)return this;if(E.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):E[p]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete E[p]),this;if(arguments.length===0){var i,t=Object.keys(E);for(s=0;s<t.length;++s)(i=t[s])!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(m=E[p])=="function")this.removeListener(p,m);else if(m!==void 0)for(s=m.length-1;s>=0;s--)this.removeListener(p,m[s]);return this},d.prototype.listeners=function(p){return h(this,p,!0)},d.prototype.rawListeners=function(p){return h(this,p,!1)},d.listenerCount=function(p,m){return typeof p.listenerCount=="function"?p.listenerCount(m):v.call(p,m)},d.prototype.listenerCount=v,d.prototype.eventNames=function(){return this._eventsCount>0?C(this._events):[]}},3582:function(G,C,l){var k=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(C,"__esModule",{value:!0}),C.Logger=void 0;const S=k(l(7833)),d="h264-profile-level-id";C.Logger=class{constructor(u){u?(this._debug=(0,S.default)(`${d}:${u}`),this._warn=(0,S.default)(`${d}:WARN:${u}`),this._error=(0,S.default)(`${d}:ERROR:${u}`)):(this._debug=(0,S.default)(d),this._warn=(0,S.default)(`${d}:WARN`),this._error=(0,S.default)(`${d}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},3200:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.generateProfileLevelIdStringForAnswer=C.isSameProfile=C.parseSdpProfileLevelId=C.levelToString=C.profileToString=C.profileLevelIdToString=C.parseProfileLevelId=C.ProfileLevelId=C.Level=C.Profile=void 0;const k=new(l(3582)).Logger;var S,d;(function(p){p[p.ConstrainedBaseline=1]="ConstrainedBaseline",p[p.Baseline=2]="Baseline",p[p.Main=3]="Main",p[p.ConstrainedHigh=4]="ConstrainedHigh",p[p.High=5]="High",p[p.PredictiveHigh444=6]="PredictiveHigh444"})(S||(C.Profile=S={})),function(p){p[p.L1_b=0]="L1_b",p[p.L1=10]="L1",p[p.L1_1=11]="L1_1",p[p.L1_2=12]="L1_2",p[p.L1_3=13]="L1_3",p[p.L2=20]="L2",p[p.L2_1=21]="L2_1",p[p.L2_2=22]="L2_2",p[p.L3=30]="L3",p[p.L3_1=31]="L3_1",p[p.L3_2=32]="L3_2",p[p.L4=40]="L4",p[p.L4_1=41]="L4_1",p[p.L4_2=42]="L4_2",p[p.L5=50]="L5",p[p.L5_1=51]="L5_1",p[p.L5_2=52]="L5_2"}(d||(C.Level=d={}));class u{constructor(m,E){this.profile=m,this.level=E}}C.ProfileLevelId=u;const f=new u(S.ConstrainedBaseline,d.L3_1);class o{constructor(m){this.mask=~_("x",m),this.masked_value=_("1",m)}isMatch(m){return this.masked_value===(m&this.mask)}}class c{constructor(m,E,s){this.profile_idc=m,this.profile_iop=E,this.profile=s}}const e=[new c(66,new o("x1xx0000"),S.ConstrainedBaseline),new c(77,new o("1xxx0000"),S.ConstrainedBaseline),new c(88,new o("11xx0000"),S.ConstrainedBaseline),new c(66,new o("x0xx0000"),S.Baseline),new c(88,new o("10xx0000"),S.Baseline),new c(77,new o("0x0x0000"),S.Main),new c(100,new o("00000000"),S.High),new c(100,new o("00001100"),S.ConstrainedHigh),new c(244,new o("00000000"),S.PredictiveHigh444)];function g(p){if(typeof p!="string"||p.length!==6)return;const m=parseInt(p,16);if(m===0)return;const E=255&m,s=m>>8&255,i=m>>16&255;let t;switch(E){case d.L1_1:t=16&s?d.L1_b:d.L1_1;break;case d.L1:case d.L1_2:case d.L1_3:case d.L2:case d.L2_1:case d.L2_2:case d.L3:case d.L3_1:case d.L3_2:case d.L4:case d.L4_1:case d.L4_2:case d.L5:case d.L5_1:case d.L5_2:t=E;break;default:return void k.warn(`parseProfileLevelId() | unrecognized level_idc [str:${p}, level_idc:${E}]`)}for(const n of e)if(i===n.profile_idc&&n.profile_iop.isMatch(s))return new u(n.profile,t);k.warn(`parseProfileLevelId() | unrecognized profile_idc/profile_iop combination [str:${p}, profile_idc:${i}, profile_iop:${s}]`)}function h(p){if(p.level==d.L1_b)switch(p.profile){case S.ConstrainedBaseline:return"42f00b";case S.Baseline:return"42100b";case S.Main:return"4d100b";default:return void k.warn(`profileLevelIdToString() | Level 1_b not is allowed for profile ${p.profile}`)}let m;switch(p.profile){case S.ConstrainedBaseline:m="42e0";break;case S.Baseline:m="4200";break;case S.Main:m="4d00";break;case S.ConstrainedHigh:m="640c";break;case S.High:m="6400";break;case S.PredictiveHigh444:m="f400";break;default:return void k.warn(`profileLevelIdToString() | unrecognized profile ${p.profile}`)}let E=p.level.toString(16);return E.length===1&&(E=`0${E}`),`${m}${E}`}function v(p={}){const m=p["profile-level-id"];return m?g(m):f}function _(p,m){return+(m[0]===p)<<7|+(m[1]===p)<<6|+(m[2]===p)<<5|+(m[3]===p)<<4|+(m[4]===p)<<3|+(m[5]===p)<<2|+(m[6]===p)<<1|+(m[7]===p)}function b(p={}){const m=p["level-asymmetry-allowed"];return m===!0||m===1||m==="1"}C.parseProfileLevelId=g,C.profileLevelIdToString=h,C.profileToString=function(p){switch(p){case S.ConstrainedBaseline:return"ConstrainedBaseline";case S.Baseline:return"Baseline";case S.Main:return"Main";case S.ConstrainedHigh:return"ConstrainedHigh";case S.High:return"High";case S.PredictiveHigh444:return"PredictiveHigh444";default:return void k.warn(`profileToString() | unrecognized profile ${p}`)}},C.levelToString=function(p){switch(p){case d.L1_b:return"1b";case d.L1:return"1";case d.L1_1:return"1.1";case d.L1_2:return"1.2";case d.L1_3:return"1.3";case d.L2:return"2";case d.L2_1:return"2.1";case d.L2_2:return"2.2";case d.L3:return"3";case d.L3_1:return"3.1";case d.L3_2:return"3.2";case d.L4:return"4";case d.L4_1:return"4.1";case d.L4_2:return"4.2";case d.L5:return"5";case d.L5_1:return"5.1";case d.L5_2:return"5.2";default:return void k.warn(`levelToString() | unrecognized level ${p}`)}},C.parseSdpProfileLevelId=v,C.isSameProfile=function(p={},m={}){const E=v(p),s=v(m);return!!(E&&s&&E.profile===s.profile)},C.generateProfileLevelIdStringForAnswer=function(p={},m={}){if(!p["profile-level-id"]&&!m["profile-level-id"])return void k.warn("generateProfileLevelIdStringForAnswer() | profile-level-id missing in local and remote params");const E=v(p),s=v(m);if(!E)throw new TypeError("invalid local_profile_level_id");if(!s)throw new TypeError("invalid remote_profile_level_id");if(E.profile!==s.profile)throw new TypeError("H264 Profile mismatch");const i=b(p)&&b(m),t=E.level,n=s.level,r=function(O,M){return O===d.L1_b?M!==d.L1&&M!==d.L1_b:M===d.L1_b?O!==d.L1:O<M}(a=t,y=n)?a:y;var a,y;const P=i?t:r;return k.debug(`generateProfileLevelIdStringForAnswer() | result [profile:${E.profile}, level:${P}]`),h(new u(E.profile,P))}},328:(G,C,l)=>{l(8624),G.exports=self.fetch.bind(self)},2215:(G,C,l)=>{var k,S;(function(d){(S=typeof(k=d)=="function"?k.call(C,l,C,G):k)===void 0||(G.exports=S),G.exports=d()})(function(){function d(){for(var f=0,o={};f<arguments.length;f++){var c=arguments[f];for(var e in c)o[e]=c[e]}return o}function u(f){return f.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function f(o){function c(){}function e(h,v,_){if(typeof document<"u"){typeof(_=d({path:"/"},c.defaults,_)).expires=="number"&&(_.expires=new Date(1*new Date+864e5*_.expires)),_.expires=_.expires?_.expires.toUTCString():"";try{var b=JSON.stringify(v);/^[\{\[]/.test(b)&&(v=b)}catch{}v=o.write?o.write(v,h):encodeURIComponent(String(v)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),h=encodeURIComponent(String(h)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var p="";for(var m in _)_[m]&&(p+="; "+m,_[m]!==!0&&(p+="="+_[m].split(";")[0]));return document.cookie=h+"="+v+p}}function g(h,v){if(typeof document<"u"){for(var _={},b=document.cookie?document.cookie.split("; "):[],p=0;p<b.length;p++){var m=b[p].split("="),E=m.slice(1).join("=");v||E.charAt(0)!=='"'||(E=E.slice(1,-1));try{var s=u(m[0]);if(E=(o.read||o)(E,s)||u(E),v)try{E=JSON.parse(E)}catch{}if(_[s]=E,h===s)break}catch{}}return h?_[h]:_}}return c.set=e,c.get=function(h){return g(h,!1)},c.getJSON=function(h){return g(h,!0)},c.remove=function(h,v){e(h,"",d(v,{expires:-1}))},c.defaults={},c.withConverter=f,c}(function(){})})},7654:(G,C,l)=>{var k="__lodash_hash_undefined__",S="[object Function]",d="[object GeneratorFunction]",u=/^\[object .+?Constructor\]$/,f=typeof l.g=="object"&&l.g&&l.g.Object===Object&&l.g,o=typeof self=="object"&&self&&self.Object===Object&&self,c=f||o||Function("return this")(),e,g=Array.prototype,h=Function.prototype,v=Object.prototype,_=c["__core-js_shared__"],b=(e=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"",p=h.toString,m=v.hasOwnProperty,E=v.toString,s=RegExp("^"+p.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),i=g.splice,t=j(c,"Map"),n=j(Object,"create");function r(re){var oe=-1,le=re?re.length:0;for(this.clear();++oe<le;){var ve=re[oe];this.set(ve[0],ve[1])}}function a(re){var oe=-1,le=re?re.length:0;for(this.clear();++oe<le;){var ve=re[oe];this.set(ve[0],ve[1])}}function y(re){var oe=-1,le=re?re.length:0;for(this.clear();++oe<le;){var ve=re[oe];this.set(ve[0],ve[1])}}function P(re,oe){for(var le,ve,ke=re.length;ke--;)if((le=re[ke][0])===(ve=oe)||le!=le&&ve!=ve)return ke;return-1}function O(re){if(!Q(re)||(oe=re,b&&b in oe))return!1;var oe,le=function(ve){var ke=Q(ve)?E.call(ve):"";return ke==S||ke==d}(re)||function(ve){var ke=!1;if(ve!=null&&typeof ve.toString!="function")try{ke=!!(ve+"")}catch{}return ke}(re)?s:u;return le.test(function(ve){if(ve!=null){try{return p.call(ve)}catch{}try{return ve+""}catch{}}return""}(re))}function M(re,oe){var le,ve,ke=re.__data__;return((ve=typeof(le=oe))=="string"||ve=="number"||ve=="symbol"||ve=="boolean"?le!=="__proto__":le===null)?ke[typeof oe=="string"?"string":"hash"]:ke.map}function j(re,oe){var le=function(ve,ke){return ve==null?void 0:ve[ke]}(re,oe);return O(le)?le:void 0}function B(re,oe){if(typeof re!="function"||oe&&typeof oe!="function")throw new TypeError("Expected a function");var le=function(){var ve=arguments,ke=oe?oe.apply(this,ve):ve[0],ce=le.cache;if(ce.has(ke))return ce.get(ke);var te=re.apply(this,ve);return le.cache=ce.set(ke,te),te};return le.cache=new(B.Cache||y),le}function Q(re){var oe=typeof re;return!!re&&(oe=="object"||oe=="function")}r.prototype.clear=function(){this.__data__=n?n(null):{}},r.prototype.delete=function(re){return this.has(re)&&delete this.__data__[re]},r.prototype.get=function(re){var oe=this.__data__;if(n){var le=oe[re];return le===k?void 0:le}return m.call(oe,re)?oe[re]:void 0},r.prototype.has=function(re){var oe=this.__data__;return n?oe[re]!==void 0:m.call(oe,re)},r.prototype.set=function(re,oe){return this.__data__[re]=n&&oe===void 0?k:oe,this},a.prototype.clear=function(){this.__data__=[]},a.prototype.delete=function(re){var oe=this.__data__,le=P(oe,re);return!(le<0)&&(le==oe.length-1?oe.pop():i.call(oe,le,1),!0)},a.prototype.get=function(re){var oe=this.__data__,le=P(oe,re);return le<0?void 0:oe[le][1]},a.prototype.has=function(re){return P(this.__data__,re)>-1},a.prototype.set=function(re,oe){var le=this.__data__,ve=P(le,re);return ve<0?le.push([re,oe]):le[ve][1]=oe,this},y.prototype.clear=function(){this.__data__={hash:new r,map:new(t||a),string:new r}},y.prototype.delete=function(re){return M(this,re).delete(re)},y.prototype.get=function(re){return M(this,re).get(re)},y.prototype.has=function(re){return M(this,re).has(re)},y.prototype.set=function(re,oe){return M(this,re).set(re,oe),this},B.Cache=y,G.exports=B},3518:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.Consumer=void 0;const k=l(2994),S=l(2010),d=l(4893),u=new k.Logger("Consumer");class f extends S.EnhancedEventEmitter{constructor({id:c,localId:e,producerId:g,rtpReceiver:h,track:v,rtpParameters:_,appData:b}){super(),this._closed=!1,this._observer=new S.EnhancedEventEmitter,u.debug("constructor()"),this._id=c,this._localId=e,this._producerId=g,this._rtpReceiver=h,this._track=v,this._rtpParameters=_,this._paused=!v.enabled,this._appData=b||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(c){this._appData=c}get observer(){return this._observer}close(){this._closed||(u.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new d.InvalidStateError("closed");return new Promise((c,e)=>{this.safeEmit("@getstats",c,e)})}pause(){u.debug("pause()"),this._closed?u.error("pause() | Consumer closed"):this._paused?u.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){u.debug("resume()"),this._closed?u.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):u.debug("resume() | Consumer is already resumed")}onTrackEnded(){u.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch{}}}C.Consumer=f},9166:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.DataConsumer=void 0;const k=l(2994),S=l(2010),d=new k.Logger("DataConsumer");class u extends S.EnhancedEventEmitter{constructor({id:o,dataProducerId:c,dataChannel:e,sctpStreamParameters:g,appData:h}){super(),this._closed=!1,this._observer=new S.EnhancedEventEmitter,d.debug("constructor()"),this._id=o,this._dataProducerId=c,this._dataChannel=e,this._sctpStreamParameters=g,this._appData=h||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(o){this._dataChannel.binaryType=o}get appData(){return this._appData}set appData(o){this._appData=o}get observer(){return this._observer}close(){this._closed||(d.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(d.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(d.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",o=>{if(this._closed)return;let{error:c}=o;c||(c=new Error("unknown DataChannel error")),c.errorDetail==="sctp-failure"?d.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",c.sctpCauseCode,c.message):d.error('DataChannel "error" event: %o',c),this.safeEmit("error",c)}),this._dataChannel.addEventListener("close",()=>{this._closed||(d.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",o=>{this._closed||this.safeEmit("message",o.data)})}}C.DataConsumer=u},7504:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.DataProducer=void 0;const k=l(2994),S=l(2010),d=l(4893),u=new k.Logger("DataProducer");class f extends S.EnhancedEventEmitter{constructor({id:c,dataChannel:e,sctpStreamParameters:g,appData:h}){super(),this._closed=!1,this._observer=new S.EnhancedEventEmitter,u.debug("constructor()"),this._id=c,this._dataChannel=e,this._sctpStreamParameters=g,this._appData=h||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(c){this._dataChannel.bufferedAmountLowThreshold=c}get appData(){return this._appData}set appData(c){this._appData=c}get observer(){return this._observer}close(){this._closed||(u.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(c){if(u.debug("send()"),this._closed)throw new d.InvalidStateError("closed");this._dataChannel.send(c)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(u.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",c=>{if(this._closed)return;let{error:e}=c;e||(e=new Error("unknown DataChannel error")),e.errorDetail==="sctp-failure"?u.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",e.sctpCauseCode,e.message):u.error('DataChannel "error" event: %o',e),this.safeEmit("error",e)}),this._dataChannel.addEventListener("close",()=>{this._closed||(u.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||u.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}C.DataProducer=f},6004:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(O,M,j,B){B===void 0&&(B=j);var Q=Object.getOwnPropertyDescriptor(M,j);Q&&!("get"in Q?!M.__esModule:Q.writable||Q.configurable)||(Q={enumerable:!0,get:function(){return M[j]}}),Object.defineProperty(O,B,Q)}:function(O,M,j,B){B===void 0&&(B=j),O[B]=M[j]}),S=this&&this.__setModuleDefault||(Object.create?function(O,M){Object.defineProperty(O,"default",{enumerable:!0,value:M})}:function(O,M){O.default=M}),d=this&&this.__importStar||function(O){if(O&&O.__esModule)return O;var M={};if(O!=null)for(var j in O)j!=="default"&&Object.prototype.hasOwnProperty.call(O,j)&&k(M,O,j);return S(M,O),M};Object.defineProperty(C,"__esModule",{value:!0}),C.Device=C.detectDevice=void 0;const u=l(7232),f=l(2994),o=l(2010),c=l(4893),e=d(l(1765)),g=d(l(8046)),h=l(5601),v=l(2183),_=l(11),b=l(5535),p=l(8155),m=l(7402),E=l(2292),s=l(1767),i=l(5765),t=l(9676),n=l(8633),r=l(4039),a=l(9352),y=new f.Logger("Device");function P(){var O,M,j,B;if(typeof navigator=="object"&&navigator.product==="ReactNative")return y.debug("detectDevice() | React-Native detected"),typeof RTCPeerConnection>"u"?void y.warn("detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?"):typeof RTCRtpTransceiver<"u"?(y.debug("detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(y.debug("detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");if(typeof navigator!="object"||typeof navigator.userAgent!="string")y.warn("detectDevice() | unknown device");else{const Q=navigator.userAgent,re=new u.UAParser(Q);y.debug("detectDevice() | browser detected [ua:%s, parsed:%o]",Q,re.getResult());const oe=re.getBrowser(),le=(O=oe.name)==null?void 0:O.toLowerCase(),ve=parseInt(oe.major??"0"),ke=re.getEngine(),ce=(M=ke.name)==null?void 0:M.toLowerCase(),te=re.getOS(),ue=(j=te.name)==null?void 0:j.toLowerCase(),pe=parseFloat(te.version??"0"),he=re.getDevice(),Ze=(B=he.model)==null?void 0:B.toLowerCase(),Ot=ue==="ios"||Ze==="ipad",Ht=le&&["chrome","chromium","mobile chrome","chrome webview","chrome headless"].includes(le),st=le&&["firefox","mobile firefox","mobile focus"].includes(le),_r=le&&["safari","mobile safari"].includes(le),jt=le&&["edge"].includes(le);if((Ht||jt)&&!Ot&&ve>=111)return"Chrome111";if(Ht&&!Ot&&ve>=74||jt&&!Ot&&ve>=88)return"Chrome74";if(Ht&&!Ot&&ve>=70)return"Chrome70";if(Ht&&!Ot&&ve>=67)return"Chrome67";if(Ht&&!Ot&&ve>=55)return"Chrome55";if(st&&!Ot&&ve>=120)return"Firefox120";if(st&&!Ot&&ve>=60)return"Firefox60";if(st&&Ot&&pe>=14.3||_r&&ve>=12&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(_r&&ve>=11)return"Safari11";if(jt&&!Ot&&ve>=11&&ve<=18)return"Edge11";if(ce==="webkit"&&Ot&&typeof RTCRtpTransceiver<"u"&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection"))return"Safari12";if(ce==="blink"){const _t=Q.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i);if(_t){const vr=Number(_t[1]);return vr>=111?"Chrome111":vr>=74?"Chrome74":vr>=70?"Chrome70":vr>=67?"Chrome67":"Chrome55"}return"Chrome111"}y.warn("detectDevice() | browser not supported [name:%s, version:%s]",le,ve)}}C.detectDevice=P,C.Device=class{constructor({handlerName:O,handlerFactory:M,Handler:j}={}){if(this._loaded=!1,this._observer=new o.EnhancedEventEmitter,y.debug("constructor()"),j){if(y.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),typeof j!="string")throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");O=j}if(O&&M)throw new TypeError("just one of handlerName or handlerInterface can be given");if(M)this._handlerFactory=M;else{if(O)y.debug("constructor() | handler given: %s",O);else{if(!(O=P()))throw new c.UnsupportedError("device not supported");y.debug("constructor() | detected handler: %s",O)}switch(O){case"Chrome111":this._handlerFactory=v.Chrome111.createFactory();break;case"Chrome74":this._handlerFactory=_.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=b.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=p.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=m.Chrome55.createFactory();break;case"Firefox120":this._handlerFactory=E.Firefox120.createFactory();break;case"Firefox60":this._handlerFactory=s.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=i.Safari12.createFactory();break;case"Safari11":this._handlerFactory=t.Safari11.createFactory();break;case"Edge11":this._handlerFactory=n.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=r.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=a.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${O}"`)}}const B=this._handlerFactory();this._handlerName=B.name,B.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(!this._loaded)throw new c.InvalidStateError("not loaded");return this._recvRtpCapabilities}get sctpCapabilities(){if(!this._loaded)throw new c.InvalidStateError("not loaded");return this._sctpCapabilities}get observer(){return this._observer}async load({routerRtpCapabilities:O}){let M;y.debug("load() [routerRtpCapabilities:%o]",O);try{if(this._loaded)throw new c.InvalidStateError("already loaded");const j=e.clone(O);g.validateRtpCapabilities(j),M=this._handlerFactory();const B=await M.getNativeRtpCapabilities();y.debug("load() | got native RTP capabilities:%o",B);const Q=e.clone(B);g.validateRtpCapabilities(Q),this._extendedRtpCapabilities=g.getExtendedRtpCapabilities(Q,j),y.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=g.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=g.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=g.getRecvRtpCapabilities(this._extendedRtpCapabilities),g.validateRtpCapabilities(this._recvRtpCapabilities),y.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await M.getNativeSctpCapabilities(),y.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),g.validateSctpCapabilities(this._sctpCapabilities),y.debug("load() succeeded"),this._loaded=!0,M.close()}catch(j){throw M&&M.close(),j}}canProduce(O){if(!this._loaded)throw new c.InvalidStateError("not loaded");if(O!=="audio"&&O!=="video")throw new TypeError(`invalid kind "${O}"`);return this._canProduceByKind[O]}createSendTransport({id:O,iceParameters:M,iceCandidates:j,dtlsParameters:B,sctpParameters:Q,iceServers:re,iceTransportPolicy:oe,additionalSettings:le,proprietaryConstraints:ve,appData:ke}){return y.debug("createSendTransport()"),this.createTransport({direction:"send",id:O,iceParameters:M,iceCandidates:j,dtlsParameters:B,sctpParameters:Q,iceServers:re,iceTransportPolicy:oe,additionalSettings:le,proprietaryConstraints:ve,appData:ke})}createRecvTransport({id:O,iceParameters:M,iceCandidates:j,dtlsParameters:B,sctpParameters:Q,iceServers:re,iceTransportPolicy:oe,additionalSettings:le,proprietaryConstraints:ve,appData:ke}){return y.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:O,iceParameters:M,iceCandidates:j,dtlsParameters:B,sctpParameters:Q,iceServers:re,iceTransportPolicy:oe,additionalSettings:le,proprietaryConstraints:ve,appData:ke})}createTransport({direction:O,id:M,iceParameters:j,iceCandidates:B,dtlsParameters:Q,sctpParameters:re,iceServers:oe,iceTransportPolicy:le,additionalSettings:ve,proprietaryConstraints:ke,appData:ce}){if(!this._loaded)throw new c.InvalidStateError("not loaded");if(typeof M!="string")throw new TypeError("missing id");if(typeof j!="object")throw new TypeError("missing iceParameters");if(!Array.isArray(B))throw new TypeError("missing iceCandidates");if(typeof Q!="object")throw new TypeError("missing dtlsParameters");if(re&&typeof re!="object")throw new TypeError("wrong sctpParameters");if(ce&&typeof ce!="object")throw new TypeError("if given, appData must be an object");const te=new h.Transport({direction:O,id:M,iceParameters:j,iceCandidates:B,dtlsParameters:Q,sctpParameters:re,iceServers:oe,iceTransportPolicy:le,additionalSettings:ve,proprietaryConstraints:ke,appData:ce,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",te),te}}},2010:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.EnhancedEventEmitter=void 0;const k=l(7007),S=new(l(2994)).Logger("EnhancedEventEmitter");class d extends k.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(f,...o){return super.emit(f,...o)}safeEmit(f,...o){const c=super.listenerCount(f);try{return super.emit(f,...o)}catch(e){return S.error("safeEmit() | event listener threw an error [eventName:%s]:%o",f,e),!!c}}on(f,o){return super.on(f,o),this}off(f,o){return super.off(f,o),this}addListener(f,o){return super.on(f,o),this}prependListener(f,o){return super.prependListener(f,o),this}once(f,o){return super.once(f,o),this}prependOnceListener(f,o){return super.prependOnceListener(f,o),this}removeListener(f,o){return super.off(f,o),this}removeAllListeners(f){return super.removeAllListeners(f),this}listenerCount(f){return super.listenerCount(f)}listeners(f){return super.listeners(f)}rawListeners(f){return super.rawListeners(f)}}C.EnhancedEventEmitter=d},2994:function(G,C,l){var k=this&&this.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(C,"__esModule",{value:!0}),C.Logger=void 0;const S=k(l(7833)),d="mediasoup-client";C.Logger=class{constructor(u){u?(this._debug=(0,S.default)(`${d}:${u}`),this._warn=(0,S.default)(`${d}:WARN:${u}`),this._error=(0,S.default)(`${d}:ERROR:${u}`)):(this._debug=(0,S.default)(d),this._warn=(0,S.default)(`${d}:WARN`),this._error=(0,S.default)(`${d}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},9792:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.Producer=void 0;const k=l(2994),S=l(2010),d=l(4893),u=new k.Logger("Producer");class f extends S.EnhancedEventEmitter{constructor({id:c,localId:e,rtpSender:g,track:h,rtpParameters:v,stopTracks:_,disableTrackOnPause:b,zeroRtpOnPause:p,appData:m}){super(),this._closed=!1,this._observer=new S.EnhancedEventEmitter,u.debug("constructor()"),this._id=c,this._localId=e,this._rtpSender=g,this._track=h,this._kind=h.kind,this._rtpParameters=v,this._paused=!!b&&!h.enabled,this._maxSpatialLayer=void 0,this._stopTracks=_,this._disableTrackOnPause=b,this._zeroRtpOnPause=p,this._appData=m||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(c){this._appData=c}get observer(){return this._observer}close(){this._closed||(u.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(u.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new d.InvalidStateError("closed");return new Promise((c,e)=>{this.safeEmit("@getstats",c,e)})}pause(){u.debug("pause()"),this._closed?u.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((c,e)=>{this.safeEmit("@pause",c,e)}).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){u.debug("resume()"),this._closed?u.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((c,e)=>{this.safeEmit("@resume",c,e)}).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:c}){if(u.debug("replaceTrack() [track:%o]",c),this._closed){if(c&&this._stopTracks)try{c.stop()}catch{}throw new d.InvalidStateError("closed")}if(c&&c.readyState==="ended")throw new d.InvalidStateError("track ended");c!==this._track?(await new Promise((e,g)=>{this.safeEmit("@replacetrack",c,e,g)}),this.destroyTrack(),this._track=c,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack()):u.debug("replaceTrack() | same track, ignored")}async setMaxSpatialLayer(c){if(this._closed)throw new d.InvalidStateError("closed");if(this._kind!=="video")throw new d.UnsupportedError("not a video Producer");if(typeof c!="number")throw new TypeError("invalid spatialLayer");c!==this._maxSpatialLayer&&(await new Promise((e,g)=>{this.safeEmit("@setmaxspatiallayer",c,e,g)}).catch(()=>{}),this._maxSpatialLayer=c)}async setRtpEncodingParameters(c){if(this._closed)throw new d.InvalidStateError("closed");if(typeof c!="object")throw new TypeError("invalid params");await new Promise((e,g)=>{this.safeEmit("@setrtpencodingparameters",c,e,g)})}onTrackEnded(){u.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch{}}}C.Producer=f},5370:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0})},4160:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0})},5601:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(t,n,r,a){a===void 0&&(a=r);var y=Object.getOwnPropertyDescriptor(n,r);y&&!("get"in y?!n.__esModule:y.writable||y.configurable)||(y={enumerable:!0,get:function(){return n[r]}}),Object.defineProperty(t,a,y)}:function(t,n,r,a){a===void 0&&(a=r),t[a]=n[r]}),S=this&&this.__setModuleDefault||(Object.create?function(t,n){Object.defineProperty(t,"default",{enumerable:!0,value:n})}:function(t,n){t.default=n}),d=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var n={};if(t!=null)for(var r in t)r!=="default"&&Object.prototype.hasOwnProperty.call(t,r)&&k(n,t,r);return S(n,t),n},u=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(C,"__esModule",{value:!0}),C.Transport=void 0;const f=l(8876),o=u(l(9596)),c=l(2994),e=l(2010),g=l(4893),h=d(l(1765)),v=d(l(8046)),_=l(9792),b=l(3518),p=l(7504),m=l(9166),E=new c.Logger("Transport");class s{constructor(n){this.consumerOptions=n,this.promise=new Promise((r,a)=>{this.resolve=r,this.reject=a})}}class i extends e.EnhancedEventEmitter{constructor({direction:n,id:r,iceParameters:a,iceCandidates:y,dtlsParameters:P,sctpParameters:O,iceServers:M,iceTransportPolicy:j,additionalSettings:B,proprietaryConstraints:Q,appData:re,handlerFactory:oe,extendedRtpCapabilities:le,canProduceByKind:ve}){super(),this._closed=!1,this._iceGatheringState="new",this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new f.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new e.EnhancedEventEmitter,E.debug("constructor() [id:%s, direction:%s]",r,n),this._id=r,this._direction=n,this._extendedRtpCapabilities=le,this._canProduceByKind=ve,this._maxSctpMessageSize=O?O.maxMessageSize:null;const ke=h.clone(B)||{};delete ke.iceServers,delete ke.iceTransportPolicy,delete ke.bundlePolicy,delete ke.rtcpMuxPolicy,delete ke.sdpSemantics,this._handler=oe(),this._handler.run({direction:n,iceParameters:a,iceCandidates:y,dtlsParameters:P,sctpParameters:O,iceServers:M,iceTransportPolicy:j,additionalSettings:ke,proprietaryConstraints:Q,extendedRtpCapabilities:le}),this._appData=re||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get iceGatheringState(){return this._iceGatheringState}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(n){this._appData=n}get observer(){return this._observer}close(){if(!this._closed){E.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close(),this._connectionState="closed";for(const n of this._producers.values())n.transportClosed();this._producers.clear();for(const n of this._consumers.values())n.transportClosed();this._consumers.clear();for(const n of this._dataProducers.values())n.transportClosed();this._dataProducers.clear();for(const n of this._dataConsumers.values())n.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new g.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:n}){if(E.debug("restartIce()"),this._closed)throw new g.InvalidStateError("closed");if(!n)throw new TypeError("missing iceParameters");return this._awaitQueue.push(async()=>await this._handler.restartIce(n),"transport.restartIce()")}async updateIceServers({iceServers:n}={}){if(E.debug("updateIceServers()"),this._closed)throw new g.InvalidStateError("closed");if(!Array.isArray(n))throw new TypeError("missing iceServers");return this._awaitQueue.push(async()=>this._handler.updateIceServers(n),"transport.updateIceServers()")}async produce({track:n,encodings:r,codecOptions:a,codec:y,stopTracks:P=!0,disableTrackOnPause:O=!0,zeroRtpOnPause:M=!1,appData:j={}}={}){if(E.debug("produce() [track:%o]",n),this._closed)throw new g.InvalidStateError("closed");if(!n)throw new TypeError("missing track");if(this._direction!=="send")throw new g.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[n.kind])throw new g.UnsupportedError(`cannot produce ${n.kind}`);if(n.readyState==="ended")throw new g.InvalidStateError("track ended");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("produce")===0)throw new TypeError('no "produce" listener set into this transport');if(j&&typeof j!="object")throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let B;if(r&&!Array.isArray(r))throw TypeError("encodings must be an array");r&&r.length===0?B=void 0:r&&(B=r.map(le=>{const ve={active:!0};return le.active===!1&&(ve.active=!1),typeof le.dtx=="boolean"&&(ve.dtx=le.dtx),typeof le.scalabilityMode=="string"&&(ve.scalabilityMode=le.scalabilityMode),typeof le.scaleResolutionDownBy=="number"&&(ve.scaleResolutionDownBy=le.scaleResolutionDownBy),typeof le.maxBitrate=="number"&&(ve.maxBitrate=le.maxBitrate),typeof le.maxFramerate=="number"&&(ve.maxFramerate=le.maxFramerate),typeof le.adaptivePtime=="boolean"&&(ve.adaptivePtime=le.adaptivePtime),typeof le.priority=="string"&&(ve.priority=le.priority),typeof le.networkPriority=="string"&&(ve.networkPriority=le.networkPriority),ve}));const{localId:Q,rtpParameters:re,rtpSender:oe}=await this._handler.send({track:n,encodings:B,codecOptions:a,codec:y});try{v.validateRtpParameters(re);const{id:le}=await new Promise((ke,ce)=>{this.safeEmit("produce",{kind:n.kind,rtpParameters:re,appData:j},ke,ce)}),ve=new _.Producer({id:le,localId:Q,rtpSender:oe,track:n,rtpParameters:re,stopTracks:P,disableTrackOnPause:O,zeroRtpOnPause:M,appData:j});return this._producers.set(ve.id,ve),this.handleProducer(ve),this._observer.safeEmit("newproducer",ve),ve}catch(le){throw this._handler.stopSending(Q).catch(()=>{}),le}},"transport.produce()").catch(B=>{if(P)try{n.stop()}catch{}throw B})}async consume({id:n,producerId:r,kind:a,rtpParameters:y,streamId:P,appData:O={}}){if(E.debug("consume()"),this._closed)throw new g.InvalidStateError("closed");if(this._direction!=="recv")throw new g.UnsupportedError("not a receiving Transport");if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing producerId");if(a!=="audio"&&a!=="video")throw new TypeError(`invalid kind '${a}'`);if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(O&&typeof O!="object")throw new TypeError("if given, appData must be an object");const M=h.clone(y);if(!v.canReceive(M,this._extendedRtpCapabilities))throw new g.UnsupportedError("cannot consume this Producer");const j=new s({id:n,producerId:r,kind:a,rtpParameters:M,streamId:P,appData:O});return this._pendingConsumerTasks.push(j),(0,o.default)(()=>{this._closed||this._consumerCreationInProgress===!1&&this.createPendingConsumers()}),j.promise}async produceData({ordered:n=!0,maxPacketLifeTime:r,maxRetransmits:a,label:y="",protocol:P="",appData:O={}}={}){if(E.debug("produceData()"),this._closed)throw new g.InvalidStateError("closed");if(this._direction!=="send")throw new g.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new g.UnsupportedError("SCTP not enabled by remote Transport");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(this.listenerCount("producedata")===0)throw new TypeError('no "producedata" listener set into this transport');if(O&&typeof O!="object")throw new TypeError("if given, appData must be an object");return(r||a)&&(n=!1),this._awaitQueue.push(async()=>{const{dataChannel:M,sctpStreamParameters:j}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:r,maxRetransmits:a,label:y,protocol:P});v.validateSctpStreamParameters(j);const{id:B}=await new Promise((re,oe)=>{this.safeEmit("producedata",{sctpStreamParameters:j,label:y,protocol:P,appData:O},re,oe)}),Q=new p.DataProducer({id:B,dataChannel:M,sctpStreamParameters:j,appData:O});return this._dataProducers.set(Q.id,Q),this.handleDataProducer(Q),this._observer.safeEmit("newdataproducer",Q),Q},"transport.produceData()")}async consumeData({id:n,dataProducerId:r,sctpStreamParameters:a,label:y="",protocol:P="",appData:O={}}){if(E.debug("consumeData()"),this._closed)throw new g.InvalidStateError("closed");if(this._direction!=="recv")throw new g.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new g.UnsupportedError("SCTP not enabled by remote Transport");if(typeof n!="string")throw new TypeError("missing id");if(typeof r!="string")throw new TypeError("missing dataProducerId");if(this.listenerCount("connect")===0&&this._connectionState==="new")throw new TypeError('no "connect" listener set into this transport');if(O&&typeof O!="object")throw new TypeError("if given, appData must be an object");const M=h.clone(a);return v.validateSctpStreamParameters(M),this._awaitQueue.push(async()=>{const{dataChannel:j}=await this._handler.receiveDataChannel({sctpStreamParameters:M,label:y,protocol:P}),B=new m.DataConsumer({id:n,dataProducerId:r,dataChannel:j,sctpStreamParameters:M,appData:O});return this._dataConsumers.set(B.id,B),this.handleDataConsumer(B),this._observer.safeEmit("newdataconsumer",B),B},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingConsumerTasks.length===0)return void E.debug("createPendingConsumers() | there is no Consumer to be created");const n=[...this._pendingConsumerTasks];let r;this._pendingConsumerTasks=[];const a=[];for(const y of n){const{id:P,kind:O,rtpParameters:M,streamId:j}=y.consumerOptions;a.push({trackId:P,kind:O,rtpParameters:M,streamId:j})}try{const y=await this._handler.receive(a);for(let P=0;P<y.length;++P){const O=n[P],M=y[P],{id:j,producerId:B,kind:Q,rtpParameters:re,appData:oe}=O.consumerOptions,{localId:le,rtpReceiver:ve,track:ke}=M,ce=new b.Consumer({id:j,localId:le,producerId:B,rtpReceiver:ve,track:ke,rtpParameters:re,appData:oe});this._consumers.set(ce.id,ce),this.handleConsumer(ce),this._probatorConsumerCreated||r||Q!=="video"||(r=ce),this._observer.safeEmit("newconsumer",ce),O.resolve(ce)}}catch(y){for(const P of n)P.reject(y)}if(r)try{const y=v.generateProbatorRtpParameters(r.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:y}]),E.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(y){E.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",y)}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,this._pendingConsumerTasks.length>0&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingPauseConsumers.size===0)return void E.debug("pausePendingConsumers() | there is no Consumer to be paused");const n=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{const r=n.map(a=>a.localId);await this._handler.pauseReceiving(r)}catch(r){E.error("pausePendingConsumers() | failed to pause Consumers:",r)}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,this._pendingPauseConsumers.size>0&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingResumeConsumers.size===0)return void E.debug("resumePendingConsumers() | there is no Consumer to be resumed");const n=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{const r=n.map(a=>a.localId);await this._handler.resumeReceiving(r)}catch(r){E.error("resumePendingConsumers() | failed to resume Consumers:",r)}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,this._pendingResumeConsumers.size>0&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(this._pendingCloseConsumers.size===0)return void E.debug("closePendingConsumers() | there is no Consumer to be closed");const n=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(n.map(r=>r.localId))}catch(r){E.error("closePendingConsumers() | failed to close Consumers:",r)}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,this._pendingCloseConsumers.size>0&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){const n=this._handler;n.on("@connect",({dtlsParameters:r},a,y)=>{this._closed?y(new g.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:r},a,y)}),n.on("@icegatheringstatechange",r=>{r!==this._iceGatheringState&&(E.debug("ICE gathering state changed to %s",r),this._iceGatheringState=r,this._closed||this.safeEmit("icegatheringstatechange",r))}),n.on("@connectionstatechange",r=>{r!==this._connectionState&&(E.debug("connection state changed to %s",r),this._connectionState=r,this._closed||this.safeEmit("connectionstatechange",r))})}handleProducer(n){n.on("@close",()=>{this._producers.delete(n.id),this._closed||this._awaitQueue.push(async()=>await this._handler.stopSending(n.localId),"producer @close event").catch(r=>E.warn("producer.close() failed:%o",r))}),n.on("@pause",(r,a)=>{this._awaitQueue.push(async()=>await this._handler.pauseSending(n.localId),"producer @pause event").then(r).catch(a)}),n.on("@resume",(r,a)=>{this._awaitQueue.push(async()=>await this._handler.resumeSending(n.localId),"producer @resume event").then(r).catch(a)}),n.on("@replacetrack",(r,a,y)=>{this._awaitQueue.push(async()=>await this._handler.replaceTrack(n.localId,r),"producer @replacetrack event").then(a).catch(y)}),n.on("@setmaxspatiallayer",(r,a,y)=>{this._awaitQueue.push(async()=>await this._handler.setMaxSpatialLayer(n.localId,r),"producer @setmaxspatiallayer event").then(a).catch(y)}),n.on("@setrtpencodingparameters",(r,a,y)=>{this._awaitQueue.push(async()=>await this._handler.setRtpEncodingParameters(n.localId,r),"producer @setrtpencodingparameters event").then(a).catch(y)}),n.on("@getstats",(r,a)=>{if(this._closed)return a(new g.InvalidStateError("closed"));this._handler.getSenderStats(n.localId).then(r).catch(a)})}handleConsumer(n){n.on("@close",()=>{this._consumers.delete(n.id),this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.delete(n.id),this._closed||(this._pendingCloseConsumers.set(n.id,n),this._consumerCloseInProgress===!1&&this.closePendingConsumers())}),n.on("@pause",()=>{this._pendingResumeConsumers.has(n.id)&&this._pendingResumeConsumers.delete(n.id),this._pendingPauseConsumers.set(n.id,n),(0,o.default)(()=>{this._closed||this._consumerPauseInProgress===!1&&this.pausePendingConsumers()})}),n.on("@resume",()=>{this._pendingPauseConsumers.has(n.id)&&this._pendingPauseConsumers.delete(n.id),this._pendingResumeConsumers.set(n.id,n),(0,o.default)(()=>{this._closed||this._consumerResumeInProgress===!1&&this.resumePendingConsumers()})}),n.on("@getstats",(r,a)=>{if(this._closed)return a(new g.InvalidStateError("closed"));this._handler.getReceiverStats(n.localId).then(r).catch(a)})}handleDataProducer(n){n.on("@close",()=>{this._dataProducers.delete(n.id)})}handleDataConsumer(n){n.on("@close",()=>{this._dataConsumers.delete(n.id)})}}C.Transport=i},4893:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.InvalidStateError=C.UnsupportedError=void 0;class l extends Error{constructor(d){super(d),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,l):this.stack=new Error(d).stack}}C.UnsupportedError=l;class k extends Error{constructor(d){super(d),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,k):this.stack=new Error(d).stack}}C.InvalidStateError=k},2183:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(i,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(i,r,a)}:function(i,t,n,r){r===void 0&&(r=n),i[r]=t[n]}),S=this&&this.__setModuleDefault||(Object.create?function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}:function(i,t){i.default=t}),d=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var n in i)n!=="default"&&Object.prototype.hasOwnProperty.call(i,n)&&k(t,i,n);return S(t,i),t};Object.defineProperty(C,"__esModule",{value:!0}),C.Chrome111=void 0;const u=d(l(7363)),f=l(2994),o=d(l(1765)),c=d(l(8046)),e=d(l(5544)),g=d(l(5938)),h=d(l(4256)),v=l(4893),_=l(521),b=l(1305),p=l(3303),m=new f.Logger("Chrome111"),E={OS:1024,MIS:1024};class s extends _.HandlerInterface{static createFactory(){return()=>new s}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome111"}close(){if(m.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const n=await t.createOffer();try{t.close()}catch{}const r=u.parse(n.sdp),a=e.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(a),a}catch(n){try{t.close()}catch{}throw n}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:E}}run({direction:t,iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y,iceServers:P,iceTransportPolicy:O,additionalSettings:M,proprietaryConstraints:j,extendedRtpCapabilities:B}){this.assertNotClosed(),m.debug("run()"),this._direction=t,this._remoteSdp=new b.RemoteSdp({iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",B),video:c.getSendingRtpParameters("video",B)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",B),video:c.getSendingRemoteRtpParameters("video",B)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P||[],iceTransportPolicy:O||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...M},j),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(t){this.assertNotClosed(),m.debug("updateIceServers()");const n=this._pc.getConfiguration();n.iceServers=t,this._pc.setConfiguration(n)}async restartIce(t){if(this.assertNotClosed(),m.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady)if(this._direction==="send"){const n=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:n,codecOptions:r,codec:a}){if(this.assertNotClosed(),this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),n&&n.length>1){let le=1;for(const ve of n){const ke=ve.scalabilityMode?(0,p.parse)(ve.scalabilityMode).temporalLayers:3;ke>le&&(le=ke)}n.forEach((ve,ke)=>{ve.rid=`r${ke}`,ve.scalabilityMode=`L1T${le}`})}const y=o.clone(this._sendingRtpParametersByKind[t.kind]);y.codecs=c.reduceCodecs(y.codecs,a);const P=o.clone(this._sendingRemoteRtpParametersByKind[t.kind]);P.codecs=c.reduceCodecs(P.codecs,a);const O=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:n}),j=await this._pc.createOffer();let B=u.parse(j.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:B}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",j),await this._pc.setLocalDescription(j);const Q=M.mid;y.mid=Q,B=u.parse(this._pc.localDescription.sdp);const re=B.media[O.idx];if(y.rtcp.cname=e.getCname({offerMediaObject:re}),n)if(n.length===1){const le=g.getRtpEncodings({offerMediaObject:re});Object.assign(le[0],n[0]),y.encodings=le}else y.encodings=n;else y.encodings=g.getRtpEncodings({offerMediaObject:re});this._remoteSdp.send({offerMediaObject:re,reuseMid:O.reuseMid,offerRtpParameters:y,answerRtpParameters:P,codecOptions:r,extmapAllowMixed:!0});const oe={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",oe),await this._pc.setRemoteDescription(oe),this._mapMidTransceiver.set(Q,M),{localId:Q,rtpParameters:y,rtpSender:M.sender}}async stopSending(t){if(this.assertSendDirection(),m.debug("stopSending() [localId:%s]",t),this._closed)return;const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");if(n.sender.replaceTrack(null),this._pc.removeTrack(n.sender),this._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch{}const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("pauseSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(t);const r=await this._pc.createOffer();m.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("resumeSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="sendonly";const r=await this._pc.createOffer();m.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,n){this.assertNotClosed(),this.assertSendDirection(),n?m.debug("replaceTrack() [localId:%s, track.id:%s]",t,n.id):m.debug("replaceTrack() [localId:%s, no track]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(n)}async setMaxSpatialLayer(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{O.active=M<=n}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{a.encodings[M]={...O,...n}}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:n,maxRetransmits:r,label:a,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:n,maxRetransmits:r,protocol:y};m.debug("sendDataChannel() [options:%o]",P);const O=this._pc.createDataChannel(a,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),j=u.parse(M.sdp),B=j.media.find(re=>re.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:B});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:O,sctpStreamParameters:{streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits}}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const n=[],r=new Map;for(const O of t){const{trackId:M,kind:j,rtpParameters:B,streamId:Q}=O;m.debug("receive() [trackId:%s, kind:%s]",M,j);const re=B.mid||String(this._mapMidTransceiver.size);r.set(M,re),this._remoteSdp.receive({mid:re,kind:j,offerRtpParameters:B,streamId:Q||B.rtcp.cname,trackId:M})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let y=await this._pc.createAnswer();const P=u.parse(y.sdp);for(const O of t){const{trackId:M,rtpParameters:j}=O,B=r.get(M),Q=P.media.find(re=>String(re.mid)===B);e.applyCodecParameters({offerRtpParameters:j,answerMediaObject:Q})}y={type:"answer",sdp:u.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const O of t){const{trackId:M}=O,j=r.get(M),B=this._pc.getTransceivers().find(Q=>Q.mid===j);if(!B)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(j,B),n.push({localId:j,track:B.receiver.track,rtpReceiver:B.receiver})}return n}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){m.debug("stopReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("pauseReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("resumeReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:n,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O}=t,M={negotiated:!0,id:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O,protocol:r};m.debug("receiveDataChannel() [options:%o]",M);const j=this._pc.createDataChannel(n,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const B={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",B),await this._pc.setRemoteDescription(B);const Q=await this._pc.createAnswer();if(!this._transportReady){const re=u.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:re})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:j}}async setupTransport({localDtlsRole:t,localSdpObject:n}){n||(n=u.parse(this._pc.localDescription.sdp));const r=e.extractDtlsParameters({sdpObject:n});r.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,y)=>{this.safeEmit("@connect",{dtlsParameters:r},a,y)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new v.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Chrome111=s},7402:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(E,s,i,t){t===void 0&&(t=i);var n=Object.getOwnPropertyDescriptor(s,i);n&&!("get"in n?!s.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(E,t,n)}:function(E,s,i,t){t===void 0&&(t=i),E[t]=s[i]}),S=this&&this.__setModuleDefault||(Object.create?function(E,s){Object.defineProperty(E,"default",{enumerable:!0,value:s})}:function(E,s){E.default=s}),d=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var s={};if(E!=null)for(var i in E)i!=="default"&&Object.prototype.hasOwnProperty.call(E,i)&&k(s,E,i);return S(s,E),s};Object.defineProperty(C,"__esModule",{value:!0}),C.Chrome55=void 0;const u=d(l(7363)),f=l(2994),o=l(4893),c=d(l(1765)),e=d(l(8046)),g=d(l(5544)),h=d(l(4496)),v=l(521),_=l(1305),b=new f.Logger("Chrome55"),p={OS:1024,MIS:1024};class m extends v.HandlerInterface{static createFactory(){return()=>new m}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const s=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const i=await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{s.close()}catch{}const t=u.parse(i.sdp);return g.extractRtpCapabilities({sdpObject:t})}catch(i){try{s.close()}catch{}throw i}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:p}}run({direction:s,iceParameters:i,iceCandidates:t,dtlsParameters:n,sctpParameters:r,iceServers:a,iceTransportPolicy:y,additionalSettings:P,proprietaryConstraints:O,extendedRtpCapabilities:M}){b.debug("run()"),this._direction=s,this._remoteSdp=new _.RemoteSdp({iceParameters:i,iceCandidates:t,dtlsParameters:n,sctpParameters:r,planB:!0}),this._sendingRtpParametersByKind={audio:e.getSendingRtpParameters("audio",M),video:e.getSendingRtpParameters("video",M)},this._sendingRemoteRtpParametersByKind={audio:e.getSendingRemoteRtpParameters("audio",M),video:e.getSendingRemoteRtpParameters("video",M)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:y||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...P},O),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(s){b.debug("updateIceServers()");const i=this._pc.getConfiguration();i.iceServers=s,this._pc.setConfiguration(i)}async restartIce(s){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(s),this._transportReady)if(this._direction==="send"){const i=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const t={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const t=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:s,encodings:i,codecOptions:t,codec:n}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",s.kind,s.id),n&&b.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(s),this._pc.addStream(this._sendStream);let r,a=await this._pc.createOffer(),y=u.parse(a.sdp);const P=c.clone(this._sendingRtpParametersByKind[s.kind]);P.codecs=e.reduceCodecs(P.codecs);const O=c.clone(this._sendingRemoteRtpParametersByKind[s.kind]);if(O.codecs=e.reduceCodecs(O.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:y}),s.kind==="video"&&i&&i.length>1&&(b.debug("send() | enabling simulcast"),y=u.parse(a.sdp),r=y.media.find(B=>B.type==="video"),h.addLegacySimulcast({offerMediaObject:r,track:s,numStreams:i.length}),a={type:"offer",sdp:u.write(y)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),y=u.parse(this._pc.localDescription.sdp),r=y.media.find(B=>B.type===s.kind),P.rtcp.cname=g.getCname({offerMediaObject:r}),P.encodings=h.getRtpEncodings({offerMediaObject:r,track:s}),i)for(let B=0;B<P.encodings.length;++B)i[B]&&Object.assign(P.encodings[B],i[B]);if(P.encodings.length>1&&P.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const B of P.encodings)B.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:r,offerRtpParameters:P,answerRtpParameters:O,codecOptions:t});const M={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M);const j=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(j,s),{localId:j,rtpParameters:P}}async stopSending(s){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",s);const i=this._mapSendLocalIdTrack.get(s);if(!i)throw new Error("track not found");this._mapSendLocalIdTrack.delete(s),this._sendStream.removeTrack(i),this._pc.addStream(this._sendStream);const t=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(r){if(this._sendStream.getTracks().length===0)return void b.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.toString());throw r}if(this._pc.signalingState==="stable")return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(s){}async resumeSending(s){}async replaceTrack(s,i){throw new o.UnsupportedError("not implemented")}async setMaxSpatialLayer(s,i){throw new o.UnsupportedError(" not implemented")}async setRtpEncodingParameters(s,i){throw new o.UnsupportedError("not supported")}async getSenderStats(s){throw new o.UnsupportedError("not implemented")}async sendDataChannel({ordered:s,maxPacketLifeTime:i,maxRetransmits:t,label:n,protocol:r}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:s,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:t,protocol:r};b.debug("sendDataChannel() [options:%o]",a);const y=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%p.MIS,!this._hasDataChannelMediaSection){const P=await this._pc.createOffer(),O=u.parse(P.sdp),M=O.media.find(B=>B.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),await this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:M});const j={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:y,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(s){this.assertRecvDirection();const i=[];for(const a of s){const{trackId:y,kind:P,rtpParameters:O,streamId:M}=a;b.debug("receive() [trackId:%s, kind:%s]",y,P);const j=P;this._remoteSdp.receive({mid:j,kind:P,offerRtpParameters:O,streamId:M||O.rtcp.cname,trackId:y})}const t={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);let n=await this._pc.createAnswer();const r=u.parse(n.sdp);for(const a of s){const{kind:y,rtpParameters:P}=a,O=y,M=r.media.find(j=>String(j.mid)===O);g.applyCodecParameters({offerRtpParameters:P,answerMediaObject:M})}n={type:"answer",sdp:u.write(r)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:r}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const a of s){const{kind:y,trackId:P,rtpParameters:O}=a,M=y,j=P,B=a.streamId||O.rtcp.cname,Q=this._pc.getRemoteStreams().find(re=>re.id===B).getTrackById(j);if(!Q)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(j,{mid:M,rtpParameters:O}),i.push({localId:j,track:Q})}return i}async stopReceiving(s){this.assertRecvDirection();for(const n of s){b.debug("stopReceiving() [localId:%s]",n);const{mid:r,rtpParameters:a}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:a})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const t=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async pauseReceiving(s){}async resumeReceiving(s){}async getReceiverStats(s){throw new o.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:s,label:i,protocol:t}){this.assertRecvDirection();const{streamId:n,ordered:r,maxPacketLifeTime:a,maxRetransmits:y}=s,P={negotiated:!0,id:n,ordered:r,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:y,protocol:t};b.debug("receiveDataChannel() [options:%o]",P);const O=this._pc.createDataChannel(i,P);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const M={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const j=await this._pc.createAnswer();if(!this._transportReady){const B=u.parse(j.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:B})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setLocalDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:O}}async setupTransport({localDtlsRole:s,localSdpObject:i}){i||(i=u.parse(this._pc.localDescription.sdp));const t=g.extractDtlsParameters({sdpObject:i});t.role=s,this._remoteSdp.updateDtlsRole(s==="client"?"server":"client"),await new Promise((n,r)=>{this.safeEmit("@connect",{dtlsParameters:t},n,r)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Chrome55=m},8155:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(m,E,s,i){i===void 0&&(i=s);var t=Object.getOwnPropertyDescriptor(E,s);t&&!("get"in t?!E.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return E[s]}}),Object.defineProperty(m,i,t)}:function(m,E,s,i){i===void 0&&(i=s),m[i]=E[s]}),S=this&&this.__setModuleDefault||(Object.create?function(m,E){Object.defineProperty(m,"default",{enumerable:!0,value:E})}:function(m,E){m.default=E}),d=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var E={};if(m!=null)for(var s in m)s!=="default"&&Object.prototype.hasOwnProperty.call(m,s)&&k(E,m,s);return S(E,m),E};Object.defineProperty(C,"__esModule",{value:!0}),C.Chrome67=void 0;const u=d(l(7363)),f=l(2994),o=d(l(1765)),c=d(l(8046)),e=d(l(5544)),g=d(l(4496)),h=l(521),v=l(1305),_=new f.Logger("Chrome67"),b={OS:1024,MIS:1024};class p extends h.HandlerInterface{static createFactory(){return()=>new p}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(_.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");const E=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await E.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{E.close()}catch{}const i=u.parse(s.sdp);return e.extractRtpCapabilities({sdpObject:i})}catch(s){try{E.close()}catch{}throw s}}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),{numStreams:b}}run({direction:E,iceParameters:s,iceCandidates:i,dtlsParameters:t,sctpParameters:n,iceServers:r,iceTransportPolicy:a,additionalSettings:y,proprietaryConstraints:P,extendedRtpCapabilities:O}){_.debug("run()"),this._direction=E,this._remoteSdp=new v.RemoteSdp({iceParameters:s,iceCandidates:i,dtlsParameters:t,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",O),video:c.getSendingRtpParameters("video",O)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",O),video:c.getSendingRemoteRtpParameters("video",O)},t.role&&t.role!=="auto"&&(this._forcedLocalDtlsRole=t.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:r||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...y},P),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(_.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(E){_.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=E,this._pc.setConfiguration(s)}async restartIce(E){if(_.debug("restartIce()"),this._remoteSdp.updateIceParameters(E),this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:E,encodings:s,codecOptions:i,codec:t}){this.assertSendDirection(),_.debug("send() [kind:%s, track.id:%s]",E.kind,E.id),t&&_.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(E),this._pc.addTrack(E,this._sendStream);let n,r=await this._pc.createOffer(),a=u.parse(r.sdp);const y=o.clone(this._sendingRtpParametersByKind[E.kind]);y.codecs=c.reduceCodecs(y.codecs);const P=o.clone(this._sendingRemoteRtpParametersByKind[E.kind]);if(P.codecs=c.reduceCodecs(P.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),E.kind==="video"&&s&&s.length>1&&(_.debug("send() | enabling simulcast"),a=u.parse(r.sdp),n=a.media.find(B=>B.type==="video"),g.addLegacySimulcast({offerMediaObject:n,track:E,numStreams:s.length}),r={type:"offer",sdp:u.write(a)}),_.debug("send() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),a=u.parse(this._pc.localDescription.sdp),n=a.media.find(B=>B.type===E.kind),y.rtcp.cname=e.getCname({offerMediaObject:n}),y.encodings=g.getRtpEncodings({offerMediaObject:n,track:E}),s)for(let B=0;B<y.encodings.length;++B)s[B]&&Object.assign(y.encodings[B],s[B]);if(y.encodings.length>1&&y.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const B of y.encodings)B.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:y,answerRtpParameters:P,codecOptions:i});const O={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("send() | calling pc.setRemoteDescription() [answer:%o]",O),await this._pc.setRemoteDescription(O);const M=String(this._nextSendLocalId);this._nextSendLocalId++;const j=this._pc.getSenders().find(B=>B.track===E);return this._mapSendLocalIdRtpSender.set(M,j),{localId:M,rtpParameters:y,rtpSender:j}}async stopSending(E){this.assertSendDirection(),_.debug("stopSending() [localId:%s]",E);const s=this._mapSendLocalIdRtpSender.get(E);if(!s)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(s),s.track&&this._sendStream.removeTrack(s.track),this._mapSendLocalIdRtpSender.delete(E);const i=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(n){if(this._sendStream.getTracks().length===0)return void _.warn("stopSending() | ignoring expected error due no sending tracks: %s",n.toString());throw n}if(this._pc.signalingState==="stable")return;const t={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async pauseSending(E){}async resumeSending(E){}async replaceTrack(E,s){this.assertSendDirection(),s?_.debug("replaceTrack() [localId:%s, track.id:%s]",E,s.id):_.debug("replaceTrack() [localId:%s, no track]",E);const i=this._mapSendLocalIdRtpSender.get(E);if(!i)throw new Error("associated RTCRtpSender not found");const t=i.track;await i.replaceTrack(s),t&&this._sendStream.removeTrack(t),s&&this._sendStream.addTrack(s)}async setMaxSpatialLayer(E,s){this.assertSendDirection(),_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",E,s);const i=this._mapSendLocalIdRtpSender.get(E);if(!i)throw new Error("associated RTCRtpSender not found");const t=i.getParameters();t.encodings.forEach((n,r)=>{n.active=r<=s}),await i.setParameters(t)}async setRtpEncodingParameters(E,s){this.assertSendDirection(),_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",E,s);const i=this._mapSendLocalIdRtpSender.get(E);if(!i)throw new Error("associated RTCRtpSender not found");const t=i.getParameters();t.encodings.forEach((n,r)=>{t.encodings[r]={...n,...s}}),await i.setParameters(t)}async getSenderStats(E){this.assertSendDirection();const s=this._mapSendLocalIdRtpSender.get(E);if(!s)throw new Error("associated RTCRtpSender not found");return s.getStats()}async sendDataChannel({ordered:E,maxPacketLifeTime:s,maxRetransmits:i,label:t,protocol:n}){this.assertSendDirection();const r={negotiated:!0,id:this._nextSendSctpStreamId,ordered:E,maxPacketLifeTime:s,maxRetransmitTime:s,maxRetransmits:i,protocol:n};_.debug("sendDataChannel() [options:%o]",r);const a=this._pc.createDataChannel(t,r);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,!this._hasDataChannelMediaSection){const y=await this._pc.createOffer(),P=u.parse(y.sdp),O=P.media.find(j=>j.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y),this._remoteSdp.sendSctpAssociation({offerMediaObject:O});const M={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:r.id,ordered:r.ordered,maxPacketLifeTime:r.maxPacketLifeTime,maxRetransmits:r.maxRetransmits}}}async receive(E){this.assertRecvDirection();const s=[];for(const r of E){const{trackId:a,kind:y,rtpParameters:P,streamId:O}=r;_.debug("receive() [trackId:%s, kind:%s]",a,y);const M=y;this._remoteSdp.receive({mid:M,kind:y,offerRtpParameters:P,streamId:O||P.rtcp.cname,trackId:a})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let t=await this._pc.createAnswer();const n=u.parse(t.sdp);for(const r of E){const{kind:a,rtpParameters:y}=r,P=a,O=n.media.find(M=>String(M.mid)===P);e.applyCodecParameters({offerRtpParameters:y,answerMediaObject:O})}t={type:"answer",sdp:u.write(n)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:n}),_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const r of E){const{kind:a,trackId:y,rtpParameters:P}=r,O=y,M=a,j=this._pc.getReceivers().find(B=>B.track&&B.track.id===O);if(!j)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(O,{mid:M,rtpParameters:P,rtpReceiver:j}),s.push({localId:O,track:j.track,rtpReceiver:j})}return s}async stopReceiving(E){this.assertRecvDirection();for(const t of E){_.debug("stopReceiving() [localId:%s]",t);const{mid:n,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:r})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async pauseReceiving(E){}async resumeReceiving(E){}async getReceiverStats(E){this.assertRecvDirection();const{rtpReceiver:s}=this._mapRecvLocalIdInfo.get(E)||{};if(!s)throw new Error("associated RTCRtpReceiver not found");return s.getStats()}async receiveDataChannel({sctpStreamParameters:E,label:s,protocol:i}){this.assertRecvDirection();const{streamId:t,ordered:n,maxPacketLifeTime:r,maxRetransmits:a}=E,y={negotiated:!0,id:t,ordered:n,maxPacketLifeTime:r,maxRetransmitTime:r,maxRetransmits:a,protocol:i};_.debug("receiveDataChannel() [options:%o]",y);const P=this._pc.createDataChannel(s,y);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const O={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",O),await this._pc.setRemoteDescription(O);const M=await this._pc.createAnswer();if(!this._transportReady){const j=u.parse(M.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setLocalDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:P}}async setupTransport({localDtlsRole:E,localSdpObject:s}){s||(s=u.parse(this._pc.localDescription.sdp));const i=e.extractDtlsParameters({sdpObject:s});i.role=E,this._remoteSdp.updateDtlsRole(E==="client"?"server":"client"),await new Promise((t,n)=>{this.safeEmit("@connect",{dtlsParameters:i},t,n)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Chrome67=p},5535:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(E,s,i,t){t===void 0&&(t=i);var n=Object.getOwnPropertyDescriptor(s,i);n&&!("get"in n?!s.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(E,t,n)}:function(E,s,i,t){t===void 0&&(t=i),E[t]=s[i]}),S=this&&this.__setModuleDefault||(Object.create?function(E,s){Object.defineProperty(E,"default",{enumerable:!0,value:s})}:function(E,s){E.default=s}),d=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var s={};if(E!=null)for(var i in E)i!=="default"&&Object.prototype.hasOwnProperty.call(E,i)&&k(s,E,i);return S(s,E),s};Object.defineProperty(C,"__esModule",{value:!0}),C.Chrome70=void 0;const u=d(l(7363)),f=l(2994),o=d(l(1765)),c=d(l(8046)),e=d(l(5544)),g=d(l(5938)),h=l(521),v=l(1305),_=l(3303),b=new f.Logger("Chrome70"),p={OS:1024,MIS:1024};class m extends h.HandlerInterface{static createFactory(){return()=>new m}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const s=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{s.addTransceiver("audio"),s.addTransceiver("video");const i=await s.createOffer();try{s.close()}catch{}const t=u.parse(i.sdp);return e.extractRtpCapabilities({sdpObject:t})}catch(i){try{s.close()}catch{}throw i}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:p}}run({direction:s,iceParameters:i,iceCandidates:t,dtlsParameters:n,sctpParameters:r,iceServers:a,iceTransportPolicy:y,additionalSettings:P,proprietaryConstraints:O,extendedRtpCapabilities:M}){b.debug("run()"),this._direction=s,this._remoteSdp=new v.RemoteSdp({iceParameters:i,iceCandidates:t,dtlsParameters:n,sctpParameters:r}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",M),video:c.getSendingRtpParameters("video",M)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",M),video:c.getSendingRemoteRtpParameters("video",M)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:y||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...P},O),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(s){b.debug("updateIceServers()");const i=this._pc.getConfiguration();i.iceServers=s,this._pc.setConfiguration(i)}async restartIce(s){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(s),this._transportReady)if(this._direction==="send"){const i=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const t={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const t=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:s,encodings:i,codecOptions:t,codec:n}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",s.kind,s.id);const r=o.clone(this._sendingRtpParametersByKind[s.kind]);r.codecs=c.reduceCodecs(r.codecs,n);const a=o.clone(this._sendingRemoteRtpParametersByKind[s.kind]);a.codecs=c.reduceCodecs(a.codecs,n);const y=this._remoteSdp.getNextMediaSectionIdx(),P=this._pc.addTransceiver(s,{direction:"sendonly",streams:[this._sendStream]});let O,M=await this._pc.createOffer(),j=u.parse(M.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),i&&i.length>1&&(b.debug("send() | enabling legacy simulcast"),j=u.parse(M.sdp),O=j.media[y.idx],g.addLegacySimulcast({offerMediaObject:O,numStreams:i.length}),M={type:"offer",sdp:u.write(j)});let B=!1;const Q=(0,_.parse)((i||[{}])[0].scalabilityMode);if(i&&i.length===1&&Q.spatialLayers>1&&r.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),B=!0,j=u.parse(M.sdp),O=j.media[y.idx],g.addLegacySimulcast({offerMediaObject:O,numStreams:Q.spatialLayers}),M={type:"offer",sdp:u.write(j)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),i){b.debug("send() | applying given encodings");const le=P.sender.getParameters();for(let ve=0;ve<(le.encodings||[]).length;++ve){const ke=le.encodings[ve],ce=i[ve];if(!ce)break;le.encodings[ve]=Object.assign(ke,ce)}await P.sender.setParameters(le)}const re=P.mid;if(r.mid=re,j=u.parse(this._pc.localDescription.sdp),O=j.media[y.idx],r.rtcp.cname=e.getCname({offerMediaObject:O}),r.encodings=g.getRtpEncodings({offerMediaObject:O}),i)for(let le=0;le<r.encodings.length;++le)i[le]&&Object.assign(r.encodings[le],i[le]);if(B&&(r.encodings=[r.encodings[0]]),r.encodings.length>1&&(r.codecs[0].mimeType.toLowerCase()==="video/vp8"||r.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const le of r.encodings)le.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:O,reuseMid:y.reuseMid,offerRtpParameters:r,answerRtpParameters:a,codecOptions:t});const oe={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",oe),await this._pc.setRemoteDescription(oe),this._mapMidTransceiver.set(re,P),{localId:re,rtpParameters:r,rtpSender:P.sender}}async stopSending(s){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",s);const i=this._mapMidTransceiver.get(s);if(!i)throw new Error("associated RTCRtpTransceiver not found");if(i.sender.replaceTrack(null),this._pc.removeTrack(i.sender),this._remoteSdp.closeMediaSection(i.mid))try{i.stop()}catch{}const t=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.delete(s)}async pauseSending(s){}async resumeSending(s){}async replaceTrack(s,i){this.assertSendDirection(),i?b.debug("replaceTrack() [localId:%s, track.id:%s]",s,i.id):b.debug("replaceTrack() [localId:%s, no track]",s);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated RTCRtpTransceiver not found");await t.sender.replaceTrack(i)}async setMaxSpatialLayer(s,i){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",s,i);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated RTCRtpTransceiver not found");const n=t.sender.getParameters();n.encodings.forEach((y,P)=>{y.active=P<=i}),await t.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(s,n.encodings);const r=await this._pc.createOffer();b.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async setRtpEncodingParameters(s,i){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",s,i);const t=this._mapMidTransceiver.get(s);if(!t)throw new Error("associated RTCRtpTransceiver not found");const n=t.sender.getParameters();n.encodings.forEach((y,P)=>{n.encodings[P]={...y,...i}}),await t.sender.setParameters(n),this._remoteSdp.muxMediaSectionSimulcast(s,n.encodings);const r=await this._pc.createOffer();b.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async getSenderStats(s){this.assertSendDirection();const i=this._mapMidTransceiver.get(s);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.sender.getStats()}async sendDataChannel({ordered:s,maxPacketLifeTime:i,maxRetransmits:t,label:n,protocol:r}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:s,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:t,protocol:r};b.debug("sendDataChannel() [options:%o]",a);const y=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%p.MIS,!this._hasDataChannelMediaSection){const P=await this._pc.createOffer(),O=u.parse(P.sdp),M=O.media.find(B=>B.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),await this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:M});const j={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:y,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(s){this.assertRecvDirection();const i=[],t=new Map;for(const y of s){const{trackId:P,kind:O,rtpParameters:M,streamId:j}=y;b.debug("receive() [trackId:%s, kind:%s]",P,O);const B=M.mid||String(this._mapMidTransceiver.size);t.set(P,B),this._remoteSdp.receive({mid:B,kind:O,offerRtpParameters:M,streamId:j||M.rtcp.cname,trackId:P})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let r=await this._pc.createAnswer();const a=u.parse(r.sdp);for(const y of s){const{trackId:P,rtpParameters:O}=y,M=t.get(P),j=a.media.find(B=>String(B.mid)===M);e.applyCodecParameters({offerRtpParameters:O,answerMediaObject:j})}r={type:"answer",sdp:u.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const y of s){const{trackId:P}=y,O=t.get(P),M=this._pc.getTransceivers().find(j=>j.mid===O);if(!M)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(O,M),i.push({localId:O,track:M.receiver.track,rtpReceiver:M.receiver})}return i}async stopReceiving(s){this.assertRecvDirection();for(const n of s){b.debug("stopReceiving() [localId:%s]",n);const r=this._mapMidTransceiver.get(n);if(!r)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(r.mid)}const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const t=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const n of s)this._mapMidTransceiver.delete(n)}async pauseReceiving(s){}async resumeReceiving(s){}async getReceiverStats(s){this.assertRecvDirection();const i=this._mapMidTransceiver.get(s);if(!i)throw new Error("associated RTCRtpTransceiver not found");return i.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:s,label:i,protocol:t}){this.assertRecvDirection();const{streamId:n,ordered:r,maxPacketLifeTime:a,maxRetransmits:y}=s,P={negotiated:!0,id:n,ordered:r,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:y,protocol:t};b.debug("receiveDataChannel() [options:%o]",P);const O=this._pc.createDataChannel(i,P);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const M={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const j=await this._pc.createAnswer();if(!this._transportReady){const B=u.parse(j.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:B})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setLocalDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:O}}async setupTransport({localDtlsRole:s,localSdpObject:i}){i||(i=u.parse(this._pc.localDescription.sdp));const t=e.extractDtlsParameters({sdpObject:i});t.role=s,this._remoteSdp.updateDtlsRole(s==="client"?"server":"client"),await new Promise((n,r)=>{this.safeEmit("@connect",{dtlsParameters:t},n,r)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Chrome70=m},11:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(i,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(i,r,a)}:function(i,t,n,r){r===void 0&&(r=n),i[r]=t[n]}),S=this&&this.__setModuleDefault||(Object.create?function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}:function(i,t){i.default=t}),d=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var n in i)n!=="default"&&Object.prototype.hasOwnProperty.call(i,n)&&k(t,i,n);return S(t,i),t};Object.defineProperty(C,"__esModule",{value:!0}),C.Chrome74=void 0;const u=d(l(7363)),f=l(2994),o=d(l(1765)),c=d(l(8046)),e=d(l(5544)),g=d(l(5938)),h=d(l(4256)),v=l(4893),_=l(521),b=l(1305),p=l(3303),m=new f.Logger("Chrome74"),E={OS:1024,MIS:1024};class s extends _.HandlerInterface{static createFactory(){return()=>new s}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(m.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const n=await t.createOffer();try{t.close()}catch{}const r=u.parse(n.sdp),a=e.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(a),a}catch(n){try{t.close()}catch{}throw n}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:E}}run({direction:t,iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y,iceServers:P,iceTransportPolicy:O,additionalSettings:M,proprietaryConstraints:j,extendedRtpCapabilities:B}){m.debug("run()"),this._direction=t,this._remoteSdp=new b.RemoteSdp({iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",B),video:c.getSendingRtpParameters("video",B)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",B),video:c.getSendingRemoteRtpParameters("video",B)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P||[],iceTransportPolicy:O||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...M},j),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(t){this.assertNotClosed(),m.debug("updateIceServers()");const n=this._pc.getConfiguration();n.iceServers=t,this._pc.setConfiguration(n)}async restartIce(t){if(this.assertNotClosed(),m.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady)if(this._direction==="send"){const n=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:n,codecOptions:r,codec:a}){this.assertNotClosed(),this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),n&&n.length>1&&n.forEach((ke,ce)=>{ke.rid=`r${ce}`});const y=o.clone(this._sendingRtpParametersByKind[t.kind]);y.codecs=c.reduceCodecs(y.codecs,a);const P=o.clone(this._sendingRemoteRtpParametersByKind[t.kind]);P.codecs=c.reduceCodecs(P.codecs,a);const O=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:n});let j,B=await this._pc.createOffer(),Q=u.parse(B.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Q});let re=!1;const oe=(0,p.parse)((n||[{}])[0].scalabilityMode);n&&n.length===1&&oe.spatialLayers>1&&y.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(m.debug("send() | enabling legacy simulcast for VP9 SVC"),re=!0,Q=u.parse(B.sdp),j=Q.media[O.idx],g.addLegacySimulcast({offerMediaObject:j,numStreams:oe.spatialLayers}),B={type:"offer",sdp:u.write(Q)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",B),await this._pc.setLocalDescription(B);const le=M.mid;if(y.mid=le,Q=u.parse(this._pc.localDescription.sdp),j=Q.media[O.idx],y.rtcp.cname=e.getCname({offerMediaObject:j}),n)if(n.length===1){let ke=g.getRtpEncodings({offerMediaObject:j});Object.assign(ke[0],n[0]),re&&(ke=[ke[0]]),y.encodings=ke}else y.encodings=n;else y.encodings=g.getRtpEncodings({offerMediaObject:j});if(y.encodings.length>1&&(y.codecs[0].mimeType.toLowerCase()==="video/vp8"||y.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ke of y.encodings)ke.scalabilityMode?ke.scalabilityMode=`L1T${oe.temporalLayers}`:ke.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:j,reuseMid:O.reuseMid,offerRtpParameters:y,answerRtpParameters:P,codecOptions:r,extmapAllowMixed:!0});const ve={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ve),await this._pc.setRemoteDescription(ve),this._mapMidTransceiver.set(le,M),{localId:le,rtpParameters:y,rtpSender:M.sender}}async stopSending(t){if(this.assertSendDirection(),m.debug("stopSending() [localId:%s]",t),this._closed)return;const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");if(n.sender.replaceTrack(null),this._pc.removeTrack(n.sender),this._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch{}const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("pauseSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(t);const r=await this._pc.createOffer();m.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("resumeSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="sendonly";const r=await this._pc.createOffer();m.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,n){this.assertNotClosed(),this.assertSendDirection(),n?m.debug("replaceTrack() [localId:%s, track.id:%s]",t,n.id):m.debug("replaceTrack() [localId:%s, no track]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(n)}async setMaxSpatialLayer(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{O.active=M<=n}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{a.encodings[M]={...O,...n}}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:n,maxRetransmits:r,label:a,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:n,maxRetransmits:r,protocol:y};m.debug("sendDataChannel() [options:%o]",P);const O=this._pc.createDataChannel(a,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),j=u.parse(M.sdp),B=j.media.find(re=>re.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:B});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:O,sctpStreamParameters:{streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits}}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const n=[],r=new Map;for(const O of t){const{trackId:M,kind:j,rtpParameters:B,streamId:Q}=O;m.debug("receive() [trackId:%s, kind:%s]",M,j);const re=B.mid||String(this._mapMidTransceiver.size);r.set(M,re),this._remoteSdp.receive({mid:re,kind:j,offerRtpParameters:B,streamId:Q||B.rtcp.cname,trackId:M})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let y=await this._pc.createAnswer();const P=u.parse(y.sdp);for(const O of t){const{trackId:M,rtpParameters:j}=O,B=r.get(M),Q=P.media.find(re=>String(re.mid)===B);e.applyCodecParameters({offerRtpParameters:j,answerMediaObject:Q})}y={type:"answer",sdp:u.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const O of t){const{trackId:M}=O,j=r.get(M),B=this._pc.getTransceivers().find(Q=>Q.mid===j);if(!B)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(j,B),n.push({localId:j,track:B.receiver.track,rtpReceiver:B.receiver})}return n}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){m.debug("stopReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("pauseReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("resumeReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:n,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O}=t,M={negotiated:!0,id:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O,protocol:r};m.debug("receiveDataChannel() [options:%o]",M);const j=this._pc.createDataChannel(n,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const B={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",B),await this._pc.setRemoteDescription(B);const Q=await this._pc.createAnswer();if(!this._transportReady){const re=u.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:re})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:j}}async setupTransport({localDtlsRole:t,localSdpObject:n}){n||(n=u.parse(this._pc.localDescription.sdp));const r=e.extractDtlsParameters({sdpObject:n});r.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,y)=>{this.safeEmit("@connect",{dtlsParameters:r},a,y)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new v.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Chrome74=s},8633:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(_,b,p,m){m===void 0&&(m=p);var E=Object.getOwnPropertyDescriptor(b,p);E&&!("get"in E?!b.__esModule:E.writable||E.configurable)||(E={enumerable:!0,get:function(){return b[p]}}),Object.defineProperty(_,m,E)}:function(_,b,p,m){m===void 0&&(m=p),_[m]=b[p]}),S=this&&this.__setModuleDefault||(Object.create?function(_,b){Object.defineProperty(_,"default",{enumerable:!0,value:b})}:function(_,b){_.default=b}),d=this&&this.__importStar||function(_){if(_&&_.__esModule)return _;var b={};if(_!=null)for(var p in _)p!=="default"&&Object.prototype.hasOwnProperty.call(_,p)&&k(b,_,p);return S(b,_),b};Object.defineProperty(C,"__esModule",{value:!0}),C.Edge11=void 0;const u=l(2994),f=l(4893),o=d(l(1765)),c=d(l(8046)),e=d(l(8751)),g=l(521),h=new u.Logger("Edge11");class v extends g.HandlerInterface{static createFactory(){return()=>new v}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){h.debug("close()");try{this._iceGatherer.close()}catch{}try{this._iceTransport.stop()}catch{}try{this._dtlsTransport.stop()}catch{}for(const b of this._rtpSenders.values())try{b.stop()}catch{}for(const b of this._rtpReceivers.values())try{b.stop()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){return h.debug("getNativeRtpCapabilities()"),e.getCapabilities()}async getNativeSctpCapabilities(){return h.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({direction:b,iceParameters:p,iceCandidates:m,dtlsParameters:E,sctpParameters:s,iceServers:i,iceTransportPolicy:t,additionalSettings:n,proprietaryConstraints:r,extendedRtpCapabilities:a}){h.debug("run()"),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",a),video:c.getSendingRtpParameters("video",a)},this._remoteIceParameters=p,this._remoteIceCandidates=m,this._remoteDtlsParameters=E,this._cname=`CNAME-${o.generateRandomNumber()}`,this.setIceGatherer({iceServers:i,iceTransportPolicy:t}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(b){throw new f.UnsupportedError("not supported")}async restartIce(b){if(h.debug("restartIce()"),this._remoteIceParameters=b,this._transportReady){h.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,b,"controlling");for(const p of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(p);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:b,encodings:p,codecOptions:m,codec:E}){h.debug("send() [kind:%s, track.id:%s]",b.kind,b.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),h.debug("send() | calling new RTCRtpSender()");const s=new RTCRtpSender(b,this._dtlsTransport),i=o.clone(this._sendingRtpParametersByKind[b.kind]);i.codecs=c.reduceCodecs(i.codecs,E);const t=i.codecs.some(a=>/.+\/rtx$/i.test(a.mimeType));p||(p=[{}]);for(const a of p)a.ssrc=o.generateRandomNumber(),t&&(a.rtx={ssrc:o.generateRandomNumber()});i.encodings=p,i.rtcp={cname:this._cname,reducedSize:!0,mux:!0};const n=e.mangleRtpParameters(i);h.debug("send() | calling rtpSender.send() [params:%o]",n),await s.send(n);const r=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(r,s),{localId:r,rtpParameters:i,rtpSender:s}}async stopSending(b){h.debug("stopSending() [localId:%s]",b);const p=this._rtpSenders.get(b);if(!p)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(b);try{h.debug("stopSending() | calling rtpSender.stop()"),p.stop()}catch(m){throw h.warn("stopSending() | rtpSender.stop() failed:%o",m),m}}async pauseSending(b){}async resumeSending(b){}async replaceTrack(b,p){p?h.debug("replaceTrack() [localId:%s, track.id:%s]",b,p.id):h.debug("replaceTrack() [localId:%s, no track]",b);const m=this._rtpSenders.get(b);if(!m)throw new Error("RTCRtpSender not found");m.setTrack(p)}async setMaxSpatialLayer(b,p){h.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",b,p);const m=this._rtpSenders.get(b);if(!m)throw new Error("RTCRtpSender not found");const E=m.getParameters();E.encodings.forEach((s,i)=>{s.active=i<=p}),await m.setParameters(E)}async setRtpEncodingParameters(b,p){h.debug("setRtpEncodingParameters() [localId:%s, params:%o]",b,p);const m=this._rtpSenders.get(b);if(!m)throw new Error("RTCRtpSender not found");const E=m.getParameters();E.encodings.forEach((s,i)=>{E.encodings[i]={...s,...p}}),await m.setParameters(E)}async getSenderStats(b){const p=this._rtpSenders.get(b);if(!p)throw new Error("RTCRtpSender not found");return p.getStats()}async sendDataChannel(b){throw new f.UnsupportedError("not implemented")}async receive(b){const p=[];for(const m of b){const{trackId:E,kind:s}=m;h.debug("receive() [trackId:%s, kind:%s]",E,s)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const m of b){const{trackId:E,kind:s,rtpParameters:i}=m;h.debug("receive() | calling new RTCRtpReceiver()");const t=new RTCRtpReceiver(this._dtlsTransport,s);t.addEventListener("error",a=>{h.error('rtpReceiver "error" event [event:%o]',a)});const n=e.mangleRtpParameters(i);h.debug("receive() | calling rtpReceiver.receive() [params:%o]",n),await t.receive(n);const r=E;this._rtpReceivers.set(r,t),p.push({localId:r,track:t.track,rtpReceiver:t})}return p}async stopReceiving(b){for(const p of b){h.debug("stopReceiving() [localId:%s]",p);const m=this._rtpReceivers.get(p);if(!m)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(p);try{h.debug("stopReceiving() | calling rtpReceiver.stop()"),m.stop()}catch(E){h.warn("stopReceiving() | rtpReceiver.stop() failed:%o",E)}}}async pauseReceiving(b){}async resumeReceiving(b){}async getReceiverStats(b){const p=this._rtpReceivers.get(b);if(!p)throw new Error("RTCRtpReceiver not found");return p.getStats()}async receiveDataChannel(b){throw new f.UnsupportedError("not implemented")}setIceGatherer({iceServers:b,iceTransportPolicy:p}){const m=new RTCIceGatherer({iceServers:b||[],gatherPolicy:p||"all"});m.addEventListener("error",E=>{h.error('iceGatherer "error" event [event:%o]',E)});try{m.gather()}catch(E){h.debug("setIceGatherer() | iceGatherer.gather() failed: %s",E.toString())}this._iceGatherer=m}setIceTransport(){const b=new RTCIceTransport(this._iceGatherer);b.addEventListener("statechange",()=>{switch(b.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),b.addEventListener("icestatechange",()=>{switch(b.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),b.addEventListener("candidatepairchange",p=>{h.debug('iceTransport "candidatepairchange" event [pair:%o]',p.pair)}),this._iceTransport=b}setDtlsTransport(){const b=new RTCDtlsTransport(this._iceTransport);b.addEventListener("statechange",()=>{h.debug('dtlsTransport "statechange" event [state:%s]',b.state)}),b.addEventListener("dtlsstatechange",()=>{h.debug('dtlsTransport "dtlsstatechange" event [state:%s]',b.state),b.state==="closed"&&this.emit("@connectionstatechange","closed")}),b.addEventListener("error",p=>{h.error('dtlsTransport "error" event [event:%o]',p)}),this._dtlsTransport=b}async setupTransport({localDtlsRole:b}){h.debug("setupTransport()");const p=this._dtlsTransport.getLocalParameters();p.role=b,await new Promise((m,E)=>{this.safeEmit("@connect",{dtlsParameters:p},m,E)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const m of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(m);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(m=>m.algorithm==="sha-256"||m.algorithm==="sha-384"||m.algorithm==="sha-512"),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}C.Edge11=v},2292:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(s,i,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(i,t);r&&!("get"in r?!i.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return i[t]}}),Object.defineProperty(s,n,r)}:function(s,i,t,n){n===void 0&&(n=t),s[n]=i[t]}),S=this&&this.__setModuleDefault||(Object.create?function(s,i){Object.defineProperty(s,"default",{enumerable:!0,value:i})}:function(s,i){s.default=i}),d=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(s!=null)for(var t in s)t!=="default"&&Object.prototype.hasOwnProperty.call(s,t)&&k(i,s,t);return S(i,s),i};Object.defineProperty(C,"__esModule",{value:!0}),C.Firefox120=void 0;const u=d(l(7363)),f=l(2994),o=l(4893),c=d(l(1765)),e=d(l(8046)),g=d(l(5544)),h=d(l(5938)),v=l(521),_=l(1305),b=l(3303),p=new f.Logger("Firefox120"),m={OS:16,MIS:2048};class E extends v.HandlerInterface{static createFactory(){return()=>new E}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox120"}close(){if(p.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){p.debug("getNativeRtpCapabilities()");const i=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const n=t.captureStream().getVideoTracks()[0];try{i.addTransceiver("audio",{direction:"sendrecv"}),i.addTransceiver(n,{direction:"sendrecv",sendEncodings:[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}]});const r=await i.createOffer();try{t.remove()}catch{}try{n.stop()}catch{}try{i.close()}catch{}const a=u.parse(r.sdp);return g.extractRtpCapabilities({sdpObject:a})}catch(r){try{t.remove()}catch{}try{n.stop()}catch{}try{i.close()}catch{}throw r}}async getNativeSctpCapabilities(){return p.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:i,iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:a,iceServers:y,iceTransportPolicy:P,additionalSettings:O,proprietaryConstraints:M,extendedRtpCapabilities:j}){this.assertNotClosed(),p.debug("run()"),this._direction=i,this._remoteSdp=new _.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:a}),this._sendingRtpParametersByKind={audio:e.getSendingRtpParameters("audio",j),video:e.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:e.getSendingRemoteRtpParameters("audio",j),video:e.getSendingRemoteRtpParameters("video",j)},this._pc=new RTCPeerConnection({iceServers:y||[],iceTransportPolicy:P||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...O},M),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(i){throw this.assertNotClosed(),new o.UnsupportedError("not supported")}async restartIce(i){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(i),this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:i,encodings:t,codecOptions:n,codec:r}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s]",i.kind,i.id),t&&t.length>1&&t.forEach((oe,le)=>{oe.rid=`r${le}`});const a=c.clone(this._sendingRtpParametersByKind[i.kind]);a.codecs=e.reduceCodecs(a.codecs,r);const y=c.clone(this._sendingRemoteRtpParametersByKind[i.kind]);y.codecs=e.reduceCodecs(y.codecs,r);const P=this._pc.addTransceiver(i,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t}),O=await this._pc.createOffer();let M=u.parse(O.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M});const j=(0,b.parse)((t||[{}])[0].scalabilityMode);p.debug("send() | calling pc.setLocalDescription() [offer:%o]",O),await this._pc.setLocalDescription(O);const B=P.mid;a.mid=B,M=u.parse(this._pc.localDescription.sdp);const Q=M.media[M.media.length-1];if(a.rtcp.cname=g.getCname({offerMediaObject:Q}),t)if(t.length===1){const oe=h.getRtpEncodings({offerMediaObject:Q});Object.assign(oe[0],t[0]),a.encodings=oe}else a.encodings=t;else a.encodings=h.getRtpEncodings({offerMediaObject:Q});if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const oe of a.encodings)oe.scalabilityMode?oe.scalabilityMode=`L1T${j.temporalLayers}`:oe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:Q,offerRtpParameters:a,answerRtpParameters:y,codecOptions:n,extmapAllowMixed:!0});const re={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",re),await this._pc.setRemoteDescription(re),this._mapMidTransceiver.set(B,P),{localId:B,rtpParameters:a,rtpSender:P.sender}}async stopSending(i){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",i),this._closed)return;const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const n=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._mapMidTransceiver.delete(i)}async pauseSending(i){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",i);const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(i);const n=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async resumeSending(i){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",i);const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(i);const n=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(i,t){this.assertNotClosed(),this.assertSendDirection(),t?p.debug("replaceTrack() [localId:%s, track.id:%s]",i,t.id):p.debug("replaceTrack() [localId:%s, no track]",i);const n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(i,t){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",i,t);const n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated transceiver not found");const r=n.sender.getParameters();r.encodings.forEach((P,O)=>{P.active=O<=t}),await n.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(i,r.encodings);const a=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const y={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async setRtpEncodingParameters(i,t){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",i,t);const n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");const r=n.sender.getParameters();r.encodings.forEach((P,O)=>{r.encodings[O]={...P,...t}}),await n.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(i,r.encodings);const a=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const y={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async getSenderStats(i){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:i,maxPacketLifeTime:t,maxRetransmits:n,label:r,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const y={negotiated:!0,id:this._nextSendSctpStreamId,ordered:i,maxPacketLifeTime:t,maxRetransmits:n,protocol:a};p.debug("sendDataChannel() [options:%o]",y);const P=this._pc.createDataChannel(r,y);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const O=await this._pc.createOffer(),M=u.parse(O.sdp),j=M.media.find(Q=>Q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",O),await this._pc.setLocalDescription(O),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const B={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",B),await this._pc.setRemoteDescription(B),this._hasDataChannelMediaSection=!0}return{dataChannel:P,sctpStreamParameters:{streamId:y.id,ordered:y.ordered,maxPacketLifeTime:y.maxPacketLifeTime,maxRetransmits:y.maxRetransmits}}}async receive(i){this.assertNotClosed(),this.assertRecvDirection();const t=[],n=new Map;for(const P of i){const{trackId:O,kind:M,rtpParameters:j,streamId:B}=P;p.debug("receive() [trackId:%s, kind:%s]",O,M);const Q=j.mid||String(this._mapMidTransceiver.size);n.set(O,Q),this._remoteSdp.receive({mid:Q,kind:M,offerRtpParameters:j,streamId:B||j.rtcp.cname,trackId:O})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let a=await this._pc.createAnswer();const y=u.parse(a.sdp);for(const P of i){const{trackId:O,rtpParameters:M}=P,j=n.get(O),B=y.media.find(Q=>String(Q.mid)===j);g.applyCodecParameters({offerRtpParameters:M,answerMediaObject:B}),a={type:"answer",sdp:u.write(y)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:y}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const P of i){const{trackId:O}=P,M=n.get(O),j=this._pc.getTransceivers().find(B=>B.mid===M);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(M,j),t.push({localId:M,track:j.receiver.track,rtpReceiver:j.receiver})}return t}async stopReceiving(i){if(this.assertRecvDirection(),this._closed)return;for(const r of i){p.debug("stopReceiving() [localId:%s]",r);const a=this._mapMidTransceiver.get(r);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const r of i)this._mapMidTransceiver.delete(r)}async pauseReceiving(i){this.assertNotClosed(),this.assertRecvDirection();for(const r of i){p.debug("pauseReceiving() [localId:%s]",r);const a=this._mapMidTransceiver.get(r);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(i){this.assertNotClosed(),this.assertRecvDirection();for(const r of i){p.debug("resumeReceiving() [localId:%s]",r);const a=this._mapMidTransceiver.get(r);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(i){this.assertRecvDirection();const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:i,label:t,protocol:n}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:r,ordered:a,maxPacketLifeTime:y,maxRetransmits:P}=i,O={negotiated:!0,id:r,ordered:a,maxPacketLifeTime:y,maxRetransmits:P,protocol:n};p.debug("receiveDataChannel() [options:%o]",O);const M=this._pc.createDataChannel(t,O);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),await this._pc.setRemoteDescription(j);const B=await this._pc.createAnswer();if(!this._transportReady){const Q=u.parse(B.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:Q})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",B),await this._pc.setLocalDescription(B),this._hasDataChannelMediaSection=!0}return{dataChannel:M}}async setupTransport({localDtlsRole:i,localSdpObject:t}){t||(t=u.parse(this._pc.localDescription.sdp));const n=g.extractDtlsParameters({sdpObject:t});n.role=i,this._remoteSdp.updateDtlsRole(i==="client"?"server":"client"),await new Promise((r,a)=>{this.safeEmit("@connect",{dtlsParameters:n},r,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new o.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Firefox120=E},1767:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(s,i,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(i,t);r&&!("get"in r?!i.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return i[t]}}),Object.defineProperty(s,n,r)}:function(s,i,t,n){n===void 0&&(n=t),s[n]=i[t]}),S=this&&this.__setModuleDefault||(Object.create?function(s,i){Object.defineProperty(s,"default",{enumerable:!0,value:i})}:function(s,i){s.default=i}),d=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(s!=null)for(var t in s)t!=="default"&&Object.prototype.hasOwnProperty.call(s,t)&&k(i,s,t);return S(i,s),i};Object.defineProperty(C,"__esModule",{value:!0}),C.Firefox60=void 0;const u=d(l(7363)),f=l(2994),o=l(4893),c=d(l(1765)),e=d(l(8046)),g=d(l(5544)),h=d(l(5938)),v=l(521),_=l(1305),b=l(3303),p=new f.Logger("Firefox60"),m={OS:16,MIS:2048};class E extends v.HandlerInterface{static createFactory(){return()=>new E}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(p.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){p.debug("getNativeRtpCapabilities()");const i=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");const n=t.captureStream().getVideoTracks()[0];try{i.addTransceiver("audio",{direction:"sendrecv"});const r=i.addTransceiver(n,{direction:"sendrecv"}),a=r.sender.getParameters(),y=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}];a.encodings=y,await r.sender.setParameters(a);const P=await i.createOffer();try{t.remove()}catch{}try{n.stop()}catch{}try{i.close()}catch{}const O=u.parse(P.sdp);return g.extractRtpCapabilities({sdpObject:O})}catch(r){try{t.remove()}catch{}try{n.stop()}catch{}try{i.close()}catch{}throw r}}async getNativeSctpCapabilities(){return p.debug("getNativeSctpCapabilities()"),{numStreams:m}}run({direction:i,iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:a,iceServers:y,iceTransportPolicy:P,additionalSettings:O,proprietaryConstraints:M,extendedRtpCapabilities:j}){this.assertNotClosed(),p.debug("run()"),this._direction=i,this._remoteSdp=new _.RemoteSdp({iceParameters:t,iceCandidates:n,dtlsParameters:r,sctpParameters:a}),this._sendingRtpParametersByKind={audio:e.getSendingRtpParameters("audio",j),video:e.getSendingRtpParameters("video",j)},this._sendingRemoteRtpParametersByKind={audio:e.getSendingRemoteRtpParameters("audio",j),video:e.getSendingRemoteRtpParameters("video",j)},this._pc=new RTCPeerConnection({iceServers:y||[],iceTransportPolicy:P||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...O},M),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(p.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(i){throw this.assertNotClosed(),new o.UnsupportedError("not supported")}async restartIce(i){if(this.assertNotClosed(),p.debug("restartIce()"),this._remoteSdp.updateIceParameters(i),this._transportReady)if(this._direction==="send"){const t=await this._pc.createOffer({iceRestart:!0});p.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t);const n={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}else{const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:i,encodings:t,codecOptions:n,codec:r}){this.assertNotClosed(),this.assertSendDirection(),p.debug("send() [kind:%s, track.id:%s]",i.kind,i.id),t&&(t=c.clone(t)).length>1&&(t.forEach((oe,le)=>{oe.rid=`r${le}`}),t.reverse());const a=c.clone(this._sendingRtpParametersByKind[i.kind]);a.codecs=e.reduceCodecs(a.codecs,r);const y=c.clone(this._sendingRemoteRtpParametersByKind[i.kind]);y.codecs=e.reduceCodecs(y.codecs,r);const P=this._pc.addTransceiver(i,{direction:"sendonly",streams:[this._sendStream]});if(t){const oe=P.sender.getParameters();oe.encodings=t,await P.sender.setParameters(oe)}const O=await this._pc.createOffer();let M=u.parse(O.sdp);this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M});const j=(0,b.parse)((t||[{}])[0].scalabilityMode);p.debug("send() | calling pc.setLocalDescription() [offer:%o]",O),await this._pc.setLocalDescription(O);const B=P.mid;a.mid=B,M=u.parse(this._pc.localDescription.sdp);const Q=M.media[M.media.length-1];if(a.rtcp.cname=g.getCname({offerMediaObject:Q}),t)if(t.length===1){const oe=h.getRtpEncodings({offerMediaObject:Q});Object.assign(oe[0],t[0]),a.encodings=oe}else a.encodings=t.reverse();else a.encodings=h.getRtpEncodings({offerMediaObject:Q});if(a.encodings.length>1&&(a.codecs[0].mimeType.toLowerCase()==="video/vp8"||a.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const oe of a.encodings)oe.scalabilityMode?oe.scalabilityMode=`L1T${j.temporalLayers}`:oe.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:Q,offerRtpParameters:a,answerRtpParameters:y,codecOptions:n,extmapAllowMixed:!0});const re={type:"answer",sdp:this._remoteSdp.getSdp()};return p.debug("send() | calling pc.setRemoteDescription() [answer:%o]",re),await this._pc.setRemoteDescription(re),this._mapMidTransceiver.set(B,P),{localId:B,rtpParameters:a,rtpSender:P.sender}}async stopSending(i){if(this.assertSendDirection(),p.debug("stopSending() [localId:%s]",i),this._closed)return;const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);const n=await this._pc.createOffer();p.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r),this._mapMidTransceiver.delete(i)}async pauseSending(i){this.assertNotClosed(),this.assertSendDirection(),p.debug("pauseSending() [localId:%s]",i);const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(i);const n=await this._pc.createOffer();p.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async resumeSending(i){this.assertNotClosed(),this.assertSendDirection(),p.debug("resumeSending() [localId:%s]",i);const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(i);const n=await this._pc.createOffer();p.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}async replaceTrack(i,t){this.assertNotClosed(),this.assertSendDirection(),t?p.debug("replaceTrack() [localId:%s, track.id:%s]",i,t.id):p.debug("replaceTrack() [localId:%s, no track]",i);const n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");await n.sender.replaceTrack(t)}async setMaxSpatialLayer(i,t){this.assertNotClosed(),this.assertSendDirection(),p.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",i,t);const n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated transceiver not found");const r=n.sender.getParameters();t=r.encodings.length-1-t,r.encodings.forEach((P,O)=>{P.active=O>=t}),await n.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(i,r.encodings);const a=await this._pc.createOffer();p.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const y={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async setRtpEncodingParameters(i,t){this.assertNotClosed(),this.assertSendDirection(),p.debug("setRtpEncodingParameters() [localId:%s, params:%o]",i,t);const n=this._mapMidTransceiver.get(i);if(!n)throw new Error("associated RTCRtpTransceiver not found");const r=n.sender.getParameters();r.encodings.forEach((P,O)=>{r.encodings[O]={...P,...t}}),await n.sender.setParameters(r),this._remoteSdp.muxMediaSectionSimulcast(i,r.encodings);const a=await this._pc.createOffer();p.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a);const y={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",y),await this._pc.setRemoteDescription(y)}async getSenderStats(i){this.assertNotClosed(),this.assertSendDirection();const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.sender.getStats()}async sendDataChannel({ordered:i,maxPacketLifeTime:t,maxRetransmits:n,label:r,protocol:a}){this.assertNotClosed(),this.assertSendDirection();const y={negotiated:!0,id:this._nextSendSctpStreamId,ordered:i,maxPacketLifeTime:t,maxRetransmits:n,protocol:a};p.debug("sendDataChannel() [options:%o]",y);const P=this._pc.createDataChannel(r,y);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%m.MIS,!this._hasDataChannelMediaSection){const O=await this._pc.createOffer(),M=u.parse(O.sdp),j=M.media.find(Q=>Q.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:M}),p.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",O),await this._pc.setLocalDescription(O),this._remoteSdp.sendSctpAssociation({offerMediaObject:j});const B={type:"answer",sdp:this._remoteSdp.getSdp()};p.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",B),await this._pc.setRemoteDescription(B),this._hasDataChannelMediaSection=!0}return{dataChannel:P,sctpStreamParameters:{streamId:y.id,ordered:y.ordered,maxPacketLifeTime:y.maxPacketLifeTime,maxRetransmits:y.maxRetransmits}}}async receive(i){this.assertNotClosed(),this.assertRecvDirection();const t=[],n=new Map;for(const P of i){const{trackId:O,kind:M,rtpParameters:j,streamId:B}=P;p.debug("receive() [trackId:%s, kind:%s]",O,M);const Q=j.mid||String(this._mapMidTransceiver.size);n.set(O,Q),this._remoteSdp.receive({mid:Q,kind:M,offerRtpParameters:j,streamId:B||j.rtcp.cname,trackId:O})}const r={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r);let a=await this._pc.createAnswer();const y=u.parse(a.sdp);for(const P of i){const{trackId:O,rtpParameters:M}=P,j=n.get(O),B=y.media.find(Q=>String(Q.mid)===j);g.applyCodecParameters({offerRtpParameters:M,answerMediaObject:B}),a={type:"answer",sdp:u.write(y)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:y}),p.debug("receive() | calling pc.setLocalDescription() [answer:%o]",a),await this._pc.setLocalDescription(a);for(const P of i){const{trackId:O}=P,M=n.get(O),j=this._pc.getTransceivers().find(B=>B.mid===M);if(!j)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(M,j),t.push({localId:M,track:j.receiver.track,rtpReceiver:j.receiver})}return t}async stopReceiving(i){if(this.assertRecvDirection(),this._closed)return;for(const r of i){p.debug("stopReceiving() [localId:%s]",r);const a=this._mapMidTransceiver.get(r);if(!a)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(a.mid)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n);for(const r of i)this._mapMidTransceiver.delete(r)}async pauseReceiving(i){this.assertNotClosed(),this.assertRecvDirection();for(const r of i){p.debug("pauseReceiving() [localId:%s]",r);const a=this._mapMidTransceiver.get(r);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="inactive",this._remoteSdp.pauseMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async resumeReceiving(i){this.assertNotClosed(),this.assertRecvDirection();for(const r of i){p.debug("resumeReceiving() [localId:%s]",r);const a=this._mapMidTransceiver.get(r);if(!a)throw new Error("associated RTCRtpTransceiver not found");a.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}const t={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",t),await this._pc.setRemoteDescription(t);const n=await this._pc.createAnswer();p.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",n),await this._pc.setLocalDescription(n)}async getReceiverStats(i){this.assertRecvDirection();const t=this._mapMidTransceiver.get(i);if(!t)throw new Error("associated RTCRtpTransceiver not found");return t.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:i,label:t,protocol:n}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:r,ordered:a,maxPacketLifeTime:y,maxRetransmits:P}=i,O={negotiated:!0,id:r,ordered:a,maxPacketLifeTime:y,maxRetransmits:P,protocol:n};p.debug("receiveDataChannel() [options:%o]",O);const M=this._pc.createDataChannel(t,O);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const j={type:"offer",sdp:this._remoteSdp.getSdp()};p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",j),await this._pc.setRemoteDescription(j);const B=await this._pc.createAnswer();if(!this._transportReady){const Q=u.parse(B.sdp);await this.setupTransport({localDtlsRole:"client",localSdpObject:Q})}p.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",B),await this._pc.setLocalDescription(B),this._hasDataChannelMediaSection=!0}return{dataChannel:M}}async setupTransport({localDtlsRole:i,localSdpObject:t}){t||(t=u.parse(this._pc.localDescription.sdp));const n=g.extractDtlsParameters({sdpObject:t});n.role=i,this._remoteSdp.updateDtlsRole(i==="client"?"server":"client"),await new Promise((r,a)=>{this.safeEmit("@connect",{dtlsParameters:n},r,a)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new o.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Firefox60=E},521:(G,C,l)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.HandlerInterface=void 0;const k=l(2010);class S extends k.EnhancedEventEmitter{constructor(){super()}}C.HandlerInterface=S},9352:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(E,s,i,t){t===void 0&&(t=i);var n=Object.getOwnPropertyDescriptor(s,i);n&&!("get"in n?!s.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return s[i]}}),Object.defineProperty(E,t,n)}:function(E,s,i,t){t===void 0&&(t=i),E[t]=s[i]}),S=this&&this.__setModuleDefault||(Object.create?function(E,s){Object.defineProperty(E,"default",{enumerable:!0,value:s})}:function(E,s){E.default=s}),d=this&&this.__importStar||function(E){if(E&&E.__esModule)return E;var s={};if(E!=null)for(var i in E)i!=="default"&&Object.prototype.hasOwnProperty.call(E,i)&&k(s,E,i);return S(s,E),s};Object.defineProperty(C,"__esModule",{value:!0}),C.ReactNative=void 0;const u=d(l(7363)),f=l(2994),o=l(4893),c=d(l(1765)),e=d(l(8046)),g=d(l(5544)),h=d(l(4496)),v=l(521),_=l(1305),b=new f.Logger("ReactNative"),p={OS:1024,MIS:1024};class m extends v.HandlerInterface{static createFactory(){return()=>new m}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(b.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");const s=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const i=await s.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{s.close()}catch{}const t=u.parse(i.sdp);return g.extractRtpCapabilities({sdpObject:t})}catch(i){try{s.close()}catch{}throw i}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:p}}run({direction:s,iceParameters:i,iceCandidates:t,dtlsParameters:n,sctpParameters:r,iceServers:a,iceTransportPolicy:y,additionalSettings:P,proprietaryConstraints:O,extendedRtpCapabilities:M}){b.debug("run()"),this._direction=s,this._remoteSdp=new _.RemoteSdp({iceParameters:i,iceCandidates:t,dtlsParameters:n,sctpParameters:r,planB:!0}),this._sendingRtpParametersByKind={audio:e.getSendingRtpParameters("audio",M),video:e.getSendingRtpParameters("video",M)},this._sendingRemoteRtpParametersByKind={audio:e.getSendingRemoteRtpParameters("audio",M),video:e.getSendingRemoteRtpParameters("video",M)},n.role&&n.role!=="auto"&&(this._forcedLocalDtlsRole=n.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:a||[],iceTransportPolicy:y||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...P},O),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(s){b.debug("updateIceServers()");const i=this._pc.getConfiguration();i.iceServers=s,this._pc.setConfiguration(i)}async restartIce(s){if(b.debug("restartIce()"),this._remoteSdp.updateIceParameters(s),this._transportReady)if(this._direction==="send"){const i=await this._pc.createOffer({iceRestart:!0});b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);const t={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}else{const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const t=await this._pc.createAnswer();b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}}async getTransportStats(){return this._pc.getStats()}async send({track:s,encodings:i,codecOptions:t,codec:n}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",s.kind,s.id),n&&b.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(s),this._pc.addStream(this._sendStream);let r,a=await this._pc.createOffer(),y=u.parse(a.sdp);const P=c.clone(this._sendingRtpParametersByKind[s.kind]);P.codecs=e.reduceCodecs(P.codecs);const O=c.clone(this._sendingRemoteRtpParametersByKind[s.kind]);if(O.codecs=e.reduceCodecs(O.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:y}),s.kind==="video"&&i&&i.length>1&&(b.debug("send() | enabling simulcast"),y=u.parse(a.sdp),r=y.media.find(B=>B.type==="video"),h.addLegacySimulcast({offerMediaObject:r,track:s,numStreams:i.length}),a={type:"offer",sdp:u.write(y)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),y=u.parse(this._pc.localDescription.sdp),r=y.media.find(B=>B.type===s.kind),P.rtcp.cname=g.getCname({offerMediaObject:r}),P.encodings=h.getRtpEncodings({offerMediaObject:r,track:s}),i)for(let B=0;B<P.encodings.length;++B)i[B]&&Object.assign(P.encodings[B],i[B]);if(P.encodings.length>1&&(P.codecs[0].mimeType.toLowerCase()==="video/vp8"||P.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const B of P.encodings)B.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:r,offerRtpParameters:P,answerRtpParameters:O,codecOptions:t});const M={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M);const j=String(this._nextSendLocalId);return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(j,s),{localId:j,rtpParameters:P}}async stopSending(s){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",s);const i=this._mapSendLocalIdTrack.get(s);if(!i)throw new Error("track not found");this._mapSendLocalIdTrack.delete(s),this._sendStream.removeTrack(i),this._pc.addStream(this._sendStream);const t=await this._pc.createOffer();b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(r){if(this._sendStream.getTracks().length===0)return void b.warn("stopSending() | ignoring expected error due no sending tracks: %s",r.toString());throw r}if(this._pc.signalingState==="stable")return;const n={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n)}async pauseSending(s){}async resumeSending(s){}async replaceTrack(s,i){throw new o.UnsupportedError("not implemented")}async setMaxSpatialLayer(s,i){throw new o.UnsupportedError("not implemented")}async setRtpEncodingParameters(s,i){throw new o.UnsupportedError("not implemented")}async getSenderStats(s){throw new o.UnsupportedError("not implemented")}async sendDataChannel({ordered:s,maxPacketLifeTime:i,maxRetransmits:t,label:n,protocol:r}){this.assertSendDirection();const a={negotiated:!0,id:this._nextSendSctpStreamId,ordered:s,maxPacketLifeTime:i,maxRetransmitTime:i,maxRetransmits:t,protocol:r};b.debug("sendDataChannel() [options:%o]",a);const y=this._pc.createDataChannel(n,a);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%p.MIS,!this._hasDataChannelMediaSection){const P=await this._pc.createOffer(),O=u.parse(P.sdp),M=O.media.find(B=>B.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:O}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",P),await this._pc.setLocalDescription(P),this._remoteSdp.sendSctpAssociation({offerMediaObject:M});const j={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setRemoteDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:y,sctpStreamParameters:{streamId:a.id,ordered:a.ordered,maxPacketLifeTime:a.maxPacketLifeTime,maxRetransmits:a.maxRetransmits}}}async receive(s){this.assertRecvDirection();const i=[],t=new Map;for(const y of s){const{trackId:P,kind:O,rtpParameters:M}=y;b.debug("receive() [trackId:%s, kind:%s]",P,O);const j=O;let B=y.streamId||M.rtcp.cname;b.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),B+=`-hack-${c.generateRandomNumber()}`,t.set(P,B),this._remoteSdp.receive({mid:j,kind:O,offerRtpParameters:M,streamId:B,trackId:P})}const n={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);let r=await this._pc.createAnswer();const a=u.parse(r.sdp);for(const y of s){const{kind:P,rtpParameters:O}=y,M=P,j=a.media.find(B=>String(B.mid)===M);g.applyCodecParameters({offerRtpParameters:O,answerMediaObject:j})}r={type:"answer",sdp:u.write(a)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const y of s){const{kind:P,trackId:O,rtpParameters:M}=y,j=O,B=P,Q=t.get(O),re=this._pc.getRemoteStreams().find(oe=>oe.id===Q).getTrackById(j);if(!re)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(j,{mid:B,rtpParameters:M}),i.push({localId:j,track:re})}return i}async stopReceiving(s){this.assertRecvDirection();for(const n of s){b.debug("stopReceiving() [localId:%s]",n);const{mid:r,rtpParameters:a}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:r,offerRtpParameters:a})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);const t=await this._pc.createAnswer();b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t)}async pauseReceiving(s){}async resumeReceiving(s){}async getReceiverStats(s){throw new o.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:s,label:i,protocol:t}){this.assertRecvDirection();const{streamId:n,ordered:r,maxPacketLifeTime:a,maxRetransmits:y}=s,P={negotiated:!0,id:n,ordered:r,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:y,protocol:t};b.debug("receiveDataChannel() [options:%o]",P);const O=this._pc.createDataChannel(i,P);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const M={type:"offer",sdp:this._remoteSdp.getSdp()};b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",M),await this._pc.setRemoteDescription(M);const j=await this._pc.createAnswer();if(!this._transportReady){const B=u.parse(j.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:B})}b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",j),await this._pc.setLocalDescription(j),this._hasDataChannelMediaSection=!0}return{dataChannel:O}}async setupTransport({localDtlsRole:s,localSdpObject:i}){i||(i=u.parse(this._pc.localDescription.sdp));const t=g.extractDtlsParameters({sdpObject:i});t.role=s,this._remoteSdp.updateDtlsRole(s==="client"?"server":"client"),await new Promise((n,r)=>{this.safeEmit("@connect",{dtlsParameters:t},n,r)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.ReactNative=m},4039:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(i,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(i,r,a)}:function(i,t,n,r){r===void 0&&(r=n),i[r]=t[n]}),S=this&&this.__setModuleDefault||(Object.create?function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}:function(i,t){i.default=t}),d=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var n in i)n!=="default"&&Object.prototype.hasOwnProperty.call(i,n)&&k(t,i,n);return S(t,i),t};Object.defineProperty(C,"__esModule",{value:!0}),C.ReactNativeUnifiedPlan=void 0;const u=d(l(7363)),f=l(2994),o=d(l(1765)),c=d(l(8046)),e=d(l(5544)),g=d(l(5938)),h=d(l(4256)),v=l(4893),_=l(521),b=l(1305),p=l(3303),m=new f.Logger("ReactNativeUnifiedPlan"),E={OS:1024,MIS:1024};class s extends _.HandlerInterface{static createFactory(){return()=>new s}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(m.debug("close()"),!this._closed){if(this._closed=!0,this._sendStream.release(!1),this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");const n=await t.createOffer();try{t.close()}catch{}const r=u.parse(n.sdp),a=e.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(a),a}catch(n){try{t.close()}catch{}throw n}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:E}}run({direction:t,iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y,iceServers:P,iceTransportPolicy:O,additionalSettings:M,proprietaryConstraints:j,extendedRtpCapabilities:B}){this.assertNotClosed(),m.debug("run()"),this._direction=t,this._remoteSdp=new b.RemoteSdp({iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",B),video:c.getSendingRtpParameters("video",B)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",B),video:c.getSendingRemoteRtpParameters("video",B)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P||[],iceTransportPolicy:O||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...M},j),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(t){this.assertNotClosed(),m.debug("updateIceServers()");const n=this._pc.getConfiguration();n.iceServers=t,this._pc.setConfiguration(n)}async restartIce(t){if(this.assertNotClosed(),m.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady)if(this._direction==="send"){const n=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:n,codecOptions:r,codec:a}){this.assertNotClosed(),this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),n&&n.length>1&&n.forEach((ke,ce)=>{ke.rid=`r${ce}`});const y=o.clone(this._sendingRtpParametersByKind[t.kind]);y.codecs=c.reduceCodecs(y.codecs,a);const P=o.clone(this._sendingRemoteRtpParametersByKind[t.kind]);P.codecs=c.reduceCodecs(P.codecs,a);const O=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream],sendEncodings:n});let j,B=await this._pc.createOffer(),Q=u.parse(B.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Q});let re=!1;const oe=(0,p.parse)((n||[{}])[0].scalabilityMode);n&&n.length===1&&oe.spatialLayers>1&&y.codecs[0].mimeType.toLowerCase()==="video/vp9"&&(m.debug("send() | enabling legacy simulcast for VP9 SVC"),re=!0,Q=u.parse(B.sdp),j=Q.media[O.idx],g.addLegacySimulcast({offerMediaObject:j,numStreams:oe.spatialLayers}),B={type:"offer",sdp:u.write(Q)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",B),await this._pc.setLocalDescription(B);let le=M.mid??void 0;if(le||m.warn("send() | missing transceiver.mid (bug in react-native-webrtc, using a workaround"),y.mid=le,Q=u.parse(this._pc.localDescription.sdp),j=Q.media[O.idx],y.rtcp.cname=e.getCname({offerMediaObject:j}),n)if(n.length===1){let ke=g.getRtpEncodings({offerMediaObject:j});Object.assign(ke[0],n[0]),re&&(ke=[ke[0]]),y.encodings=ke}else y.encodings=n;else y.encodings=g.getRtpEncodings({offerMediaObject:j});if(y.encodings.length>1&&(y.codecs[0].mimeType.toLowerCase()==="video/vp8"||y.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ke of y.encodings)ke.scalabilityMode?ke.scalabilityMode=`L1T${oe.temporalLayers}`:ke.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:j,reuseMid:O.reuseMid,offerRtpParameters:y,answerRtpParameters:P,codecOptions:r,extmapAllowMixed:!0});const ve={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",ve),await this._pc.setRemoteDescription(ve),le||(le=M.mid,y.mid=le),this._mapMidTransceiver.set(le,M),{localId:le,rtpParameters:y,rtpSender:M.sender}}async stopSending(t){if(this.assertSendDirection(),this._closed)return;m.debug("stopSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");if(n.sender.replaceTrack(null),this._pc.removeTrack(n.sender),this._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch{}const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("pauseSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(t);const r=await this._pc.createOffer();m.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("resumeSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(this._remoteSdp.resumeSendingMediaSection(t),!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="sendonly";const r=await this._pc.createOffer();m.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,n){this.assertNotClosed(),this.assertSendDirection(),n?m.debug("replaceTrack() [localId:%s, track.id:%s]",t,n.id):m.debug("replaceTrack() [localId:%s, no track]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(n)}async setMaxSpatialLayer(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{O.active=M<=n}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{a.encodings[M]={...O,...n}}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:n,maxRetransmits:r,label:a,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:n,maxRetransmits:r,protocol:y};m.debug("sendDataChannel() [options:%o]",P);const O=this._pc.createDataChannel(a,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),j=u.parse(M.sdp),B=j.media.find(re=>re.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:B});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:O,sctpStreamParameters:{streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits}}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const n=[],r=new Map;for(const O of t){const{trackId:M,kind:j,rtpParameters:B,streamId:Q}=O;m.debug("receive() [trackId:%s, kind:%s]",M,j);const re=B.mid||String(this._mapMidTransceiver.size);r.set(M,re),this._remoteSdp.receive({mid:re,kind:j,offerRtpParameters:B,streamId:Q||B.rtcp.cname,trackId:M})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let y=await this._pc.createAnswer();const P=u.parse(y.sdp);for(const O of t){const{trackId:M,rtpParameters:j}=O,B=r.get(M),Q=P.media.find(re=>String(re.mid)===B);e.applyCodecParameters({offerRtpParameters:j,answerMediaObject:Q})}y={type:"answer",sdp:u.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const O of t){const{trackId:M}=O,j=r.get(M),B=this._pc.getTransceivers().find(Q=>Q.mid===j);if(!B)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(j,B),n.push({localId:j,track:B.receiver.track,rtpReceiver:B.receiver})}return n}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){m.debug("stopReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("pauseReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("resumeReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:n,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O}=t,M={negotiated:!0,id:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O,protocol:r};m.debug("receiveDataChannel() [options:%o]",M);const j=this._pc.createDataChannel(n,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const B={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",B),await this._pc.setRemoteDescription(B);const Q=await this._pc.createAnswer();if(!this._transportReady){const re=u.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:re})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:j}}async setupTransport({localDtlsRole:t,localSdpObject:n}){n||(n=u.parse(this._pc.localDescription.sdp));const r=e.extractDtlsParameters({sdpObject:n});r.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,y)=>{this.safeEmit("@connect",{dtlsParameters:r},a,y)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new v.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.ReactNativeUnifiedPlan=s},9676:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(m,E,s,i){i===void 0&&(i=s);var t=Object.getOwnPropertyDescriptor(E,s);t&&!("get"in t?!E.__esModule:t.writable||t.configurable)||(t={enumerable:!0,get:function(){return E[s]}}),Object.defineProperty(m,i,t)}:function(m,E,s,i){i===void 0&&(i=s),m[i]=E[s]}),S=this&&this.__setModuleDefault||(Object.create?function(m,E){Object.defineProperty(m,"default",{enumerable:!0,value:E})}:function(m,E){m.default=E}),d=this&&this.__importStar||function(m){if(m&&m.__esModule)return m;var E={};if(m!=null)for(var s in m)s!=="default"&&Object.prototype.hasOwnProperty.call(m,s)&&k(E,m,s);return S(E,m),E};Object.defineProperty(C,"__esModule",{value:!0}),C.Safari11=void 0;const u=d(l(7363)),f=l(2994),o=d(l(1765)),c=d(l(8046)),e=d(l(5544)),g=d(l(4496)),h=l(521),v=l(1305),_=new f.Logger("Safari11"),b={OS:1024,MIS:1024};class p extends h.HandlerInterface{static createFactory(){return()=>new p}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(_.debug("close()"),this._pc)try{this._pc.close()}catch{}this.emit("@close")}async getNativeRtpCapabilities(){_.debug("getNativeRtpCapabilities()");const E=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{const s=await E.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{E.close()}catch{}const i=u.parse(s.sdp);return e.extractRtpCapabilities({sdpObject:i})}catch(s){try{E.close()}catch{}throw s}}async getNativeSctpCapabilities(){return _.debug("getNativeSctpCapabilities()"),{numStreams:b}}run({direction:E,iceParameters:s,iceCandidates:i,dtlsParameters:t,sctpParameters:n,iceServers:r,iceTransportPolicy:a,additionalSettings:y,proprietaryConstraints:P,extendedRtpCapabilities:O}){_.debug("run()"),this._direction=E,this._remoteSdp=new v.RemoteSdp({iceParameters:s,iceCandidates:i,dtlsParameters:t,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",O),video:c.getSendingRtpParameters("video",O)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",O),video:c.getSendingRemoteRtpParameters("video",O)},t.role&&t.role!=="auto"&&(this._forcedLocalDtlsRole=t.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:r||[],iceTransportPolicy:a||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...y},P),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(_.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(E){_.debug("updateIceServers()");const s=this._pc.getConfiguration();s.iceServers=E,this._pc.setConfiguration(s)}async restartIce(E){if(_.debug("restartIce()"),this._remoteSdp.updateIceParameters(E),this._transportReady)if(this._direction==="send"){const s=await this._pc.createOffer({iceRestart:!0});_.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);const i={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i)}else{const s={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();_.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}}async getTransportStats(){return this._pc.getStats()}async send({track:E,encodings:s,codecOptions:i,codec:t}){this.assertSendDirection(),_.debug("send() [kind:%s, track.id:%s]",E.kind,E.id),t&&_.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(E),this._pc.addTrack(E,this._sendStream);let n,r=await this._pc.createOffer(),a=u.parse(r.sdp);const y=o.clone(this._sendingRtpParametersByKind[E.kind]);y.codecs=c.reduceCodecs(y.codecs);const P=o.clone(this._sendingRemoteRtpParametersByKind[E.kind]);if(P.codecs=c.reduceCodecs(P.codecs),this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:a}),E.kind==="video"&&s&&s.length>1&&(_.debug("send() | enabling simulcast"),a=u.parse(r.sdp),n=a.media.find(B=>B.type==="video"),g.addLegacySimulcast({offerMediaObject:n,track:E,numStreams:s.length}),r={type:"offer",sdp:u.write(a)}),_.debug("send() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),a=u.parse(this._pc.localDescription.sdp),n=a.media.find(B=>B.type===E.kind),y.rtcp.cname=e.getCname({offerMediaObject:n}),y.encodings=g.getRtpEncodings({offerMediaObject:n,track:E}),s)for(let B=0;B<y.encodings.length;++B)s[B]&&Object.assign(y.encodings[B],s[B]);if(y.encodings.length>1&&y.codecs[0].mimeType.toLowerCase()==="video/vp8")for(const B of y.encodings)B.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:n,offerRtpParameters:y,answerRtpParameters:P,codecOptions:i});const O={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("send() | calling pc.setRemoteDescription() [answer:%o]",O),await this._pc.setRemoteDescription(O);const M=String(this._nextSendLocalId);this._nextSendLocalId++;const j=this._pc.getSenders().find(B=>B.track===E);return this._mapSendLocalIdRtpSender.set(M,j),{localId:M,rtpParameters:y,rtpSender:j}}async stopSending(E){this.assertSendDirection();const s=this._mapSendLocalIdRtpSender.get(E);if(!s)throw new Error("associated RTCRtpSender not found");s.track&&this._sendStream.removeTrack(s.track),this._mapSendLocalIdRtpSender.delete(E);const i=await this._pc.createOffer();_.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",i);try{await this._pc.setLocalDescription(i)}catch(n){if(this._sendStream.getTracks().length===0)return void _.warn("stopSending() | ignoring expected error due no sending tracks: %s",n.toString());throw n}if(this._pc.signalingState==="stable")return;const t={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async pauseSending(E){}async resumeSending(E){}async replaceTrack(E,s){this.assertSendDirection(),s?_.debug("replaceTrack() [localId:%s, track.id:%s]",E,s.id):_.debug("replaceTrack() [localId:%s, no track]",E);const i=this._mapSendLocalIdRtpSender.get(E);if(!i)throw new Error("associated RTCRtpSender not found");const t=i.track;await i.replaceTrack(s),t&&this._sendStream.removeTrack(t),s&&this._sendStream.addTrack(s)}async setMaxSpatialLayer(E,s){this.assertSendDirection(),_.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",E,s);const i=this._mapSendLocalIdRtpSender.get(E);if(!i)throw new Error("associated RTCRtpSender not found");const t=i.getParameters();t.encodings.forEach((n,r)=>{n.active=r<=s}),await i.setParameters(t)}async setRtpEncodingParameters(E,s){this.assertSendDirection(),_.debug("setRtpEncodingParameters() [localId:%s, params:%o]",E,s);const i=this._mapSendLocalIdRtpSender.get(E);if(!i)throw new Error("associated RTCRtpSender not found");const t=i.getParameters();t.encodings.forEach((n,r)=>{t.encodings[r]={...n,...s}}),await i.setParameters(t)}async getSenderStats(E){this.assertSendDirection();const s=this._mapSendLocalIdRtpSender.get(E);if(!s)throw new Error("associated RTCRtpSender not found");return s.getStats()}async sendDataChannel({ordered:E,maxPacketLifeTime:s,maxRetransmits:i,label:t,protocol:n}){this.assertSendDirection();const r={negotiated:!0,id:this._nextSendSctpStreamId,ordered:E,maxPacketLifeTime:s,maxRetransmits:i,protocol:n};_.debug("sendDataChannel() [options:%o]",r);const a=this._pc.createDataChannel(t,r);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%b.MIS,!this._hasDataChannelMediaSection){const y=await this._pc.createOffer(),P=u.parse(y.sdp),O=P.media.find(j=>j.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),_.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y),this._remoteSdp.sendSctpAssociation({offerMediaObject:O});const M={type:"answer",sdp:this._remoteSdp.getSdp()};_.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setRemoteDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:a,sctpStreamParameters:{streamId:r.id,ordered:r.ordered,maxPacketLifeTime:r.maxPacketLifeTime,maxRetransmits:r.maxRetransmits}}}async receive(E){this.assertRecvDirection();const s=[];for(const r of E){const{trackId:a,kind:y,rtpParameters:P,streamId:O}=r;_.debug("receive() [trackId:%s, kind:%s]",a,y);const M=y;this._remoteSdp.receive({mid:M,kind:y,offerRtpParameters:P,streamId:O||P.rtcp.cname,trackId:a})}const i={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",i),await this._pc.setRemoteDescription(i);let t=await this._pc.createAnswer();const n=u.parse(t.sdp);for(const r of E){const{kind:a,rtpParameters:y}=r,P=a,O=n.media.find(M=>String(M.mid)===P);e.applyCodecParameters({offerRtpParameters:y,answerMediaObject:O})}t={type:"answer",sdp:u.write(n)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:n}),_.debug("receive() | calling pc.setLocalDescription() [answer:%o]",t),await this._pc.setLocalDescription(t);for(const r of E){const{kind:a,trackId:y,rtpParameters:P}=r,O=a,M=y,j=this._pc.getReceivers().find(B=>B.track&&B.track.id===M);if(!j)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(M,{mid:O,rtpParameters:P,rtpReceiver:j}),s.push({localId:M,track:j.track,rtpReceiver:j})}return s}async stopReceiving(E){this.assertRecvDirection();for(const t of E){_.debug("stopReceiving() [localId:%s]",t);const{mid:n,rtpParameters:r}=this._mapRecvLocalIdInfo.get(t)||{};this._mapRecvLocalIdInfo.delete(t),this._remoteSdp.planBStopReceiving({mid:n,offerRtpParameters:r})}const s={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",s),await this._pc.setRemoteDescription(s);const i=await this._pc.createAnswer();_.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",i),await this._pc.setLocalDescription(i)}async getReceiverStats(E){this.assertRecvDirection();const{rtpReceiver:s}=this._mapRecvLocalIdInfo.get(E)||{};if(!s)throw new Error("associated RTCRtpReceiver not found");return s.getStats()}async pauseReceiving(E){}async resumeReceiving(E){}async receiveDataChannel({sctpStreamParameters:E,label:s,protocol:i}){this.assertRecvDirection();const{streamId:t,ordered:n,maxPacketLifeTime:r,maxRetransmits:a}=E,y={negotiated:!0,id:t,ordered:n,maxPacketLifeTime:r,maxRetransmits:a,protocol:i};_.debug("receiveDataChannel() [options:%o]",y);const P=this._pc.createDataChannel(s,y);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0});const O={type:"offer",sdp:this._remoteSdp.getSdp()};_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",O),await this._pc.setRemoteDescription(O);const M=await this._pc.createAnswer();if(!this._transportReady){const j=u.parse(M.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j})}_.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",M),await this._pc.setLocalDescription(M),this._hasDataChannelMediaSection=!0}return{dataChannel:P}}async setupTransport({localDtlsRole:E,localSdpObject:s}){s||(s=u.parse(this._pc.localDescription.sdp));const i=e.extractDtlsParameters({sdpObject:s});i.role=E,this._remoteSdp.updateDtlsRole(E==="client"?"server":"client"),await new Promise((t,n)=>{this.safeEmit("@connect",{dtlsParameters:i},t,n)}),this._transportReady=!0}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Safari11=p},5765:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(i,t,n,r){r===void 0&&(r=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&!("get"in a?!t.__esModule:a.writable||a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(i,r,a)}:function(i,t,n,r){r===void 0&&(r=n),i[r]=t[n]}),S=this&&this.__setModuleDefault||(Object.create?function(i,t){Object.defineProperty(i,"default",{enumerable:!0,value:t})}:function(i,t){i.default=t}),d=this&&this.__importStar||function(i){if(i&&i.__esModule)return i;var t={};if(i!=null)for(var n in i)n!=="default"&&Object.prototype.hasOwnProperty.call(i,n)&&k(t,i,n);return S(t,i),t};Object.defineProperty(C,"__esModule",{value:!0}),C.Safari12=void 0;const u=d(l(7363)),f=l(2994),o=d(l(1765)),c=d(l(8046)),e=d(l(5544)),g=d(l(5938)),h=d(l(4256)),v=l(4893),_=l(521),b=l(1305),p=l(3303),m=new f.Logger("Safari12"),E={OS:1024,MIS:1024};class s extends _.HandlerInterface{static createFactory(){return()=>new s}constructor(){super(),this._closed=!1,this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(m.debug("close()"),!this._closed){if(this._closed=!0,this._pc)try{this._pc.close()}catch{}this.emit("@close")}}async getNativeRtpCapabilities(){m.debug("getNativeRtpCapabilities()");const t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{t.addTransceiver("audio"),t.addTransceiver("video");const n=await t.createOffer();try{t.close()}catch{}const r=u.parse(n.sdp),a=e.extractRtpCapabilities({sdpObject:r});return h.addNackSuppportForOpus(a),a}catch(n){try{t.close()}catch{}throw n}}async getNativeSctpCapabilities(){return m.debug("getNativeSctpCapabilities()"),{numStreams:E}}run({direction:t,iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y,iceServers:P,iceTransportPolicy:O,additionalSettings:M,proprietaryConstraints:j,extendedRtpCapabilities:B}){this.assertNotClosed(),m.debug("run()"),this._direction=t,this._remoteSdp=new b.RemoteSdp({iceParameters:n,iceCandidates:r,dtlsParameters:a,sctpParameters:y}),this._sendingRtpParametersByKind={audio:c.getSendingRtpParameters("audio",B),video:c.getSendingRtpParameters("video",B)},this._sendingRemoteRtpParametersByKind={audio:c.getSendingRemoteRtpParameters("audio",B),video:c.getSendingRemoteRtpParameters("video",B)},a.role&&a.role!=="auto"&&(this._forcedLocalDtlsRole=a.role==="server"?"client":"server"),this._pc=new RTCPeerConnection({iceServers:P||[],iceTransportPolicy:O||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...M},j),this._pc.addEventListener("icegatheringstatechange",()=>{this.emit("@icegatheringstatechange",this._pc.iceGatheringState)}),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(m.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(t){this.assertNotClosed(),m.debug("updateIceServers()");const n=this._pc.getConfiguration();n.iceServers=t,this._pc.setConfiguration(n)}async restartIce(t){if(this.assertNotClosed(),m.debug("restartIce()"),this._remoteSdp.updateIceParameters(t),this._transportReady)if(this._direction==="send"){const n=await this._pc.createOffer({iceRestart:!0});m.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n);const r={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),await this._pc.setRemoteDescription(r)}else{const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}}async getTransportStats(){return this.assertNotClosed(),this._pc.getStats()}async send({track:t,encodings:n,codecOptions:r,codec:a}){this.assertNotClosed(),this.assertSendDirection(),m.debug("send() [kind:%s, track.id:%s]",t.kind,t.id);const y=o.clone(this._sendingRtpParametersByKind[t.kind]);y.codecs=c.reduceCodecs(y.codecs,a);const P=o.clone(this._sendingRemoteRtpParametersByKind[t.kind]);P.codecs=c.reduceCodecs(P.codecs,a);const O=this._remoteSdp.getNextMediaSectionIdx(),M=this._pc.addTransceiver(t,{direction:"sendonly",streams:[this._sendStream]});let j,B=await this._pc.createOffer(),Q=u.parse(B.sdp);this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:Q});const re=(0,p.parse)((n||[{}])[0].scalabilityMode);n&&n.length>1&&(m.debug("send() | enabling legacy simulcast"),Q=u.parse(B.sdp),j=Q.media[O.idx],g.addLegacySimulcast({offerMediaObject:j,numStreams:n.length}),B={type:"offer",sdp:u.write(Q)}),m.debug("send() | calling pc.setLocalDescription() [offer:%o]",B),await this._pc.setLocalDescription(B);const oe=M.mid;if(y.mid=oe,Q=u.parse(this._pc.localDescription.sdp),j=Q.media[O.idx],y.rtcp.cname=e.getCname({offerMediaObject:j}),y.encodings=g.getRtpEncodings({offerMediaObject:j}),n)for(let ve=0;ve<y.encodings.length;++ve)n[ve]&&Object.assign(y.encodings[ve],n[ve]);if(y.encodings.length>1&&(y.codecs[0].mimeType.toLowerCase()==="video/vp8"||y.codecs[0].mimeType.toLowerCase()==="video/h264"))for(const ve of y.encodings)ve.scalabilityMode?ve.scalabilityMode=`L1T${re.temporalLayers}`:ve.scalabilityMode="L1T3";this._remoteSdp.send({offerMediaObject:j,reuseMid:O.reuseMid,offerRtpParameters:y,answerRtpParameters:P,codecOptions:r});const le={type:"answer",sdp:this._remoteSdp.getSdp()};return m.debug("send() | calling pc.setRemoteDescription() [answer:%o]",le),await this._pc.setRemoteDescription(le),this._mapMidTransceiver.set(oe,M),{localId:oe,rtpParameters:y,rtpSender:M.sender}}async stopSending(t){if(this.assertSendDirection(),this._closed)return;m.debug("stopSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");if(n.sender.replaceTrack(null),this._pc.removeTrack(n.sender),this._remoteSdp.closeMediaSection(n.mid))try{n.stop()}catch{}const r=await this._pc.createOffer();m.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.delete(t)}async pauseSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("pauseSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="inactive",this._remoteSdp.pauseMediaSection(t);const r=await this._pc.createOffer();m.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async resumeSending(t){this.assertNotClosed(),this.assertSendDirection(),m.debug("resumeSending() [localId:%s]",t);const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");n.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(t);const r=await this._pc.createOffer();m.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r);const a={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a)}async replaceTrack(t,n){this.assertNotClosed(),this.assertSendDirection(),n?m.debug("replaceTrack() [localId:%s, track.id:%s]",t,n.id):m.debug("replaceTrack() [localId:%s, no track]",t);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");await r.sender.replaceTrack(n)}async setMaxSpatialLayer(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{O.active=M<=n}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setMaxSpatialLayer() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setMaxSpatialLayer() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async setRtpEncodingParameters(t,n){this.assertNotClosed(),this.assertSendDirection(),m.debug("setRtpEncodingParameters() [localId:%s, params:%o]",t,n);const r=this._mapMidTransceiver.get(t);if(!r)throw new Error("associated RTCRtpTransceiver not found");const a=r.sender.getParameters();a.encodings.forEach((O,M)=>{a.encodings[M]={...O,...n}}),await r.sender.setParameters(a),this._remoteSdp.muxMediaSectionSimulcast(t,a.encodings);const y=await this._pc.createOffer();m.debug("setRtpEncodingParameters() | calling pc.setLocalDescription() [offer:%o]",y),await this._pc.setLocalDescription(y);const P={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("setRtpEncodingParameters() | calling pc.setRemoteDescription() [answer:%o]",P),await this._pc.setRemoteDescription(P)}async getSenderStats(t){this.assertNotClosed(),this.assertSendDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.sender.getStats()}async sendDataChannel({ordered:t,maxPacketLifeTime:n,maxRetransmits:r,label:a,protocol:y}){this.assertNotClosed(),this.assertSendDirection();const P={negotiated:!0,id:this._nextSendSctpStreamId,ordered:t,maxPacketLifeTime:n,maxRetransmits:r,protocol:y};m.debug("sendDataChannel() [options:%o]",P);const O=this._pc.createDataChannel(a,P);if(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%E.MIS,!this._hasDataChannelMediaSection){const M=await this._pc.createOffer(),j=u.parse(M.sdp),B=j.media.find(re=>re.type==="application");this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:j}),m.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",M),await this._pc.setLocalDescription(M),this._remoteSdp.sendSctpAssociation({offerMediaObject:B});const Q={type:"answer",sdp:this._remoteSdp.getSdp()};m.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setRemoteDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:O,sctpStreamParameters:{streamId:P.id,ordered:P.ordered,maxPacketLifeTime:P.maxPacketLifeTime,maxRetransmits:P.maxRetransmits}}}async receive(t){this.assertNotClosed(),this.assertRecvDirection();const n=[],r=new Map;for(const O of t){const{trackId:M,kind:j,rtpParameters:B,streamId:Q}=O;m.debug("receive() [trackId:%s, kind:%s]",M,j);const re=B.mid||String(this._mapMidTransceiver.size);r.set(M,re),this._remoteSdp.receive({mid:re,kind:j,offerRtpParameters:B,streamId:Q||B.rtcp.cname,trackId:M})}const a={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a);let y=await this._pc.createAnswer();const P=u.parse(y.sdp);for(const O of t){const{trackId:M,rtpParameters:j}=O,B=r.get(M),Q=P.media.find(re=>String(re.mid)===B);e.applyCodecParameters({offerRtpParameters:j,answerMediaObject:Q})}y={type:"answer",sdp:u.write(P)},this._transportReady||await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:P}),m.debug("receive() | calling pc.setLocalDescription() [answer:%o]",y),await this._pc.setLocalDescription(y);for(const O of t){const{trackId:M}=O,j=r.get(M),B=this._pc.getTransceivers().find(Q=>Q.mid===j);if(!B)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(j,B),n.push({localId:j,track:B.receiver.track,rtpReceiver:B.receiver})}return n}async stopReceiving(t){if(this.assertRecvDirection(),this._closed)return;for(const a of t){m.debug("stopReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(y.mid)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of t)this._mapMidTransceiver.delete(a)}async pauseReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("pauseReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="inactive",this._remoteSdp.pauseMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async resumeReceiving(t){this.assertNotClosed(),this.assertRecvDirection();for(const a of t){m.debug("resumeReceiving() [localId:%s]",a);const y=this._mapMidTransceiver.get(a);if(!y)throw new Error("associated RTCRtpTransceiver not found");y.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(a)}const n={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n);const r=await this._pc.createAnswer();m.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r)}async getReceiverStats(t){this.assertNotClosed(),this.assertRecvDirection();const n=this._mapMidTransceiver.get(t);if(!n)throw new Error("associated RTCRtpTransceiver not found");return n.receiver.getStats()}async receiveDataChannel({sctpStreamParameters:t,label:n,protocol:r}){this.assertNotClosed(),this.assertRecvDirection();const{streamId:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O}=t,M={negotiated:!0,id:a,ordered:y,maxPacketLifeTime:P,maxRetransmits:O,protocol:r};m.debug("receiveDataChannel() [options:%o]",M);const j=this._pc.createDataChannel(n,M);if(!this._hasDataChannelMediaSection){this._remoteSdp.receiveSctpAssociation();const B={type:"offer",sdp:this._remoteSdp.getSdp()};m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",B),await this._pc.setRemoteDescription(B);const Q=await this._pc.createAnswer();if(!this._transportReady){const re=u.parse(Q.sdp);await this.setupTransport({localDtlsRole:this._forcedLocalDtlsRole??"client",localSdpObject:re})}m.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",Q),await this._pc.setLocalDescription(Q),this._hasDataChannelMediaSection=!0}return{dataChannel:j}}async setupTransport({localDtlsRole:t,localSdpObject:n}){n||(n=u.parse(this._pc.localDescription.sdp));const r=e.extractDtlsParameters({sdpObject:n});r.role=t,this._remoteSdp.updateDtlsRole(t==="client"?"server":"client"),await new Promise((a,y)=>{this.safeEmit("@connect",{dtlsParameters:r},a,y)}),this._transportReady=!0}assertNotClosed(){if(this._closed)throw new v.InvalidStateError("method called in a closed handler")}assertSendDirection(){if(this._direction!=="send")throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if(this._direction!=="recv")throw new Error('method can just be called for handlers with "recv" direction')}}C.Safari12=s},8751:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(f,o,c,e){e===void 0&&(e=c);var g=Object.getOwnPropertyDescriptor(o,c);g&&!("get"in g?!o.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return o[c]}}),Object.defineProperty(f,e,g)}:function(f,o,c,e){e===void 0&&(e=c),f[e]=o[c]}),S=this&&this.__setModuleDefault||(Object.create?function(f,o){Object.defineProperty(f,"default",{enumerable:!0,value:o})}:function(f,o){f.default=o}),d=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var c in f)c!=="default"&&Object.prototype.hasOwnProperty.call(f,c)&&k(o,f,c);return S(o,f),o};Object.defineProperty(C,"__esModule",{value:!0}),C.mangleRtpParameters=C.getCapabilities=void 0;const u=d(l(1765));C.getCapabilities=function(){const f=RTCRtpReceiver.getCapabilities(),o=u.clone(f);for(const c of o.codecs??[]){if(c.channels=c.numChannels,delete c.numChannels,c.mimeType=c.mimeType||`${c.kind}/${c.name}`,c.parameters){const e=c.parameters;e.apt&&(e.apt=Number(e.apt)),e["packetization-mode"]&&(e["packetization-mode"]=Number(e["packetization-mode"]))}for(const e of c.rtcpFeedback||[])e.parameter||(e.parameter="")}return o},C.mangleRtpParameters=function(f){const o=u.clone(f);o.mid&&(o.muxId=o.mid,delete o.mid);for(const c of o.codecs)c.channels&&(c.numChannels=c.channels,delete c.channels),c.mimeType&&!c.name&&(c.name=c.mimeType.split("/")[1]),delete c.mimeType;return o}},4256:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.addNackSuppportForOpus=void 0,C.addNackSuppportForOpus=function(l){var k;for(const S of l.codecs||[])S.mimeType.toLowerCase()!=="audio/opus"&&S.mimeType.toLowerCase()!=="audio/multiopus"||(k=S.rtcpFeedback)!=null&&k.some(d=>d.type==="nack"&&!d.parameter)||(S.rtcpFeedback||(S.rtcpFeedback=[]),S.rtcpFeedback.push({type:"nack"}))}},3471:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(e,g,h,v){v===void 0&&(v=h);var _=Object.getOwnPropertyDescriptor(g,h);_&&!("get"in _?!g.__esModule:_.writable||_.configurable)||(_={enumerable:!0,get:function(){return g[h]}}),Object.defineProperty(e,v,_)}:function(e,g,h,v){v===void 0&&(v=h),e[v]=g[h]}),S=this&&this.__setModuleDefault||(Object.create?function(e,g){Object.defineProperty(e,"default",{enumerable:!0,value:g})}:function(e,g){e.default=g}),d=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var g={};if(e!=null)for(var h in e)h!=="default"&&Object.prototype.hasOwnProperty.call(e,h)&&k(g,e,h);return S(g,e),g};Object.defineProperty(C,"__esModule",{value:!0}),C.OfferMediaSection=C.AnswerMediaSection=C.MediaSection=void 0;const u=d(l(7363)),f=d(l(1765));class o{constructor({iceParameters:g,iceCandidates:h,dtlsParameters:v,planB:_=!1}){if(this._mediaObject={},this._planB=_,g&&this.setIceParameters(g),h){this._mediaObject.candidates=[];for(const b of h){const p={component:1};p.foundation=b.foundation,p.ip=b.address??b.ip,p.port=b.port,p.priority=b.priority,p.transport=b.protocol,p.type=b.type,b.tcpType&&(p.tcptype=b.tcpType),this._mediaObject.candidates.push(p)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}v&&this.setDtlsRole(v.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return this._mediaObject.port===0}getObject(){return this._mediaObject}setIceParameters(g){this._mediaObject.iceUfrag=g.usernameFragment,this._mediaObject.icePwd=g.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}C.MediaSection=o,C.AnswerMediaSection=class extends o{constructor({iceParameters:e,iceCandidates:g,dtlsParameters:h,sctpParameters:v,plainRtpParameters:_,planB:b=!1,offerMediaObject:p,offerRtpParameters:m,answerRtpParameters:E,codecOptions:s,extmapAllowMixed:i=!1}){switch(super({iceParameters:e,iceCandidates:g,dtlsParameters:h,planB:b}),this._mediaObject.mid=String(p.mid),this._mediaObject.type=p.type,this._mediaObject.protocol=p.protocol,_?(this._mediaObject.connection={ip:_.ip,version:_.ipVersion},this._mediaObject.port=_.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),p.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const t of E.codecs){const n={payload:t.payloadType,codec:c(t),rate:t.clockRate};t.channels>1&&(n.encoding=t.channels),this._mediaObject.rtp.push(n);const r=f.clone(t.parameters)??{};let a=f.clone(t.rtcpFeedback)??[];if(s){const{opusStereo:P,opusFec:O,opusDtx:M,opusMaxPlaybackRate:j,opusMaxAverageBitrate:B,opusPtime:Q,opusNack:re,videoGoogleStartBitrate:oe,videoGoogleMaxBitrate:le,videoGoogleMinBitrate:ve}=s,ke=m.codecs.find(ce=>ce.payloadType===t.payloadType);switch(t.mimeType.toLowerCase()){case"audio/opus":case"audio/multiopus":P!==void 0&&(ke.parameters["sprop-stereo"]=P?1:0,r.stereo=P?1:0),O!==void 0&&(ke.parameters.useinbandfec=O?1:0,r.useinbandfec=O?1:0),M!==void 0&&(ke.parameters.usedtx=M?1:0,r.usedtx=M?1:0),j!==void 0&&(r.maxplaybackrate=j),B!==void 0&&(r.maxaveragebitrate=B),Q!==void 0&&(ke.parameters.ptime=Q,r.ptime=Q),re||(ke.rtcpFeedback=ke.rtcpFeedback.filter(ce=>ce.type!=="nack"||ce.parameter),a=a.filter(ce=>ce.type!=="nack"||ce.parameter));break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":oe!==void 0&&(r["x-google-start-bitrate"]=oe),le!==void 0&&(r["x-google-max-bitrate"]=le),ve!==void 0&&(r["x-google-min-bitrate"]=ve)}}const y={payload:t.payloadType,config:""};for(const P of Object.keys(r))y.config&&(y.config+=";"),y.config+=`${P}=${r[P]}`;y.config&&this._mediaObject.fmtp.push(y);for(const P of a)this._mediaObject.rtcpFb.push({payload:t.payloadType,type:P.type,subtype:P.parameter})}this._mediaObject.payloads=E.codecs.map(t=>t.payloadType).join(" "),this._mediaObject.ext=[];for(const t of E.headerExtensions)(p.ext||[]).some(n=>n.uri===t.uri)&&this._mediaObject.ext.push({uri:t.uri,value:t.id});if(i&&p.extmapAllowMixed==="extmap-allow-mixed"&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),p.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:p.simulcast.list1},this._mediaObject.rids=[];for(const t of p.rids||[])t.direction==="send"&&this._mediaObject.rids.push({id:t.id,direction:"recv"})}else if(p.simulcast_03){this._mediaObject.simulcast_03={value:p.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const t of p.rids||[])t.direction==="send"&&this._mediaObject.rids.push({id:t.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&this._mediaObject.type==="video"&&(this._mediaObject.xGoogleFlag="conference");break;case"application":typeof p.sctpPort=="number"?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=v.port,this._mediaObject.maxMessageSize=v.maxMessageSize):p.sctpmap&&(this._mediaObject.payloads=v.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:v.port,maxMessageSize:v.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}muxSimulcastStreams(e){var _;if(!this._mediaObject.simulcast||!this._mediaObject.simulcast.list1)return;const g={};for(const b of e)b.rid&&(g[b.rid]=b);const h=this._mediaObject.simulcast.list1,v=u.parseSimulcastStreamList(h);for(const b of v)for(const p of b)p.paused=!((_=g[p.scid])!=null&&_.active);this._mediaObject.simulcast.list1=v.map(b=>b.map(p=>`${p.paused?"~":""}${p.scid}`).join(",")).join(";")}};function c(e){const g=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(!g)throw new TypeError("invalid codec.mimeType");return g[2]}C.OfferMediaSection=class extends o{constructor({iceParameters:e,iceCandidates:g,dtlsParameters:h,sctpParameters:v,plainRtpParameters:_,planB:b=!1,mid:p,kind:m,offerRtpParameters:E,streamId:s,trackId:i,oldDataChannelSpec:t=!1}){switch(super({iceParameters:e,iceCandidates:g,dtlsParameters:h,planB:b}),this._mediaObject.mid=String(p),this._mediaObject.type=m,_?(this._mediaObject.connection={ip:_.ip,version:_.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=_.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=v?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),m){case"audio":case"video":{this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${s||"-"} ${i}`);for(const y of E.codecs){const P={payload:y.payloadType,codec:c(y),rate:y.clockRate};y.channels>1&&(P.encoding=y.channels),this._mediaObject.rtp.push(P);const O={payload:y.payloadType,config:""};for(const M of Object.keys(y.parameters))O.config&&(O.config+=";"),O.config+=`${M}=${y.parameters[M]}`;O.config&&this._mediaObject.fmtp.push(O);for(const M of y.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:y.payloadType,type:M.type,subtype:M.parameter})}this._mediaObject.payloads=E.codecs.map(y=>y.payloadType).join(" "),this._mediaObject.ext=[];for(const y of E.headerExtensions)this._mediaObject.ext.push({uri:y.uri,value:y.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";const n=E.encodings[0],r=n.ssrc,a=n.rtx&&n.rtx.ssrc?n.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],E.rtcp.cname&&this._mediaObject.ssrcs.push({id:r,attribute:"cname",value:E.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:r,attribute:"msid",value:`${s||"-"} ${i}`}),a&&(E.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:E.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${s||"-"} ${i}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${r} ${a}`}));break}case"application":t?(this._mediaObject.payloads=v.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:v.port,maxMessageSize:v.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=v.port,this._mediaObject.maxMessageSize=v.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:g,trackId:h}){const v=e.encodings[0],_=v.ssrc,b=v.rtx&&v.rtx.ssrc?v.rtx.ssrc:void 0,p=this._mediaObject.payloads.split(" ");for(const m of e.codecs){if(p.includes(String(m.payloadType)))continue;const E={payload:m.payloadType,codec:c(m),rate:m.clockRate};m.channels>1&&(E.encoding=m.channels),this._mediaObject.rtp.push(E);const s={payload:m.payloadType,config:""};for(const i of Object.keys(m.parameters))s.config&&(s.config+=";"),s.config+=`${i}=${m.parameters[i]}`;s.config&&this._mediaObject.fmtp.push(s);for(const i of m.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:m.payloadType,type:i.type,subtype:i.parameter})}this._mediaObject.payloads+=` ${e.codecs.filter(m=>!this._mediaObject.payloads.includes(m.payloadType)).map(m=>m.payloadType).join(" ")}`,this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:_,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:_,attribute:"msid",value:`${g||"-"} ${h}`}),b&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:b,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:b,attribute:"msid",value:`${g||"-"} ${h}`}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:`${_} ${b}`}))}planBStopReceiving({offerRtpParameters:e}){const g=e.encodings[0],h=g.ssrc,v=g.rtx&&g.rtx.ssrc?g.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(_=>_.id!==h&&_.id!==v),v&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(_=>_.ssrcs!==`${h} ${v}`))}}},1305:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(e,g,h,v){v===void 0&&(v=h);var _=Object.getOwnPropertyDescriptor(g,h);_&&!("get"in _?!g.__esModule:_.writable||_.configurable)||(_={enumerable:!0,get:function(){return g[h]}}),Object.defineProperty(e,v,_)}:function(e,g,h,v){v===void 0&&(v=h),e[v]=g[h]}),S=this&&this.__setModuleDefault||(Object.create?function(e,g){Object.defineProperty(e,"default",{enumerable:!0,value:g})}:function(e,g){e.default=g}),d=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var g={};if(e!=null)for(var h in e)h!=="default"&&Object.prototype.hasOwnProperty.call(e,h)&&k(g,e,h);return S(g,e),g};Object.defineProperty(C,"__esModule",{value:!0}),C.RemoteSdp=void 0;const u=d(l(7363)),f=l(2994),o=l(3471),c=new f.Logger("RemoteSdp");C.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:g,dtlsParameters:h,sctpParameters:v,plainRtpParameters:_,planB:b=!1}){if(this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=g,this._dtlsParameters=h,this._sctpParameters=v,this._plainRtpParameters=_,this._planB=b,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),h){this._sdpObject.msidSemantic={semantic:"WMS",token:"*"};const p=this._dtlsParameters.fingerprints.length;this._sdpObject.fingerprint={type:h.fingerprints[p-1].algorithm,hash:h.fingerprints[p-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]}_&&(this._sdpObject.origin.address=_.ip,this._sdpObject.origin.ipVer=_.ipVersion)}updateIceParameters(e){c.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const g of this._mediaSections)g.setIceParameters(e)}updateDtlsRole(e){c.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const g of this._mediaSections)g.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){const g=this._mediaSections[e];if(g.closed)return{idx:e,reuseMid:g.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:g,offerRtpParameters:h,answerRtpParameters:v,codecOptions:_,extmapAllowMixed:b=!1}){const p=new o.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:h,answerRtpParameters:v,codecOptions:_,extmapAllowMixed:b});g?this._replaceMediaSection(p,g):this._midToIndex.has(p.mid)?this._replaceMediaSection(p):this._addMediaSection(p)}receive({mid:e,kind:g,offerRtpParameters:h,streamId:v,trackId:_}){const b=this._midToIndex.get(e);let p;if(b!==void 0&&(p=this._mediaSections[b]),p)p.planBReceive({offerRtpParameters:h,streamId:v,trackId:_}),this._replaceMediaSection(p);else{p=new o.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:g,offerRtpParameters:h,streamId:v,trackId:_});const m=this._mediaSections.find(E=>E.closed);m?this._replaceMediaSection(p,m.mid):this._addMediaSection(p)}}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){const g=this._findMediaSection(e);return e===this._firstMid?(c.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(g.close(),this._regenerateBundleMids(),!0)}muxMediaSectionSimulcast(e,g){const h=this._findMediaSection(e);h.muxSimulcastStreams(g),this._replaceMediaSection(h)}planBStopReceiving({mid:e,offerRtpParameters:g}){const h=this._findMediaSection(e);h.planBStopReceiving({offerRtpParameters:g}),this._replaceMediaSection(h)}sendSctpAssociation({offerMediaObject:e}){const g=new o.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(g)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){const g=new o.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(g)}getSdp(){return this._sdpObject.origin.sessionVersion++,u.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,g){if(typeof g=="string"){const h=this._midToIndex.get(g);if(h===void 0)throw new Error(`no media section found for reuseMid '${g}'`);const v=this._mediaSections[h];this._mediaSections[h]=e,this._midToIndex.delete(v.mid),this._midToIndex.set(e.mid,h),this._sdpObject.media[h]=e.getObject(),this._regenerateBundleMids()}else{const h=this._midToIndex.get(e.mid);if(h===void 0)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[h]=e,this._sdpObject.media[h]=e.getObject()}}_findMediaSection(e){const g=this._midToIndex.get(e);if(g===void 0)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[g]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}},5544:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(f,o,c,e){e===void 0&&(e=c);var g=Object.getOwnPropertyDescriptor(o,c);g&&!("get"in g?!o.__esModule:g.writable||g.configurable)||(g={enumerable:!0,get:function(){return o[c]}}),Object.defineProperty(f,e,g)}:function(f,o,c,e){e===void 0&&(e=c),f[e]=o[c]}),S=this&&this.__setModuleDefault||(Object.create?function(f,o){Object.defineProperty(f,"default",{enumerable:!0,value:o})}:function(f,o){f.default=o}),d=this&&this.__importStar||function(f){if(f&&f.__esModule)return f;var o={};if(f!=null)for(var c in f)c!=="default"&&Object.prototype.hasOwnProperty.call(f,c)&&k(o,f,c);return S(o,f),o};Object.defineProperty(C,"__esModule",{value:!0}),C.applyCodecParameters=C.getCname=C.extractDtlsParameters=C.extractRtpCapabilities=void 0;const u=d(l(7363));C.extractRtpCapabilities=function({sdpObject:f}){const o=new Map,c=[];let e=!1,g=!1;for(const h of f.media){const v=h.type;switch(v){case"audio":if(e)continue;e=!0;break;case"video":if(g)continue;g=!0;break;default:continue}for(const _ of h.rtp){const b={kind:v,mimeType:`${v}/${_.codec}`,preferredPayloadType:_.payload,clockRate:_.rate,channels:_.encoding,parameters:{},rtcpFeedback:[]};o.set(b.preferredPayloadType,b)}for(const _ of h.fmtp||[]){const b=u.parseParams(_.config),p=o.get(_.payload);p&&(b&&b.hasOwnProperty("profile-level-id")&&(b["profile-level-id"]=String(b["profile-level-id"])),p.parameters=b)}for(const _ of h.rtcpFb||[]){const b={type:_.type,parameter:_.subtype};if(b.parameter||delete b.parameter,_.payload!=="*"){const p=o.get(_.payload);if(!p)continue;p.rtcpFeedback.push(b)}else for(const p of o.values())p.kind!==v||/.+\/rtx$/i.test(p.mimeType)||p.rtcpFeedback.push(b)}for(const _ of h.ext||[]){if(_["encrypt-uri"])continue;const b={kind:v,uri:_.uri,preferredId:_.value};c.push(b)}}return{codecs:Array.from(o.values()),headerExtensions:c}},C.extractDtlsParameters=function({sdpObject:f}){let o,c=f.setup,e=f.fingerprint;if(!c||!e){const g=(f.media||[]).find(h=>h.port!==0);g&&(c??(c=g.setup),e??(e=g.fingerprint))}if(!c)throw new Error("no a=setup found at SDP session or media level");if(!e)throw new Error("no a=fingerprint found at SDP session or media level");switch(c){case"active":o="client";break;case"passive":o="server";break;case"actpass":o="auto"}return{role:o,fingerprints:[{algorithm:e.type,value:e.hash}]}},C.getCname=function({offerMediaObject:f}){const o=(f.ssrcs||[]).find(c=>c.attribute==="cname");return o?o.value:""},C.applyCodecParameters=function({offerRtpParameters:f,answerMediaObject:o}){for(const c of f.codecs){const e=c.mimeType.toLowerCase();if(e!=="audio/opus"||!(o.rtp||[]).find(v=>v.payload===c.payloadType))continue;o.fmtp=o.fmtp||[];let g=o.fmtp.find(v=>v.payload===c.payloadType);g||(g={payload:c.payloadType,config:""},o.fmtp.push(g));const h=u.parseParams(g.config);switch(e){case"audio/opus":{const v=c.parameters["sprop-stereo"];v!==void 0&&(h.stereo=v?1:0);break}}g.config="";for(const v of Object.keys(h))g.config&&(g.config+=";"),g.config+=`${v}=${h[v]}`}}},4496:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.addLegacySimulcast=C.getRtpEncodings=void 0,C.getRtpEncodings=function({offerMediaObject:l,track:k}){const S=new Set;for(const f of l.ssrcs||[])if(f.attribute==="msid"&&f.value.split(" ")[1]===k.id){const o=f.id;S.add(o)}if(S.size===0)throw new Error(`a=ssrc line with msid information not found [track.id:${k.id}]`);const d=new Map;for(const f of l.ssrcGroups||[]){if(f.semantics!=="FID")continue;let[o,c]=f.ssrcs.split(/\s+/);o=Number(o),c=Number(c),S.has(o)&&(S.delete(o),S.delete(c),d.set(o,c))}for(const f of S)d.set(f,null);const u=[];for(const[f,o]of d){const c={ssrc:f};o&&(c.rtx={ssrc:o}),u.push(c)}return u},C.addLegacySimulcast=function({offerMediaObject:l,track:k,numStreams:S}){if(S<=1)throw new TypeError("numStreams must be greater than 1");let d,u,f;if(!(l.ssrcs||[]).find(h=>h.attribute!=="msid"?!1:h.value.split(" ")[1]===k.id&&(d=h.id,f=h.value.split(" ")[0],!0)))throw new Error(`a=ssrc line with msid information not found [track.id:${k.id}]`);(l.ssrcGroups||[]).some(h=>{if(h.semantics!=="FID")return!1;const v=h.ssrcs.split(/\s+/);return Number(v[0])===d&&(u=Number(v[1]),!0)});const o=l.ssrcs.find(h=>h.attribute==="cname"&&h.id===d);if(!o)throw new Error(`a=ssrc line with cname information not found [track.id:${k.id}]`);const c=o.value,e=[],g=[];for(let h=0;h<S;++h)e.push(d+h),u&&g.push(u+h);l.ssrcGroups=l.ssrcGroups||[],l.ssrcs=l.ssrcs||[],l.ssrcGroups.push({semantics:"SIM",ssrcs:e.join(" ")});for(let h=0;h<e.length;++h){const v=e[h];l.ssrcs.push({id:v,attribute:"cname",value:c}),l.ssrcs.push({id:v,attribute:"msid",value:`${f} ${k.id}`})}for(let h=0;h<g.length;++h){const v=e[h],_=g[h];l.ssrcs.push({id:_,attribute:"cname",value:c}),l.ssrcs.push({id:_,attribute:"msid",value:`${f} ${k.id}`}),l.ssrcGroups.push({semantics:"FID",ssrcs:`${v} ${_}`})}}},5938:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.addLegacySimulcast=C.getRtpEncodings=void 0,C.getRtpEncodings=function({offerMediaObject:l}){const k=new Set;for(const u of l.ssrcs||[]){const f=u.id;k.add(f)}if(k.size===0)throw new Error("no a=ssrc lines found");const S=new Map;for(const u of l.ssrcGroups||[]){if(u.semantics!=="FID")continue;let[f,o]=u.ssrcs.split(/\s+/);f=Number(f),o=Number(o),k.has(f)&&(k.delete(f),k.delete(o),S.set(f,o))}for(const u of k)S.set(u,null);const d=[];for(const[u,f]of S){const o={ssrc:u};f&&(o.rtx={ssrc:f}),d.push(o)}return d},C.addLegacySimulcast=function({offerMediaObject:l,numStreams:k}){if(k<=1)throw new TypeError("numStreams must be greater than 1");const S=(l.ssrcs||[]).find(v=>v.attribute==="msid");if(!S)throw new Error("a=ssrc line with msid information not found");const[d,u]=S.value.split(" "),f=S.id;let o;(l.ssrcGroups||[]).some(v=>{if(v.semantics!=="FID")return!1;const _=v.ssrcs.split(/\s+/);return Number(_[0])===f&&(o=Number(_[1]),!0)});const c=l.ssrcs.find(v=>v.attribute==="cname");if(!c)throw new Error("a=ssrc line with cname information not found");const e=c.value,g=[],h=[];for(let v=0;v<k;++v)g.push(f+v),o&&h.push(o+v);l.ssrcGroups=[],l.ssrcs=[],l.ssrcGroups.push({semantics:"SIM",ssrcs:g.join(" ")});for(let v=0;v<g.length;++v){const _=g[v];l.ssrcs.push({id:_,attribute:"cname",value:e}),l.ssrcs.push({id:_,attribute:"msid",value:`${d} ${u}`})}for(let v=0;v<h.length;++v){const _=g[v],b=h[v];l.ssrcs.push({id:b,attribute:"cname",value:e}),l.ssrcs.push({id:b,attribute:"msid",value:`${d} ${u}`}),l.ssrcGroups.push({semantics:"FID",ssrcs:`${_} ${b}`})}}},76:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(g,h,v,_){_===void 0&&(_=v);var b=Object.getOwnPropertyDescriptor(h,v);b&&!("get"in b?!h.__esModule:b.writable||b.configurable)||(b={enumerable:!0,get:function(){return h[v]}}),Object.defineProperty(g,_,b)}:function(g,h,v,_){_===void 0&&(_=v),g[_]=h[v]}),S=this&&this.__setModuleDefault||(Object.create?function(g,h){Object.defineProperty(g,"default",{enumerable:!0,value:h})}:function(g,h){g.default=h}),d=this&&this.__importStar||function(g){if(g&&g.__esModule)return g;var h={};if(g!=null)for(var v in g)v!=="default"&&Object.prototype.hasOwnProperty.call(g,v)&&k(h,g,v);return S(h,g),h},u=this&&this.__importDefault||function(g){return g&&g.__esModule?g:{default:g}};Object.defineProperty(C,"__esModule",{value:!0}),C.debug=C.parseScalabilityMode=C.detectDevice=C.Device=C.version=C.types=void 0;const f=u(l(7833));C.debug=f.default;const o=l(6004);Object.defineProperty(C,"Device",{enumerable:!0,get:function(){return o.Device}}),Object.defineProperty(C,"detectDevice",{enumerable:!0,get:function(){return o.detectDevice}});const c=d(l(8057));C.types=c,C.version="3.7.7";var e=l(3303);Object.defineProperty(C,"parseScalabilityMode",{enumerable:!0,get:function(){return e.parse}})},8046:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(s,i,t,n){n===void 0&&(n=t);var r=Object.getOwnPropertyDescriptor(i,t);r&&!("get"in r?!i.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return i[t]}}),Object.defineProperty(s,n,r)}:function(s,i,t,n){n===void 0&&(n=t),s[n]=i[t]}),S=this&&this.__setModuleDefault||(Object.create?function(s,i){Object.defineProperty(s,"default",{enumerable:!0,value:i})}:function(s,i){s.default=i}),d=this&&this.__importStar||function(s){if(s&&s.__esModule)return s;var i={};if(s!=null)for(var t in s)t!=="default"&&Object.prototype.hasOwnProperty.call(s,t)&&k(i,s,t);return S(i,s),i};Object.defineProperty(C,"__esModule",{value:!0}),C.canReceive=C.canSend=C.generateProbatorRtpParameters=C.reduceCodecs=C.getSendingRemoteRtpParameters=C.getSendingRtpParameters=C.getRecvRtpCapabilities=C.getExtendedRtpCapabilities=C.validateSctpCapabilities=C.validateSctpStreamParameters=C.validateRtpParameters=C.validateRtpCapabilities=void 0;const u=d(l(3200)),f=d(l(1765));function o(s){if(typeof s!="object")throw new TypeError("params is not an object");if(s.mid&&typeof s.mid!="string")throw new TypeError("params.mid is not a string");if(!Array.isArray(s.codecs))throw new TypeError("missing params.codecs");for(const i of s.codecs)h(i);if(s.headerExtensions&&!Array.isArray(s.headerExtensions))throw new TypeError("params.headerExtensions is not an array");s.headerExtensions||(s.headerExtensions=[]);for(const i of s.headerExtensions)v(i);if(s.encodings&&!Array.isArray(s.encodings))throw new TypeError("params.encodings is not an array");s.encodings||(s.encodings=[]);for(const i of s.encodings)_(i);if(s.rtcp&&typeof s.rtcp!="object")throw new TypeError("params.rtcp is not an object");s.rtcp||(s.rtcp={}),function(i){if(typeof i!="object")throw new TypeError("rtcp is not an object");if(i.cname&&typeof i.cname!="string")throw new TypeError("invalid rtcp.cname");i.reducedSize&&typeof i.reducedSize=="boolean"||(i.reducedSize=!0)}(s.rtcp)}function c(s){const i=new RegExp("^(audio|video)/(.+)","i");if(typeof s!="object")throw new TypeError("codec is not an object");if(!s.mimeType||typeof s.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=i.exec(s.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(s.kind=t[1].toLowerCase(),s.preferredPayloadType&&typeof s.preferredPayloadType!="number")throw new TypeError("invalid codec.preferredPayloadType");if(typeof s.clockRate!="number")throw new TypeError("missing codec.clockRate");s.kind==="audio"?typeof s.channels!="number"&&(s.channels=1):delete s.channels,s.parameters&&typeof s.parameters=="object"||(s.parameters={});for(const n of Object.keys(s.parameters)){let r=s.parameters[n];if(r===void 0&&(s.parameters[n]="",r=""),typeof r!="string"&&typeof r!="number")throw new TypeError(`invalid codec parameter [key:${n}s, value:${r}]`);if(n==="apt"&&typeof r!="number")throw new TypeError("invalid codec apt parameter")}s.rtcpFeedback&&Array.isArray(s.rtcpFeedback)||(s.rtcpFeedback=[]);for(const n of s.rtcpFeedback)e(n)}function e(s){if(typeof s!="object")throw new TypeError("fb is not an object");if(!s.type||typeof s.type!="string")throw new TypeError("missing fb.type");s.parameter&&typeof s.parameter=="string"||(s.parameter="")}function g(s){if(typeof s!="object")throw new TypeError("ext is not an object");if(s.kind!=="audio"&&s.kind!=="video")throw new TypeError("invalid ext.kind");if(!s.uri||typeof s.uri!="string")throw new TypeError("missing ext.uri");if(typeof s.preferredId!="number")throw new TypeError("missing ext.preferredId");if(s.preferredEncrypt&&typeof s.preferredEncrypt!="boolean")throw new TypeError("invalid ext.preferredEncrypt");if(s.preferredEncrypt||(s.preferredEncrypt=!1),s.direction&&typeof s.direction!="string")throw new TypeError("invalid ext.direction");s.direction||(s.direction="sendrecv")}function h(s){const i=new RegExp("^(audio|video)/(.+)","i");if(typeof s!="object")throw new TypeError("codec is not an object");if(!s.mimeType||typeof s.mimeType!="string")throw new TypeError("missing codec.mimeType");const t=i.exec(s.mimeType);if(!t)throw new TypeError("invalid codec.mimeType");if(typeof s.payloadType!="number")throw new TypeError("missing codec.payloadType");if(typeof s.clockRate!="number")throw new TypeError("missing codec.clockRate");t[1].toLowerCase()==="audio"?typeof s.channels!="number"&&(s.channels=1):delete s.channels,s.parameters&&typeof s.parameters=="object"||(s.parameters={});for(const n of Object.keys(s.parameters)){let r=s.parameters[n];if(r===void 0&&(s.parameters[n]="",r=""),typeof r!="string"&&typeof r!="number")throw new TypeError(`invalid codec parameter [key:${n}s, value:${r}]`);if(n==="apt"&&typeof r!="number")throw new TypeError("invalid codec apt parameter")}s.rtcpFeedback&&Array.isArray(s.rtcpFeedback)||(s.rtcpFeedback=[]);for(const n of s.rtcpFeedback)e(n)}function v(s){if(typeof s!="object")throw new TypeError("ext is not an object");if(!s.uri||typeof s.uri!="string")throw new TypeError("missing ext.uri");if(typeof s.id!="number")throw new TypeError("missing ext.id");if(s.encrypt&&typeof s.encrypt!="boolean")throw new TypeError("invalid ext.encrypt");s.encrypt||(s.encrypt=!1),s.parameters&&typeof s.parameters=="object"||(s.parameters={});for(const i of Object.keys(s.parameters)){let t=s.parameters[i];if(t===void 0&&(s.parameters[i]="",t=""),typeof t!="string"&&typeof t!="number")throw new TypeError("invalid header extension parameter")}}function _(s){if(typeof s!="object")throw new TypeError("encoding is not an object");if(s.ssrc&&typeof s.ssrc!="number")throw new TypeError("invalid encoding.ssrc");if(s.rid&&typeof s.rid!="string")throw new TypeError("invalid encoding.rid");if(s.rtx&&typeof s.rtx!="object")throw new TypeError("invalid encoding.rtx");if(s.rtx&&typeof s.rtx.ssrc!="number")throw new TypeError("missing encoding.rtx.ssrc");if(s.dtx&&typeof s.dtx=="boolean"||(s.dtx=!1),s.scalabilityMode&&typeof s.scalabilityMode!="string")throw new TypeError("invalid encoding.scalabilityMode")}function b(s){return!!s&&/.+\/rtx$/i.test(s.mimeType)}function p(s,i,{strict:t=!1,modify:n=!1}={}){const r=s.mimeType.toLowerCase();if(r!==i.mimeType.toLowerCase()||s.clockRate!==i.clockRate||s.channels!==i.channels)return!1;switch(r){case"video/h264":if(t){if((s.parameters["packetization-mode"]||0)!==(i.parameters["packetization-mode"]||0)||!u.isSameProfile(s.parameters,i.parameters))return!1;let a;try{a=u.generateProfileLevelIdStringForAnswer(s.parameters,i.parameters)}catch{return!1}n&&(a?(s.parameters["profile-level-id"]=a,i.parameters["profile-level-id"]=a):(delete s.parameters["profile-level-id"],delete i.parameters["profile-level-id"]))}break;case"video/vp9":if(t&&(s.parameters["profile-id"]||0)!==(i.parameters["profile-id"]||0))return!1}return!0}function m(s,i){return(!s.kind||!i.kind||s.kind===i.kind)&&s.uri===i.uri}function E(s,i){const t=[];for(const n of s.rtcpFeedback||[]){const r=(i.rtcpFeedback||[]).find(a=>a.type===n.type&&(a.parameter===n.parameter||!a.parameter&&!n.parameter));r&&t.push(r)}return t}C.validateRtpCapabilities=function(s){if(typeof s!="object")throw new TypeError("caps is not an object");if(s.codecs&&!Array.isArray(s.codecs))throw new TypeError("caps.codecs is not an array");s.codecs||(s.codecs=[]);for(const i of s.codecs)c(i);if(s.headerExtensions&&!Array.isArray(s.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");s.headerExtensions||(s.headerExtensions=[]);for(const i of s.headerExtensions)g(i)},C.validateRtpParameters=o,C.validateSctpStreamParameters=function(s){if(typeof s!="object")throw new TypeError("params is not an object");if(typeof s.streamId!="number")throw new TypeError("missing params.streamId");let i=!1;if(typeof s.ordered=="boolean"?i=!0:s.ordered=!0,s.maxPacketLifeTime&&typeof s.maxPacketLifeTime!="number")throw new TypeError("invalid params.maxPacketLifeTime");if(s.maxRetransmits&&typeof s.maxRetransmits!="number")throw new TypeError("invalid params.maxRetransmits");if(s.maxPacketLifeTime&&s.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(i&&s.ordered&&(s.maxPacketLifeTime||s.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(i||!s.maxPacketLifeTime&&!s.maxRetransmits||(s.ordered=!1),s.label&&typeof s.label!="string")throw new TypeError("invalid params.label");if(s.protocol&&typeof s.protocol!="string")throw new TypeError("invalid params.protocol")},C.validateSctpCapabilities=function(s){if(typeof s!="object")throw new TypeError("caps is not an object");if(!s.numStreams||typeof s.numStreams!="object")throw new TypeError("missing caps.numStreams");(function(i){if(typeof i!="object")throw new TypeError("numStreams is not an object");if(typeof i.OS!="number")throw new TypeError("missing numStreams.OS");if(typeof i.MIS!="number")throw new TypeError("missing numStreams.MIS")})(s.numStreams)},C.getExtendedRtpCapabilities=function(s,i){const t={codecs:[],headerExtensions:[]};for(const n of i.codecs||[]){if(b(n))continue;const r=(s.codecs||[]).find(y=>p(y,n,{strict:!0,modify:!0}));if(!r)continue;const a={mimeType:r.mimeType,kind:r.kind,clockRate:r.clockRate,channels:r.channels,localPayloadType:r.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:n.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:r.parameters,remoteParameters:n.parameters,rtcpFeedback:E(r,n)};t.codecs.push(a)}for(const n of t.codecs){const r=s.codecs.find(y=>b(y)&&y.parameters.apt===n.localPayloadType),a=i.codecs.find(y=>b(y)&&y.parameters.apt===n.remotePayloadType);r&&a&&(n.localRtxPayloadType=r.preferredPayloadType,n.remoteRtxPayloadType=a.preferredPayloadType)}for(const n of i.headerExtensions){const r=s.headerExtensions.find(y=>m(y,n));if(!r)continue;const a={kind:n.kind,uri:n.uri,sendId:r.preferredId,recvId:n.preferredId,encrypt:r.preferredEncrypt,direction:"sendrecv"};switch(n.direction){case"sendrecv":a.direction="sendrecv";break;case"recvonly":a.direction="sendonly";break;case"sendonly":a.direction="recvonly";break;case"inactive":a.direction="inactive"}t.headerExtensions.push(a)}return t},C.getRecvRtpCapabilities=function(s){const i={codecs:[],headerExtensions:[]};for(const t of s.codecs){const n={mimeType:t.mimeType,kind:t.kind,preferredPayloadType:t.remotePayloadType,clockRate:t.clockRate,channels:t.channels,parameters:t.localParameters,rtcpFeedback:t.rtcpFeedback};if(i.codecs.push(n),!t.remoteRtxPayloadType)continue;const r={mimeType:`${t.kind}/rtx`,kind:t.kind,preferredPayloadType:t.remoteRtxPayloadType,clockRate:t.clockRate,parameters:{apt:t.remotePayloadType},rtcpFeedback:[]};i.codecs.push(r)}for(const t of s.headerExtensions){if(t.direction!=="sendrecv"&&t.direction!=="recvonly")continue;const n={kind:t.kind,uri:t.uri,preferredId:t.recvId,preferredEncrypt:t.encrypt,direction:t.direction};i.headerExtensions.push(n)}return i},C.getSendingRtpParameters=function(s,i){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of i.codecs){if(n.kind!==s)continue;const r={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(r),n.localRtxPayloadType){const a={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};t.codecs.push(a)}}for(const n of i.headerExtensions){if(n.kind&&n.kind!==s||n.direction!=="sendrecv"&&n.direction!=="sendonly")continue;const r={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};t.headerExtensions.push(r)}return t},C.getSendingRemoteRtpParameters=function(s,i){const t={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const n of i.codecs){if(n.kind!==s)continue;const r={mimeType:n.mimeType,payloadType:n.localPayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.remoteParameters,rtcpFeedback:n.rtcpFeedback};if(t.codecs.push(r),n.localRtxPayloadType){const a={mimeType:`${n.kind}/rtx`,payloadType:n.localRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.localPayloadType},rtcpFeedback:[]};t.codecs.push(a)}}for(const n of i.headerExtensions){if(n.kind&&n.kind!==s||n.direction!=="sendrecv"&&n.direction!=="sendonly")continue;const r={uri:n.uri,id:n.sendId,encrypt:n.encrypt,parameters:{}};t.headerExtensions.push(r)}if(t.headerExtensions.some(n=>n.uri==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"))for(const n of t.codecs)n.rtcpFeedback=(n.rtcpFeedback||[]).filter(r=>r.type!=="goog-remb");else if(t.headerExtensions.some(n=>n.uri==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"))for(const n of t.codecs)n.rtcpFeedback=(n.rtcpFeedback||[]).filter(r=>r.type!=="transport-cc");else for(const n of t.codecs)n.rtcpFeedback=(n.rtcpFeedback||[]).filter(r=>r.type!=="transport-cc"&&r.type!=="goog-remb");return t},C.reduceCodecs=function(s,i){const t=[];if(i){for(let n=0;n<s.length;++n)if(p(s[n],i,{strict:!0})){t.push(s[n]),b(s[n+1])&&t.push(s[n+1]);break}if(t.length===0)throw new TypeError("no matching codec found")}else t.push(s[0]),b(s[1])&&t.push(s[1]);return t},C.generateProbatorRtpParameters=function(s){o(s=f.clone(s));const i={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return i.codecs.push(s.codecs[0]),i.codecs[0].payloadType=127,i.headerExtensions=s.headerExtensions,i},C.canSend=function(s,i){return i.codecs.some(t=>t.kind===s)},C.canReceive=function(s,i){if(o(s),s.codecs.length===0)return!1;const t=s.codecs[0];return i.codecs.some(n=>n.remotePayloadType===t.payloadType)}},3303:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.parse=void 0;const l=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");C.parse=function(k){const S=l.exec(k||"");return S?{spatialLayers:Number(S[1]),temporalLayers:Number(S[2])}:{spatialLayers:1,temporalLayers:1}}},8057:function(G,C,l){var k=this&&this.__createBinding||(Object.create?function(d,u,f,o){o===void 0&&(o=f);var c=Object.getOwnPropertyDescriptor(u,f);c&&!("get"in c?!u.__esModule:c.writable||c.configurable)||(c={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(d,o,c)}:function(d,u,f,o){o===void 0&&(o=f),d[o]=u[f]}),S=this&&this.__exportStar||function(d,u){for(var f in d)f==="default"||Object.prototype.hasOwnProperty.call(u,f)||k(u,d,f)};Object.defineProperty(C,"__esModule",{value:!0}),S(l(6004),C),S(l(5601),C),S(l(9792),C),S(l(3518),C),S(l(7504),C),S(l(9166),C),S(l(5370),C),S(l(4160),C),S(l(521),C),S(l(4893),C)},1765:(G,C)=>{Object.defineProperty(C,"__esModule",{value:!0}),C.deepFreeze=C.generateRandomNumber=C.clone=void 0,C.clone=function(l){return l===void 0?void 0:Number.isNaN(l)?NaN:typeof structuredClone=="function"?structuredClone(l):JSON.parse(JSON.stringify(l))},C.generateRandomNumber=function(){return Math.round(1e7*Math.random())},C.deepFreeze=function l(k){const S=Reflect.ownKeys(k);for(const d of S){const u=k[d];(u&&typeof u=="object"||typeof u=="function")&&l(u)}return Object.freeze(k)}},6585:G=>{var C=1e3,l=60*C,k=60*l,S=24*k,d=7*S,u=365.25*S;function f(o,c,e,g){var h=c>=1.5*e;return Math.round(o/e)+" "+g+(h?"s":"")}G.exports=function(o,c){c=c||{};var e=typeof o;if(e==="string"&&o.length>0)return function(g){if(!((g=String(g)).length>100)){var h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(g);if(h){var v=parseFloat(h[1]);switch((h[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return v*u;case"weeks":case"week":case"w":return v*d;case"days":case"day":case"d":return v*S;case"hours":case"hour":case"hrs":case"hr":case"h":return v*k;case"minutes":case"minute":case"mins":case"min":case"m":return v*l;case"seconds":case"second":case"secs":case"sec":case"s":return v*C;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return v;default:return}}}}(o);if(e==="number"&&isFinite(o))return c.long?function(g){var h=Math.abs(g);return h>=S?f(g,h,S,"day"):h>=k?f(g,h,k,"hour"):h>=l?f(g,h,l,"minute"):h>=C?f(g,h,C,"second"):g+" ms"}(o):function(g){var h=Math.abs(g);return h>=S?Math.round(g/S)+"d":h>=k?Math.round(g/k)+"h":h>=l?Math.round(g/l)+"m":h>=C?Math.round(g/C)+"s":g+"ms"}(o);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(o))}},4252:(G,C,l)=>{const{EventEmitter:k}=l(7007),S=l(3612);G.exports=class extends k{constructor(d){super(),this.setMaxListeners(1/0),this._logger=d||new S("EnhancedEventEmitter")}safeEmit(d,...u){try{this.emit(d,...u)}catch(f){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",d,f)}}async safeEmitAsPromise(d,...u){return new Promise((f,o)=>{this.safeEmit(d,...u,f,o)})}}},3612:(G,C,l)=>{const k=l(7833),S="protoo-client";G.exports=class{constructor(d){d?(this._debug=k(`${S}:${d}`),this._warn=k(`${S}:WARN:${d}`),this._error=k(`${S}:ERROR:${d}`)):(this._debug=k(S),this._warn=k(`${S}:WARN`),this._error=k(`${S}:ERROR`)),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}},3241:(G,C,l)=>{const k=l(3612),{generateRandomNumber:S}=l(9007),d=new k("Message");G.exports=class{static parse(u){let f;const o={};try{f=JSON.parse(u)}catch(c){return void d.error("parse() | invalid JSON: %s",c)}if(typeof f=="object"&&!Array.isArray(f)){if(f.request){if(o.request=!0,typeof f.method!="string")return void d.error("parse() | missing/invalid method field");if(typeof f.id!="number")return void d.error("parse() | missing/invalid id field");o.id=f.id,o.method=f.method,o.data=f.data||{}}else if(f.response){if(o.response=!0,typeof f.id!="number")return void d.error("parse() | missing/invalid id field");o.id=f.id,f.ok?(o.ok=!0,o.data=f.data||{}):(o.ok=!1,o.errorCode=f.errorCode,o.errorReason=f.errorReason)}else{if(!f.notification)return void d.error("parse() | missing request/response field");if(o.notification=!0,typeof f.method!="string")return void d.error("parse() | missing/invalid method field");o.method=f.method,o.data=f.data||{}}return o}d.error("parse() | not an object")}static createRequest(u,f){return{request:!0,id:S(),method:u,data:f||{}}}static createSuccessResponse(u,f){return{response:!0,id:u.id,ok:!0,data:f||{}}}static createErrorResponse(u,f,o){return{response:!0,id:u.id,ok:!1,errorCode:f,errorReason:o}}static createNotification(u,f){return{notification:!0,method:u,data:f||{}}}}},7204:(G,C,l)=>{const k=l(3612),S=l(4252),d=l(3241),u=new k("Peer");G.exports=class extends S{constructor(f){super(u),u.debug("constructor()"),this._closed=!1,this._transport=f,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(f){throw new Error("cannot override data object")}close(){if(!this._closed){u.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const f of this._sents.values())f.close();this.safeEmit("close")}}async request(f,o=void 0){const c=d.createRequest(f,o);return this._logger.debug("request() [method:%s, id:%s]",f,c.id),await this._transport.send(c),new Promise((e,g)=>{const h=1500*(15+.1*this._sents.size),v={id:c.id,method:c.method,resolve:_=>{this._sents.delete(c.id)&&(clearTimeout(v.timer),e(_))},reject:_=>{this._sents.delete(c.id)&&(clearTimeout(v.timer),g(_))},timer:setTimeout(()=>{this._sents.delete(c.id)&&g(new Error("request timeout"))},h),close:()=>{clearTimeout(v.timer),g(new Error("peer closed"))}};this._sents.set(c.id,v)})}async notify(f,o=void 0){const c=d.createNotification(f,o);this._logger.debug("notify() [method:%s]",f),await this._transport.send(c)}_handleTransport(){if(this._transport.closed)return this._closed=!0,void setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))});this._transport.on("open",()=>{this._closed||(u.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(u.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",f=>{this._closed||(u.debug('emit "failed" [currentAttempt:%s]',f),this._connected=!1,this.safeEmit("failed",f))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,u.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",f=>{f.request?this._handleRequest(f):f.response?this._handleResponse(f):f.notification&&this._handleNotification(f)})}_handleRequest(f){try{this.emit("request",f,o=>{const c=d.createSuccessResponse(f,o);this._transport.send(c).catch(()=>{})},(o,c)=>{o instanceof Error?(c=o.message,o=500):typeof o=="number"&&c instanceof Error&&(c=c.message);const e=d.createErrorResponse(f,o,c);this._transport.send(e).catch(()=>{})})}catch(o){const c=d.createErrorResponse(f,500,String(o));this._transport.send(c).catch(()=>{})}}_handleResponse(f){const o=this._sents.get(f.id);if(o)if(f.ok)o.resolve(f.data);else{const c=new Error(f.errorReason);c.code=f.errorCode,o.reject(c)}else u.error("received response does not match any sent request [id:%s]",f.id)}_handleNotification(f){this.safeEmit("notification",f)}}},9566:(G,C,l)=>{l(7949);const k=l(7204),S=l(3545);C.xM=k,C.TJ=S},3545:(G,C,l)=>{const k=l(952).w3cwebsocket,S=l(5617),d=l(3612),u=l(4252),f=l(3241),o={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},c=new d("WebSocketTransport");G.exports=class extends u{constructor(e,g){super(c),c.debug("constructor() [url:%s, options:%o]",e,g),this._closed=!1,this._url=e,this._options=g||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){c.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){c.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(g){throw c.warn("send() failed:%o",g),g}}_runWebSocket(){const e=S.operation(this._options.retry||o);let g=!1;e.attempt(h=>{this._closed?e.stop():(c.debug("_runWebSocket() [currentAttempt:%s]",h),this._ws=new k(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(g=!0,this.safeEmit("open"))},this._ws.onclose=v=>{if(!this._closed){if(c.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',v.wasClean,v.code,v.reason),v.code!==4e3){if(g)return e.stop(),this.safeEmit("disconnected"),this._closed?void 0:void this._runWebSocket();if(this.safeEmit("failed",h),this._closed||e.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||c.error('WebSocket "error" event')},this._ws.onmessage=v=>{if(this._closed)return;const _=f.parse(v.data);_&&(this.listenerCount("message")!==0?this.safeEmit("message",_):c.error('no listeners for WebSocket "message" event, ignoring received message'))})})}}},9007:(G,C)=>{C.generateRandomNumber=function(){return Math.round(1e7*Math.random())}},9596:(G,C,l)=>{let k;G.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window<"u"?window:l.g):S=>(k||(k=Promise.resolve())).then(S).catch(d=>setTimeout(()=>{throw d},0))},2211:G=>{G.exports=function(C){var l,k,S="",d=(C=function(f){return f||(f={}),{length:f.length||8,numeric:typeof f.numeric!="boolean"||f.numeric,letters:typeof f.letters!="boolean"||f.letters,special:typeof f.special=="boolean"&&f.special,exclude:Array.isArray(f.exclude)?f.exclude:[]}}(C)).length,u=(C.exclude,function(f){var o="";f.numeric&&(o+="0123456789"),f.letters&&(o+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),f.special&&(o+="!$%^&*()_+|~-=`{}[]:;<>?,./");for(var c=0;c<=f.exclude.length;c++)o=o.replace(f.exclude[c],"");return o}(C));for(l=1;l<=d;l++)S+=u.substring(k=Math.floor(Math.random()*u.length),k+1);return S}},5617:(G,C,l)=>{G.exports=l(8303)},8303:(G,C,l)=>{var k=l(3961);C.operation=function(S){var d=C.timeouts(S);return new k(d,{forever:S&&S.forever,unref:S&&S.unref,maxRetryTime:S&&S.maxRetryTime})},C.timeouts=function(S){if(S instanceof Array)return[].concat(S);var d={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var u in S)d[u]=S[u];if(d.minTimeout>d.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var f=[],o=0;o<d.retries;o++)f.push(this.createTimeout(o,d));return S&&S.forever&&!f.length&&f.push(this.createTimeout(o,d)),f.sort(function(c,e){return c-e}),f},C.createTimeout=function(S,d){var u=d.randomize?Math.random()+1:1,f=Math.round(u*d.minTimeout*Math.pow(d.factor,S));return f=Math.min(f,d.maxTimeout)},C.wrap=function(S,d,u){if(d instanceof Array&&(u=d,d=null),!u)for(var f in u=[],S)typeof S[f]=="function"&&u.push(f);for(var o=0;o<u.length;o++){var c=u[o],e=S[c];S[c]=(function(g){var h=C.operation(d),v=Array.prototype.slice.call(arguments,1),_=v.pop();v.push(function(b){h.retry(b)||(b&&(arguments[0]=h.mainError()),_.apply(this,arguments))}),h.attempt(function(){g.apply(S,v)})}).bind(S,e),S[c].options=d}}},3961:G=>{function C(l,k){typeof k=="boolean"&&(k={forever:k}),this._originalTimeouts=JSON.parse(JSON.stringify(l)),this._timeouts=l,this._options=k||{},this._maxRetryTime=k&&k.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}G.exports=C,C.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},C.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},C.prototype.retry=function(l){if(this._timeout&&clearTimeout(this._timeout),!l)return!1;var k=new Date().getTime();if(l&&k-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(l);var S=this._timeouts.shift();if(S===void 0){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),S=this._timeouts.shift()}var d=this,u=setTimeout(function(){d._attempts++,d._operationTimeoutCb&&(d._timeout=setTimeout(function(){d._operationTimeoutCb(d._attempts)},d._operationTimeout),d._options.unref&&d._timeout.unref()),d._fn(d._attempts)},S);return this._options.unref&&u.unref(),!0},C.prototype.attempt=function(l,k){this._fn=l,k&&(k.timeout&&(this._operationTimeout=k.timeout),k.cb&&(this._operationTimeoutCb=k.cb));var S=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){S._operationTimeoutCb()},S._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},C.prototype.try=function(l){console.log("Using RetryOperation.try() is deprecated"),this.attempt(l)},C.prototype.start=function(l){console.log("Using RetryOperation.start() is deprecated"),this.attempt(l)},C.prototype.start=C.prototype.try,C.prototype.errors=function(){return this._errors},C.prototype.attempts=function(){return this._attempts},C.prototype.mainError=function(){if(this._errors.length===0)return null;for(var l={},k=null,S=0,d=0;d<this._errors.length;d++){var u=this._errors[d],f=u.message,o=(l[f]||0)+1;l[f]=o,o>=S&&(k=u,S=o)}return k}},5602:G=>{var C=G.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(l){return l.encoding?"rtpmap:%d %s/%s/%s":l.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(l){return l.address!=null?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(l){return l.subtype!=null?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(l){return"extmap:%d"+(l.direction?"/%s":"%v")+(l["encrypt-uri"]?" %s":"%v")+" %s"+(l.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(l){return l.sessionConfig!=null?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(l){var k="candidate:%s %d %s %d %s %d typ %s";return k+=l.raddr!=null?" raddr %s rport %d":"%v%v",k+=l.tcptype!=null?" tcptype %s":"%v",l.generation!=null&&(k+=" generation %d"),k+=l["network-id"]!=null?" network-id %d":"%v",k+=l["network-cost"]!=null?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(l){var k="ssrc:%d";return l.attribute!=null&&(k+=" %s",l.value!=null&&(k+=":%s")),k}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(l){return l.maxMessageSize!=null?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(l){return l.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(l){return"imageattr:%s %s %s"+(l.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(l){return"simulcast:%s %s"+(l.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(l){return"ts-refclk:%s"+(l.clksrcExt!=null?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(l){var k="mediaclk:";return k+=l.id!=null?"id=%s %s":"%v%s",k+=l.mediaClockValue!=null?"=%s":"",k+=l.rateNumerator!=null?" rate=%s":"",k+=l.rateDenominator!=null?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(C).forEach(function(l){C[l].forEach(function(k){k.reg||(k.reg=/(.*)/),k.format||(k.format="%s")})})},7363:(G,C,l)=>{var k=l(5020),S=l(3804),d=l(5602);C.grammar=d,C.write=S,C.parse=k.parse,C.parseParams=k.parseParams,C.parseFmtpConfig=k.parseFmtpConfig,C.parsePayloads=k.parsePayloads,C.parseRemoteCandidates=k.parseRemoteCandidates,C.parseImageAttributes=k.parseImageAttributes,C.parseSimulcastStreamList=k.parseSimulcastStreamList},5020:(G,C,l)=>{var k=function(o){return String(Number(o))===o?Number(o):o},S=function(o,c,e){var g=o.name&&o.names;o.push&&!c[o.push]?c[o.push]=[]:g&&!c[o.name]&&(c[o.name]={});var h=o.push?{}:g?c[o.name]:c;(function(v,_,b,p){if(p&&!b)_[p]=k(v[1]);else for(var m=0;m<b.length;m+=1)v[m+1]!=null&&(_[b[m]]=k(v[m+1]))})(e.match(o.reg),h,o.names,o.name),o.push&&c[o.push].push(h)},d=l(5602),u=RegExp.prototype.test.bind(/^([a-z])=(.*)/);C.parse=function(o){var c={},e=[],g=c;return o.split(/(\r\n|\r|\n)/).filter(u).forEach(function(h){var v=h[0],_=h.slice(2);v==="m"&&(e.push({rtp:[],fmtp:[]}),g=e[e.length-1]);for(var b=0;b<(d[v]||[]).length;b+=1){var p=d[v][b];if(p.reg.test(_))return S(p,g,_)}}),c.media=e,c};var f=function(o,c){var e=c.split(/=(.+)/,2);return e.length===2?o[e[0]]=k(e[1]):e.length===1&&c.length>1&&(o[e[0]]=void 0),o};C.parseParams=function(o){return o.split(/;\s?/).reduce(f,{})},C.parseFmtpConfig=C.parseParams,C.parsePayloads=function(o){return o.toString().split(" ").map(Number)},C.parseRemoteCandidates=function(o){for(var c=[],e=o.split(" ").map(k),g=0;g<e.length;g+=3)c.push({component:e[g],ip:e[g+1],port:e[g+2]});return c},C.parseImageAttributes=function(o){return o.split(" ").map(function(c){return c.substring(1,c.length-1).split(",").reduce(f,{})})},C.parseSimulcastStreamList=function(o){return o.split(";").map(function(c){return c.split(",").map(function(e){var g,h=!1;return e[0]!=="~"?g=k(e):(g=k(e.substring(1,e.length)),h=!0),{scid:g,paused:h}})})}},3804:(G,C,l)=>{var k=l(5602),S=/%[sdv%]/g,d=function(c){var e=1,g=arguments,h=g.length;return c.replace(S,function(v){if(e>=h)return v;var _=g[e];switch(e+=1,v){case"%%":return"%";case"%s":return String(_);case"%d":return Number(_);case"%v":return""}})},u=function(c,e,g){var h=[c+"="+(e.format instanceof Function?e.format(e.push?g:g[e.name]):e.format)];if(e.names)for(var v=0;v<e.names.length;v+=1){var _=e.names[v];e.name?h.push(g[e.name][_]):h.push(g[e.names[v]])}else h.push(g[e.name]);return d.apply(null,h)},f=["v","o","s","i","u","e","p","c","b","t","r","z","a"],o=["i","c","b","a"];G.exports=function(c,e){e=e||{},c.version==null&&(c.version=0),c.name==null&&(c.name=" "),c.media.forEach(function(_){_.payloads==null&&(_.payloads="")});var g=e.outerOrder||f,h=e.innerOrder||o,v=[];return g.forEach(function(_){k[_].forEach(function(b){b.name in c&&c[b.name]!=null?v.push(u(_,b,c)):b.push in c&&c[b.push]!=null&&c[b.push].forEach(function(p){v.push(u(_,b,p))})})}),c.media.forEach(function(_){v.push(u("m",k.m[0],_)),h.forEach(function(b){k[b].forEach(function(p){p.name in _&&_[p.name]!=null?v.push(u(b,p,_)):p.push in _&&_[p.push]!=null&&_[p.push].forEach(function(m){v.push(u(b,p,m))})})})}),v.join(`\r
`)+`\r
`}},7232:function(G,C,l){var k;(function(S,d){var u="function",f="undefined",o="object",c="string",e="major",g="model",h="name",v="type",_="vendor",b="version",p="architecture",m="console",E="mobile",s="tablet",i="smarttv",t="wearable",n="embedded",r="Amazon",a="Apple",y="ASUS",P="BlackBerry",O="Browser",M="Chrome",j="Firefox",B="Google",Q="Huawei",re="LG",oe="Microsoft",le="Motorola",ve="Opera",ke="Samsung",ce="Sharp",te="Sony",ue="Xiaomi",pe="Zebra",he="Facebook",Ze="Chromium OS",Ot="Mac OS",Ht=" Browser",st=function(Gt){for(var Ke={},Ct=0;Ct<Gt.length;Ct++)Ke[Gt[Ct].toUpperCase()]=Gt[Ct];return Ke},_r=function(Gt,Ke){return typeof Gt===c&&jt(Ke).indexOf(jt(Gt))!==-1},jt=function(Gt){return Gt.toLowerCase()},_t=function(Gt,Ke){if(typeof Gt===c)return Gt=Gt.replace(/^\s\s*/,""),typeof Ke===f?Gt:Gt.substring(0,500)},vr=function(Gt,Ke){for(var Ct,dr,xe,Ye,zt,pt,rr=0;rr<Ke.length&&!zt;){var jr=Ke[rr],Hr=Ke[rr+1];for(Ct=dr=0;Ct<jr.length&&!zt&&jr[Ct];)if(zt=jr[Ct++].exec(Gt))for(xe=0;xe<Hr.length;xe++)pt=zt[++dr],typeof(Ye=Hr[xe])===o&&Ye.length>0?Ye.length===2?typeof Ye[1]==u?this[Ye[0]]=Ye[1].call(this,pt):this[Ye[0]]=Ye[1]:Ye.length===3?typeof Ye[1]!==u||Ye[1].exec&&Ye[1].test?this[Ye[0]]=pt?pt.replace(Ye[1],Ye[2]):d:this[Ye[0]]=pt?Ye[1].call(this,pt,Ye[2]):d:Ye.length===4&&(this[Ye[0]]=pt?Ye[3].call(this,pt.replace(Ye[1],Ye[2])):d):this[Ye]=pt||d;rr+=2}},ft=function(Gt,Ke){for(var Ct in Ke)if(typeof Ke[Ct]===o&&Ke[Ct].length>0){for(var dr=0;dr<Ke[Ct].length;dr++)if(_r(Ke[Ct][dr],Gt))return Ct==="?"?d:Ct}else if(_r(Ke[Ct],Gt))return Ct==="?"?d:Ct;return Ke.hasOwnProperty("*")?Ke["*"]:Gt},xt={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},$r={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[b,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[b,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,b],[/opios[\/ ]+([\w\.]+)/i],[b,[h,ve+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[b,[h,ve+" GX"]],[/\bopr\/([\w\.]+)/i],[b,[h,ve]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[b,[h,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[b,[h,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,b],[/quark(?:pc)?\/([-\w\.]+)/i],[b,[h,"Quark"]],[/\bddg\/([\w\.]+)/i],[b,[h,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[b,[h,"UC"+O]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[b,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[b,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[b,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[b,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[b,[h,"Smart Lenovo "+O]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+O],b],[/\bfocus\/([\w\.]+)/i],[b,[h,j+" Focus"]],[/\bopt\/([\w\.]+)/i],[b,[h,ve+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[b,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[b,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[b,[h,ve+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[b,[h,"MIUI"+Ht]],[/fxios\/([\w\.-]+)/i],[b,[h,j]],[/\bqihoobrowser\/?([\w\.]*)/i],[b,[h,"360"]],[/\b(qq)\/([\w\.]+)/i],[[h,/(.+)/,"$1Browser"],b],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1"+Ht],b],[/samsungbrowser\/([\w\.]+)/i],[b,[h,ke+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[b,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],b],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[h,b],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[h],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[b,h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,he],b],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,b],[/\bgsa\/([\w\.]+) .*safari\//i],[b,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[b,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[b,[h,M+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,M+" WebView"],b],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[b,[h,"Android "+O]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,b],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[b,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[b,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[b,ft,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,b],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],b],[/(wolvic|librewolf)\/([\w\.]+)/i],[h,b],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[b,[h,j+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[h,[b,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[h,[b,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,jt]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",jt]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,jt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[g,[_,ke],[v,s]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[g,[_,ke],[v,E]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[g,[_,a],[v,E]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[g,[_,a],[v,s]],[/(macintosh);/i],[g,[_,a]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[g,[_,ce],[v,E]],[/(?:honor)([-\w ]+)[;\)]/i],[g,[_,"Honor"],[v,E]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[g,[_,Q],[v,s]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[g,[_,Q],[v,E]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[g,/_/g," "],[_,ue],[v,E]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[g,/_/g," "],[_,ue],[v,s]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[g,[_,"OPPO"],[v,E]],[/\b(opd2\d{3}a?) bui/i],[g,[_,"OPPO"],[v,s]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[g,[_,"Vivo"],[v,E]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[g,[_,"Realme"],[v,E]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[g,[_,le],[v,E]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[g,[_,le],[v,s]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[g,[_,re],[v,s]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[g,[_,re],[v,E]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[g,[_,"Lenovo"],[v,s]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[g,/_/g," "],[_,"Nokia"],[v,E]],[/(pixel c)\b/i],[g,[_,B],[v,s]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[g,[_,B],[v,E]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[g,[_,te],[v,E]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[g,"Xperia Tablet"],[_,te],[v,s]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[g,[_,"OnePlus"],[v,E]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[g,[_,r],[v,s]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[g,/(.+)/g,"Fire Phone $1"],[_,r],[v,E]],[/(playbook);[-\w\),; ]+(rim)/i],[g,_,[v,s]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[g,[_,P],[v,E]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[g,[_,y],[v,s]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[g,[_,y],[v,E]],[/(nexus 9)/i],[g,[_,"HTC"],[v,s]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_,[g,/_/g," "],[v,E]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[g,[_,"TCL"],[v,s]],[/(itel) ((\w+))/i],[[_,jt],g,[v,ft,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[g,[_,"Acer"],[v,s]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[g,[_,"Meizu"],[v,E]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[g,[_,"Ulefone"],[v,E]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[g,[_,"Energizer"],[v,E]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[g,[_,"Cat"],[v,E]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[g,[_,"Smartfren"],[v,E]],[/droid.+; (a(?:015|06[35]|142p?))/i],[g,[_,"Nothing"],[v,E]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_,g,[v,E]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_,g,[v,s]],[/(surface duo)/i],[g,[_,oe],[v,s]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[g,[_,"Fairphone"],[v,E]],[/(u304aa)/i],[g,[_,"AT&T"],[v,E]],[/\bsie-(\w*)/i],[g,[_,"Siemens"],[v,E]],[/\b(rct\w+) b/i],[g,[_,"RCA"],[v,s]],[/\b(venue[\d ]{2,7}) b/i],[g,[_,"Dell"],[v,s]],[/\b(q(?:mv|ta)\w+) b/i],[g,[_,"Verizon"],[v,s]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[g,[_,"Barnes & Noble"],[v,s]],[/\b(tm\d{3}\w+) b/i],[g,[_,"NuVision"],[v,s]],[/\b(k88) b/i],[g,[_,"ZTE"],[v,s]],[/\b(nx\d{3}j) b/i],[g,[_,"ZTE"],[v,E]],[/\b(gen\d{3}) b.+49h/i],[g,[_,"Swiss"],[v,E]],[/\b(zur\d{3}) b/i],[g,[_,"Swiss"],[v,s]],[/\b((zeki)?tb.*\b) b/i],[g,[_,"Zeki"],[v,s]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_,"Dragon Touch"],g,[v,s]],[/\b(ns-?\w{0,9}) b/i],[g,[_,"Insignia"],[v,s]],[/\b((nxa|next)-?\w{0,9}) b/i],[g,[_,"NextBook"],[v,s]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_,"Voice"],g,[v,E]],[/\b(lvtel\-)?(v1[12]) b/i],[[_,"LvTel"],g,[v,E]],[/\b(ph-1) /i],[g,[_,"Essential"],[v,E]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[g,[_,"Envizen"],[v,s]],[/\b(trio[-\w\. ]+) b/i],[g,[_,"MachSpeed"],[v,s]],[/\btu_(1491) b/i],[g,[_,"Rotor"],[v,s]],[/(shield[\w ]+) b/i],[g,[_,"Nvidia"],[v,s]],[/(sprint) (\w+)/i],[_,g,[v,E]],[/(kin\.[onetw]{3})/i],[[g,/\./g," "],[_,oe],[v,E]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[g,[_,pe],[v,s]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[g,[_,pe],[v,E]],[/smart-tv.+(samsung)/i],[_,[v,i]],[/hbbtv.+maple;(\d+)/i],[[g,/^/,"SmartTV"],[_,ke],[v,i]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_,re],[v,i]],[/(apple) ?tv/i],[_,[g,a+" TV"],[v,i]],[/crkey/i],[[g,M+"cast"],[_,B],[v,i]],[/droid.+aft(\w+)( bui|\))/i],[g,[_,r],[v,i]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[g,[_,ce],[v,i]],[/(bravia[\w ]+)( bui|\))/i],[g,[_,te],[v,i]],[/(mitv-\w{5}) bui/i],[g,[_,ue],[v,i]],[/Hbbtv.*(technisat) (.*);/i],[_,g,[v,i]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_,_t],[g,_t],[v,i]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[v,i]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_,g,[v,m]],[/droid.+; (shield) bui/i],[g,[_,"Nvidia"],[v,m]],[/(playstation [345portablevi]+)/i],[g,[_,te],[v,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[g,[_,oe],[v,m]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[g,[_,ke],[v,t]],[/((pebble))app/i],[_,g,[v,t]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[g,[_,a],[v,t]],[/droid.+; (glass) \d/i],[g,[_,B],[v,t]],[/droid.+; (wt63?0{2,3})\)/i],[g,[_,pe],[v,t]],[/droid.+; (glass) \d/i],[g,[_,B],[v,t]],[/(pico) (4|neo3(?: link|pro)?)/i],[_,g,[v,t]],[/; (quest( \d| pro)?)/i],[g,[_,he],[v,t]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_,[v,n]],[/(aeobc)\b/i],[g,[_,r],[v,n]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[g,[v,E]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[g,[v,s]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[v,s]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[v,E]],[/(android[-\w\. ]{0,9});.+buil/i],[g,[_,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[b,[h,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[h,b],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[b,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,b],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[b,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,b],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[b,ft,xt]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[b,ft,xt],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[b,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,Ot],[b,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[b,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,b],[/\(bb(10);/i],[b,[h,P]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[b,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[b,[h,j+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[b,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[b,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[b,[h,M+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,Ze],b],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,b],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],b],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,b]]},cr=function(Gt,Ke){if(typeof Gt===o&&(Ke=Gt,Gt=d),!(this instanceof cr))return new cr(Gt,Ke).getResult();var Ct=typeof S!==f&&S.navigator?S.navigator:d,dr=Gt||(Ct&&Ct.userAgent?Ct.userAgent:""),xe=Ct&&Ct.userAgentData?Ct.userAgentData:d,Ye=Ke?function(pt,rr){var jr={};for(var Hr in pt)rr[Hr]&&rr[Hr].length%2==0?jr[Hr]=rr[Hr].concat(pt[Hr]):jr[Hr]=pt[Hr];return jr}($r,Ke):$r,zt=Ct&&Ct.userAgent==dr;return this.getBrowser=function(){var pt,rr={};return rr[h]=d,rr[b]=d,vr.call(rr,dr,Ye.browser),rr[e]=typeof(pt=rr[b])===c?pt.replace(/[^\d\.]/g,"").split(".")[0]:d,zt&&Ct&&Ct.brave&&typeof Ct.brave.isBrave==u&&(rr[h]="Brave"),rr},this.getCPU=function(){var pt={};return pt[p]=d,vr.call(pt,dr,Ye.cpu),pt},this.getDevice=function(){var pt={};return pt[_]=d,pt[g]=d,pt[v]=d,vr.call(pt,dr,Ye.device),zt&&!pt[v]&&xe&&xe.mobile&&(pt[v]=E),zt&&pt[g]=="Macintosh"&&Ct&&typeof Ct.standalone!==f&&Ct.maxTouchPoints&&Ct.maxTouchPoints>2&&(pt[g]="iPad",pt[v]=s),pt},this.getEngine=function(){var pt={};return pt[h]=d,pt[b]=d,vr.call(pt,dr,Ye.engine),pt},this.getOS=function(){var pt={};return pt[h]=d,pt[b]=d,vr.call(pt,dr,Ye.os),zt&&!pt[h]&&xe&&xe.platform&&xe.platform!="Unknown"&&(pt[h]=xe.platform.replace(/chrome os/i,Ze).replace(/macos/i,Ot)),pt},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return dr},this.setUA=function(pt){return dr=typeof pt===c&&pt.length>500?_t(pt,500):pt,this},this.setUA(dr),this};cr.VERSION="1.0.40",cr.BROWSER=st([h,b,e]),cr.CPU=st([p]),cr.DEVICE=st([g,_,v,m,E,i,s,t,n]),cr.ENGINE=cr.OS=st([h,b]),typeof C!==f?(G.exports&&(C=G.exports=cr),C.UAParser=cr):l.amdO?(k=(function(){return cr}).call(C,l,C,G))===d||(G.exports=k):typeof S!==f&&(S.UAParser=cr);var yr=typeof S!==f&&(S.jQuery||S.Zepto);if(yr&&!yr.ua){var Jr=new cr;yr.ua=Jr.getResult(),yr.ua.get=function(){return Jr.getUA()},yr.ua.set=function(Gt){Jr.setUA(Gt);var Ke=Jr.getResult();for(var Ct in Ke)yr.ua[Ct]=Ke[Ct]}}})(typeof window=="object"?window:this)},952:(G,C,l)=>{var k;if(typeof globalThis=="object")k=globalThis;else try{k=l(4903)}catch{}finally{if(k||typeof window>"u"||(k=window),!k)throw new Error("Could not determine global this")}var S=k.WebSocket||k.MozWebSocket,d=l(9840);function u(f,o){return o?new S(f,o):new S(f)}S&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(f){Object.defineProperty(u,f,{get:function(){return S[f]}})}),G.exports={w3cwebsocket:S?u:null,version:d}},9840:(G,C,l)=>{G.exports=l(9003).version},8624:(G,C,l)=>{l.r(C),l.d(C,{DOMException:()=>t,Headers:()=>e,Request:()=>m,Response:()=>s,fetch:()=>n});var k=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||l.g!==void 0&&l.g||{},S={searchParams:"URLSearchParams"in k,iterable:"Symbol"in k&&"iterator"in Symbol,blob:"FileReader"in k&&"Blob"in k&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in k,arrayBuffer:"ArrayBuffer"in k};if(S.arrayBuffer)var d=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(r){return r&&d.indexOf(Object.prototype.toString.call(r))>-1};function f(r){if(typeof r!="string"&&(r=String(r)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(r)||r==="")throw new TypeError('Invalid character in header field name: "'+r+'"');return r.toLowerCase()}function o(r){return typeof r!="string"&&(r=String(r)),r}function c(r){var a={next:function(){var y=r.shift();return{done:y===void 0,value:y}}};return S.iterable&&(a[Symbol.iterator]=function(){return a}),a}function e(r){this.map={},r instanceof e?r.forEach(function(a,y){this.append(y,a)},this):Array.isArray(r)?r.forEach(function(a){if(a.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+a.length);this.append(a[0],a[1])},this):r&&Object.getOwnPropertyNames(r).forEach(function(a){this.append(a,r[a])},this)}function g(r){if(!r._noBody)return r.bodyUsed?Promise.reject(new TypeError("Already read")):void(r.bodyUsed=!0)}function h(r){return new Promise(function(a,y){r.onload=function(){a(r.result)},r.onerror=function(){y(r.error)}})}function v(r){var a=new FileReader,y=h(a);return a.readAsArrayBuffer(r),y}function _(r){if(r.slice)return r.slice(0);var a=new Uint8Array(r.byteLength);return a.set(new Uint8Array(r)),a.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(r){var a;this.bodyUsed=this.bodyUsed,this._bodyInit=r,r?typeof r=="string"?this._bodyText=r:S.blob&&Blob.prototype.isPrototypeOf(r)?this._bodyBlob=r:S.formData&&FormData.prototype.isPrototypeOf(r)?this._bodyFormData=r:S.searchParams&&URLSearchParams.prototype.isPrototypeOf(r)?this._bodyText=r.toString():S.arrayBuffer&&S.blob&&(a=r)&&DataView.prototype.isPrototypeOf(a)?(this._bodyArrayBuffer=_(r.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):S.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(r)||u(r))?this._bodyArrayBuffer=_(r):this._bodyText=r=Object.prototype.toString.call(r):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof r=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):S.searchParams&&URLSearchParams.prototype.isPrototypeOf(r)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},S.blob&&(this.blob=function(){var r=g(this);if(r)return r;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var r=g(this);return r||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}if(S.blob)return this.blob().then(v);throw new Error("could not read as ArrayBuffer")},this.text=function(){var r,a,y,P,O,M=g(this);if(M)return M;if(this._bodyBlob)return r=this._bodyBlob,a=new FileReader,y=h(a),P=/charset=([A-Za-z0-9_-]+)/.exec(r.type),O=P?P[1]:"utf-8",a.readAsText(r,O),y;if(this._bodyArrayBuffer)return Promise.resolve(function(j){for(var B=new Uint8Array(j),Q=new Array(B.length),re=0;re<B.length;re++)Q[re]=String.fromCharCode(B[re]);return Q.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},S.formData&&(this.formData=function(){return this.text().then(E)}),this.json=function(){return this.text().then(JSON.parse)},this}e.prototype.append=function(r,a){r=f(r),a=o(a);var y=this.map[r];this.map[r]=y?y+", "+a:a},e.prototype.delete=function(r){delete this.map[f(r)]},e.prototype.get=function(r){return r=f(r),this.has(r)?this.map[r]:null},e.prototype.has=function(r){return this.map.hasOwnProperty(f(r))},e.prototype.set=function(r,a){this.map[f(r)]=o(a)},e.prototype.forEach=function(r,a){for(var y in this.map)this.map.hasOwnProperty(y)&&r.call(a,this.map[y],y,this)},e.prototype.keys=function(){var r=[];return this.forEach(function(a,y){r.push(y)}),c(r)},e.prototype.values=function(){var r=[];return this.forEach(function(a){r.push(a)}),c(r)},e.prototype.entries=function(){var r=[];return this.forEach(function(a,y){r.push([y,a])}),c(r)},S.iterable&&(e.prototype[Symbol.iterator]=e.prototype.entries);var p=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function m(r,a){if(!(this instanceof m))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var y,P,O=(a=a||{}).body;if(r instanceof m){if(r.bodyUsed)throw new TypeError("Already read");this.url=r.url,this.credentials=r.credentials,a.headers||(this.headers=new e(r.headers)),this.method=r.method,this.mode=r.mode,this.signal=r.signal,O||r._bodyInit==null||(O=r._bodyInit,r.bodyUsed=!0)}else this.url=String(r);if(this.credentials=a.credentials||this.credentials||"same-origin",!a.headers&&this.headers||(this.headers=new e(a.headers)),this.method=(y=a.method||this.method||"GET",P=y.toUpperCase(),p.indexOf(P)>-1?P:y),this.mode=a.mode||this.mode||null,this.signal=a.signal||this.signal||function(){if("AbortController"in k)return new AbortController().signal}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&O)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(O),!(this.method!=="GET"&&this.method!=="HEAD"||a.cache!=="no-store"&&a.cache!=="no-cache")){var M=/([?&])_=[^&]*/;M.test(this.url)?this.url=this.url.replace(M,"$1_="+new Date().getTime()):this.url+=(/\?/.test(this.url)?"&":"?")+"_="+new Date().getTime()}}function E(r){var a=new FormData;return r.trim().split("&").forEach(function(y){if(y){var P=y.split("="),O=P.shift().replace(/\+/g," "),M=P.join("=").replace(/\+/g," ");a.append(decodeURIComponent(O),decodeURIComponent(M))}}),a}function s(r,a){if(!(this instanceof s))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(a||(a={}),this.type="default",this.status=a.status===void 0?200:a.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=a.statusText===void 0?"":""+a.statusText,this.headers=new e(a.headers),this.url=a.url||"",this._initBody(r)}m.prototype.clone=function(){return new m(this,{body:this._bodyInit})},b.call(m.prototype),b.call(s.prototype),s.prototype.clone=function(){return new s(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new e(this.headers),url:this.url})},s.error=function(){var r=new s(null,{status:200,statusText:""});return r.ok=!1,r.status=0,r.type="error",r};var i=[301,302,303,307,308];s.redirect=function(r,a){if(i.indexOf(a)===-1)throw new RangeError("Invalid status code");return new s(null,{status:a,headers:{location:r}})};var t=k.DOMException;try{new t}catch{(t=function(a,y){this.message=a,this.name=y;var P=Error(a);this.stack=P.stack}).prototype=Object.create(Error.prototype),t.prototype.constructor=t}function n(r,a){return new Promise(function(y,P){var O=new m(r,a);if(O.signal&&O.signal.aborted)return P(new t("Aborted","AbortError"));var M=new XMLHttpRequest;function j(){M.abort()}if(M.onload=function(){var Q,re,oe={statusText:M.statusText,headers:(Q=M.getAllResponseHeaders()||"",re=new e,Q.replace(/\r?\n[\t ]+/g," ").split("\r").map(function(ve){return ve.indexOf(`
`)===0?ve.substr(1,ve.length):ve}).forEach(function(ve){var ke=ve.split(":"),ce=ke.shift().trim();if(ce){var te=ke.join(":").trim();try{re.append(ce,te)}catch(ue){console.warn("Response "+ue.message)}}}),re)};O.url.indexOf("file://")===0&&(M.status<200||M.status>599)?oe.status=200:oe.status=M.status,oe.url="responseURL"in M?M.responseURL:oe.headers.get("X-Request-URL");var le="response"in M?M.response:M.responseText;setTimeout(function(){y(new s(le,oe))},0)},M.onerror=function(){setTimeout(function(){P(new TypeError("Network request failed"))},0)},M.ontimeout=function(){setTimeout(function(){P(new TypeError("Network request timed out"))},0)},M.onabort=function(){setTimeout(function(){P(new t("Aborted","AbortError"))},0)},M.open(O.method,function(Q){try{return Q===""&&k.location.href?k.location.href:Q}catch{return Q}}(O.url),!0),O.credentials==="include"?M.withCredentials=!0:O.credentials==="omit"&&(M.withCredentials=!1),"responseType"in M&&(S.blob?M.responseType="blob":S.arrayBuffer&&(M.responseType="arraybuffer")),a&&typeof a.headers=="object"&&!(a.headers instanceof e||k.Headers&&a.headers instanceof k.Headers)){var B=[];Object.getOwnPropertyNames(a.headers).forEach(function(Q){B.push(f(Q)),M.setRequestHeader(Q,o(a.headers[Q]))}),O.headers.forEach(function(Q,re){B.indexOf(re)===-1&&M.setRequestHeader(re,Q)})}else O.headers.forEach(function(Q,re){M.setRequestHeader(re,Q)});O.signal&&(O.signal.addEventListener("abort",j),M.onreadystatechange=function(){M.readyState===4&&O.signal.removeEventListener("abort",j)}),M.send(O._bodyInit===void 0?null:O._bodyInit)})}n.polyfill=!0,k.fetch||(k.fetch=n,k.Headers=e,k.Request=m,k.Response=s)},477:()=>{},4633:(G,C,l)=>{var k=l(3738).default;function S(){G.exports=S=function(){return u},G.exports.__esModule=!0,G.exports.default=G.exports;var d,u={},f=Object.prototype,o=f.hasOwnProperty,c=Object.defineProperty||function(ce,te,ue){ce[te]=ue.value},e=typeof Symbol=="function"?Symbol:{},g=e.iterator||"@@iterator",h=e.asyncIterator||"@@asyncIterator",v=e.toStringTag||"@@toStringTag";function _(ce,te,ue){return Object.defineProperty(ce,te,{value:ue,enumerable:!0,configurable:!0,writable:!0}),ce[te]}try{_({},"")}catch{_=function(te,ue,pe){return te[ue]=pe}}function b(ce,te,ue,pe){var he=te&&te.prototype instanceof n?te:n,Ze=Object.create(he.prototype),Ot=new ve(pe||[]);return c(Ze,"_invoke",{value:Q(ce,ue,Ot)}),Ze}function p(ce,te,ue){try{return{type:"normal",arg:ce.call(te,ue)}}catch(pe){return{type:"throw",arg:pe}}}u.wrap=b;var m="suspendedStart",E="suspendedYield",s="executing",i="completed",t={};function n(){}function r(){}function a(){}var y={};_(y,g,function(){return this});var P=Object.getPrototypeOf,O=P&&P(P(ke([])));O&&O!==f&&o.call(O,g)&&(y=O);var M=a.prototype=n.prototype=Object.create(y);function j(ce){["next","throw","return"].forEach(function(te){_(ce,te,function(ue){return this._invoke(te,ue)})})}function B(ce,te){function ue(he,Ze,Ot,Ht){var st=p(ce[he],ce,Ze);if(st.type!=="throw"){var _r=st.arg,jt=_r.value;return jt&&k(jt)=="object"&&o.call(jt,"__await")?te.resolve(jt.__await).then(function(_t){ue("next",_t,Ot,Ht)},function(_t){ue("throw",_t,Ot,Ht)}):te.resolve(jt).then(function(_t){_r.value=_t,Ot(_r)},function(_t){return ue("throw",_t,Ot,Ht)})}Ht(st.arg)}var pe;c(this,"_invoke",{value:function(he,Ze){function Ot(){return new te(function(Ht,st){ue(he,Ze,Ht,st)})}return pe=pe?pe.then(Ot,Ot):Ot()}})}function Q(ce,te,ue){var pe=m;return function(he,Ze){if(pe===s)throw Error("Generator is already running");if(pe===i){if(he==="throw")throw Ze;return{value:d,done:!0}}for(ue.method=he,ue.arg=Ze;;){var Ot=ue.delegate;if(Ot){var Ht=re(Ot,ue);if(Ht){if(Ht===t)continue;return Ht}}if(ue.method==="next")ue.sent=ue._sent=ue.arg;else if(ue.method==="throw"){if(pe===m)throw pe=i,ue.arg;ue.dispatchException(ue.arg)}else ue.method==="return"&&ue.abrupt("return",ue.arg);pe=s;var st=p(ce,te,ue);if(st.type==="normal"){if(pe=ue.done?i:E,st.arg===t)continue;return{value:st.arg,done:ue.done}}st.type==="throw"&&(pe=i,ue.method="throw",ue.arg=st.arg)}}}function re(ce,te){var ue=te.method,pe=ce.iterator[ue];if(pe===d)return te.delegate=null,ue==="throw"&&ce.iterator.return&&(te.method="return",te.arg=d,re(ce,te),te.method==="throw")||ue!=="return"&&(te.method="throw",te.arg=new TypeError("The iterator does not provide a '"+ue+"' method")),t;var he=p(pe,ce.iterator,te.arg);if(he.type==="throw")return te.method="throw",te.arg=he.arg,te.delegate=null,t;var Ze=he.arg;return Ze?Ze.done?(te[ce.resultName]=Ze.value,te.next=ce.nextLoc,te.method!=="return"&&(te.method="next",te.arg=d),te.delegate=null,t):Ze:(te.method="throw",te.arg=new TypeError("iterator result is not an object"),te.delegate=null,t)}function oe(ce){var te={tryLoc:ce[0]};1 in ce&&(te.catchLoc=ce[1]),2 in ce&&(te.finallyLoc=ce[2],te.afterLoc=ce[3]),this.tryEntries.push(te)}function le(ce){var te=ce.completion||{};te.type="normal",delete te.arg,ce.completion=te}function ve(ce){this.tryEntries=[{tryLoc:"root"}],ce.forEach(oe,this),this.reset(!0)}function ke(ce){if(ce||ce===""){var te=ce[g];if(te)return te.call(ce);if(typeof ce.next=="function")return ce;if(!isNaN(ce.length)){var ue=-1,pe=function he(){for(;++ue<ce.length;)if(o.call(ce,ue))return he.value=ce[ue],he.done=!1,he;return he.value=d,he.done=!0,he};return pe.next=pe}}throw new TypeError(k(ce)+" is not iterable")}return r.prototype=a,c(M,"constructor",{value:a,configurable:!0}),c(a,"constructor",{value:r,configurable:!0}),r.displayName=_(a,v,"GeneratorFunction"),u.isGeneratorFunction=function(ce){var te=typeof ce=="function"&&ce.constructor;return!!te&&(te===r||(te.displayName||te.name)==="GeneratorFunction")},u.mark=function(ce){return Object.setPrototypeOf?Object.setPrototypeOf(ce,a):(ce.__proto__=a,_(ce,v,"GeneratorFunction")),ce.prototype=Object.create(M),ce},u.awrap=function(ce){return{__await:ce}},j(B.prototype),_(B.prototype,h,function(){return this}),u.AsyncIterator=B,u.async=function(ce,te,ue,pe,he){he===void 0&&(he=Promise);var Ze=new B(b(ce,te,ue,pe),he);return u.isGeneratorFunction(te)?Ze:Ze.next().then(function(Ot){return Ot.done?Ot.value:Ze.next()})},j(M),_(M,v,"Generator"),_(M,g,function(){return this}),_(M,"toString",function(){return"[object Generator]"}),u.keys=function(ce){var te=Object(ce),ue=[];for(var pe in te)ue.push(pe);return ue.reverse(),function he(){for(;ue.length;){var Ze=ue.pop();if(Ze in te)return he.value=Ze,he.done=!1,he}return he.done=!0,he}},u.values=ke,ve.prototype={constructor:ve,reset:function(ce){if(this.prev=0,this.next=0,this.sent=this._sent=d,this.done=!1,this.delegate=null,this.method="next",this.arg=d,this.tryEntries.forEach(le),!ce)for(var te in this)te.charAt(0)==="t"&&o.call(this,te)&&!isNaN(+te.slice(1))&&(this[te]=d)},stop:function(){this.done=!0;var ce=this.tryEntries[0].completion;if(ce.type==="throw")throw ce.arg;return this.rval},dispatchException:function(ce){if(this.done)throw ce;var te=this;function ue(st,_r){return Ze.type="throw",Ze.arg=ce,te.next=st,_r&&(te.method="next",te.arg=d),!!_r}for(var pe=this.tryEntries.length-1;pe>=0;--pe){var he=this.tryEntries[pe],Ze=he.completion;if(he.tryLoc==="root")return ue("end");if(he.tryLoc<=this.prev){var Ot=o.call(he,"catchLoc"),Ht=o.call(he,"finallyLoc");if(Ot&&Ht){if(this.prev<he.catchLoc)return ue(he.catchLoc,!0);if(this.prev<he.finallyLoc)return ue(he.finallyLoc)}else if(Ot){if(this.prev<he.catchLoc)return ue(he.catchLoc,!0)}else{if(!Ht)throw Error("try statement without catch or finally");if(this.prev<he.finallyLoc)return ue(he.finallyLoc)}}}},abrupt:function(ce,te){for(var ue=this.tryEntries.length-1;ue>=0;--ue){var pe=this.tryEntries[ue];if(pe.tryLoc<=this.prev&&o.call(pe,"finallyLoc")&&this.prev<pe.finallyLoc){var he=pe;break}}he&&(ce==="break"||ce==="continue")&&he.tryLoc<=te&&te<=he.finallyLoc&&(he=null);var Ze=he?he.completion:{};return Ze.type=ce,Ze.arg=te,he?(this.method="next",this.next=he.finallyLoc,t):this.complete(Ze)},complete:function(ce,te){if(ce.type==="throw")throw ce.arg;return ce.type==="break"||ce.type==="continue"?this.next=ce.arg:ce.type==="return"?(this.rval=this.arg=ce.arg,this.method="return",this.next="end"):ce.type==="normal"&&te&&(this.next=te),t},finish:function(ce){for(var te=this.tryEntries.length-1;te>=0;--te){var ue=this.tryEntries[te];if(ue.finallyLoc===ce)return this.complete(ue.completion,ue.afterLoc),le(ue),t}},catch:function(ce){for(var te=this.tryEntries.length-1;te>=0;--te){var ue=this.tryEntries[te];if(ue.tryLoc===ce){var pe=ue.completion;if(pe.type==="throw"){var he=pe.arg;le(ue)}return he}}throw Error("illegal catch attempt")},delegateYield:function(ce,te,ue){return this.delegate={iterator:ke(ce),resultName:te,nextLoc:ue},this.method==="next"&&(this.arg=d),t}},u}G.exports=S,G.exports.__esModule=!0,G.exports.default=G.exports},3738:G=>{function C(l){return G.exports=C=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(k){return typeof k}:function(k){return k&&typeof Symbol=="function"&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},G.exports.__esModule=!0,G.exports.default=G.exports,C(l)}G.exports=C,G.exports.__esModule=!0,G.exports.default=G.exports},4756:(G,C,l)=>{var k=l(4633)();G.exports=k;try{regeneratorRuntime=k}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=k:Function("r","regeneratorRuntime = r")(k)}},3145:(G,C,l)=>{function k(S,d){(d==null||d>S.length)&&(d=S.length);for(var u=0,f=Array(d);u<d;u++)f[u]=S[u];return f}l.d(C,{A:()=>k})},467:(G,C,l)=>{function k(d,u,f,o,c,e,g){try{var h=d[e](g),v=h.value}catch(_){return void f(_)}h.done?u(v):Promise.resolve(v).then(o,c)}function S(d){return function(){var u=this,f=arguments;return new Promise(function(o,c){var e=d.apply(u,f);function g(v){k(e,o,c,g,h,"next",v)}function h(v){k(e,o,c,g,h,"throw",v)}g(void 0)})}}l.d(C,{A:()=>S})},3029:(G,C,l)=>{function k(S,d){if(!(S instanceof d))throw new TypeError("Cannot call a class as a function")}l.d(C,{A:()=>k})},2901:(G,C,l)=>{l.d(C,{A:()=>d});var k=l(816);function S(u,f){for(var o=0;o<f.length;o++){var c=f[o];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(u,(0,k.A)(c.key),c)}}function d(u,f,o){return f&&S(u.prototype,f),o&&S(u,o),Object.defineProperty(u,"prototype",{writable:!1}),u}},4467:(G,C,l)=>{l.d(C,{A:()=>S});var k=l(816);function S(d,u,f){return(u=(0,k.A)(u))in d?Object.defineProperty(d,u,{value:f,enumerable:!0,configurable:!0,writable:!0}):d[u]=f,d}},296:(G,C,l)=>{l.d(C,{A:()=>S});var k=l(7800);function S(d,u){return function(f){if(Array.isArray(f))return f}(d)||function(f,o){var c=f==null?null:typeof Symbol<"u"&&f[Symbol.iterator]||f["@@iterator"];if(c!=null){var e,g,h,v,_=[],b=!0,p=!1;try{if(h=(c=c.call(f)).next,o===0){if(Object(c)!==c)return;b=!1}else for(;!(b=(e=h.call(c)).done)&&(_.push(e.value),_.length!==o);b=!0);}catch(m){p=!0,g=m}finally{try{if(!b&&c.return!=null&&(v=c.return(),Object(v)!==v))return}finally{if(p)throw g}}return _}}(d,u)||(0,k.A)(d,u)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},5458:(G,C,l)=>{l.d(C,{A:()=>d});var k=l(3145),S=l(7800);function d(u){return function(f){if(Array.isArray(f))return(0,k.A)(f)}(u)||function(f){if(typeof Symbol<"u"&&f[Symbol.iterator]!=null||f["@@iterator"]!=null)return Array.from(f)}(u)||(0,S.A)(u)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}},816:(G,C,l)=>{l.d(C,{A:()=>S});var k=l(2284);function S(d){var u=function(f,o){if((0,k.A)(f)!="object"||!f)return f;var c=f[Symbol.toPrimitive];if(c!==void 0){var e=c.call(f,o||"default");if((0,k.A)(e)!="object")return e;throw new TypeError("@@toPrimitive must return a primitive value.")}return(o==="string"?String:Number)(f)}(d,"string");return(0,k.A)(u)=="symbol"?u:u+""}},2284:(G,C,l)=>{function k(S){return k=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(d){return typeof d}:function(d){return d&&typeof Symbol=="function"&&d.constructor===Symbol&&d!==Symbol.prototype?"symbol":typeof d},k(S)}l.d(C,{A:()=>k})},7800:(G,C,l)=>{l.d(C,{A:()=>S});var k=l(3145);function S(d,u){if(d){if(typeof d=="string")return(0,k.A)(d,u);var f={}.toString.call(d).slice(8,-1);return f==="Object"&&d.constructor&&(f=d.constructor.name),f==="Map"||f==="Set"?Array.from(d):f==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(f)?(0,k.A)(d,u):void 0}}},7949:G=>{G.exports=JSON.parse('{"name":"protoo-client","version":"4.0.6","description":"protoo JavaScript client module","author":"Iñaki Baz Castillo <ibc@aliax.net>","homepage":"https://protoo.versatica.com","license":"MIT","repository":{"type":"git","url":"https://github.com/ibc/protoo.git"},"main":"lib/index.js","keywords":["nodejs","browser","websocket"],"engines":{"node":">=8.0.0"},"scripts":{"lint":"eslint -c .eslintrc.js lib"},"dependencies":{"debug":"^4.3.1","events":"^3.2.0","retry":"^0.12.0"},"devDependencies":{"eslint":"^5.16.0"},"optionalDependencies":{"websocket":"^1.0.33"}}')},9003:G=>{G.exports={version:"1.0.35"}}},fe={};function De(G){var C=fe[G];if(C!==void 0)return C.exports;var l=fe[G]={exports:{}};return se[G].call(l.exports,l,l.exports,De),l.exports}De.amdO={},De.n=G=>{var C=G&&G.__esModule?()=>G.default:()=>G;return De.d(C,{a:C}),C},De.d=(G,C)=>{for(var l in C)De.o(C,l)&&!De.o(G,l)&&Object.defineProperty(G,l,{enumerable:!0,get:C[l]})},De.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),De.o=(G,C)=>Object.prototype.hasOwnProperty.call(G,C),De.r=G=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(G,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(G,"__esModule",{value:!0})};var Pt={};return(()=>{De.r(Pt),De.d(Pt,{CameraDeviceInfo:()=>vs,DeviceInfo:()=>ts,MicrophoneDeviceInfo:()=>ys,VideoSDK:()=>ei,ZujoSDK:()=>Dc});var G=De(2284),C=De(467),l=De(3029),k=De(2901),S=De(4467),d=De(4756),u=De.n(d),f=De(6880),o=De.n(f);function c(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function e(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?c(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):c(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}function g(w){return"Minified Redux error #"+w+"; visit https://redux.js.org/Errors?code="+w+" for the full message or use the non-minified dev environment for full errors. "}var h=typeof Symbol=="function"&&Symbol.observable||"@@observable",v=function(){return Math.random().toString(36).substring(7).split("").join(".")},_={INIT:"@@redux/INIT"+v(),REPLACE:"@@redux/REPLACE"+v(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+v()}};function b(w){if(typeof w!="object"||w===null)return!1;for(var R=w;Object.getPrototypeOf(R)!==null;)R=Object.getPrototypeOf(R);return Object.getPrototypeOf(w)===R}function p(w,R,T){var F;if(typeof R=="function"&&typeof T=="function"||typeof T=="function"&&typeof arguments[3]=="function")throw new Error(g(0));if(typeof R=="function"&&T===void 0&&(T=R,R=void 0),T!==void 0){if(typeof T!="function")throw new Error(g(1));return T(p)(w,R)}if(typeof w!="function")throw new Error(g(2));var $=w,Y=R,ee=[],ne=ee,L=!1;function W(){ne===ee&&(ne=ee.slice())}function q(){if(L)throw new Error(g(3));return Y}function z(Ee){if(typeof Ee!="function")throw new Error(g(4));if(L)throw new Error(g(5));var Je=!0;return W(),ne.push(Ee),function(){if(Je){if(L)throw new Error(g(6));Je=!1,W();var _e=ne.indexOf(Ee);ne.splice(_e,1),ee=null}}}function ye(Ee){if(!b(Ee))throw new Error(g(7));if(Ee.type===void 0)throw new Error(g(8));if(L)throw new Error(g(9));try{L=!0,Y=$(Y,Ee)}finally{L=!1}for(var Je=ee=ne,_e=0;_e<Je.length;_e++)(0,Je[_e])();return Ee}return ye({type:_.INIT}),(F={dispatch:ye,subscribe:z,getState:q,replaceReducer:function(Ee){if(typeof Ee!="function")throw new Error(g(10));$=Ee,ye({type:_.REPLACE})}})[h]=function(){var Ee,Je=z;return(Ee={subscribe:function(_e){if(typeof _e!="object"||_e===null)throw new Error(g(11));function Be(){_e.next&&_e.next(q())}return Be(),{unsubscribe:Je(Be)}}})[h]=function(){return this},Ee},F}function m(){for(var w=arguments.length,R=new Array(w),T=0;T<w;T++)R[T]=arguments[T];return R.length===0?function(F){return F}:R.length===1?R[0]:R.reduce(function(F,$){return function(){return F($.apply(void 0,arguments))}})}function E(){for(var w=arguments.length,R=new Array(w),T=0;T<w;T++)R[T]=arguments[T];return function(F){return function(){var $=F.apply(void 0,arguments),Y=function(){throw new Error(g(15))},ee={getState:$.getState,dispatch:function(){return Y.apply(void 0,arguments)}},ne=R.map(function(L){return L(ee)});return Y=m.apply(void 0,ne)($.dispatch),e(e({},$),{},{dispatch:Y})}}}function s(w){return function(R){var T=R.dispatch,F=R.getState;return function($){return function(Y){return typeof Y=="function"?Y(T,F,w):$(Y)}}}}var i=s();i.withExtraArgument=s;const t=i;var n=De(2211),r=De.n(n);function a(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function y(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?a(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):a(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}var P={url:null,state:"new",activeSpeakerId:null,statsPeerId:null,faceDetection:!1};const O=function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:P,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"SET_ROOM_URL":var T=R.payload.url;return y(y({},w),{},{url:T});case"SET_ROOM_STATE":var F=R.payload.state;return y(y({},w),{},F==="connected"?{state:F}:{state:F,activeSpeakerId:null,statsPeerId:null});case"SET_ROOM_ACTIVE_SPEAKER":var $=R.payload.peerId;return y(y({},w),{},{activeSpeakerId:$});case"SET_ROOM_STATS_PEER_ID":var Y=R.payload.peerId;return w.statsPeerId===Y?y(y({},w),{},{statsPeerId:null}):y(y({},w),{},{statsPeerId:Y});case"SET_FACE_DETECTION":var ee=R.payload;return y(y({},w),{},{faceDetection:ee});case"REMOVE_PEER":var ne=R.payload.peerId,L=y({},w);return ne&&ne===w.activeSpeakerId&&(L.activeSpeakerId=null),ne&&ne===w.statsPeerId&&(L.statsPeerId=null),L;default:return w}};function M(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function j(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?M(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):M(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}var B={id:null,displayName:null,displayNameSet:!1,device:null,canSendMic:!1,canSendWebcam:!1,canChangeWebcam:!1,webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1};const Q=function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:B,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"SET_ROOM_STATE":return R.payload.state==="closed"?j(j({},w),{},{webcamInProgress:!1,shareInProgress:!1,audioOnly:!1,audioOnlyInProgress:!1,audioMuted:!1,restartIceInProgress:!1}):w;case"SET_ME":var T=R.payload,F=T.peerId,$=T.displayName,Y=T.displayNameSet,ee=T.device;return j(j({},w),{},{id:F,displayName:$,displayNameSet:Y,device:ee});case"SET_MEDIA_CAPABILITIES":var ne=R.payload,L=ne.canSendMic,W=ne.canSendWebcam;return j(j({},w),{},{canSendMic:L,canSendWebcam:W});case"SET_CAN_CHANGE_WEBCAM":var q=R.payload;return j(j({},w),{},{canChangeWebcam:q});case"SET_WEBCAM_IN_PROGRESS":var z=R.payload.flag;return j(j({},w),{},{webcamInProgress:z});case"SET_SHARE_IN_PROGRESS":var ye=R.payload.flag;return j(j({},w),{},{shareInProgress:ye});case"SET_DISPLAY_NAME":var Ee=R.payload.displayName;return Ee||(Ee=w.displayName),j(j({},w),{},{displayName:Ee,displayNameSet:!0});case"SET_AUDIO_ONLY_STATE":var Je=R.payload.enabled;return j(j({},w),{},{audioOnly:Je});case"SET_AUDIO_ONLY_IN_PROGRESS":var _e=R.payload.flag;return j(j({},w),{},{audioOnlyInProgress:_e});case"SET_AUDIO_MUTED_STATE":var Be=R.payload.enabled;return j(j({},w),{},{audioMuted:Be});case"SET_RESTART_ICE_IN_PROGRESS":var be=R.payload.flag;return j(j({},w),{},{restartIceInProgress:be});default:return w}};function re(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function oe(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?re(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):re(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}var le={};const ve=function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:le,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"SET_ROOM_STATE":return R.payload.state==="closed"?{}:w;case"ADD_PRODUCER":var T=R.payload.producer;return oe(oe({},w),{},(0,S.A)({},T.id,T));case"REMOVE_PRODUCER":var F=R.payload.producerId,$=oe({},w);return delete $[F],$;case"SET_PRODUCER_PAUSED":var Y=R.payload.producerId,ee=oe(oe({},w[Y]),{},{paused:!0});return oe(oe({},w),{},(0,S.A)({},Y,ee));case"SET_PRODUCER_RESUMED":var ne=R.payload.producerId,L=oe(oe({},w[ne]),{},{paused:!1});return oe(oe({},w),{},(0,S.A)({},ne,L));case"SET_PRODUCER_TRACK":var W=R.payload,q=W.producerId,z=W.track,ye=oe(oe({},w[q]),{},{track:z});return oe(oe({},w),{},(0,S.A)({},q,ye));case"SET_PRODUCER_SCORE":var Ee=R.payload,Je=Ee.producerId,_e=Ee.score,Be=w[Je];if(!Be)return w;var be=oe(oe({},Be),{},{score:_e});return oe(oe({},w),{},(0,S.A)({},Je,be));default:return w}};function ke(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function ce(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?ke(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):ke(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}var te={};const ue=function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:te,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"SET_ROOM_STATE":return R.payload.state==="closed"?{}:w;case"ADD_DATA_PRODUCER":var T=R.payload.dataProducer;return ce(ce({},w),{},(0,S.A)({},T.id,T));case"REMOVE_DATA_PRODUCER":var F=R.payload.dataProducerId,$=ce({},w);return delete $[F],$;default:return w}};var pe=De(5458);function he(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function Ze(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?he(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):he(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}var Ot={};function Ht(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function st(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?Ht(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):Ht(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}var _r={};function jt(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function _t(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?jt(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):jt(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}var vr={},ft=[];const xt=function(w){for(var R=Object.keys(w),T={},F=0;F<R.length;F++){var $=R[F];typeof w[$]=="function"&&(T[$]=w[$])}var Y,ee=Object.keys(T);try{(function(ne){Object.keys(ne).forEach(function(L){var W=ne[L];if(W(void 0,{type:_.INIT})===void 0)throw new Error(g(12));if(W(void 0,{type:_.PROBE_UNKNOWN_ACTION()})===void 0)throw new Error(g(13))})})(T)}catch(ne){Y=ne}return function(ne,L){if(ne===void 0&&(ne={}),Y)throw Y;for(var W=!1,q={},z=0;z<ee.length;z++){var ye=ee[z],Ee=T[ye],Je=ne[ye],_e=Ee(Je,L);if(_e===void 0)throw L&&L.type,new Error(g(14));q[ye]=_e,W=W||_e!==Je}return(W=W||ee.length!==Object.keys(ne).length)?q:ne}}({room:O,me:Q,producers:ve,dataProducers:ue,peers:function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Ot,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"SET_ROOM_STATE":return R.payload.state==="closed"?{}:w;case"ADD_PEER":var T=R.payload.peer;return Ze(Ze({},w),{},(0,S.A)({},T.id,T));case"REMOVE_PEER":var F=R.payload.peerId,$=Ze({},w);return delete $[F],$;case"SET_PEER_DISPLAY_NAME":var Y=R.payload,ee=Y.displayName,ne=w[Y.peerId];if(!ne)throw new Error("no Peer found");var L=Ze(Ze({},ne),{},{displayName:ee});return Ze(Ze({},w),{},(0,S.A)({},L.id,L));case"ADD_CONSUMER":var W=R.payload,q=W.consumer,z=w[W.peerId];if(!z)return Ze({},w);var ye=[].concat((0,pe.A)(z.consumers),[q.id]),Ee=Ze(Ze({},z),{},{consumers:ye});return Ze(Ze({},w),{},(0,S.A)({},Ee.id,Ee));case"REMOVE_CONSUMER":var Je=R.payload,_e=Je.consumerId,Be=w[Je.peerId];if(!Be)return w;var be=Be.consumers.indexOf(_e);if(be===-1)throw new Error("Consumer not found");var ae=Be.consumers.slice();ae.splice(be,1);var ct=Ze(Ze({},Be),{},{consumers:ae});return Ze(Ze({},w),{},(0,S.A)({},ct.id,ct));case"ADD_DATA_CONSUMER":var Ae=R.payload,nt=Ae.dataConsumer,tt=Ae.peerId;if(!tt)return w;var at=w[tt];if(!at)return Ze({},w);var ot=[].concat((0,pe.A)(at.dataConsumers),[nt.id]),Te=Ze(Ze({},at),{},{dataConsumers:ot});return Ze(Ze({},w),{},(0,S.A)({},Te.id,Te));case"REMOVE_DATA_CONSUMER":var Jt=R.payload,zr=Jt.dataConsumerId,kt=Jt.peerId;if(!kt)return w;var ln=w[kt];if(!ln)return w;var In=ln.dataConsumers.indexOf(zr);if(In===-1)throw new Error("DataConsumer not found");var ta=ln.dataConsumers.slice();ta.splice(In,1);var va=Ze(Ze({},ln),{},{dataConsumers:ta});return Ze(Ze({},w),{},(0,S.A)({},va.id,va));default:return w}},consumers:function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_r,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"SET_ROOM_STATE":return R.payload.state==="closed"?{}:w;case"ADD_CONSUMER":var T=R.payload.consumer;return st(st({},w),{},(0,S.A)({},T.id,T));case"REMOVE_CONSUMER":var F=R.payload.consumerId,$=st({},w);return delete $[F],$;case"SET_CONSUMER_PAUSED":var Y,ee=R.payload,ne=ee.consumerId,L=ee.originator,W=w[ne];return Y=st(st({},W),{},L==="local"?{locallyPaused:!0}:{remotelyPaused:!0}),st(st({},w),{},(0,S.A)({},ne,Y));case"SET_CONSUMER_RESUMED":var q,z=R.payload,ye=z.consumerId,Ee=z.originator,Je=w[ye];return q=st(st({},Je),{},Ee==="local"?{locallyPaused:!1}:{remotelyPaused:!1}),st(st({},w),{},(0,S.A)({},ye,q));case"SET_CONSUMER_CURRENT_LAYERS":var _e=R.payload,Be=_e.consumerId,be=_e.spatialLayer,ae=_e.temporalLayer,ct=st(st({},w[Be]),{},{currentSpatialLayer:be,currentTemporalLayer:ae});return st(st({},w),{},(0,S.A)({},Be,ct));case"SET_CONSUMER_PREFERRED_LAYERS":var Ae=R.payload,nt=Ae.consumerId,tt=Ae.spatialLayer,at=Ae.temporalLayer,ot=st(st({},w[nt]),{},{preferredSpatialLayer:tt,preferredTemporalLayer:at});return st(st({},w),{},(0,S.A)({},nt,ot));case"SET_CONSUMER_PRIORITY":var Te=R.payload,Jt=Te.consumerId,zr=Te.priority,kt=st(st({},w[Jt]),{},{priority:zr});return st(st({},w),{},(0,S.A)({},Jt,kt));case"SET_CONSUMER_TRACK":var ln=R.payload,In=ln.consumerId,ta=ln.track,va=st(st({},w[In]),{},{track:ta});return st(st({},w),{},(0,S.A)({},In,va));case"SET_CONSUMER_SCORE":var Ma=R.payload,Ra=Ma.consumerId,Hn=Ma.score,ri=w[Ra];if(!ri)return w;var ji=st(st({},ri),{},{score:Hn});return st(st({},w),{},(0,S.A)({},Ra,ji));default:return w}},dataConsumers:function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:vr,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"SET_ROOM_STATE":return R.payload.state==="closed"?{}:w;case"ADD_DATA_CONSUMER":var T=R.payload.dataConsumer;return _t(_t({},w),{},(0,S.A)({},T.id,T));case"REMOVE_DATA_CONSUMER":var F=R.payload.dataConsumerId,$=_t({},w);return delete $[F],$;default:return w}},notifications:function(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ft,R=arguments.length>1?arguments[1]:void 0;switch(R.type){case"ADD_NOTIFICATION":var T=R.payload.notification;return[].concat((0,pe.A)(w),[T]);case"REMOVE_NOTIFICATION":var F=R.payload.notificationId;return w.filter(function($){return $.id!==F});case"REMOVE_ALL_NOTIFICATIONS":return[];default:return w}}});var $r=De(8049),cr=De(7007),yr=De(296),Jr=(De(8049).default,(0,k.A)(function w(){(0,l.A)(this,w),this.roomClient=null})),Gt=new(function(){function w(){(0,l.A)(this,w),w.instance||(w.instance=new Jr)}return(0,k.A)(w,[{key:"getInstance",value:function(){return w.instance}}])}());Object.freeze(Gt);var Ke=Gt.getInstance(),Ct=function(){return(0,k.A)(function w(R){(0,l.A)(this,w),this.id=R.id,this.kind=R.track.kind,this.codec=R.codec,this.track=R.track,this.producerOrConsumer=R.instance,R.appData&&R.appData.share===!0&&R.track.kind==="video"&&(this.kind="share"),R.appData&&R.appData.share===!0&&R.track.kind==="audio"&&(this.kind="shareAudio")},[{key:"pause",value:function(){Ke.roomClient._pauseConsumer(this.producerOrConsumer)}},{key:"resume",value:function(){Ke.roomClient._resumeConsumer(this.producerOrConsumer)}},{key:"paused",get:function(){return this.producerOrConsumer.paused}}])}();function dr(w,R){var T=typeof Symbol<"u"&&w[Symbol.iterator]||w["@@iterator"];if(!T){if(Array.isArray(w)||(T=function(L,W){if(L){if(typeof L=="string")return xe(L,W);var q={}.toString.call(L).slice(8,-1);return q==="Object"&&L.constructor&&(q=L.constructor.name),q==="Map"||q==="Set"?Array.from(L):q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(q)?xe(L,W):void 0}}(w))||R){T&&(w=T);var F=0,$=function(){};return{s:$,n:function(){return F>=w.length?{done:!0}:{done:!1,value:w[F++]}},e:function(L){throw L},f:$}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Y,ee=!0,ne=!1;return{s:function(){T=T.call(w)},n:function(){var L=T.next();return ee=L.done,L},e:function(L){ne=!0,Y=L},f:function(){try{ee||T.return==null||T.return()}finally{if(ne)throw Y}}}}function xe(w,R){(R==null||R>w.length)&&(R=w.length);for(var T=0,F=Array(R);T<R;T++)F[T]=w[T];return F}var Ye="stream-enabled",zt="stream-disabled",pt="media-status-changed",rr="video-quality-changed",jr=function(){return(0,k.A)(function Y(ee){var ne=this;(0,l.A)(this,Y),(0,S.A)(this,"captureImage",(0,C.A)(u().mark(function L(){var W,q,z,ye,Ee,Je,_e,Be,be=arguments;return u().wrap(function(ae){for(;;)switch(ae.prev=ae.next){case 0:q=(W=be.length>0&&be[0]!==void 0?be[0]:{}).height,z=W.width,ae.prev=1,ye=(0,pe.A)(ne.streams.values()),Ee=dr(ye),ae.prev=4,_e=u().mark(function ct(){var Ae,nt,tt,at,ot;return u().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if((Ae=Je.value).kind!="video"){Te.next=19;break}return Te.prev=2,(nt=new MediaStream).addTrack(Ae.track),(tt=document.createElement("video")).srcObject=nt,tt.playsInline=!0,(at=document.createElement("canvas")).id="canvasId",Te.next=12,new Promise(function(Jt,zr){tt.addEventListener("loadeddata",(0,C.A)(u().mark(function kt(){var ln,In,ta,va,Ma,Ra;return u().wrap(function(Hn){for(;;)switch(Hn.prev=Hn.next){case 0:return ln=tt.videoWidth,In=tt.videoHeight,ta=16/9,q==null&&z==null&&(q=In,z=ln),q==null&&q==null||(q<=0||q>In)&&(q=In),z==null&&z==null||(z<=0||z>ln)&&(z=ln),q==null&&(q=z/ta),z==null&&(z=q*ta),at.width=z,at.height=q,Hn.prev=9,Hn.next=12,tt.play();case 12:document.body.appendChild(tt),va=(at.width-ln*ta)/2,Ma=(at.height-In*ta)/2,at.getContext("2d").clearRect(0,0,va/2,Ma/2),at.getContext("2d").drawImage(tt,0,0),Ra=at.toDataURL("image/jpeg").split(";base64,")[1],document.body.appendChild(at),document.body.removeChild(at),document.body.removeChild(tt),Jt(Ra),Hn.next=28;break;case 24:Hn.prev=24,Hn.t0=Hn.catch(9),zr(Hn.t0),console.log("error in video",Hn.t0);case 28:case"end":return Hn.stop()}},kt,null,[[9,24]])})))});case 12:return ot=Te.sent,Te.abrupt("return",{v:ot});case 16:Te.prev=16,Te.t0=Te.catch(2),console.error("err on image capture",Te.t0);case 19:case"end":return Te.stop()}},ct,null,[[2,16]])}),Ee.s();case 7:if((Je=Ee.n()).done){ae.next=14;break}return ae.delegateYield(_e(),"t0",9);case 9:if(!(Be=ae.t0)){ae.next=12;break}return ae.abrupt("return",Be.v);case 12:ae.next=7;break;case 14:ae.next=19;break;case 16:ae.prev=16,ae.t1=ae.catch(4),Ee.e(ae.t1);case 19:return ae.prev=19,Ee.f(),ae.finish(19);case 22:throw new Error("Camera must be on to capture an image");case 25:ae.prev=25,ae.t2=ae.catch(1),console.error("Error in captureImage::",ae.t2),Ke.roomClient._videosdkLogs&&Ke.roomClient._videosdkLogs.pushLogs({logText:"Error on image capture",logType:"ERROR",attributes:{error:ae.t2.message}});case 29:case"end":return ae.stop()}},L,null,[[1,25],[4,16,19,22]])}))),this.id=ee.id,this.displayName=ee.displayName,this.streams=new Map,this.quality="low",this.local=ee.local||!1,this.pinState={cam:!1,share:!1},this.webcamOn=!1,this.micOn=!1,this.mode=ee.mode,this.metaData=ee.metaData,this.eventEmitter=new cr.EventEmitter},[{key:"_setPinState",value:function(Y){Y.cam!=null&&(this.pinState.cam=Y.cam),Y.share!=null&&(this.pinState.share=Y.share)}},{key:"remove",value:function(){Ke.roomClient.removePeer(this.id)}},{key:"enableMic",value:function(){Ke.roomClient.enablePeerMic(this.id)}},{key:"disableMic",value:function(){Ke.roomClient.disablePeerMic(this.id)}},{key:"enableWebcam",value:function(){Ke.roomClient.enablePeerWebcam(this.id)}},{key:"disableWebcam",value:function(){Ke.roomClient.disablePeerWebcam(this.id)}},{key:"addStream",value:function(Y){this.streams.set(Y.id,Y),Y.kind!=="video"||this.local||Ke.roomClient.setConsumerQuality(Y.id,this.quality),this.eventEmitter.emit(Ye,Y)}},{key:"updateStream",value:function(Y){this.streams.set(Y.id,Y),this.eventEmitter.emit(Ye,Y)}},{key:"deleteStream",value:function(Y){var ee=this.streams.get(Y);if(ee!=null)return this.streams.delete(Y),this.eventEmitter.emit(zt,ee),ee}},{key:"updateParticipantMediaState",value:function(Y,ee){Y=="audio"?this.micOn=ee:Y=="video"&&(this.webcamOn=ee),this.eventEmitter.emit(pt,{peerId:this.id,kind:Y,newStatus:ee})}},{key:"videoQualityChanged",value:function(Y,ee){this.eventEmitter.emit(rr,{peerId:this.id,prevQuality:Y,currentQuality:ee})}},{key:"setQuality",value:function(Y){this.quality===Y||this.local||(this.quality=Y,(0,pe.A)(this.streams.entries()).forEach(function(ee){var ne=ee[1];ne.kind==="video"&&Ke.roomClient.setConsumerQuality(ne.id,Y)}))}},{key:"setViewPort",value:function(Y,ee){(0,pe.A)(this.streams.entries()).forEach(function(ne){var L=ne[1];L.kind==="video"&&Ke.roomClient.setViewPort(L.producerOrConsumer,Y,ee)})}},{key:"pin",value:function(Y){switch(Y){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!0,share:!0});break;case"CAM":this._setPinState({cam:!0});break;case"SHARE":this._setPinState({share:!0});break;default:throw new Error("Unknown pin type")}Ke.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"unpin",value:function(Y){switch(Y){case"SHARE_AND_CAM":case void 0:this._setPinState({cam:!1,share:!1});break;case"CAM":this._setPinState({cam:!1});break;case"SHARE":this._setPinState({share:!1});break;default:throw new Error("Unknown unpin type")}Ke.roomClient.pinStateChange({peerId:this.id,state:this.pinState})}},{key:"switchTo",value:($=(0,C.A)(u().mark(function Y(ee){var ne,L,W;return u().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return ne=ee.meetingId,L=ee.payload,W=ee.token,q.next=3,Ke.roomClient.switchPeerRoom({peerId:this.id,roomId:ne,payload:L,token:W});case 3:case"end":return q.stop()}},Y,this)})),function(Y){return $.apply(this,arguments)})},{key:"getVideoStats",value:(F=(0,C.A)(u().mark(function Y(){var ee,ne,L,W,q;return u().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!this.local){z.next=6;break}return z.next=3,Ke.roomClient.getVideoRemoteStats();case 3:return z.abrupt("return",z.sent);case 6:ee=(0,pe.A)(this.streams.entries()),ne=dr(ee),z.prev=8,ne.s();case 10:if((L=ne.n()).done){z.next=18;break}if(W=(0,yr.A)(L.value,2),q=W[0],W[1].kind!="video"){z.next=16;break}return z.next=15,Ke.roomClient.getConsumerRemoteStats(q);case 15:return z.abrupt("return",z.sent);case 16:z.next=10;break;case 18:z.next=23;break;case 20:z.prev=20,z.t0=z.catch(8),ne.e(z.t0);case 23:return z.prev=23,ne.f(),z.finish(23);case 26:case"end":return z.stop()}},Y,this,[[8,20,23,26]])})),function(){return F.apply(this,arguments)})},{key:"getShareStats",value:(T=(0,C.A)(u().mark(function Y(){var ee,ne,L,W,q;return u().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!this.local){z.next=6;break}return z.next=3,Ke.roomClient.getShareRemoteStats();case 3:return z.abrupt("return",z.sent);case 6:ee=(0,pe.A)(this.streams.entries()),ne=dr(ee),z.prev=8,ne.s();case 10:if((L=ne.n()).done){z.next=18;break}if(W=(0,yr.A)(L.value,2),q=W[0],W[1].kind!="share"){z.next=16;break}return z.next=15,Ke.roomClient.getConsumerRemoteStats(q);case 15:return z.abrupt("return",z.sent);case 16:z.next=10;break;case 18:z.next=23;break;case 20:z.prev=20,z.t0=z.catch(8),ne.e(z.t0);case 23:return z.prev=23,ne.f(),z.finish(23);case 26:case"end":return z.stop()}},Y,this,[[8,20,23,26]])})),function(){return T.apply(this,arguments)})},{key:"getShareAudioStats",value:(R=(0,C.A)(u().mark(function Y(){var ee,ne,L,W,q;return u().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(!this.local){z.next=6;break}return z.next=3,Ke.roomClient.getShareAudioRemoteStats();case 3:return z.abrupt("return",z.sent);case 6:ee=(0,pe.A)(this.streams.entries()),ne=dr(ee),z.prev=8,ne.s();case 10:if((L=ne.n()).done){z.next=18;break}if(W=(0,yr.A)(L.value,2),q=W[0],W[1].kind!="shareAudio"){z.next=16;break}return z.next=15,Ke.roomClient.getConsumerRemoteStats(q);case 15:return z.abrupt("return",z.sent);case 16:z.next=10;break;case 18:z.next=23;break;case 20:z.prev=20,z.t0=z.catch(8),ne.e(z.t0);case 23:return z.prev=23,ne.f(),z.finish(23);case 26:case"end":return z.stop()}},Y,this,[[8,20,23,26]])})),function(){return R.apply(this,arguments)})},{key:"getAudioStats",value:(w=(0,C.A)(u().mark(function Y(){var ee,ne,L,W,q;return u().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(this.micOn){z.next=2;break}return z.abrupt("return",[]);case 2:if(!this.local){z.next=8;break}return z.next=5,Ke.roomClient.getAudioRemoteStats();case 5:return z.abrupt("return",z.sent);case 8:ee=(0,pe.A)(this.streams.entries()),ne=dr(ee),z.prev=10,ne.s();case 12:if((L=ne.n()).done){z.next=20;break}if(W=(0,yr.A)(L.value,2),q=W[0],W[1].kind!="audio"){z.next=18;break}return z.next=17,Ke.roomClient.getConsumerRemoteStats(q);case 17:return z.abrupt("return",z.sent);case 18:z.next=12;break;case 20:z.next=25;break;case 22:z.prev=22,z.t0=z.catch(10),ne.e(z.t0);case 25:return z.prev=25,ne.f(),z.finish(25);case 28:case"end":return z.stop()}},Y,this,[[10,22,25,28]])})),function(){return w.apply(this,arguments)})},{key:"consumeMicStreams",value:function(){Ke.roomClient.consumeMicStreams(this.id)}},{key:"consumeWebcamStreams",value:function(){Ke.roomClient.consumeWebcamStreams(this.id)}},{key:"stopConsumingWebcamStreams",value:function(){Ke.roomClient.stopConsumingWebcamStreams(this.id)}},{key:"stopConsumingMicStreams",value:function(){Ke.roomClient.stopConsumingMicStreams(this.id)}},{key:"on",value:function(Y,ee){switch(Y){case Ye:case zt:case pt:case rr:this.eventEmitter.on(Y,ee);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(Y,ee){switch(Y){case Ye:case zt:case pt:case rr:this.eventEmitter.off(Y,ee);break;default:throw new Error("Invalid event type")}}}]);var w,R,T,F,$}();function Hr(w,R){if(R&&((0,G.A)(R)=="object"||typeof R=="function"))return R;if(R!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return function(T){if(T===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}(w)}function vt(w){return vt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(R){return R.__proto__||Object.getPrototypeOf(R)},vt(w)}function zn(w,R){return zn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,F){return T.__proto__=F,T},zn(w,R)}function oa(w,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(R&&R.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),R&&zn(w,R)}var ca={CHARACTER_SPEAKING:"CHARACTER_SPEAKING",CHARACTER_THINKING:"CHARACTER_THINKING",CHARACTER_LISTENING:"CHARACTER_LISTENING"},pn=De(2107);function ba(){try{var w=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ba=function(){return!!w})()}function wt(w,R,T){je(w,R),R.set(w,T)}function je(w,R){if(R.has(w))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Qe(w,R){return w.get(Ce(w,R))}function Ve(w,R,T){return w.set(Ce(w,R),T),T}function Ce(w,R,T){if(typeof w=="function"?w===R:w.has(R))return arguments.length<3?R:T;throw new TypeError("Private element is not present on this object")}var ur="stream-enabled",we="stream-disabled",er="character-joined",fr="character-left",br="media-status-changed",gr="video-quality-changed",tn="character-state-changed",Ie="character-message",yt="user-message",gt="data",ht=new WeakMap,Pr=new WeakMap,Cr=new WeakMap,Ar=new WeakMap,Yt=new WeakMap,ar=new WeakMap,Tr=new WeakMap,kn=new WeakSet,rn=function(w){function R(L){var W,q,z,ye;return(0,l.A)(this,R),q=this,z=R,ye=[{id:L.id,displayName:L.displayName,mode:pn.nI.SEND_AND_RECV,metaData:L.metaData}],z=vt(z),function(Ee,Je){je(Ee,Je),Je.add(Ee)}(W=Hr(q,ba()?Reflect.construct(z,ye||[],vt(q).constructor):z.apply(q,ye)),kn),wt(W,ht,void 0),wt(W,Pr,void 0),wt(W,Cr,void 0),wt(W,Ar,void 0),wt(W,Yt,void 0),wt(W,ar,void 0),wt(W,Tr,void 0),(0,S.A)(W,"captureImage",(0,C.A)(u().mark(function Ee(){var Je,_e=arguments;return u().wrap(function(Be){for(;;)switch(Be.prev=Be.next){case 0:throw(Je=_e.length>0&&_e[0]!==void 0?_e[0]:{}).height,Je.width,new Error("captureImage method is not supported on character");case 2:case"end":return Be.stop()}},Ee)}))),Ve(Yt,W,L.interactionId||null),W.id=L.id||null,Ve(ht,W,L.characterRole),Ve(Pr,W,L.characterMode),Ve(Cr,W,L.knowledgeBases||[]),W.displayName=L.displayName,Ve(Ar,W,L.language),Ve(ar,W,L.state||ca.CHARACTER_LISTENING),Ve(Tr,W,L.roomClient),W}return oa(R,w),(0,k.A)(R,[{key:"join",value:(ne=(0,C.A)(u().mark(function L(){var W;return u().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,Qe(Tr,this).joinCharacter({interactionId:Qe(Yt,this),characterId:this.id,characterRole:Qe(ht,this),displayName:this.displayName,characterMode:Qe(Pr,this),knowledgeBases:Qe(Cr,this),language:Qe(Ar,this),metaData:this.metaData});case 2:(W=q.sent)&&(this.id=W.characterId,this.displayName=W.displayName,Ve(Pr,this,W.characterMode),Ve(ht,this,W.characterRole),Ve(Yt,this,W.interactionId),Ve(Cr,this,W.knowledgeBases),Ve(Ar,this,W.language),Qe(Tr,this)._eventEmitter.emit("INIT_CHARACTER",this));case 4:case"end":return q.stop()}},L,this)})),function(){return ne.apply(this,arguments)})},{key:"leave",value:(ee=(0,C.A)(u().mark(function L(){return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,Qe(Tr,this).removeCharacter();case 2:case"end":return W.stop()}},L,this)})),function(){return ee.apply(this,arguments)})},{key:"remove",value:(Y=(0,C.A)(u().mark(function L(){return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:throw new Error("remove method is not supported on character");case 1:case"end":return W.stop()}},L)})),function(){return Y.apply(this,arguments)})},{key:"sendMessage",value:($=(0,C.A)(u().mark(function L(W){return u().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,Qe(Tr,this).sendCharacterMessage({interactionId:Qe(Yt,this),text:W});case 2:case"end":return q.stop()}},L,this)})),function(L){return $.apply(this,arguments)})},{key:"handleCharacterStateChanged",value:function(L){Object.keys(ca).includes(L.status)&&(Ce(kn,this,na).call(this,L.status),this.eventEmitter.emit(tn,L))}},{key:"handleCharacterMessage",value:function(L){this.eventEmitter.emit(Ie,L)}},{key:"interrupt",value:(F=(0,C.A)(u().mark(function L(){return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,Qe(Tr,this).interruptCharacter({interactionId:Qe(Yt,this)});case 2:case"end":return W.stop()}},L,this)})),function(){return F.apply(this,arguments)})},{key:"handleUserMessage",value:function(L){this.eventEmitter.emit(yt,L)}},{key:"handleCharacterData",value:function(L){var W=L.topic,q=L.data;this.eventEmitter.emit(gt,W,q)}},{key:"enableMic",value:function(){Qe(Tr,this).enablePeerMic(this.id)}},{key:"disableMic",value:function(){Qe(Tr,this).disablePeerMic(this.id)}},{key:"enableWebcam",value:function(){Qe(Tr,this).enablePeerWebcam(this.id)}},{key:"disableWebcam",value:function(){Qe(Tr,this).disablePeerWebcam(this.id)}},{key:"updateStream",value:function(L){throw new Error("updateStream method is not supported on character")}},{key:"switchTo",value:(T=(0,C.A)(u().mark(function L(W){return u().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:throw W.meetingId,W.payload,W.token,new Error("switchTo method is not supported on character");case 2:case"end":return q.stop()}},L)})),function(L){return T.apply(this,arguments)})},{key:"pin",value:function(L){throw new Error("pin method is not supported on character")}},{key:"on",value:function(L,W){switch(L){case ur:case we:case er:case fr:case br:case gr:case tn:case Ie:case yt:case gt:this.eventEmitter.on(L,W);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(L,W){switch(L){case ur:case we:case er:case fr:case br:case gr:case tn:case Ie:case yt:case gt:this.eventEmitter.off(L,W);break;default:throw new Error("Invalid event type")}}},{key:"state",get:function(){return Qe(ar,this)}},{key:"knowledgeBases",get:function(){return Qe(Cr,this)}},{key:"characterMode",get:function(){return Qe(Pr,this)}},{key:"characterRole",get:function(){return Qe(ht,this)}},{key:"interactionId",get:function(){return Qe(Yt,this)}},{key:"language",get:function(){return Qe(Ar,this)}}]);var T,F,$,Y,ee,ne}(jr);function na(w){Ve(ar,this,w)}function Aa(w,R,T){(function(F,$){if($.has(F))throw new TypeError("Cannot initialize the same private elements twice on an object")})(w,R),R.set(w,T)}function Gr(w,R,T){if(typeof w=="function"?w===R:w.has(R))return arguments.length<3?R:T;throw new TypeError("Private element is not present on this object")}var Pe=new WeakMap,La=function(){return(0,k.A)(function R(T,F){var $,Y,ee,ne=T.id,L=T.displayName;(0,l.A)(this,R),Aa(this,Pe,void 0),this.id=ne,this.displayName=L,Y=this,ee=F,($=Pe).set(Gr($,Y),ee)},[{key:"switchTo",value:(w=(0,C.A)(u().mark(function R(T){var F,$,Y;return u().wrap(function(ee){for(;;)switch(ee.prev=ee.next){case 0:return F=T.meetingId,$=T.payload,Y=T.token,ee.next=3,Ke.roomClient.connectionSwitchPeerRoom({roomId:F,connectionRoomId:(ne=Pe,L=this,ne.get(Gr(ne,L))),payload:$,peerId:this.id,token:Y});case 3:case"end":return ee.stop()}var ne,L},R,this)})),function(R){return w.apply(this,arguments)})}]);var w}(),Da="participant-joined",Ua="participant-left",Na="chat-message",gs=function(){return(0,k.A)(function R(T,F){var $=this;(0,l.A)(this,R),this.eventEmitter=new cr.EventEmitter,this.id=T,this.participants=new Map,F.forEach(function(Y){$.participants.set(Y.id,new La(Y,$.id))})},[{key:"participantJoin",value:function(R){var T=new La(R,this.id);this.participants.set(R.id,T),this.eventEmitter.emit(Da,T)}},{key:"participantLeft",value:function(R){this.participants.delete(R),this.eventEmitter.emit(Ua,R)}},{key:"sendChatMessage",value:function(R){Ke.roomClient.connectionSendChatMessage({roomId:this.id,message:R})}},{key:"sendChatMessageEvent",value:function(R){var T=R.participantId,F=R.message;this.eventEmitter.emit(Na,{participantId:T,message:F})}},{key:"end",value:(w=(0,C.A)(u().mark(function R(){return u().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return T.next=2,Ke.roomClient.connectionEndMeeting({roomId:this.id});case 2:case"end":return T.stop()}},R,this)})),function(){return w.apply(this,arguments)})},{key:"on",value:function(R,T){switch(R){case Da:case Ua:case Na:this.eventEmitter.on(R,T);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(R,T){switch(R){case Da:case Ua:case Na:this.eventEmitter.off(R,T);break;default:throw new Error("Invalid event type")}}}]);var w}(),ss=function(){return(0,k.A)(function w(R){var T=R.roomId,F=R.peers,$=R.payload;(0,l.A)(this,w),this.id=T,this.payload=$,this.meeting=new gs(T,F)},[{key:"close",value:function(){Ke.roomClient.closeConnection(this.id)}}])}();function Se(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function ja(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?Se(Object(T),!0).forEach(function(F){(0,S.A)(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):Se(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}function ge(w,R){if(R.has(w))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Oe(w,R){return w.get(Me(w,R))}function Me(w,R,T){if(typeof w=="function"?w===R:w.has(R))return arguments.length<3?R:T;throw new TypeError("Private element is not present on this object")}var rt="error",Lt="meeting-joined",Bt="meeting-left",ir="participant-mode-changed",Qt="participant-joined",Tt="participant-left",wr="speaker-changed",It="presenter-changed",lr="main-participant-changed",Or="chat-message",Lr="entry-requested",Yr="entry-responded",Qr="recording-state-changed",Mn="recording-started",An="recording-stopped",Vn="livestream-state-changed",$n="livestream-started",da="livestream-stopped",ma="hls-state-changed",aa="hls-started",wa="hls-stopped",Ea="whiteboard-started",Wa="whiteboard-stopped",Va="video-state-changed",qa="video-seeked",Ha="mic-requested",za="webcam-requested",$a="stream-enabled",Ga="stream-disabled",Ka="pin-state-changed",Ja="connection-open",Ya="connection-close",Qa="switch-meeting",Xa="meeting-state-changed",Za="transcription-state-changed",es="transcription-text",xa="character-joined",lt="character-left",H=new WeakMap,ze=new WeakSet,Wt=function(){return(0,k.A)(function L(W,q,z){var ye,Ee,Je,_e,Be,be=this;(0,l.A)(this,L),ge(ye=this,Ee=ze),Ee.add(ye),function(ae,ct,Ae){ge(ae,ct),ct.set(ae,Ae)}(this,H,void 0),(0,S.A)(this,"pubSub",{publish:(Be=(0,C.A)(u().mark(function ae(ct,Ae,nt,tt){return u().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:if(tt==null){at.next=3;break}if((0,G.A)(tt)=="object"){at.next=3;break}throw new Error('"payload" can only be object.');case 3:return at.next=5,be.roomClient.pubsubPublish(ct,Ae,nt,tt);case 5:case"end":return at.stop()}},ae)})),function(ae,ct,Ae,nt){return Be.apply(this,arguments)}),subscribe:(_e=(0,C.A)(u().mark(function ae(ct,Ae){var nt;return u().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:if(!Oe(H,be).listeners(ct).includes(Ae)){tt.next=2;break}return tt.abrupt("return");case 2:return tt.next=4,be.roomClient.pubsubSubscribe(ct);case 4:return nt=tt.sent,Oe(H,be).on(ct,Ae),tt.abrupt("return",nt);case 7:case"end":return tt.stop()}},ae)})),function(ae,ct){return _e.apply(this,arguments)}),unsubscribe:(Je=(0,C.A)(u().mark(function ae(ct,Ae){return u().wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:if(Oe(H,be).off(ct,Ae),Oe(H,be).listeners(ct).length!=0){nt.next=4;break}return nt.next=4,be.roomClient.pubsubUnsubscribe(ct);case 4:case"end":return nt.stop()}},ae)})),function(ae,ct){return Je.apply(this,arguments)})}),(0,S.A)(this,"uploadBase64File",function(){var ae=(0,C.A)(u().mark(function ct(Ae){var nt,tt,at,ot,Te,Jt,zr;return u().wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:if(nt=Ae.base64Data,tt=Ae.token,at=Ae.fileName,kt.prev=1,nt&&tt&&at){kt.next=4;break}throw new Error("please provide base64Data, token and fileName");case 4:return ot="https://".concat(be.baseUrl,"/base64-upload?roomId=").concat(be.id),Te={fileName:at,base64Data:nt},kt.next=8,fetch(ot,{method:"POST",body:JSON.stringify(Te),headers:{"Content-Type":"application/json",Authorization:tt}});case 8:return Jt=kt.sent,kt.next=11,Jt.json();case 11:return zr=kt.sent,kt.abrupt("return",zr.url);case 15:kt.prev=15,kt.t0=kt.catch(1),console.error("Error while Uploading Base64 File::",kt.t0),be.roomClient._videosdkLogs&&be.roomClient._videosdkLogs.pushLogs({logText:"Error while Uploading Base64 File",logType:"ERROR",attributes:{error:kt.t0.message}});case 19:case"end":return kt.stop()}},ct,null,[[1,15]])}));return function(ct){return ae.apply(this,arguments)}}()),(0,S.A)(this,"fetchBase64File",function(){var ae=(0,C.A)(u().mark(function ct(Ae){var nt,tt,at,ot,Te;return u().wrap(function(Jt){for(;;)switch(Jt.prev=Jt.next){case 0:if(nt=Ae.url,tt=Ae.token,Jt.prev=1,nt&&tt){Jt.next=4;break}throw new Error("please provide url and token");case 4:return Jt.next=6,fetch(nt,{headers:{Authorization:tt}});case 6:return at=Jt.sent,Jt.next=9,at.arrayBuffer();case 9:return ot=Jt.sent,Te=window.btoa(new Uint8Array(ot).reduce(function(zr,kt){return zr+String.fromCharCode(kt)},"")),Jt.abrupt("return",Te);case 14:Jt.prev=14,Jt.t0=Jt.catch(1),console.error("Error while fetching Base64 File::",Jt.t0),be.roomClient._videosdkLogs&&be.roomClient._videosdkLogs.pushLogs({logText:"Error while fetching Base64 File",logType:"ERROR",attributes:{error:Jt.t0.message}});case 18:case"end":return Jt.stop()}},ct,null,[[1,14]])}));return function(ct){return ae.apply(this,arguments)}}()),this.id=W,this.roomClient=z,this.activeSpeakerId=null,this.activePresenterId=null,this.mainParticipantId=null,this.connections=new Map,this.localParticipant=q,this.participants=new Map,this.characters=new Map,this.baseUrl=null,this.livestreamState="LIVESTREAM_STOPPED",this.recordingState="RECORDING_STOPPED",this.hlsState="HLS_STOPPED",this.transcriptionState="TRANSCRIPTION_STOPPED",this.hlsUrls={downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null},this.messages=[],this.eventEmitter=new cr.EventEmitter,function(ae,ct,Ae){ae.set(Me(ae,ct),Ae)}(H,this,new cr.EventEmitter),this.eventEmitter.setMaxListeners(9999),Oe(H,this).setMaxListeners(9999),this.roomClient.on("ERROR",function(ae){return be.handleError(ae)}),this.roomClient.on("ADD_PEER",function(ae){return be.handlePeerAdd(ae)}),this.roomClient.on("REMOVE_PEER",function(ae){return be.handlePeerRemove(ae)}),this.roomClient.on("ADD_PRODUCER",function(ae){return be.handleProducerAdd(ae)}),this.roomClient.on("UPDATE_PRODUCER",function(ae){return be.handleUpdateProducer(ae)}),this.roomClient.on("REMOVE_PRODUCER",function(ae){return be.handleProducerRemove(ae)}),this.roomClient.on("ADD_CONSUMER",function(ae){return be.handleConsumerAdd(ae)}),this.roomClient.on("REMOVE_CONSUMER",function(ae){return be.handleConsumerRemove(ae)}),this.roomClient.on("PARTICIPANT_MEDIA_STATE_CHANGED",function(ae){return be.handleParticipantMediaStateChanged(ae)}),this.roomClient.on("CHAT_MESSAGE",function(ae){return be.handleNewChatMessage(ae)}),this.roomClient.on("SET_ROOM_ACTIVE_SPEAKER",function(ae){return be.handleSpeakerChange(ae)}),this.roomClient.on("ENTRY_REQUESTED",function(ae){return be.handleEntryRequested(ae)}),this.roomClient.on("ENTRY_RESPONDED",function(ae){return be.handleEntryResponded(ae)}),this.roomClient.on("MEETING_JOINED",function(ae){return be.handleMeetingJoined(ae)}),this.roomClient.on("MEETING_LEFT",function(ae){return be.handleMeetingLeft(ae)}),this.roomClient.on("RECORDING_STATE_CHANGED",function(ae){be.handleRecordingStateChanged(ae)}),this.roomClient.on("RECORDING_STARTED",function(ae){return be.handleRecordingStarted(ae)}),this.roomClient.on("RECORDING_STOPPED",function(ae){return be.handleRecordingStopped(ae)}),this.roomClient.on("LIVESTREAM_STATE_CHANGED",function(ae){be.handleLivestreamStateChanged(ae)}),this.roomClient.on("LIVESTREAM_STARTED",function(ae){return be.handleLivestreamStarted(ae)}),this.roomClient.on("LIVESTREAM_STOPPED",function(ae){return be.handleLivestreamStopped(ae)}),this.roomClient.on("HLS_STATE_CHANGED",function(ae){be.handleHlsStateChanged(ae)}),this.roomClient.on("HLS_STARTED",function(ae){be.handleHlsStarted(ae)}),this.roomClient.on("HLS_STOPPED",function(ae){be.handleHlsStopped(ae)}),this.roomClient.on("TRANSCRIPTION_STATE_CHANGED",function(ae){be.handleTranscriptionStateChanged(ae)}),this.roomClient.on("TRANSCRIPTION_TEXT",function(ae){be.handleTranscriptionText(ae)}),this.roomClient.on("WHITEBOARD_STARTED",function(ae){return be.handleWhiteboardStarted(ae)}),this.roomClient.on("WHITEBOARD_STOPPED",function(ae){return be.handleWhiteboardStopped(ae)}),this.roomClient.on("VIDEO_STATE_CHANGED",function(ae){return be.handleVideoStateChanged(ae)}),this.roomClient.on("VIDEO_SEEKED",function(ae){return be.handleVideoSeeked(ae)}),this.roomClient.on("PIN_STATE_CHANGED",function(ae){be.handlePinStateChanged(ae)}),this.roomClient.on("MIC_REQUESTED",function(ae){return be.handleMicRequested(ae)}),this.roomClient.on("WEBCAM_REQUESTED",function(ae){return be.handleWebcamRequested(ae)}),this.roomClient.on("CONNECTION_OPEN",function(ae){return be.handleConnectionOpen(ae)}),this.roomClient.on("CONNECTION_CLOSE",function(ae){return be.handleConnectionClose(ae)}),this.roomClient.on("CONNECTION_PARTICIPANT_JOIN",function(ae){return be.handleConnectionParticipantJoin(ae)}),this.roomClient.on("SWITCH_ROOM",function(ae){return be.handleSwitchMeeting(ae)}),this.roomClient.on("CONNECTION_CHAT_MESSAGE",function(ae){return be.handleConnectionChatMessage(ae)}),this.roomClient.on("CONNECTION_PARTICIPANT_LEFT",function(ae){be.handleConnectionParticipantLeft(ae)}),this.roomClient.on("PUBSUB_MESSAGE",function(ae){return Me(ze,be,Pn).call(be,ae)}),this.roomClient.on("PEER_MODE_CHANGED",function(ae){return Me(ze,be,Ln).call(be,ae)}),this.updateMainParticipant(this.localParticipant.id),this.roomClient.on("MEETING_STATE_CHANGED",function(ae){return be.handleMeetingStateChanged(ae)}),this.roomClient.on("VIDEO_QUALITY_CHANGED",function(ae){return be.handleVideoQualityChanged(ae)}),this.roomClient.on("ADD_CHARACTER",function(ae){return be.handleAddCharacter(ae)}),this.roomClient.on("INIT_CHARACTER",function(ae){return be.handleInitCharacter(ae)}),this.roomClient.on("REMOVE_CHARACTER",function(ae){return be.handleRemoveCharacter(ae)}),this.roomClient.on("CHARACTER_STATE_CHANGED",function(ae){return be.handleCharacterStateChanged(ae)}),this.roomClient.on("CHARACTER_MESSAGE",function(ae){return be.handleCharacterMessage(ae)}),this.roomClient.on("USER_MESSAGE",function(ae){return be.handleUserMessage(ae)}),this.roomClient.on("CHARACTER_DATA",function(ae){return be.handleOnCharacterData(ae)})},[{key:"handleError",value:function(L){this.eventEmitter.listenerCount(rt)>0&&this.eventEmitter.emit(rt,L)}},{key:"join",value:function(){this.roomClient.join()}},{key:"changeMode",value:function(L){this.roomClient.changeMode(L)}},{key:"leave",value:function(){this.roomClient.close({sendLeft:!0})}},{key:"end",value:function(){this.roomClient.closeRoom()}},{key:"respondEntry",value:function(L,W){this.roomClient.respondEntry(L,W)}},{key:"pinnedParticipants",get:function(){return this.roomClient._pinnedParticipants}},{key:"muteMic",value:function(){this.roomClient.disableMic()}},{key:"unmuteMic",value:function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableMic(L)}},{key:"publishAudio",value:(ne=(0,C.A)(u().mark(function L(){var W,q=arguments;return u().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return W=q.length>0&&q[0]!==void 0?q[0]:void 0,z.next=3,this.roomClient.enableMic(W);case 3:return z.abrupt("return");case 4:case"end":return z.stop()}},L,this)})),function(){return ne.apply(this,arguments)})},{key:"unpublishAudio",value:(ee=(0,C.A)(u().mark(function L(){return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.roomClient.disableMic();case 2:return W.abrupt("return");case 3:case"end":return W.stop()}},L,this)})),function(){return ee.apply(this,arguments)})},{key:"disableWebcam",value:function(){this.roomClient.disableWebcam()}},{key:"enableWebcam",value:function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableWebcam(L)}},{key:"publishVideo",value:(Y=(0,C.A)(u().mark(function L(){var W,q=arguments;return u().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return W=q.length>0&&q[0]!==void 0?q[0]:void 0,this.roomClient.enableWebcam(W),z.abrupt("return");case 3:case"end":return z.stop()}},L,this)})),function(){return Y.apply(this,arguments)})},{key:"unpublishVideo",value:($=(0,C.A)(u().mark(function L(){return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return this.roomClient.disableWebcam(),W.abrupt("return");case 2:case"end":return W.stop()}},L,this)})),function(){return $.apply(this,arguments)})},{key:"disableScreenShare",value:function(){this.roomClient.disableShare()}},{key:"enableScreenShare",value:function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableShare(L)}},{key:"pubblishScreenShare",value:function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;this.roomClient.enableShare(L)}},{key:"unpublishScreenShare",value:function(){this.roomClient.disableShare()}},{key:"sendChatMessage",value:function(L){this.roomClient.sendChatMessage(L);var W={text:L,timestamp:new Date().getTime(),senderId:this.localParticipant.id,senderName:this.localParticipant.displayName};this.handleNewChatMessage(W)}},{key:"startRecording",value:function(L,W,q,z){this.roomClient.startRecording(L,W,q,z)}},{key:"stopRecording",value:function(){this.roomClient.stopRecording()}},{key:"startTranscription",value:function(L){this.roomClient.startTranscription(L)}},{key:"stopTranscription",value:function(){this.roomClient.stopTranscription()}},{key:"startLivestream",value:function(L,W){this.roomClient.startLivestream(L,W)}},{key:"stopLivestream",value:function(){this.roomClient.stopLivestream()}},{key:"startHls",value:(F=(0,C.A)(u().mark(function L(W,q){return u().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,this.roomClient.startHls(W,q);case 2:case"end":return z.stop()}},L,this)})),function(L,W){return F.apply(this,arguments)})},{key:"stopHls",value:function(){this.roomClient.stopHls()}},{key:"createCharacter",value:function(L){if(!L.interactionId&&!L.id)throw new Error("InteractionId or id is required");return new rn(ja(ja({},L),{},{roomClient:this.roomClient}))}},{key:"getMics",value:(T=(0,C.A)(u().mark(function L(){return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.roomClient.getMics();case 2:return W.abrupt("return",W.sent);case 3:case"end":return W.stop()}},L,this)})),function(){return T.apply(this,arguments)})},{key:"getWebcams",value:(R=(0,C.A)(u().mark(function L(){return u().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.next=2,this.roomClient.getWebcams();case 2:return W.abrupt("return",W.sent);case 3:case"end":return W.stop()}},L,this)})),function(){return R.apply(this,arguments)})},{key:"changeMic",value:function(L){this.roomClient.changeMic(L)}},{key:"changeWebcam",value:function(L){this.roomClient.changeWebcam(L)}},{key:"replaceWebcamStream",value:function(L){this.roomClient.replaceWebcamStream(L)}},{key:"setWebcamQuality",value:function(L){this.roomClient.setWebcamQuality(L)}},{key:"startWhiteboard",value:function(){this.roomClient.startWhiteboard()}},{key:"stopWhiteboard",value:function(){this.roomClient.stopWhiteboard()}},{key:"startVideo",value:function(L){var W=L.link;this.roomClient.startVideo({link:W})}},{key:"stopVideo",value:function(){this.roomClient.stopVideo()}},{key:"resumeVideo",value:function(){this.roomClient.resumeVideo()}},{key:"refreshConnection",value:function(){this.roomClient.restartIce()}},{key:"pauseVideo",value:function(L){var W=L.currentTime;this.roomClient.pauseVideo(W)}},{key:"seekVideo",value:function(L){var W=L.currentTime;this.roomClient.seekVideo(W)}},{key:"handlePeerAdd",value:function(L){var W=L.peer,q=new jr(W);this.participants.set(q.id,q),this.eventEmitter.emit(Qt,q),this.participants.size===1&&this.updateMainParticipant(q.id)}},{key:"handlePeerRemove",value:function(L){var W=L.peerId,q=this.participants.get(W);q!=null&&(this.participants.delete(W),this.eventEmitter.emit(Tt,q),this.activePresenterId===q.id&&(this.activePresenterId=null,this.eventEmitter.emit(It,this.activePresenterId)),this.mainParticipantId===q.id&&(this.participants.size>0?this.updateMainParticipant(this.participants.entries().next().value[1].id):this.updateMainParticipant(this.localParticipant.id)))}},{key:"handleProducerAdd",value:function(L){var W=L.producer,q=new Ct(W);this.localParticipant.addStream(q),q.kind==="share"&&(this.activePresenterId=this.localParticipant.id,this.eventEmitter.emit(It,this.activePresenterId),this.updateMainParticipant(this.localParticipant.id))}},{key:"handleUpdateProducer",value:function(L){var W=L.producer,q=new Ct(W);this.localParticipant.updateStream(q)}},{key:"handleProducerRemove",value:function(L){var W=L.producerId,q=this.localParticipant.deleteStream(W);if(q&&q.kind==="share"){this.activePresenterId=null,this.eventEmitter.emit(It,this.activePresenterId);var z=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||z||this.localParticipant.id)}}},{key:"handleConsumerAdd",value:function(L){var W=L.consumer,q=L.peerId,z=this.participants.get(q)||this.characters.get(q);if(z){var ye=new Ct(W);z.addStream(ye),this.eventEmitter.emit($a,ye),ye.kind==="share"&&(this.activePresenterId=z.id,this.eventEmitter.emit(It,this.activePresenterId),this.updateMainParticipant(z.id))}}},{key:"handleConsumerRemove",value:function(L){var W=L.consumerId,q=L.peerId,z=this.participants.get(q)||this.characters.get(q);if(z!=null&&z){var ye=z.deleteStream(W);if(this.eventEmitter.emit(Ga,ye),ye&&ye.kind==="share"){this.activePresenterId=null,this.eventEmitter.emit(It,this.activePresenterId);var Ee=this.participants.size>0?this.participants.entries().next().value[1].id:null;this.updateMainParticipant(this.activeSpeakerId||Ee||this.localParticipant.id)}}}},{key:"handleParticipantMediaStateChanged",value:function(L){var W=L.peerId,q=L.kind,z=L.newState,ye=this.participants.get(W)||this.characters.get(W);this.localParticipant.id==W&&(ye=this.localParticipant),ye&&ye&&(q=="audio"?ye.micOn=z:q=="video"&&(ye.webcamOn=z),ye.updateParticipantMediaState(q,z))}},{key:"handleSpeakerChange",value:function(L){var W=L.peerId;this.activeSpeakerId!==W&&(this.activeSpeakerId=W,this.eventEmitter.emit(wr,W),W&&W!==this.localParticipant.id&&this.activePresenterId!==this.mainParticipantId&&W!==this.mainParticipantId&&this.updateMainParticipant(W))}},{key:"handleNewChatMessage",value:function(L){var W=L.senderId,q={senderId:W,text:L.text,timestamp:L.timestamp};if(this.localParticipant.id===W)q.senderName=this.localParticipant.displayName;else{var z=this.participants.get(W);z&&(q.senderName=z.displayName)}this.messages.push(q),this.eventEmitter.emit(Or,q)}},{key:"updateMainParticipant",value:function(L){this.mainParticipantId=L;var W=null;W=L===this.localParticipant.id?this.localParticipant:this.participants.get(this.mainParticipantId),this.eventEmitter.emit(lr,W)}},{key:"handleEntryRequested",value:function(L){var W=this,q=L.id,z=L.name;this.eventEmitter.emit(Lr,{participantId:q,name:z,allow:function(){W.roomClient.respondEntry(q,"allowed")},deny:function(){W.roomClient.respondEntry(q,"denied")}})}},{key:"handleEntryResponded",value:function(L){var W=L.id,q=L.decision;this.eventEmitter.emit(Yr,W,q)}},{key:"handleMeetingJoined",value:function(L){var W=L.peers,q=L.poll,z=L.messages,ye=L.baseUrl;this.baseUrl=ye,z.length>0&&(this.messages=z),this.eventEmitter.emit(Lt,{peers:W,poll:q,messages:z})}},{key:"handleMeetingLeft",value:function(L){this.eventEmitter.emit(Bt,L)}},{key:"handleRecordingStateChanged",value:function(L){this.recordingState=L.status,this.eventEmitter.emit(Qr,L)}},{key:"handleLivestreamStateChanged",value:function(L){this.livestreamState=L.status,this.eventEmitter.emit(Vn,L)}},{key:"handleHlsStateChanged",value:function(L){this.hlsState=L.status,L.status=="HLS_PLAYABLE"?this.hlsUrls={downstreamUrl:L.downstreamUrl,playbackHlsUrl:L.playbackHlsUrl,livestreamUrl:L.livestreamUrl}:L.status=="HLS_STOPPED"&&(this.hlsUrls={downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),this.eventEmitter.emit(ma,L)}},{key:"handleTranscriptionStateChanged",value:function(L){this.transcriptionState=L.status,this.eventEmitter.emit(Za,L)}},{key:"handleTranscriptionText",value:function(L){this.eventEmitter.emit(es,L)}},{key:"handleRecordingStarted",value:function(){this.eventEmitter.emit(Mn)}},{key:"handleRecordingStopped",value:function(){this.eventEmitter.emit(An)}},{key:"handleLivestreamStarted",value:function(){this.eventEmitter.emit($n)}},{key:"handleLivestreamStopped",value:function(){this.eventEmitter.emit(da)}},{key:"handleHlsStarted",value:function(L){this.eventEmitter.emit(aa,L)}},{key:"handleHlsStopped",value:function(){this.eventEmitter.emit(wa)}},{key:"handleWhiteboardStarted",value:function(L){this.eventEmitter.emit(Ea,L)}},{key:"handleWhiteboardStopped",value:function(L){(function(W){if(W==null)throw new TypeError("Cannot destructure "+W)})(L),this.eventEmitter.emit(Wa)}},{key:"handleAddCharacter",value:function(L){var W,q=L.id,z=(W=this.characters.get(q))!==null&&W!==void 0?W:new rn(ja(ja({},L),{},{state:ca.CHARACTER_LISTENING,roomClient:this.roomClient}));this.characters.set(q,z),this.eventEmitter.emit(xa,z),z.eventEmitter.emit(xa)}},{key:"handleInitCharacter",value:function(L){this.characters.set(L.id,L)}},{key:"handleRemoveCharacter",value:function(L){var W=L.id;if(this.characters.has(W)){var q=this.characters.get(W);this.eventEmitter.emit(lt,q),q.eventEmitter.emit(lt),this.characters.delete(W)}}},{key:"handleCharacterStateChanged",value:function(L){var W=L.id;this.characters.has(W)&&this.characters.get(W).handleCharacterStateChanged(L)}},{key:"handleCharacterMessage",value:function(L){var W=L.id;this.characters.has(W)&&this.characters.get(W).handleCharacterMessage(L)}},{key:"handleUserMessage",value:function(L){var W=L.id;this.characters.has(W)&&this.characters.get(W).handleUserMessage(L)}},{key:"handleOnCharacterData",value:function(L){var W=L.id;this.characters.has(W)&&this.characters.get(W).handleCharacterData(L)}},{key:"handleVideoStateChanged",value:function(L){this.eventEmitter.emit(Va,L)}},{key:"handleVideoSeeked",value:function(L){var W=L.currentTime;this.eventEmitter.emit(qa,{currentTime:W})}},{key:"handlePinStateChanged",value:function(L){var W=L.peerId,q=L.state,z=L.pinnedBy;this.eventEmitter.emit(Ka,{participantId:W,state:q,pinnedBy:z})}},{key:"handleMeetingStateChanged",value:function(L){var W=L.state;this.eventEmitter.emit(Xa,{state:W})}},{key:"handleVideoQualityChanged",value:function(L){var W=L.peerId,q=L.prevQuality,z=L.currentQuality,ye=this.participants.get(W)||this.characters.get(W);ye&&ye&&ye.videoQualityChanged(q,z)}},{key:"handleMicRequested",value:function(L){var W=this,q=L.peerId;this.eventEmitter.emit(Ha,{participantId:q,accept:function(){return W.unmuteMic()},reject:function(){}})}},{key:"handleWebcamRequested",value:function(L){var W=this,q=L.peerId;this.eventEmitter.emit(za,{participantId:q,accept:function(){return W.enableWebcam()},reject:function(){}})}},{key:"handleConnectionParticipantJoin",value:function(L){var W=L.roomId,q=L.peer,z=this.connections.get(W);z!=null&&z.meeting.participantJoin(q)}},{key:"handleConnectionParticipantLeft",value:function(L){var W=L.roomId,q=L.peerId,z=this.connections.get(W);z!=null&&z.meeting.participantLeft(q)}},{key:"handleConnectionOpen",value:function(L){var W=L.peers,q=L.roomId,z=L.payload,ye=new ss({roomId:q,peers:W,payload:z});this.connections.set(ye.id,ye),this.eventEmitter.emit(Ja,ye)}},{key:"handleConnectionClose",value:function(L){var W=L.roomId;this.connections.get(W)!=null&&(this.connections.delete(W),this.eventEmitter.emit(Ya,W))}},{key:"handleSwitchMeeting",value:function(L){var W=L.roomId,q=L.token,z=L.payload,ye=L.peerId,Ee=L.connectionPeerId,Je=L.connectionRoomId,_e=ye?{meetingId:W,payload:z,token:q,participantId:ye}:{meetingId:W,payload:z,token:q,connectionParticipantId:Ee,connectionMeetingId:Je};this.eventEmitter.emit(Qa,_e)}},{key:"handleConnectionChatMessage",value:function(L){var W=L.roomId,q=L.peerId,z=L.message,ye=this.connections.get(W);ye!=null&&ye.meeting.sendChatMessageEvent({participantId:q,message:z})}},{key:"connectTo",value:(w=(0,C.A)(u().mark(function L(W){var q,z;return u().wrap(function(ye){for(;;)switch(ye.prev=ye.next){case 0:return q=W.meetingId,z=W.payload,ye.next=3,this.roomClient.openConnection({roomId:q,payload:z});case 3:case"end":return ye.stop()}},L,this)})),function(L){return w.apply(this,arguments)})},{key:"selectedCameraDevice",get:function(){var L;return(L=this.roomClient._webcam)===null||L===void 0?void 0:L.device}},{key:"selectedMicrophoneDevice",get:function(){var L;return(L=this.roomClient._mic)===null||L===void 0?void 0:L.device}},{key:"on",value:function(L,W){switch(L){case Qt:case Tt:case wr:case It:case lr:case Or:case Lr:case Yr:case Qr:case Mn:case An:case Vn:case $n:case da:case aa:case wa:case ma:case Za:case es:case $a:case Ga:case Ea:case Wa:case xa:case lt:case Lt:case Bt:case Va:case qa:case Ha:case za:case Ka:case Ja:case Ya:case Qa:case Xa:case ir:case rt:this.eventEmitter.on(L,W);break;default:throw new Error("Invalid event type")}}},{key:"off",value:function(L,W){switch(L){case Qt:case Tt:case wr:case It:case lr:case Or:case Lr:case Yr:case Qr:case Mn:case An:case Vn:case $n:case da:case ma:case aa:case wa:case Za:case es:case $a:case Ga:case Ea:case Wa:case xa:case lt:case Lt:case Bt:case Va:case qa:case Ha:case za:case Ka:case Ja:case Ya:case Qa:case Xa:case rt:case ir:this.eventEmitter.off(L,W);break;default:throw new Error("Invalid event type")}}}]);var w,R,T,F,$,Y,ee,ne}();function Pn(w){var R=w.topic,T=w.message,F=w.senderId,$=w.timestamp,Y=w.senderName,ee=w.id,ne=w.payload;R&&T&&Oe(H,this).emit(R,{message:T,senderId:F,timestamp:$,topic:R,senderName:Y,id:ee,payload:ne})}function Ln(w){var R=w.peerId,T=w.mode;R===this.localParticipant.id?this.localParticipant.mode=T:this.participants.get(R).mode=T,this.activePresenterId!==this.localParticipant.id||(0,pn.kR)(T)||(this.activePresenterId=null,this.eventEmitter.emit(It,this.activePresenterId)),this.eventEmitter.emit(ir,{participantId:R,mode:T})}var nr=De(7080),di=De(5071),_s=De(4973),Ba=De(9027);function is(w,R,T){return R=vt(R),Hr(w,Ls()?Reflect.construct(R,T||[],vt(w).constructor):R.apply(w,T))}function Ls(){try{var w=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Ls=function(){return!!w})()}var ts=function(w){function R(T,F,$,Y){return(0,l.A)(this,R),is(this,R,[T,F,$,Y])}return oa(R,w),(0,k.A)(R)}((0,k.A)(function w(R,T,F,$){(0,l.A)(this,w),this.deviceId=R,this.groupId=T,this.kind=F,this.label=$})),vs=function(w){function R(T,F,$,Y){return(0,l.A)(this,R),is(this,R,[T,F,$,Y])}return oa(R,w),(0,k.A)(R)}(ts),ys=function(w){function R(T,F,$,Y){return(0,l.A)(this,R),is(this,R,[T,F,$,Y])}return oa(R,w),(0,k.A)(R)}(ts),Ns=function(w){function R(T,F,$,Y){return(0,l.A)(this,R),is(this,R,[T,F,$,Y])}return oa(R,w),(0,k.A)(R)}(ts),qn={AUDIO:"audio",VIDEO:"video",AUDIO_AND_VIDEO:"audio_video"},ui=(De(328),De(7654));function os(w,R){return w==null||R==null?NaN:w<R?-1:w>R?1:w>=R?0:NaN}function li(w,R){return w==null||R==null?NaN:R<w?-1:R>w?1:R>=w?0:NaN}function js(w){let R,T,F;function $(Y,ee,ne=0,L=Y.length){if(ne<L){if(R(ee,ee)!==0)return L;do{const W=ne+L>>>1;T(Y[W],ee)<0?ne=W+1:L=W}while(ne<L)}return ne}return w.length!==2?(R=os,T=(Y,ee)=>os(w(Y),ee),F=(Y,ee)=>w(Y)-ee):(R=w===os||w===li?w:pi,T=w,F=w),{left:$,center:function(Y,ee,ne=0,L=Y.length){const W=$(Y,ee,ne,L-1);return W>ne&&F(Y[W-1],ee)>-F(Y[W],ee)?W-1:W},right:function(Y,ee,ne=0,L=Y.length){if(ne<L){if(R(ee,ee)!==0)return L;do{const W=ne+L>>>1;T(Y[W],ee)<=0?ne=W+1:L=W}while(ne<L)}return ne}}}function pi(){return 0}const hi=js(os),mi=hi.right,fi=(js(function(w){return w===null?NaN:+w}).center,mi);function gi(w,R){switch(arguments.length){case 0:break;case 1:this.range(w);break;default:this.range(R).domain(w)}return this}function ka(){var w,R=[.5],T=[0,1],F=1;function $(Y){return Y!=null&&Y<=Y?T[fi(R,Y,0,F)]:w}return $.domain=function(Y){return arguments.length?(R=Array.from(Y),F=Math.min(R.length,T.length-1),$):R.slice()},$.range=function(Y){return arguments.length?(T=Array.from(Y),F=Math.min(R.length,T.length-1),$):T.slice()},$.invertExtent=function(Y){var ee=T.indexOf(Y);return[R[ee-1],R[ee]]},$.unknown=function(Y){return arguments.length?(w=Y,$):w},$.copy=function(){return ka().domain(R).range(T).unknown(w)},gi.apply($,arguments)}function Bs(w,R){var T=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);R&&(F=F.filter(function($){return Object.getOwnPropertyDescriptor(w,$).enumerable})),T.push.apply(T,F)}return T}function ua(w){for(var R=1;R<arguments.length;R++){var T=arguments[R]!=null?arguments[R]:{};R%2?Bs(Object(T),!0).forEach(function(F){$t(w,F,T[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(T)):Bs(Object(T)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(T,F))})}return w}function Gn(w,R){if(!(w instanceof R))throw new TypeError("Cannot call a class as a function")}function _i(w,R){for(var T=0;T<R.length;T++){var F=R[T];F.enumerable=F.enumerable||!1,F.configurable=!0,"value"in F&&(F.writable=!0),Object.defineProperty(w,Ws(F.key),F)}}function Kn(w,R,T){return R&&_i(w.prototype,R),Object.defineProperty(w,"prototype",{writable:!1}),w}function $t(w,R,T){return(R=Ws(R))in w?Object.defineProperty(w,R,{value:T,enumerable:!0,configurable:!0,writable:!0}):w[R]=T,w}function cs(w,R){if(typeof R!="function"&&R!==null)throw new TypeError("Super expression must either be null or a function");w.prototype=Object.create(R&&R.prototype,{constructor:{value:w,writable:!0,configurable:!0}}),Object.defineProperty(w,"prototype",{writable:!1}),R&&bs(w,R)}function Ur(w){return Ur=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(R){return R.__proto__||Object.getPrototypeOf(R)},Ur(w)}function bs(w,R){return bs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,F){return T.__proto__=F,T},bs(w,R)}function Pa(w,R){if(w==null)return{};var T,F,$=function(ee,ne){if(ee==null)return{};var L,W,q={},z=Object.keys(ee);for(W=0;W<z.length;W++)L=z[W],ne.indexOf(L)>=0||(q[L]=ee[L]);return q}(w,R);if(Object.getOwnPropertySymbols){var Y=Object.getOwnPropertySymbols(w);for(F=0;F<Y.length;F++)T=Y[F],R.indexOf(T)>=0||Object.prototype.propertyIsEnumerable.call(w,T)&&($[T]=w[T])}return $}function pr(w){if(w===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return w}function ds(w){var R=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var T,F=Ur(w);if(R){var $=Ur(this).constructor;T=Reflect.construct(F,arguments,$)}else T=F.apply(this,arguments);return function(Y,ee){if(ee&&(typeof ee=="object"||typeof ee=="function"))return ee;if(ee!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pr(Y)}(this,T)}}function Fs(w,R){for(;!Object.prototype.hasOwnProperty.call(w,R)&&(w=Ur(w))!==null;);return w}function ws(){return ws=typeof Reflect<"u"&&Reflect.get?Reflect.get.bind():function(w,R,T){var F=Fs(w,R);if(F){var $=Object.getOwnPropertyDescriptor(F,R);return $.get?$.get.call(arguments.length<3?w:T):$.value}},ws.apply(this,arguments)}function Ss(w,R,T,F){return Ss=typeof Reflect<"u"&&Reflect.set?Reflect.set:function($,Y,ee,ne){var L,W=Fs($,Y);if(W){if((L=Object.getOwnPropertyDescriptor(W,Y)).set)return L.set.call(ne,ee),!0;if(!L.writable)return!1}if(L=Object.getOwnPropertyDescriptor(ne,Y)){if(!L.writable)return!1;L.value=ee,Object.defineProperty(ne,Y,L)}else $t(ne,Y,ee);return!0},Ss(w,R,T,F)}function hn(w,R,T,F,$){if(!Ss(w,R,T,F||w)&&$)throw new TypeError("failed to set property");return T}function Jn(w,R){return function(T){if(Array.isArray(T))return T}(w)||function(T,F){var $=T==null?null:typeof Symbol<"u"&&T[Symbol.iterator]||T["@@iterator"];if($!=null){var Y,ee,ne,L,W=[],q=!0,z=!1;try{if(ne=($=$.call(T)).next,F===0){if(Object($)!==$)return;q=!1}else for(;!(q=(Y=ne.call($)).done)&&(W.push(Y.value),W.length!==F);q=!0);}catch(ye){z=!0,ee=ye}finally{try{if(!q&&$.return!=null&&(L=$.return(),Object(L)!==L))return}finally{if(z)throw ee}}return W}}(w,R)||Us(w,R)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ca(w){return function(R){if(Array.isArray(R))return Rs(R)}(w)||function(R){if(typeof Symbol<"u"&&R[Symbol.iterator]!=null||R["@@iterator"]!=null)return Array.from(R)}(w)||Us(w)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Us(w,R){if(w){if(typeof w=="string")return Rs(w,R);var T=Object.prototype.toString.call(w).slice(8,-1);return T==="Object"&&w.constructor&&(T=w.constructor.name),T==="Map"||T==="Set"?Array.from(w):T==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(T)?Rs(w,R):void 0}}function Rs(w,R){(R==null||R>w.length)&&(R=w.length);for(var T=0,F=new Array(R);T<R;T++)F[T]=w[T];return F}function Ws(w){var R=function(T,F){if(typeof T!="object"||T===null)return T;var $=T[Symbol.toPrimitive];if($!==void 0){var Y=$.call(T,F||"default");if(typeof Y!="object")return Y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(F==="string"?String:Number)(T)}(w,"string");return typeof R=="symbol"?R:String(R)}function ie(w,R){return function(T,F){return F.get?F.get.call(T):F.value}(w,Vs(w,R,"get"))}function St(w,R,T){return function(F,$,Y){if($.set)$.set.call(F,Y);else{if(!$.writable)throw new TypeError("attempted to set read only private field");$.value=Y}}(w,Vs(w,R,"set"),T),T}function Vs(w,R,T){if(!R.has(w))throw new TypeError("attempted to "+T+" private field on non-instance");return R.get(w)}function Ft(w,R,T){if(!R.has(w))throw new TypeError("attempted to get private field on non-instance");return T}function qs(w,R){if(R.has(w))throw new TypeError("Cannot initialize the same private elements twice on an object")}function bt(w,R,T){qs(w,R),R.set(w,T)}function Cn(w,R){qs(w,R),R.add(w)}var us="https://speed.cloudflare.com",Hs={autoStart:!0,downloadApiUrl:"".concat(us,"/__down"),uploadApiUrl:"".concat(us,"/__up"),logMeasurementApiUrl:null,logAimApiUrl:"https://aim.cloudflare.com/__log",turnServerUri:"turn.speed.cloudflare.com:50000",turnServerCredsApiUrl:"".concat(us,"/turn-creds"),turnServerUser:null,turnServerPass:null,rpkiInvalidHost:"invalid.rpki.cloudflare.com",cfTraceUrl:"".concat(us,"/cdn-cgi/trace"),includeCredentials:!1,measurements:[{type:"latency",numPackets:1},{type:"download",bytes:1e5,count:1,bypassMinDuration:!0},{type:"latency",numPackets:20},{type:"download",bytes:1e5,count:9},{type:"download",bytes:1e6,count:8},{type:"upload",bytes:1e5,count:8},{type:"packetLoss",numPackets:1e3,batchSize:10,batchWaitTime:10,responsesWaitTime:3e3},{type:"upload",bytes:1e6,count:6},{type:"download",bytes:1e7,count:6},{type:"upload",bytes:1e7,count:4},{type:"download",bytes:25e6,count:4},{type:"upload",bytes:25e6,count:4},{type:"download",bytes:1e8,count:3},{type:"upload",bytes:5e7,count:3},{type:"download",bytes:25e7,count:2}],measureDownloadLoadedLatency:!0,measureUploadLoadedLatency:!0,loadedLatencyThrottle:400,bandwidthFinishRequestDuration:1e3,estimatedServerTime:10,latencyPercentile:.5,bandwidthPercentile:.9,bandwidthMinRequestDuration:10,loadedRequestMinDuration:250,loadedLatencyMaxPoints:20},zs={aimMeasurementScoring:{packetLoss:ka([.01,.05,.25,.5],[10,5,0,-10,-20]),latency:ka([10,20,50,100,500],[20,10,5,0,-10,-20]),loadedLatencyIncrease:ka([10,20,50,100,500],[20,10,5,0,-10,-20]),jitter:ka([10,20,100,500],[10,5,0,-10,-20]),download:ka([1e6,1e7,5e7,1e8],[0,5,10,20,30]),upload:ka([1e6,1e7,5e7,1e8],[0,5,10,20,30])},aimExperiencesDefs:{streaming:{input:["latency","packetLoss","download","loadedLatencyIncrease"],pointThresholds:[15,20,40,60]},gaming:{input:["latency","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,30]},rtc:{input:["latency","jitter","packetLoss","loadedLatencyIncrease"],pointThresholds:[5,15,25,40]}}},vi=function(w){var R=w.headers.get("server-timing");if(R){var T=R.match(/dur=([0-9.]+)/);if(T)return+T[1]}},yi=function(w){return w.responseStart-w.requestStart},bi=function(w){return w.responseEnd-w.responseStart},wi=function(w){return w.ping+w.payloadDownloadTime},Si=function(w){return w.ttfb},Ri=function(w,R){var T=w.duration,F=w.transferSize,$=T/1e3;return $?8*(F||1.005*+R)/$:void 0},Ei=function(w,R){var T=w.duration/1e3;return T?8*R*1.005/T:void 0},ki=ui(function(w){return"0".repeat(w)}),ls=new WeakMap,V=new WeakMap,D=new WeakMap,x=new WeakMap,I=new WeakMap,A=new WeakMap,K=new WeakMap,X=new WeakMap,Re=new WeakMap,me=new WeakMap,it=new WeakMap,Ue=new WeakMap,et=new WeakMap,Z=new WeakMap,Xe=new WeakMap,Le=new WeakMap,Ge=new WeakMap,de=new WeakMap,Ne=new WeakMap,Mt=new WeakMap,Ut=new WeakMap,ut=new WeakMap,Vt=new WeakMap,Nt=new WeakSet,Kt=new WeakSet,At=new WeakSet,Et=new WeakSet;function Sr(w){var R=this;w!==ie(this,et)&&(St(this,et,w),setTimeout(function(){return ie(R,I).call(R,ie(R,et))}))}function qt(w,R){var T=this,F=ie(this,me)[w],$=F.bytes,Y=F.dir,ee=ie(this,Xe),ne=ee[Y].hasOwnProperty($)?ee[Y][$]:{timings:[],numMeasurements:ie(this,me).filter(function(L){var W=L.bytes,q=L.dir;return $===W&&Y===q}).map(function(L){return L.count}).reduce(function(L,W){return L+W},0)};R&&ne.timings.push(R),ne.timings=ne.timings.slice(-ne.numMeasurements),ee[Y][$]=ne,R?setTimeout(function(){ie(T,K).call(T,ua({type:Y,bytes:$},R),ee)}):ie(this,A).call(this,ie(this,me)[w],ee)}function Xt(){var w=this,R=ie(this,me),T=R[ie(this,Le)];if(ie(this,Ge)>=T.count){var F=ie(this,Z);if(ie(this,Ne)>this.finishRequestDuration&&!T.bypassMinDuration){var $=T.dir;ie(this,Z)[$]=!0,Object.values(ie(this,Z)).every(function(_e){return _e})&&ie(this,X).call(this,ie(this,Xe))}St(this,Ge,0),St(this,Ne,-1/0),performance.clearResourceTimings();do St(this,Le,ie(this,Le)+1);while(ie(this,Le)<R.length&&F[R[ie(this,Le)].dir]);if(ie(this,Le)>=R.length)return St(this,Z,{down:!0,up:!0}),Ft(this,Nt,Sr).call(this,!1),void ie(this,X).call(this,ie(this,Xe));T=R[ie(this,Le)]}var Y=ie(this,Le);ie(this,Ge)===0&&Ft(this,Kt,qt).call(this,Y);var ee=T,ne=ee.bytes,L=ee.dir==="down",W=ie(this,L?it:Ue),q=Object.assign({},ie(this,ls));L&&(q.bytes="".concat(ne));var z,ye="".concat(W.startsWith("http")||W.startsWith("//")?"":window.location.origin).concat(W,"?").concat(Object.entries(q).map(function(_e){var Be=Jn(_e,2),be=Be[0],ae=Be[1];return"".concat(be,"=").concat(ae)}).join("&")),Ee=Object.assign({},L?{}:{method:"POST",body:ki(ne)},ie(this,V)),Je=St(this,ut,fetch(ye,Ee).then(function(_e){if(_e.ok)return _e;throw Error(_e.statusText)}).then(function(_e){return w.getServerTime&&(z=w.getServerTime(_e)),_e}).then(function(_e){return _e.text().then(function(Be){return ie(w,x)&&ie(w,x).call(w,{url:ye,headers:_e.headers,body:Be}),Be})}).then(function(_e,Be){if(Je._cancel)Be("cancelled");else{var be=performance.getEntriesByName(ye).slice(-1)[0],ae={transferSize:be.transferSize,ttfb:yi(be),payloadDownloadTime:bi(be),serverTime:z||-1,measTime:new Date};if(ae.ping=Math.max(.01,ae.ttfb-(z||ie(w,Ut))),ae.duration=(L?wi:Si)(ae),ae.bps=(L?Ri:Ei)(ae,ne),L&&ne){var ct=+ne;ae.transferSize&&(ae.transferSize<ct||ae.transferSize/ct>1.05)&&console.warn("Requested ".concat(ct,"B but received ").concat(ae.transferSize,"B (").concat(Math.round(ae.transferSize/ct*1e4)/100,"%)."))}Ft(w,Kt,qt).call(w,Y,ae);var Ae=ae.duration;St(w,Ne,ie(w,Ne)<0?Ae:Math.min(ie(w,Ne),Ae)),St(w,Ge,ie(w,Ge)+1),St(w,de,0),ie(w,Mt)?St(w,Vt,setTimeout(function(){return Ft(w,At,Xt).call(w)},ie(w,Mt))):Ft(w,At,Xt).call(w)}}).catch(function(_e){var Be,be;Je._cancel||(console.warn("Error fetching ".concat(ye,": ").concat(_e)),St(w,de,(Be=ie(w,de),be=Be++,Be)),be<20?Ft(w,At,Xt).call(w):(St(w,de,0),Ft(w,Nt,Sr).call(w,!1),ie(w,Re).call(w,"Connection failed to ".concat(ye,". Gave up after ").concat(20," retries."))))}))}function Ir(){var w=ie(this,ut);w&&(w._cancel=!0)}var on=function(){function w(R){var T=this,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},$=F.downloadApiUrl,Y=F.uploadApiUrl,ee=F.throttleMs,ne=ee===void 0?0:ee,L=F.estimatedServerTime,W=L===void 0?0:L;if(Gn(this,w),Cn(this,Et),Cn(this,At),Cn(this,Kt),Cn(this,Nt),bt(this,ls,{writable:!0,value:{}}),bt(this,V,{writable:!0,value:{}}),bt(this,D,{writable:!0,value:function(){document.visibilityState==="hidden"?T.pause():document.visibilityState==="visible"&&T.play()}}),$t(this,"finishRequestDuration",1e3),$t(this,"getServerTime",vi),bt(this,x,{writable:!0,value:function(q){return q}}),bt(this,I,{writable:!0,value:function(){}}),bt(this,A,{writable:!0,value:function(){}}),bt(this,K,{writable:!0,value:function(){}}),bt(this,X,{writable:!0,value:function(){}}),bt(this,Re,{writable:!0,value:function(){}}),bt(this,me,{writable:!0,value:void 0}),bt(this,it,{writable:!0,value:void 0}),bt(this,Ue,{writable:!0,value:void 0}),bt(this,et,{writable:!0,value:!1}),bt(this,Z,{writable:!0,value:{down:!1,up:!1}}),bt(this,Xe,{writable:!0,value:{down:{},up:{}}}),bt(this,Le,{writable:!0,value:0}),bt(this,Ge,{writable:!0,value:0}),bt(this,de,{writable:!0,value:0}),bt(this,Ne,{writable:!0,value:-1/0}),bt(this,Mt,{writable:!0,value:0}),bt(this,Ut,{writable:!0,value:0}),bt(this,ut,{writable:!0,value:void 0}),bt(this,Vt,{writable:!0,value:void 0}),!R)throw new Error("Missing measurements argument");if(!$)throw new Error("Missing downloadApiUrl argument");if(!Y)throw new Error("Missing uploadApiUrl argument");St(this,me,R),St(this,it,$),St(this,Ue,Y),St(this,Mt,ne),St(this,Ut,Math.max(0,W)),document.addEventListener("visibilitychange",ie(this,D))}return Kn(w,[{key:"results",get:function(){return ie(this,Xe)}},{key:"qsParams",get:function(){return ie(this,ls)},set:function(R){St(this,ls,R)}},{key:"fetchOptions",get:function(){return ie(this,V)},set:function(R){St(this,V,R)}},{key:"responseHook",set:function(R){St(this,x,R)}},{key:"onRunningChange",set:function(R){St(this,I,R)}},{key:"onNewMeasurementStarted",set:function(R){St(this,A,R)}},{key:"onMeasurementResult",set:function(R){St(this,K,R)}},{key:"onFinished",set:function(R){St(this,X,R)}},{key:"onConnectionError",set:function(R){St(this,Re,R)}},{key:"pause",value:function(){clearTimeout(ie(this,Vt)),Ft(this,Et,Ir).call(this),Ft(this,Nt,Sr).call(this,!1)}},{key:"play",value:function(){ie(this,et)||(Ft(this,Nt,Sr).call(this,!0),Ft(this,At,Xt).call(this))}},{key:"deleteEventListener",value:function(){document.removeEventListener("visibilitychange",ie(this,D))}}]),w}(),nn=["measureParallelLatency","parallelLatencyThrottleMs","downloadApiUrl","uploadApiUrl","estimatedServerTime"],hr=new WeakMap,Xr=new WeakSet;function mn(w){var R=this;ie(this,hr)&&(w?setTimeout(function(){return ie(R,hr).play()},20):ie(this,hr).pause())}var vn=function(w){cs(T,w);var R=ds(T);function T(F){var $,Y,ee,ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},L=ne.measureParallelLatency,W=L!==void 0&&L,q=ne.parallelLatencyThrottleMs,z=q===void 0?100:q,ye=ne.downloadApiUrl,Ee=ne.uploadApiUrl,Je=ne.estimatedServerTime,_e=Je===void 0?0:Je,Be=Pa(ne,nn);return Gn(this,T),Cn(pr(ee=R.call(this,F,ua({downloadApiUrl:ye,uploadApiUrl:Ee,estimatedServerTime:_e},Be))),Xr),bt(pr(ee),hr,{writable:!0,value:void 0}),W&&(St(pr(ee),hr,new on([{dir:"down",bytes:0,count:1/0,bypassMinDuration:!0}],{downloadApiUrl:ye,uploadApiUrl:Ee,estimatedServerTime:_e,throttleMs:z})),ie(pr(ee),hr).qsParams={during:"".concat(F[0].dir,"load")},hn(($=pr(ee),Ur(T.prototype)),"onRunningChange",Ft(pr(ee),Xr,mn),$,!0),hn((Y=pr(ee),Ur(T.prototype)),"onConnectionError",function(){return ie(pr(ee),hr).pause()},Y,!0)),ee}return Kn(T,[{key:"latencyResults",get:function(){return ie(this,hr)&&ie(this,hr).results.down[0].timings}},{key:"onParallelLatencyResult",set:function(F){ie(this,hr)&&(ie(this,hr).onMeasurementResult=function($){return F($)})}},{key:"fetchOptions",get:function(){return ws(Ur(T.prototype),"fetchOptions",this)},set:function(F){hn(Ur(T.prototype),"fetchOptions",F,this,!0),ie(this,hr)&&(ie(this,hr).fetchOptions=F)}},{key:"onRunningChange",set:function(F){var $=this;hn(Ur(T.prototype),"onRunningChange",function(Y){Ft($,Xr,mn).call($,Y),F(Y)},this,!0)}},{key:"onConnectionError",set:function(F){var $=this;hn(Ur(T.prototype),"onConnectionError",function(){ie($,hr)&&ie($,hr).pause(),F.apply(void 0,arguments)},this,!0)}}]),T}(on),fn=["measurementId","logApiUrl"],sr=new WeakMap,Zr=new WeakMap,Rt=new WeakMap,Wr=new WeakMap,mt=new WeakSet,Zt=new WeakSet;function xr(w){ie(this,Wr)&&(St(this,Rt,+w.headers.get("cf-meta-request-time")),St(this,Zr,w.body.slice(-300).split("___").pop()))}function Vr(w){if(console.log("MEASUREMENT",w),ie(this,Wr)){var R={type:w.type,bytes:w.bytes,ping:Math.round(w.ping),ttfb:Math.round(w.ttfb),payloadDownloadTime:Math.round(w.payloadDownloadTime),duration:Math.round(w.duration),transferSize:Math.round(w.transferSize),serverTime:Math.round(w.serverTime),token:ie(this,Zr),requestTime:ie(this,Rt),measId:ie(this,sr)};St(this,Zr,null),St(this,Rt,null),fetch(ie(this,Wr),ua({method:"POST",body:JSON.stringify(R)},this.fetchOptions))}}var Br=function(w){cs(T,w);var R=ds(T);function T(F){var $,Y,ee,ne,L=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},W=L.measurementId,q=L.logApiUrl,z=Pa(L,fn);return Gn(this,T),Cn(pr(ne=R.call(this,F,z)),Zt),Cn(pr(ne),mt),bt(pr(ne),sr,{writable:!0,value:void 0}),bt(pr(ne),Zr,{writable:!0,value:void 0}),bt(pr(ne),Rt,{writable:!0,value:void 0}),bt(pr(ne),Wr,{writable:!0,value:void 0}),St(pr(ne),sr,W),St(pr(ne),Wr,q),hn(($=pr(ne),Ur(T.prototype)),"qsParams",q?{measId:ie(pr(ne),sr)}:{},$,!0),hn((Y=pr(ne),Ur(T.prototype)),"responseHook",function(ye){return Ft(pr(ne),mt,xr).call(pr(ne),ye)},Y,!0),hn((ee=pr(ne),Ur(T.prototype)),"onMeasurementResult",function(ye){return Ft(pr(ne),Zt,Vr).call(pr(ne),ye)},ee,!0),ne}return Kn(T,[{key:"qsParams",set:function(F){hn(Ur(T.prototype),"qsParams",ie(this,Wr)?ua({measId:ie(this,sr)},F):F,this,!0)}},{key:"responseHook",set:function(F){var $=this;hn(Ur(T.prototype),"responseHook",function(Y){F(Y),Ft($,mt,xr).call($,Y)},this,!0)}},{key:"onMeasurementResult",set:function(F){var $=this;hn(Ur(T.prototype),"onMeasurementResult",function(Y){for(var ee=arguments.length,ne=new Array(ee>1?ee-1:0),L=1;L<ee;L++)ne[L-1]=arguments[L];F.apply(void 0,[Y].concat(ne)),Ft($,Zt,Vr).call($,Y)},this,!0)}}]),T}(vn),Mr=new WeakMap,Nn=new WeakMap,Zn=new WeakMap,jn=new WeakSet,yn=new WeakSet,Bn=new WeakSet,la=function(){function w(R){if(Gn(this,w),Cn(this,Bn),Cn(this,yn),Cn(this,jn),bt(this,Mr,{writable:!0,value:!1}),bt(this,Nn,{writable:!0,value:void 0}),bt(this,Zn,{writable:!0,value:void 0}),!R)throw new Error("Missing operation to perform");St(this,Zn,R),this.play()}return Kn(w,[{key:"pause",value:function(){Ft(this,Bn,ea).call(this),Ft(this,jn,Yn).call(this,!1)}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){ie(this,Mr)||(Ft(this,jn,Yn).call(this,!0),Ft(this,yn,Nr).call(this))}}]),w}();function Yn(w){w!==ie(this,Mr)&&St(this,Mr,w)}function Nr(){var w=this,R=St(this,Nn,ie(this,Zn).call(this).then(function(){!R._cancel&&Ft(w,yn,Nr).call(w)}))}function ea(){var w=ie(this,Nn);w&&(w._cancel=!0)}var en=new WeakMap,Tn=function(){function w(){var R=this,T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=T.download,$=T.upload;if(Gn(this,w),$t(this,"qsParams",{}),$t(this,"fetchOptions",{}),bt(this,en,{writable:!0,value:[]}),!F&&!$)throw new Error("Missing at least one of download/upload config");[[F,"download"],[$,"upload"]].filter(function(ee){return Jn(ee,1)[0]}).forEach(function(ee){var ne=Jn(ee,2),L=ne[0],W=ne[1],q=L.apiUrl,z=L.chunkSize;if(!q)throw new Error("Missing ".concat(W," apiUrl argument"));if(!z)throw new Error("Missing ".concat(W," chunkSize argument"))});var Y=function(ee){var ne=ee.apiUrl,L=ee.qsParams,W=L===void 0?{}:L,q=ee.fetchOptions,z=q===void 0?{}:q;return new la(function(){var ye=Object.assign({},W,R.qsParams),Ee="".concat(ne.startsWith("http")||ne.startsWith("//")?"":window.location.origin).concat(ne,"?").concat(Object.entries(ye).map(function(_e){var Be=Jn(_e,2),be=Be[0],ae=Be[1];return"".concat(be,"=").concat(ae)}).join("&")),Je=Object.assign({},z,R.fetchOptions);return fetch(Ee,Je).then(function(_e){if(_e.ok)return _e;throw Error(_e.statusText)}).then(function(_e){return _e.text()})})};F&&ie(this,en).push(Y({apiUrl:F.apiUrl,qsParams:{bytes:"".concat(F.chunkSize)}})),$&&ie(this,en).push(Y({apiUrl:$.apiUrl,fetchOptions:{method:"POST",body:"0".repeat($.chunkSize)}}))}return Kn(w,[{key:"pause",value:function(){ie(this,en).forEach(function(R){return R.pause()})}},{key:"stop",value:function(){this.pause()}},{key:"play",value:function(){ie(this,en).forEach(function(R){return R.play()})}}]),w}(),On=["iceServers","acceptIceCandidate","dataChannelCfg"],gn=new WeakMap,Dn=new WeakMap,Fn=new WeakMap,bn=new WeakMap,xn=new WeakMap,wn=function(){function w(){var R=this,T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=T.iceServers,$=F===void 0?[]:F,Y=T.acceptIceCandidate,ee=Y===void 0?function(Ee){var Je=Ee.protocol||"";if(!Je&&Ee.candidate){var _e=Ee.candidate.split(" ");_e.length>=3&&(Je=_e[2])}return Je.toLowerCase()==="udp"}:Y,ne=T.dataChannelCfg,L=ne===void 0?{ordered:!1,maxRetransmits:0}:ne,W=Pa(T,On);Gn(this,w),$t(this,"onOpen",function(){}),$t(this,"onClose",function(){}),$t(this,"onMessageReceived",function(){}),bt(this,gn,{writable:!0,value:!1}),bt(this,Dn,{writable:!0,value:void 0}),bt(this,Fn,{writable:!0,value:void 0}),bt(this,bn,{writable:!0,value:void 0}),bt(this,xn,{writable:!0,value:void 0});var q=new RTCPeerConnection(ua({iceServers:$},W)),z=new RTCPeerConnection(ua({iceServers:$},W)),ye=q.createDataChannel("channel",L);ye.onopen=function(){St(R,gn,!0),R.onOpen()},ye.onclose=function(){return R.close()},z.ondatachannel=function(Ee){var Je=Ee.channel;Je.onclose=function(){return R.close()},Je.onmessage=function(_e){return R.onMessageReceived(_e.data)},St(R,xn,Je)},q.onicecandidate=function(Ee){Ee.candidate&&ee(Ee.candidate)&&z.addIceCandidate(Ee.candidate)},z.onicecandidate=function(Ee){Ee.candidate&&ee(Ee.candidate)&&q.addIceCandidate(Ee.candidate)},q.createOffer().then(function(Ee){return q.setLocalDescription(Ee)}).then(function(){return z.setRemoteDescription(q.localDescription)}).then(function(){return z.createAnswer()}).then(function(Ee){return z.setLocalDescription(Ee)}).then(function(){return q.setRemoteDescription(z.localDescription)}),St(this,Dn,q),St(this,Fn,z),St(this,bn,ye),St(this,gn,!1)}return Kn(w,[{key:"send",value:function(R){return ie(this,bn).send(R)}},{key:"close",value:function(){return ie(this,Dn)&&ie(this,Dn).close(),ie(this,Fn)&&ie(this,Fn).close(),ie(this,bn)&&ie(this,bn).close(),ie(this,xn)&&ie(this,xn).close(),ie(this,gn)&&this.onClose(),St(this,gn,!1),this}}]),w}(),Kr=new WeakMap,cn=new WeakMap,an=new WeakMap,dn=new WeakMap,Rr=new WeakMap,Un=new WeakMap,Er=function(){function w(){var R=this,T=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},F=T.turnServerUri,$=T.turnServerCredsApi,Y=T.turnServerCredsApiParser,ee=Y===void 0?function(nt){return{turnServerUser:nt.username,turnServerPass:nt.credential}}:Y,ne=T.turnServerCredsApiIncludeCredentials,L=ne!==void 0&&ne,W=T.turnServerUser,q=T.turnServerPass,z=T.numMsgs,ye=z===void 0?100:z,Ee=T.batchSize,Je=Ee===void 0?10:Ee,_e=T.batchWaitTime,Be=_e===void 0?10:_e,be=T.responsesWaitTime,ae=be===void 0?5e3:be,ct=T.connectionTimeout,Ae=ct===void 0?5e3:ct;if(Gn(this,w),bt(this,Kr,{writable:!0,value:function(){}}),bt(this,cn,{writable:!0,value:function(){}}),bt(this,an,{writable:!0,value:function(){}}),$t(this,"onMsgSent",function(){}),$t(this,"onAllMsgsSent",function(){}),$t(this,"onMsgReceived",function(){}),bt(this,dn,{writable:!0,value:{}}),bt(this,Rr,{writable:!0,value:void 0}),bt(this,Un,{writable:!0,value:void 0}),!F)throw new Error("Missing turnServerUri argument");if(!(W&&q||$))throw new Error("Missing either turnServerCredsApi or turnServerUser+turnServerPass arguments");St(this,Un,ye),(W&&q?Promise.resolve({turnServerUser:W,turnServerPass:q}):fetch($,{credentials:L?"include":void 0}).then(function(nt){return nt.json()}).then(function(nt){if(nt.error)throw nt.error;return nt}).then(ee)).catch(function(nt){return ie(R,Kr).call(R,nt)}).then(function(nt){var tt=nt.turnServerUser,at=nt.turnServerPass,ot=St(R,Rr,new wn({iceServers:[{urls:"turn:".concat(F,"?transport=udp"),username:tt,credential:at}],iceTransportPolicy:"relay"})),Te=!1;setTimeout(function(){Te||(ot.close(),ie(R,cn).call(R,"ICE connection timeout!"))},Ae);var Jt=ie(R,dn);ot.onOpen=function(){Te=!0;var zr=R;(function kt(ln){if(ln<=ye){for(var In=ln;In<=Math.min(ye,ln+Je-1);)Jt[In]=!1,ot.send(In),zr.onMsgSent(In),In++;setTimeout(function(){return kt(In)},Be)}else{zr.onAllMsgsSent(Object.keys(Jt).length);var ta=function(){ot.close(),ie(zr,an).call(zr,zr.results)},va=setTimeout(ta,ae),Ma=Object.values(ie(zr,dn)).filter(function(Ra){return!Ra}).length;ot.onMessageReceived=function(Ra){clearTimeout(va),Jt[Ra]=!0,zr.onMsgReceived(Ra),--Ma<=0&&Object.values(ie(zr,dn)).every(function(Hn){return Hn})?ta():va=setTimeout(ta,ae)}}})(1)},ot.onMessageReceived=function(zr){Jt[zr]=!0,R.onMsgReceived(zr)}}).catch(function(nt){return ie(R,cn).call(R,nt.toString())})}return Kn(w,[{key:"onCredentialsFailure",set:function(R){St(this,Kr,R)}},{key:"onConnectionError",set:function(R){St(this,cn,R)}},{key:"onFinished",set:function(R){St(this,an,R)}},{key:"results",get:function(){var R=ie(this,Un),T=Object.keys(ie(this,dn)).length,F=Object.entries(ie(this,dn)).filter(function($){return!Jn($,2)[1]}).map(function($){return+Jn($,1)[0]});return{totalMessages:R,numMessagesSent:T,packetLoss:F.length/T,lostMessages:F}}}]),w}(),mr=["downloadChunkSize","uploadChunkSize","downloadApiUrl","uploadApiUrl"],qe=new WeakMap,We=function(w){cs(T,w);var R=ds(T);function T(){var F,$,Y,ee,ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},L=ne.downloadChunkSize,W=ne.uploadChunkSize,q=ne.downloadApiUrl,z=ne.uploadApiUrl,ye=Pa(ne,mr);return Gn(this,T),bt(pr(ee=R.call(this,ye)),qe,{writable:!0,value:void 0}),(L||W)&&(St(pr(ee),qe,new Tn({download:L?{apiUrl:q,chunkSize:L}:null,upload:W?{apiUrl:z,chunkSize:W}:null})),hn((F=pr(ee),Ur(T.prototype)),"onCredentialsFailure",hn((Y=pr(ee),Ur(T.prototype)),"onConnectionError",hn(($=pr(ee),Ur(T.prototype)),"onFinished",function(){return ie(pr(ee),qe).stop()},$,!0),Y,!0),F,!0)),ee}return Kn(T,[{key:"qsParams",set:function(F){ie(this,qe)&&(ie(this,qe).qsParams=F)}},{key:"fetchOptions",set:function(F){ie(this,qe)&&(ie(this,qe).fetchOptions=F)}},{key:"onCredentialsFailure",set:function(F){var $=this;hn(Ur(T.prototype),"onCredentialsFailure",function(){F.apply(void 0,arguments),ie($,qe)&&ie($,qe).stop()},this,!0)}},{key:"onConnectionError",set:function(F){var $=this;hn(Ur(T.prototype),"onConnectionError",function(){F.apply(void 0,arguments),ie($,qe)&&ie($,qe).stop()},this,!0)}},{key:"onFinished",set:function(F){var $=this;hn(Ur(T.prototype),"onFinished",function(){F.apply(void 0,arguments),ie($,qe)&&ie($,qe).stop()},this,!0)}}]),T}(Er),or=["reachable"],Dr=Kn(function w(R){var T=this,F=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},$=F.timeout,Y=$===void 0?-1:$,ee=F.fetchOptions,ne=ee===void 0?{}:ee;Gn(this,w),$t(this,"onFinished",function(){});var L=!1,W=function(q){var z=q.reachable,ye=Pa(q,or);L||(L=!0,T.onFinished(ua({targetUrl:R,reachable:z},ye)))};fetch(R,ne).then(function(q){W({reachable:!0,response:q})}).catch(function(q){W({reachable:!1,error:q})}),Y>0&&setTimeout(function(){return W({reachable:!1,error:"Request timeout"})},Y)}),_n=function(w){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5;if(!w.length)return 0;var T=w.slice().sort(function(ee,ne){return ee-ne}),F=(w.length-1)*R,$=F%1;if($===0)return T[Math.round(F)];var Y=[Math.floor,Math.ceil].map(function(ee){return T[ee(F)]});return Y[0]+(Y[1]-Y[0])*$},un=new WeakMap,fa=new WeakMap,Fa=function(){function w(R){var T=this;Gn(this,w),$t(this,"getLatencyPoints",function(F){return F.timings.map(function($){return $.ping})}),$t(this,"getLatency",function(F){return _n(T.getLatencyPoints(F),ie(T,un).latencyPercentile)}),$t(this,"getBandwidthPoints",function(F){return Object.entries(F).map(function($){var Y=Jn($,2),ee=Y[0];return Y[1].timings.map(function(ne){var L=ne.bps,W=ne.duration,q=ne.ping,z=ne.measTime,ye=ne.serverTime,Ee=ne.transferSize;return{bytes:+ee,bps:L,duration:W,ping:q,measTime:z,serverTime:ye,transferSize:Ee}})}).flat()}),$t(this,"getBandwidth",function(F){return _n(T.getBandwidthPoints(F).filter(function($){return $.duration>=ie(T,un).bandwidthMinRequestDuration}).map(function($){return $.bps}).filter(function($){return $}),ie(T,un).bandwidthPercentile)}),$t(this,"getLoadedLatency",function(F){return T.getLatency({timings:ie(T,fa).call(T,F)})}),$t(this,"getLoadedJitter",function(F){return T.getJitter({timings:ie(T,fa).call(T,F)})}),$t(this,"getLoadedLatencyPoints",function(F){return T.getLatencyPoints({timings:ie(T,fa).call(T,F)})}),$t(this,"getPacketLoss",function(F){return F.packetLoss}),$t(this,"getPacketLossDetails",function(F){return F}),$t(this,"getReachability",function(F){return!!F.reachable}),$t(this,"getReachabilityDetails",function(F){return{host:F.host,reachable:F.reachable}}),bt(this,un,{writable:!0,value:void 0}),bt(this,fa,{writable:!0,value:function(F){return Object.values(F).filter(function($){return $.timings.length&&Math.min.apply(Math,Ca($.timings.map(function(Y){return Y.duration})))>=ie(T,un).loadedRequestMinDuration}).map(function($){return $.sideLatency||[]}).flat().slice(-ie(T,un).loadedLatencyMaxPoints)}}),St(this,un,R)}return Kn(w,[{key:"getJitter",value:function(R){var T=this.getLatencyPoints(R);return T.length<2?null:T.reduce(function(F,$){var Y=F.sumDeltas,ee=Y===void 0?0:Y,ne=F.prevLatency;return{sumDeltas:ee+(ne!==void 0?Math.abs(ne-$):0),prevLatency:$}},{}).sumDeltas/(T.length-1)}}]),w}(),dt=["bad","poor","average","good","great"],Fr={loadedLatencyIncrease:function(w){return w.latency&&(w.downLoadedLatency||w.upLoadedLatency)?Math.max(w.downLoadedLatency,w.upLoadedLatency)-w.latency:void 0}},Ta={packetLoss:0},Oa=new WeakMap,rs=function(){function w(R){Gn(this,w),bt(this,Oa,{writable:!0,value:void 0}),St(this,Oa,R)}return Kn(w,[{key:"getScores",value:function(R){var T=Object.assign.apply(Object,Ca(Object.entries(ie(this,Oa).aimMeasurementScoring).map(function(F){var $=Jn(F,2),Y=$[0],ee=$[1],ne=Fr.hasOwnProperty(Y)?Fr[Y](R):R[Y];return ne===void 0?Ta.hasOwnProperty(Y)?$t({},Y,Ta[Y]):{}:$t({},Y,ne===void 0?0:+ee(ne))})));return Object.assign.apply(Object,[{}].concat(Ca(Object.entries(ie(this,Oa).aimExperiencesDefs).filter(function(F){return Jn(F,2)[1].input.every(function($){return T.hasOwnProperty($)})}).map(function(F){var $,Y=Jn(F,2),ee=Y[0],ne=Y[1],L=ne.input,W=ne.pointThresholds,q=Math.max(0,($=L.map(function(ye){return T[ye]}),$.reduce(function(ye,Ee){return ye+Ee},0))),z=ka(W,[0,1,2,3,4])(q);return $t({},ee,{points:q,classificationIdx:z,classificationName:dt[z]})}))))}}]),w}(),ga=new WeakMap,ps=new WeakMap,hs=new WeakMap,sn=new WeakMap,$s=new WeakMap,Pi=new WeakMap,Es=new WeakMap,Ci=new WeakMap,Ti=function(){function w(R){var T=this;Gn(this,w),$t(this,"raw",void 0),$t(this,"getUnloadedLatency",function(){return ie(T,sn).call(T,"getLatency","latency")}),$t(this,"getUnloadedJitter",function(){return ie(T,sn).call(T,"getJitter","latency")}),$t(this,"getUnloadedLatencyPoints",function(){return ie(T,sn).call(T,"getLatencyPoints","latency",[])}),$t(this,"getDownLoadedLatency",function(){return ie(T,sn).call(T,"getLoadedLatency","download")}),$t(this,"getDownLoadedJitter",function(){return ie(T,sn).call(T,"getLoadedJitter","download")}),$t(this,"getDownLoadedLatencyPoints",function(){return ie(T,sn).call(T,"getLoadedLatencyPoints","download",[])}),$t(this,"getUpLoadedLatency",function(){return ie(T,sn).call(T,"getLoadedLatency","upload")}),$t(this,"getUpLoadedJitter",function(){return ie(T,sn).call(T,"getLoadedJitter","upload")}),$t(this,"getUpLoadedLatencyPoints",function(){return ie(T,sn).call(T,"getLoadedLatencyPoints","upload",[])}),$t(this,"getDownloadBandwidth",function(){return ie(T,sn).call(T,"getBandwidth","download")}),$t(this,"getDownloadBandwidthPoints",function(){return ie(T,sn).call(T,"getBandwidthPoints","download",[])}),$t(this,"getUploadBandwidth",function(){return ie(T,sn).call(T,"getBandwidth","upload")}),$t(this,"getUploadBandwidthPoints",function(){return ie(T,sn).call(T,"getBandwidthPoints","upload",[])}),$t(this,"getPacketLoss",function(){return ie(T,sn).call(T,"getPacketLoss","packetLoss")}),$t(this,"getPacketLossDetails",function(){return ie(T,sn).call(T,"getPacketLossDetails","packetLoss",void 0,!0)}),$t(this,"getScores",function(){return ie(T,hs).getScores(T.getSummary())}),bt(this,ga,{writable:!0,value:void 0}),bt(this,ps,{writable:!0,value:void 0}),bt(this,hs,{writable:!0,value:void 0}),bt(this,sn,{writable:!0,value:function(F,$){var Y=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0,ee=arguments.length>3&&arguments[3]!==void 0&&arguments[3];return T.raw.hasOwnProperty($)&&T.raw[$].started?ee&&T.raw[$].error?{error:T.raw[$].error}:ie(T,ps)[F](T.raw[$].results):Y}}),bt(this,$s,{writable:!0,value:function(){return ie(T,sn).call(T,"getReachability","v4Reachability")}}),bt(this,Pi,{writable:!0,value:function(){return ie(T,sn).call(T,"getReachabilityDetails","v4Reachability")}}),bt(this,Es,{writable:!0,value:function(){return ie(T,sn).call(T,"getReachability","v6Reachability")}}),bt(this,Ci,{writable:!0,value:function(){return ie(T,sn).call(T,"getReachabilityDetails","v6Reachability")}}),St(this,ga,R),this.clear(),St(this,ps,new Fa(ie(this,ga))),St(this,hs,new rs(ie(this,ga)))}return Kn(w,[{key:"isFinished",get:function(){return Object.values(this.raw).every(function(R){return R.finished})}},{key:"clear",value:function(){this.raw=Object.assign.apply(Object,[{}].concat(Ca(Ca(new Set(ie(this,ga).measurements.map(function(R){return R.type}))).map(function(R){return $t({},R,{started:!1,finished:!1,results:{}})}))))}},{key:"getSummary",value:function(){var R={download:this.getDownloadBandwidth,upload:this.getUploadBandwidth,latency:this.getUnloadedLatency,jitter:this.getUnloadedJitter,downLoadedLatency:this.getDownLoadedLatency,downLoadedJitter:this.getDownLoadedJitter,upLoadedLatency:this.getUpLoadedLatency,upLoadedJitter:this.getUpLoadedJitter,packetLoss:this.getPacketLoss,v4Reachability:ie(this,$s),v6Reachability:ie(this,Es)};return Object.assign.apply(Object,Ca(Object.entries(R).map(function(T){var F=Jn(T,2),$=F[0],Y=(0,F[1])();return Y===void 0?{}:$t({},$,Y)})))}}]),w}(),ms=function(w){var R=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return w&&Math.round(w*Math.pow(10,R))/Math.pow(10,R)},ks=function(w){return w.map(function(R){return ms(R,2)})},Ps=function(w){return w.map(function(R){return{bytes:+R.bytes,bps:ms(R.bps)}})},Gs={latencyMs:["getUnloadedLatencyPoints",ks],download:["getDownloadBandwidthPoints",Ps],upload:["getUploadBandwidthPoints",Ps],downLoadedLatencyMs:["getDownLoadedLatencyPoints",ks],upLoadedLatencyMs:["getUpLoadedLatencyPoints",ks],packetLoss:["getPacketLossDetails",function(w){return w.error?void 0:{numMessages:w.numMessagesSent,lossRatio:ms(w.packetLoss,4)}}]},Ks=function(w,R){var T=R.apiUrl,F={};Object.entries(Gs).forEach(function(Y){var ee=Jn(Y,2),ne=ee[0],L=Jn(ee[1],2),W=L[0],q=L[1],z=q===void 0?function(Ee){return Ee}:q,ye=w[W]();ye&&(F[ne]=z(ye))});var $=w.getScores();$&&(F.scores=Object.assign.apply(Object,[{}].concat(Ca(Object.entries($).map(function(Y){var ee,ne=Jn(Y,2),L=ne[0],W=ne[1];return $t({},L,{points:(ee=W).points,classification:ee.classificationName})}))))),fetch(T,{method:"POST",body:JSON.stringify(F)})},Js=["type"],Ys=["numPackets"],Oi=["bytes"],Fe=["latency","latencyUnderLoad","download","upload"],ns=function(){return"".concat(Math.round(1e16*Math.random()))},$i=new WeakMap,Cs=new WeakMap,Sn=new WeakMap,Qs=new WeakMap,Di=new WeakMap,Ia=new WeakMap,Ts=new WeakMap,xi=new WeakMap,Ii=new WeakMap,as=new WeakMap,Mi=new WeakMap,Xs=new WeakSet,Gi=new WeakSet,Zs=new WeakSet,fs=new WeakSet,lo=new WeakSet,po=new WeakSet,_a=new WeakSet,kc=function(){function w(){var R=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Gn(this,w),Cn(this,_a),Cn(this,po),Cn(this,lo),Cn(this,fs),Cn(this,Zs),Cn(this,Gi),Cn(this,Xs),$t(this,"onRunningChange",function(){}),$t(this,"onResultsChange",function(){}),bt(this,$i,{writable:!0,value:function(){}}),bt(this,Cs,{writable:!0,value:function(){}}),bt(this,Sn,{writable:!0,value:void 0}),bt(this,Qs,{writable:!0,value:void 0}),bt(this,Di,{writable:!0,value:ns()}),bt(this,Ia,{writable:!0,value:-1}),bt(this,Ts,{writable:!0,value:void 0}),bt(this,xi,{writable:!0,value:1e6}),bt(this,Ii,{writable:!0,value:1e6}),bt(this,as,{writable:!0,value:!1}),bt(this,Mi,{writable:!0,value:!1}),St(this,Sn,Object.assign({},Hs,R,zs)),St(this,Qs,new Ti(ie(this,Sn))),ie(this,Sn).autoStart&&this.play()}return Kn(w,[{key:"results",get:function(){return ie(this,Qs)}},{key:"isRunning",get:function(){return ie(this,as)}},{key:"isFinished",get:function(){return ie(this,Mi)}},{key:"onFinish",set:function(R){St(this,$i,R)}},{key:"onError",set:function(R){St(this,Cs,R)}},{key:"pause",value:function(){Fe.includes(Ft(this,Zs,Li).call(this))&&ie(this,Ts).pause(),Ft(this,Xs,Ai).call(this,!1)}},{key:"play",value:function(){ie(this,as)||(Ft(this,Xs,Ai).call(this,!0),Ft(this,_a,Sa).call(this))}},{key:"restart",value:function(){Ft(this,lo,Pc).call(this),this.play()}}]),w}();function Ai(w){w!==ie(this,as)&&(St(this,as,w),this.onRunningChange(ie(this,as)))}function ho(w){var R=this;w!==ie(this,Mi)&&(St(this,Mi,w),w&&setTimeout(function(){return ie(R,$i).call(R,R.results)}))}function Li(){return ie(this,Ia)<0||ie(this,Ia)>=ie(this,Sn).measurements.length?null:ie(this,Sn).measurements[ie(this,Ia)].type}function Os(){return ie(this,Qs).raw[Ft(this,Zs,Li).call(this)]||void 0}function Pc(){Ft(this,po,Cc).call(this),St(this,Di,ns()),St(this,Ia,-1),St(this,Ts,void 0),Ft(this,Xs,Ai).call(this,!1),Ft(this,Gi,ho).call(this,!1),ie(this,Qs).clear()}function Cc(){var w=ie(this,Ts);w&&(w.onFinished=w.onConnectionError=w.onFail=w.onMsgReceived=w.onCredentialsFailure=w.onMeasurementResult=function(){},Fe.includes(Ft(this,Zs,Li).call(this))&&w.pause())}function Sa(){var w,R=this;if(!(Fe.includes(Ft(this,Zs,Li).call(this))&&Ft(this,fs,Os).call(this)&&Ft(this,fs,Os).call(this).started)||Ft(this,fs,Os).call(this).finished||Ft(this,fs,Os).call(this).finishedCurrentRound||Ft(this,fs,Os).call(this).error){if(St(this,Ia,(w=ie(this,Ia),++w)),ie(this,Ia)>=ie(this,Sn).measurements.length)return Ft(this,Xs,Ai).call(this,!1),void Ft(this,Gi,ho).call(this,!0);var T,F=ie(this,Sn).measurements[ie(this,Ia)],$=F.type,Y=Pa(F,Js),ee=Ft(this,fs,Os).call(this),ne=ie(this,Sn),L=ne.downloadApiUrl,W=ne.uploadApiUrl,q=ne.estimatedServerTime;switch($){case"v4Reachability":case"v6Reachability":(T=new Dr("https://".concat(Y.host),{fetchOptions:{method:"GET",mode:"no-cors"}})).onFinished=function(Ae){ee.finished=!0,ee.results=ua({host:Y.host},Ae),R.onResultsChange({type:$}),Ft(R,_a,Sa).call(R)};break;case"rpki":(T=new Dr("https://".concat(ie(this,Sn).rpkiInvalidHost),{timeout:5e3})).onFinished=function(Ae){(Ae.response?Ae.response.json():Promise.resolve()).then(function(nt){ee.finished=!0,ee.results=ua({host:ie(R,Sn).rpkiInvalidHost,filteringInvalids:!Ae.reachable},nt?{asn:nt.asn,name:nt.name}:{}),R.onResultsChange({type:$}),Ft(R,_a,Sa).call(R)})};break;case"nxdomain":(T=new Dr("https://".concat(Y.nxhost),{fetchOptions:{mode:"no-cors"}})).onFinished=function(Ae){ee.finished=!0,ee.results={host:Y.nxhost,reachable:Ae.reachable},R.onResultsChange({type:$}),Ft(R,_a,Sa).call(R)};break;case"packetLoss":case"packetLossUnderLoad":ee.finished=!1;var z=Y.numPackets,ye=Pa(Y,Ys),Ee=ie(this,Sn),Je=Ee.turnServerUri,_e=Ee.turnServerCredsApiUrl,Be=Ee.turnServerUser,be=Ee.turnServerPass,ae=Ee.includeCredentials;(T=new We(ua({turnServerUri:Je,turnServerCredsApi:_e,turnServerCredsApiIncludeCredentials:ae,turnServerUser:Be,turnServerPass:be,numMsgs:z,downloadChunkSize:Y.loadDown?ie(this,xi):void 0,uploadChunkSize:Y.loadUp?ie(this,Ii):void 0,downloadApiUrl:L,uploadApiUrl:W},ye))).onMsgReceived=function(){ee.results=Object.assign({},T.results),R.onResultsChange({type:$})},T.onFinished=function(){ee.finished=!0,R.onResultsChange({type:$}),Ft(R,_a,Sa).call(R)},T.onConnectionError=function(Ae){ee.error=Ae,R.onResultsChange({type:$}),ie(R,Cs).call(R,"Connection error while measuring packet loss: ".concat(Ae)),Ft(R,_a,Sa).call(R)},T.onCredentialsFailure=function(){ee.error="unable to get turn server credentials",R.onResultsChange({type:$}),ie(R,Cs).call(R,"Error while measuring packet loss: unable to get turn server credentials."),Ft(R,_a,Sa).call(R)};break;case"latency":case"latencyUnderLoad":ee.finished=!1,(T=new Br([{dir:"down",bytes:0,count:Y.numPackets,bypassMinDuration:!0}],{downloadApiUrl:L,uploadApiUrl:W,estimatedServerTime:q,logApiUrl:ie(this,Sn).logMeasurementApiUrl,measurementId:ie(this,Di),downloadChunkSize:Y.loadDown?ie(this,xi):void 0,uploadChunkSize:Y.loadUp?ie(this,Ii):void 0})).fetchOptions={credentials:ie(this,Sn).includeCredentials?"include":void 0},T.onMeasurementResult=T.onNewMeasurementStarted=function(Ae,nt){ee.results=Object.assign({},nt.down[0]),R.onResultsChange({type:$})},T.onFinished=function(){ee.finished=!0,R.onResultsChange({type:$}),ie(R,as)&&Ft(R,_a,Sa).call(R),T.deleteEventListener()},T.onConnectionError=function(Ae){ee.error=Ae,R.onResultsChange({type:$}),ie(R,Cs).call(R,"Connection error while measuring latency: ".concat(Ae)),Ft(R,_a,Sa).call(R)},T.play();break;case"download":case"upload":if(ee.finished||ee.error)Ft(this,_a,Sa).call(this);else{delete ee.finishedCurrentRound;var ct=ie(this,Sn)["measure".concat($==="download"?"Down":"Up","loadLoadedLatency")];(T=new Br([ua({dir:$==="download"?"down":"up"},Y)],{downloadApiUrl:L,uploadApiUrl:W,estimatedServerTime:q,logApiUrl:ie(this,Sn).logMeasurementApiUrl,measurementId:ie(this,Di),measureParallelLatency:ct,parallelLatencyThrottleMs:ie(this,Sn).loadedLatencyThrottle})).fetchOptions={credentials:ie(this,Sn).includeCredentials?"include":void 0},T.finishRequestDuration=ie(this,Sn).bandwidthFinishRequestDuration,T.onNewMeasurementStarted=function(Ae){var nt=Ae.count,tt=Ae.bytes,at=ee.results=Object.assign({},ee.results);!at.hasOwnProperty(tt)&&(at[tt]={timings:[],numMeasurements:0,sideLatency:ct?[]:void 0}),at[tt].numMeasurements-at[tt].timings.length!==nt&&(at[tt].numMeasurements+=nt,R.onResultsChange({type:$}))},T.onMeasurementResult=function(Ae){var nt=Ae.bytes,tt=Pa(Ae,Oi);ee.results[nt].timings.push(tt),ee.results=Object.assign({},ee.results),R.onResultsChange({type:$})},T.onParallelLatencyResult=function(Ae){ee.results[Y.bytes].sideLatency.push(Ae),ee.results=Object.assign({},ee.results),R.onResultsChange({type:$})},T.onFinished=function(Ae){var nt=!ie(R,Sn).measurements.slice(ie(R,Ia)+1).map(function(ot){return ot.type}).includes($),tt=Math.min.apply(Math,Ca(Object.values($==="download"?Ae.down:Ae.up).slice(-1)[0].timings.map(function(ot){return ot.duration})));if(nt||!Y.bypassMinDuration&&tt>ie(R,Sn).bandwidthFinishRequestDuration){ee.finished=!0,R.onResultsChange({type:$});var at=.5*Object.keys(ee.results).map(function(ot){return+ot}).sort(function(ot,Te){return Te-ot})[0];$==="download"&&St(R,xi,at),$==="upload"&&St(R,Ii,at)}else ee.finishedCurrentRound=!0;ie(R,as)&&Ft(R,_a,Sa).call(R),T.deleteEventListener()},T.onConnectionError=function(Ae){ee.error=Ae,R.onResultsChange({type:$}),ie(R,Cs).call(R,"Connection error while measuring ".concat($,": ").concat(Ae)),Ft(R,_a,Sa).call(R)},T.play()}}St(this,Ts,T),ee.started=!0,this.onResultsChange({type:$})}else ie(this,Ts).play()}var Ni=new WeakMap,Ki=new WeakMap,Tc=function(w){cs(T,w);var R=ds(T);function T(F){var $,Y;Gn(this,T);for(var ee=arguments.length,ne=new Array(ee>1?ee-1:0),L=1;L<ee;L++)ne[L-1]=arguments[L];return bt(pr(Y=R.call.apply(R,[this,F].concat(ne))),Ni,{writable:!0,value:void 0}),bt(pr(Y),Ki,{writable:!0,value:function(W){ie(pr(Y),Ni)&&Ks(W,{apiUrl:ie(pr(Y),Ni)})}}),hn(($=pr(Y),Ur(T.prototype)),"onFinish",ie(pr(Y),Ki),$,!0),St(pr(Y),Ni,Object.assign({},Hs,F,zs).logAimApiUrl),Y}return Kn(T,[{key:"onFinish",set:function(F){var $=this;hn(Ur(T.prototype),"onFinish",function(Y){F(Y),ie($,Ki).call($,Y)},this,!0)}}]),T}(kc);function mo(w,R){var T=typeof Symbol<"u"&&w[Symbol.iterator]||w["@@iterator"];if(!T){if(Array.isArray(w)||(T=function(L,W){if(L){if(typeof L=="string")return fo(L,W);var q={}.toString.call(L).slice(8,-1);return q==="Object"&&L.constructor&&(q=L.constructor.name),q==="Map"||q==="Set"?Array.from(L):q==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(q)?fo(L,W):void 0}}(w))||R){T&&(w=T);var F=0,$=function(){};return{s:$,n:function(){return F>=w.length?{done:!0}:{done:!1,value:w[F++]}},e:function(L){throw L},f:$}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var Y,ee=!0,ne=!1;return{s:function(){T=T.call(w)},n:function(){var L=T.next();return ee=L.done,L},e:function(L){ne=!0,Y=L},f:function(){try{ee||T.return==null||T.return()}finally{if(ne)throw Y}}}}function fo(w,R){(R==null||R>w.length)&&(R=w.length);for(var T=0,F=Array(R);T<R;T++)F[T]=w[T];return F}var Oc=[t],go=!1,ei=function(){return(0,k.A)(function q(){(0,l.A)(this,q)},null,[{key:"config",value:function(q){if(!q)throw new Error("'token' is empty, please provide it in config");this.apiKey=q;var z=p(xt,void 0,E.apply(void 0,Oc));window.STORE=z,$r.default.init({store:z})}},{key:"getCameras",value:(W=(0,C.A)(u().mark(function q(){var z,ye,Ee,Je;return u().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(_e.prev=0,z=navigator.userAgent.includes("Firefox"),ye=[],!z){_e.next=8;break}return _e.next=6,new Promise(function(Be,be){navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then(function(){var ae=(0,C.A)(u().mark(function ct(Ae){var nt;return u().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return tt.next=2,navigator.mediaDevices.enumerateDevices();case 2:nt=tt.sent,ye=nt.filter(function(at){return at.kind==="videoinput"}).map(function(at){return new vs(at.deviceId,at.groupId,at.kind,at.label)}),Be(ye),Ae.getTracks().forEach(function(at){return at.stop()});case 6:case"end":return tt.stop()}},ct)}));return function(ct){return ae.apply(this,arguments)}}()).catch(function(ae){console.error("Error in getCameras()",ae),be(ae)})});case 6:_e.next=12;break;case 8:return _e.next=10,navigator.mediaDevices.enumerateDevices();case 10:Ee=_e.sent,ye=Ee.filter(function(Be){return Be.kind==="videoinput"}).map(function(Be){return new vs(Be.deviceId,Be.groupId,Be.kind,Be.label)});case 12:return _e.abrupt("return",ye);case 15:_e.prev=15,_e.t0=_e.catch(0),Je=_e.t0.message,_e.t0 instanceof TypeError&&_e.t0.name==="TypeError"&&(Je=nr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message),console.error("An error occurred in getCameras(), ".concat(Je));case 20:case"end":return _e.stop()}},q,null,[[0,15]])})),function(){return W.apply(this,arguments)})},{key:"getMicrophones",value:(L=(0,C.A)(u().mark(function q(){var z,ye,Ee,Je;return u().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(_e.prev=0,z=navigator.userAgent.includes("Firefox"),ye=[],!z){_e.next=8;break}return _e.next=6,new Promise(function(Be,be){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(){var ae=(0,C.A)(u().mark(function ct(Ae){var nt;return u().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return tt.next=2,navigator.mediaDevices.enumerateDevices();case 2:nt=tt.sent,ye=nt.filter(function(at){return at.kind==="audioinput"}).map(function(at){return new ys(at.deviceId,at.groupId,at.kind,at.label)}),Be(ye),Ae.getTracks().forEach(function(at){return at.stop()});case 6:case"end":return tt.stop()}},ct)}));return function(ct){return ae.apply(this,arguments)}}()).catch(function(ae){console.error("Error in getMicrophones()",ae),be(ae)})});case 6:_e.next=12;break;case 8:return _e.next=10,navigator.mediaDevices.enumerateDevices();case 10:Ee=_e.sent,ye=Ee.filter(function(Be){return Be.kind==="audioinput"}).map(function(Be){return new ys(Be.deviceId,Be.groupId,Be.kind,Be.label)});case 12:return _e.abrupt("return",ye);case 15:_e.prev=15,_e.t0=_e.catch(0),Je=_e.t0.message,_e.t0 instanceof TypeError&&_e.t0.name==="TypeError"&&(Je=nr.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message),console.error("An error occurred in getMicrophones(), ".concat(Je));case 20:case"end":return _e.stop()}},q,null,[[0,15]])})),function(){return L.apply(this,arguments)})},{key:"getPlaybackDevices",value:(ne=(0,C.A)(u().mark(function q(){var z,ye,Ee,Je;return u().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(_e.prev=0,z=navigator.userAgent.includes("Firefox"),ye=[],!z){_e.next=8;break}return _e.next=6,new Promise(function(Be,be){navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(){var ae=(0,C.A)(u().mark(function ct(Ae){var nt;return u().wrap(function(tt){for(;;)switch(tt.prev=tt.next){case 0:return tt.next=2,navigator.mediaDevices.enumerateDevices();case 2:nt=tt.sent,ye=nt.filter(function(at){return at.kind==="audiooutput"}).map(function(at){return new Ns(at.deviceId,at.groupId,at.kind,at.label)}),Be(ye),Ae.getTracks().forEach(function(at){return at.stop()});case 6:case"end":return tt.stop()}},ct)}));return function(ct){return ae.apply(this,arguments)}}()).catch(function(ae){console.error("Error in getPlaybackDevices()",ae),be(ae)})});case 6:_e.next=12;break;case 8:return _e.next=10,navigator.mediaDevices.enumerateDevices();case 10:Ee=_e.sent,ye=Ee.filter(function(Be){return Be.kind==="audiooutput"}).map(function(Be){return new Ns(Be.deviceId,Be.groupId,Be.kind,Be.label)});case 12:return _e.abrupt("return",ye);case 15:_e.prev=15,_e.t0=_e.catch(0),Je=_e.t0.message,_e.t0 instanceof TypeError&&_e.t0.name==="TypeError"&&(Je="Playback device access unavailable: Please ensure your device is compatible and that you're on a secure website (https://)"),console.error("An error occurred in getPlaybackDevices(), ".concat(Je));case 20:case"end":return _e.stop()}},q,null,[[0,15]])})),function(){return ne.apply(this,arguments)})},{key:"getDevices",value:(ee=(0,C.A)(u().mark(function q(){var z,ye,Ee,Je,_e,Be;return u().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:return be.prev=0,be.next=3,navigator.mediaDevices.enumerateDevices();case 3:z=be.sent,ye=[],Ee=mo(z);try{for(Ee.s();!(Je=Ee.n()).done;)_e=Je.value,ye.push(new ts(_e.deviceId,_e.groupId,_e.kind,_e.label))}catch(ae){Ee.e(ae)}finally{Ee.f()}return be.abrupt("return",ye);case 10:be.prev=10,be.t0=be.catch(0),Be=be.t0.message,be.t0 instanceof TypeError&&(Be=be.t0.name==="TypeError"?"Could not access devices : Please ensure your devices is compatible and that you're on a secure website (https://)":be.t0.message),console.error("An error occurred in getDevices(), ".concat(Be));case 15:case"end":return be.stop()}},q,null,[[0,10]])})),function(){return ee.apply(this,arguments)})},{key:"on",value:function(q,z){if(q!=="device-changed")throw new Error("Unsupported event type");this.addDeviceChangeEvent(),this.eventEmitter.on(q,z)}},{key:"addDeviceChangeEvent",value:function(){var q=this;if(!go){this.getDevices().then(function(ye){q.devices=ye});try{navigator.mediaDevices.addEventListener("devicechange",function(){var ye=(0,C.A)(u().mark(function Ee(Je){var _e,Be,be,ae,ct;return u().wrap(function(Ae){for(;;)switch(Ae.prev=Ae.next){case 0:return _e=q.devices,Ae.next=3,q.getDevices();case 3:q.devices=Ae.sent,Be=new Array,be=mo(q.devices),Ae.prev=6,ct=u().mark(function nt(){var tt;return u().wrap(function(at){for(;;)switch(at.prev=at.next){case 0:tt=ae.value,_e.filter(function(ot){return ot.deviceId==tt.deviceId&&ot.kind==tt.kind}).length==0?Be.push(tt):_e=_e.filter(function(ot){return!(ot.deviceId==tt.deviceId&&ot.kind==tt.kind)});case 3:case"end":return at.stop()}},nt)}),be.s();case 9:if((ae=be.n()).done){Ae.next=13;break}return Ae.delegateYield(ct(),"t0",11);case 11:Ae.next=9;break;case 13:Ae.next=18;break;case 15:Ae.prev=15,Ae.t1=Ae.catch(6),be.e(Ae.t1);case 18:return Ae.prev=18,be.f(),Ae.finish(18);case 21:Be.length!=0&&q.eventEmitter.emit("device-changed",{devices:q.devices}),_e.length!=0&&q.eventEmitter.emit("device-changed",{devices:q.devices});case 23:case"end":return Ae.stop()}},Ee,null,[[6,15,18,21]])}));return function(Ee){return ye.apply(this,arguments)}}()),go=!0}catch(ye){var z=ye.message;ye instanceof TypeError&&(z=ye.name==="TypeError"?"Could not access devices : Please ensure your devices is compatible and that you're on a secure website (https://)":ye.message),console.error("An error occurred in device-change event, ".concat(z))}}}},{key:"off",value:function(q,z){if(q!=="device-changed")throw new Error("Unsupported event type");this.eventEmitter.off(q,z)}},{key:"checkPermissions",value:(Y=(0,C.A)(u().mark(function q(z){var ye,Ee,Je,_e,Be;return u().wrap(function(be){for(;;)switch(be.prev=be.next){case 0:if(z||(z=qn.AUDIO_AND_VIDEO),ye=new Map,!z.includes(qn.AUDIO)&&!z.includes(qn.AUDIO_AND_VIDEO)){be.next=15;break}return Ee=!0,be.prev=4,be.next=7,navigator.permissions.query({name:"microphone"});case 7:(Je=be.sent).state!="prompt"&&Je.state!="denied"||(Ee=!1),be.next=14;break;case 11:throw be.prev=11,be.t0=be.catch(4),Error("Browser does not support microphone permission check");case 14:ye.set(qn.AUDIO,Ee);case 15:if(!z.includes(qn.VIDEO)&&!z.includes(qn.AUDIO_AND_VIDEO)){be.next=28;break}return _e=!0,be.prev=17,be.next=20,navigator.permissions.query({name:"camera"});case 20:(Be=be.sent).state!="prompt"&&Be.state!="denied"||(_e=!1),be.next=27;break;case 24:throw be.prev=24,be.t1=be.catch(17),Error("Browser does not support camera permission check");case 27:ye.set(qn.VIDEO,_e);case 28:return be.abrupt("return",ye);case 29:case"end":return be.stop()}},q,null,[[4,11],[17,24]])})),function(q){return Y.apply(this,arguments)})},{key:"requestPermission",value:($=(0,C.A)(u().mark(function q(z){var ye,Ee,Je,_e,Be,be,ae,ct,Ae,nt,tt,at,ot;return u().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:if(z||(z=qn.AUDIO_AND_VIDEO),ye=new Map,!z.includes(qn.AUDIO_AND_VIDEO)){Te.next=32;break}return Je={audio:!0,video:!0},_e=!0,Te.prev=5,Te.next=8,navigator.mediaDevices.getUserMedia(Je);case 8:Ee=Te.sent,Te.next=30;break;case 11:if(Te.prev=11,Te.t0=Te.catch(5),!(Te.t0 instanceof DOMException)){Te.next=27;break}Te.t1=Te.t0.name,Te.next=Te.t1==="NotAllowedError"?17:Te.t1==="NotReadableError"?19:Te.t1==="NotFoundError"?21:24;break;case 17:return Te.t0.message==="Permission denied by system"&&(Be=nr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),Te.abrupt("break",25);case 19:return Be=ti(Te.t0,"video"),Te.abrupt("break",25);case 21:return Be=nr.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(Be=nr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),Te.abrupt("break",25);case 24:Be=Te.t0.message;case 25:Te.next=28;break;case 27:Be=Te.t0 instanceof TypeError&&Te.t0.name==="TypeError"?nr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message:Te.t0.message;case 28:_e=!1,Be&&console.error("An error occurred in request permission, ".concat(Be));case 30:Ee&&setTimeout(function(){Ee.getTracks().forEach(function(Jt){Jt.stop()})},100),ye.set(qn.AUDIO_AND_VIDEO,_e);case 32:if(!z.includes(qn.VIDEO)){Te.next=62;break}return ae={audio:!1,video:!0},ct=!0,Te.prev=35,Te.next=38,navigator.mediaDevices.getUserMedia(ae);case 38:be=Te.sent,Te.next=60;break;case 41:if(Te.prev=41,Te.t2=Te.catch(35),!(Te.t2 instanceof DOMException)){Te.next=57;break}Te.t3=Te.t2.name,Te.next=Te.t3==="NotAllowedError"?47:Te.t3==="NotReadableError"?49:Te.t3==="NotFoundError"?51:54;break;case 47:return Te.t2.message==="Permission denied by system"&&(Ae=nr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),Te.abrupt("break",55);case 49:return Ae=ti(Te.t2,"video"),Te.abrupt("break",55);case 51:return Ae=nr.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(Ae=nr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),Te.abrupt("break",55);case 54:Ae=Te.t2.message;case 55:Te.next=58;break;case 57:Ae=Te.t2 instanceof TypeError&&Te.t2.name==="TypeError"?nr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE.message:Te.t2.message;case 58:ct=!1,Ae&&console.error("An error occurred in request permission, ".concat(Ae));case 60:be&&be.getTracks().forEach(function(Jt){Jt.stop()}),ye.set(qn.VIDEO,ct);case 62:if(!z.includes(qn.AUDIO)){Te.next=92;break}return tt={audio:!0,video:!1},at=!0,Te.prev=65,Te.next=68,navigator.mediaDevices.getUserMedia(tt);case 68:nt=Te.sent,Te.next=90;break;case 71:if(Te.prev=71,Te.t4=Te.catch(65),!(Te.t4 instanceof DOMException)){Te.next=87;break}Te.t5=Te.t4.name,Te.next=Te.t5==="NotAllowedError"?77:Te.t5==="NotReadableError"?79:Te.t5==="NotFoundError"?81:84;break;case 77:return Te.t4.message==="Permission denied by system"&&(ot=nr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message),Te.abrupt("break",85);case 79:return ot=ti(Te.t4,"audio"),Te.abrupt("break",85);case 81:return ot=nr.q.ERROR_MICROPHONE_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(ot=nr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message),Te.abrupt("break",85);case 84:ot=Te.t4.message;case 85:Te.next=88;break;case 87:ot=Te.t4 instanceof TypeError&&Te.t4.name==="TypeError"?nr.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE.message:Te.t4.message;case 88:at=!1,ot&&console.error("An error occurred in request permission, ".concat(ot));case 90:nt&&nt.getTracks().forEach(function(Jt){Jt.stop()}),ye.set(qn.AUDIO,at);case 92:return Te.abrupt("return",ye);case 93:case"end":return Te.stop()}},q,null,[[5,11],[35,41],[65,71]])})),function(q){return $.apply(this,arguments)})},{key:"isInt",value:function(q){return typeof q=="number"&&q%1==0}},{key:"getNetworkStats",value:(F=(0,C.A)(u().mark(function q(){var z,ye,Ee,Je=arguments;return u().wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:return(z=(Je.length>0&&Je[0]!==void 0?Je[0]:{}).timeoutDuration)&&this.isInt(z)||(z=6e4),ye=new Promise(function(Be,be){setTimeout(function(){be("Not able to get NetworkStats due to timeout")},z)}),Ee=new Promise(function(Be,be){if(navigator.onLine){var ae=new Tc({measureDownloadLoadedLatency:!1,measureUploadLoadedLatency:!1,measurements:[{type:"upload",bytes:3e6,count:1,bypassMinDuration:!0},{type:"download",bytes:3e6,count:1,bypassMinDuration:!0}]});ae.isRunning?(ae.onFinish=function(ct){Be({downloadSpeed:parseFloat(Number(ct.getDownloadBandwidth()/1048576).toFixed(2)),uploadSpeed:parseFloat(Number(ct.getUploadBandwidth()/1048576).toFixed(2))})},ae.onError=function(ct){be("Not able to get NetworkStats")}):be("Not able to get NetworkStats")}else be("Not able to get NetworkStats due to no Network")}),_e.abrupt("return",Promise.race([Ee,ye]));case 5:case"end":return _e.stop()}},q,this)})),function(){return F.apply(this,arguments)})},{key:"analytics",value:function(q){var z,ye,Ee;!q&&navigator&&navigator.userAgent&&(ye=navigator.userAgent,delete(Ee=o().parse(ye)).engine);try{var Je;(Je=q)!==null&&Je!==void 0&&Je.browserUserAgent||(ye=navigator.userAgent,delete(Ee=o().parse(ye)).engine)}catch{}q&&q.rawUserAgent&&(ye=q.rawUserAgent,delete(Ee=o().parse(ye)).engine),q||(q={});var _e={};_e.sdkType=q.sdkType||"javascript",_e.sdkVersion=q.sdkVersion||"0.0.101",_e.platform=q.platform||((z=Ee)===null||z===void 0||(z=z.platform)===null||z===void 0?void 0:z.type)||"",q.browserUserAgent=="null"?_e.browserUserAgent=void 0:_e.browserUserAgent=Ee,q.deviceUserAgent&&(_e.deviceUserAgent=q.deviceUserAgent),this._deviceInfo=_e}},{key:"initMeeting",value:function(q){var z,ye=q.meetingId,Ee=q.customCameraVideoTrack,Je=Ee===void 0?void 0:Ee,_e=q.customMicrophoneAudioTrack,Be=_e===void 0?void 0:_e,be=q.autoConsume,ae=be===void 0||be,ct=q.preferredProtocol,Ae=q.mode,nt=q.multiStream,tt=nt===void 0||nt,at=q.participantId,ot=q.name,Te=q.micEnabled,Jt=q.webcamEnabled,zr=q.maxResolution,kt=q.metaData,ln=q.chatEnabled,In=q.useSpartialLayerAnalytics,ta=q.signalingBaseUrl,va=q.defaultCamera,Ma=q.debugMode,Ra=Ma===void 0||Ma;if(!ye)throw new Error("'meetingId' is empty, please verify it or generate new meetingId using the API.");var Hn=at?at.toString():r()({length:8}).toLowerCase(),ri=ot||r()({length:6}).toLowerCase();switch(this._deviceInfo||this.analytics(),typeof ct!="string"&&(ct="UDP_OVER_TCP"),(z=ct)===null||z===void 0?void 0:z.toUpperCase()){case"UDP_ONLY":case"UDP_OVER_TCP":case"TCP_ONLY":ct=ct.toUpperCase();break;default:ct="UDP_OVER_TCP"}if(Ae||(Ae=pn.nI.SEND_AND_RECV),Ae!==pn.nI.SEND_AND_RECV&&Ae!==pn.nI.SIGNALLING_ONLY&&Ae!==pn.nI.RECV_ONLY&&Ae!==pn.nI.VIEWER&&Ae!==pn.nI.CONFERENCE)throw new Error('"mode" can only be either '.concat(pn.nI.SEND_AND_RECV," or ").concat(pn.nI.SIGNALLING_ONLY," or ").concat(pn.nI.RECV_ONLY," "));if(kt!=null&&(0,G.A)(kt)!="object")throw new Error('"metaData" can only be object.');var ji=this._deviceInfo.sdkType==="react-native",xc=ji?va?va==="front"?1:0:Je?Je.getVideoTracks()[0].getConstraints().facingMode==="user"?1:0:ji?1:0:0,vo=new $r.default({roomId:ye,peerId:Hn,secret:this.apiKey,device:"unknown",displayName:ri,mode:Ae,useSimulcast:tt,produce:!0,consume:!0,useSharingSimulcast:!0,datachannel:ln!==!1,micEnabled:Te!==!1,webcamEnabled:Jt!==!1,maxResolution:zr||"hd",useSpartialLayerAnalytics:In,_deviceInfo:this._deviceInfo,customCameraVideoTrack:Je,customMicrophoneAudioTrack:Be,autoConsume:ae,preferredProtocol:ct,signalingBaseUrl:ta,metaData:kt,defaultCameraIndex:xc,debugMode:Ra});Ke.roomClient=vo;var Ic=new jr({id:Hn,displayName:ri,local:!0,mode:Ae,metaData:kt});return new Wt(ye,Ic,vo)}},{key:"createCameraVideoTrack",value:(T=(0,C.A)(u().mark(function q(z){var ye,Ee,Je,_e,Be,be,ae,ct,Ae,nt,tt,at,ot,Te,Jt,zr;return u().wrap(function(kt){for(;;)switch(kt.prev=kt.next){case 0:if(ye=z.cameraId,Ee=ye===void 0?void 0:ye,Je=z.encoderConfig,_e=Je===void 0?void 0:Je,Be=z.facingMode,be=Be===void 0?void 0:Be,ae=z.optimizationMode,ct=ae===void 0?void 0:ae,Ae=z.multiStream,nt=Ae===void 0||Ae,!Ee){kt.next=6;break}return kt.next=4,this.getCameras();case 4:(tt=kt.sent)&&tt.some(function(ln){return ln.deviceId})&&(tt.some(function(ln){return ln.deviceId===Ee})||console.error("No camera device found for the given cameraId, please check the passed cameraId. The default camera will be used instead."));case 6:return kt.prev=6,at=_e?Ba.$.videoProfiles[_e]:Ba.$.videoProfiles.h360p_w640p,ot={video:{deviceId:Ee||void 0,facingMode:be||void 0,width:at.width,height:at.height,frameRate:at.frameRate}},kt.next=11,(0,_s.lp)(ot);case 11:return Te=kt.sent,ct&&(Te.contentHint=ct),Te.encoderConfig=_e||"h360p_w640p",Te.contentHint=ct||"",Te.multiStream=nt,Te.cameraId=Ee,kt.abrupt("return",Te);case 20:if(kt.prev=20,kt.t0=kt.catch(6),kt.t0.name!=="SecurityError"){kt.next=26;break}Jt=nr.q.ERROR_RN_CAMERA_ACCESS_DENIED_OR_DISMISSED.message,kt.next=46;break;case 26:if(kt.t0.name!=="DOMException"){kt.next=30;break}Jt=nr.q.ERROR_RN_CAMERA_NOT_FOUND.message,kt.next=46;break;case 30:if(!(kt.t0 instanceof DOMException)){kt.next=45;break}kt.t1=kt.t0.name,kt.next=kt.t1==="NotAllowedError"?34:kt.t1==="NotReadableError"?36:kt.t1==="NotFoundError"?38:41;break;case 34:return Jt=_o(kt.t0,"video"),kt.abrupt("break",43);case 36:return Jt=ti(kt.t0,"video"),kt.abrupt("break",43);case 38:return Jt=nr.q.ERROR_CAMERA_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(Jt=nr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS.message),kt.abrupt("break",43);case 41:return Jt=kt.t0.message,kt.abrupt("break",43);case 43:kt.next=46;break;case 45:kt.t0.message=="getUserMedia is not implemented in this browser"?(zr=nr.q.ERROR_CAMERA_ACCESS_UNAVAILABLE,Jt=zr.message):Jt=kt.t0.message;case 46:console.error("An error occurred in creating video track, ".concat(Jt));case 47:case"end":return kt.stop()}},q,this,[[6,20]])})),function(q){return T.apply(this,arguments)})},{key:"createScreenShareVideoTrack",value:(R=(0,C.A)(u().mark(function q(z){var ye,Ee,Je,_e,Be,be,ae,ct,Ae;return u().wrap(function(nt){for(;;)switch(nt.prev=nt.next){case 0:return ye=z.encoderConfig,Ee=ye===void 0?void 0:ye,Je=z.optimizationMode,_e=Je===void 0?void 0:Je,Be=z.withAudio,be=Be===void 0?"enable":Be,ae=Ee?Ba.$.screenShareProfiles[Ee]:Ba.$.screenShareProfiles.h720p_15fps,ct={audio:be==="enable",video:{width:ae.width,height:ae.height,frameRate:ae.frameRate}},nt.next=5,(0,_s.Zu)(ct);case 5:return Ae=nt.sent,_e&&(Ae.contentHint=_e),nt.abrupt("return",Ae);case 8:case"end":return nt.stop()}},q)})),function(q){return R.apply(this,arguments)})},{key:"createMicrophoneAudioTrack",value:(w=(0,C.A)(u().mark(function q(z){var ye,Ee,Je,_e,Be,be,ae,ct,Ae,nt,tt,at;return u().wrap(function(ot){for(;;)switch(ot.prev=ot.next){case 0:if(ye=z.noiseConfig,Ee=ye===void 0?void 0:ye,Je=z.encoderConfig,_e=Je===void 0?void 0:Je,Be=z.microphoneId,!(be=Be===void 0?void 0:Be)){ot.next=6;break}return ot.next=4,this.getMicrophones();case 4:(ae=ot.sent)&&ae.some(function(Te){return Te.deviceId})&&(ae.some(function(Te){return Te.deviceId===be})||console.error("No microphone device found for the given microphoneId, please check the passed microphoneId. The default microphone will be used instead."));case 6:return ot.prev=6,ct=_e?Ba.$.audioProfiles[_e]:Ba.$.audioProfiles.speech_standard,Ae={audio:{deviceId:be,sampleRate:ct.sampleRate,echoCancellation:Ee?Ee&&Ee.acousticEchoCancellation:ct.echoCancellation,autoGainControl:Ee?Ee&&Ee.autoGainControl:ct.autoGainControl,noiseSuppression:Ee?Ee&&Ee.noiseSuppression:ct.noiseSuppression,channelCount:ct.channelCount}},ot.next=11,(0,_s.lp)(Ae);case 11:return(nt=ot.sent).encoderConfig=_e||"speech_standard",nt.microphoneId=be,ot.abrupt("return",nt);case 17:if(ot.prev=17,ot.t0=ot.catch(6),ot.t0.name!=="SecurityError"){ot.next=23;break}tt=nr.q.ERROR_RN_MIC_ACCESS_DENIED_OR_DISMISSED.message,ot.next=43;break;case 23:if(ot.t0.name!=="DOMException"){ot.next=27;break}tt=nr.q.ERROR_RN_MIC_NOT_FOUND.message,ot.next=43;break;case 27:if(!(ot.t0 instanceof DOMException)){ot.next=42;break}ot.t1=ot.t0.name,ot.next=ot.t1==="NotAllowedError"?31:ot.t1==="NotReadableError"?33:ot.t1==="NotFoundError"?35:38;break;case 31:return tt=_o(ot.t0,"audio"),ot.abrupt("break",40);case 33:return tt=ti(ot.t0,"audio"),ot.abrupt("break",40);case 35:return tt=nr.q.ERROR_MICROPHONE_NOT_FOUND.message,navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Firefox")!=-1&&(tt=nr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS.message),ot.abrupt("break",40);case 38:return tt=ot.t0.message,ot.abrupt("break",40);case 40:ot.next=43;break;case 42:ot.t0.message=="getUserMedia is not implemented in this browser"?(at=nr.q.ERROR_MICROPHONE_ACCESS_UNAVAILABLE,tt=at.message):tt=ot.t0.message;case 43:console.error("An error occurred in creating audio track, ".concat(tt));case 44:case"end":return ot.stop()}},q,this,[[6,17]])})),function(q){return w.apply(this,arguments)})}]);var w,R,T,F,$,Y,ee,ne,L,W}();function _o(w,R){return(w.message==="Permission denied"||w.message==="Permission dismissed"?R==="video"?nr.q.ERROR_CAMERA_ACCESS_DENIED_OR_DISMISSED:nr.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:w.message.includes("The request is not allowed by the user agent")?R==="video"?nr.q.ERROR_CAMERA_PERMISSION_OR_AUTOPLAY_ISSUE:nr.q.ERROR_MICROPHONE_ACCESS_DENIED_OR_DISMISSED:w.message==="Permission denied by system"?R==="video"?nr.q.ERROR_CAMERA_PERMISSION_DENIED_BY_OS:nr.q.ERROR_MICROPHONE_PERMISSION_DENIED_BY_OS:R==="video"?nr.q.ERROR_GET_VIDEO_MEDIA_PERMISSION_DENIED:nr.q.ERROR_GET_AUDIO_MEDIA_PERMISSION_DENIED).message}function ti(w,R){return(w.message==="Device in use"?R==="video"?nr.q.ERROR_CAMERA_IN_USE:nr.q.ERROR_MICROPHONE_IN_USE:R==="video"?nr.q.ERROR_VIDEO_SOURCE_INITIATION_FAILED:nr.q.ERROR_MICROPHONE_IN_USE).message}(0,S.A)(ei,"devices",[]),(0,S.A)(ei,"eventEmitter",new cr),(0,S.A)(ei,"Constants",{errors:nr.s,recordingEvents:{RECORDING_STARTING:"RECORDING_STARTING",RECORDING_STARTED:"RECORDING_STARTED",RECORDING_STOPPING:"RECORDING_STOPPING",RECORDING_STOPPED:"RECORDING_STOPPED"},livestreamEvents:{LIVESTREAM_STARTING:"LIVESTREAM_STARTING",LIVESTREAM_STARTED:"LIVESTREAM_STARTED",LIVESTREAM_STOPPING:"LIVESTREAM_STOPPING",LIVESTREAM_STOPPED:"LIVESTREAM_STOPPED"},characterState:ca,characterMode:{TEXT:"text",CO_PILOT:"co_pilot",AUTO_PILOT:"auto_pilot",VISION_PILOT:"vision_pilot"},hlsEvents:di.V,transcriptionEvents:{TRANSCRIPTION_STARTING:"TRANSCRIPTION_STARTING",TRANSCRIPTION_STARTED:"TRANSCRIPTION_STARTED",TRANSCRIPTION_STOPPING:"TRANSCRIPTION_STOPPING",TRANSCRIPTION_STOPPED:"TRANSCRIPTION_STOPPED"},modes:pn.nI,permission:qn});var Dc=ei})(),Pt})())})(Vo);var Is=Vo.exports,kr="videosdk-live-react-sdk",$e={"participant-joined":kr+"-participant-joined","participant-left":kr+"-participant-left","speaker-changed":kr+"-speaker-changed","presenter-changed":kr+"-presenter-changed","main-participant-changed":kr+"-main-participant-changed","entry-requested":kr+"-entry-requested","entry-responded":kr+"-entry-responded","recording-started":kr+"-recording-started","recording-stopped":kr+"-recording-stopped","chat-message":kr+"-chat-message","meeting-joined":kr+"-meeting-joined","meeting-left":kr+"-meeting-left","live-stream-started":kr+"-live-stream-started","live-stream-stopped":kr+"-live-stream-stopped","video-state-changed":kr+"-video-state-changed","video-seeked":kr+"-video-seeked","webcam-requested":kr+"-webcam-requested","mic-requested":kr+"-mic-requested","pin-state-changed":kr+"-pin-state-changed","connection-open":kr+"-connection-open","connection-close":kr+"-connection-close","switch-meeting":kr+"-switch-meeting",error:kr+"-error","hls-started":kr+"-hls-started","hls-stopped":kr+"-hls-stopped","hls-state-changed":kr+"-hls-state-changed","hls-playable-state-changed":kr+"-hls-playable-state-changed","recording-state-changed":kr+"-recording-state-changed","livestream-state-changed":kr+"-livestream-state-changed","meeting-state-changed":kr+"-meeting-state-changed","participant-mode-changed":kr+"-participant-mode-changed","transcription-state-changed":kr+"-transcription-state-changed","transcription-text":kr+"-transcription-text","character-joined":kr+"-character-joined","character-left":kr+"-character-left","whiteboard-started":kr+"-whiteboard-started","whiteboard-stopped":kr+"-whiteboard-stopped"},He=new rd;He.setMaxListeners(9999);var qo=Dt.createContext(),Ho=function(U){var J=U===void 0?{}:U,se=J.onParticipantJoined,fe=se===void 0?function(){}:se,De=J.onParticipantLeft,Pt=De===void 0?function(){}:De,G=J.onSpeakerChanged,C=G===void 0?function(){}:G,l=J.onPresenterChanged,k=l===void 0?function(){}:l,S=J.onMainParticipantChanged,d=S===void 0?function(){}:S,u=J.onEntryRequested,f=u===void 0?function(){}:u,o=J.onEntryResponded,c=o===void 0?function(){}:o,e=J.onRecordingStarted,g=e===void 0?function(){}:e,h=J.onRecordingStopped,v=h===void 0?function(){}:h,_=J.onChatMessage,b=_===void 0?function(){}:_,p=J.onMeetingJoined,m=p===void 0?function(){}:p,E=J.onMeetingLeft,s=E===void 0?function(){}:E,i=J.onLiveStreamStarted,t=i===void 0?function(){}:i,n=J.onLiveStreamStopped,r=n===void 0?function(){}:n,a=J.onVideoStateChanged,y=a===void 0?function(){}:a,P=J.onVideoSeeked,O=P===void 0?function(){}:P,M=J.onWebcamRequested,j=M===void 0?function(){}:M,B=J.onMicRequested,Q=B===void 0?function(){}:B,re=J.onPinStateChanged,oe=re===void 0?function(){}:re,le=J.onConnectionOpen,ve=le===void 0?function(){}:le,ke=J.onConnetionClose,ce=ke===void 0?function(){}:ke,te=J.onSwitchMeeting,ue=te===void 0?function(){}:te,pe=J.onError,he=pe===void 0?function(){}:pe,Ze=J.onHlsStarted,Ot=Ze===void 0?function(){}:Ze,Ht=J.onHlsStopped,st=Ht===void 0?function(){}:Ht,_r=J.onHlsStateChanged,jt=_r===void 0?function(){}:_r,_t=J.onRecordingStateChanged,vr=_t===void 0?function(){}:_t,ft=J.onLivestreamStateChanged,xt=ft===void 0?function(){}:ft,$r=J.onMeetingStateChanged,cr=$r===void 0?function(){}:$r,yr=J.onParticipantModeChanged,Jr=yr===void 0?function(){}:yr,Gt=J.onCharacterJoined,Ke=Gt===void 0?function(){}:Gt,Ct=J.onCharacterLeft,dr=Ct===void 0?function(){}:Ct;return Dt.useEffect(function(){return He.on($e["participant-joined"],fe),He.on($e["participant-left"],Pt),He.on($e["speaker-changed"],C),He.on($e["presenter-changed"],k),He.on($e["main-participant-changed"],d),He.on($e["entry-requested"],f),He.on($e["entry-responded"],c),He.on($e["recording-started"],g),He.on($e["recording-stopped"],v),He.on($e["chat-message"],b),He.on($e["meeting-joined"],m),He.on($e["meeting-left"],s),He.on($e["live-stream-started"],t),He.on($e["live-stream-stopped"],r),He.on($e["video-state-changed"],y),He.on($e["video-seeked"],O),He.on($e["webcam-requested"],j),He.on($e["mic-requested"],Q),He.on($e["pin-state-changed"],oe),He.on($e["connection-open"],ve),He.on($e["connection-close"],ce),He.on($e["switch-meeting"],ue),He.on($e.error,he),He.on($e["hls-started"],Ot),He.on($e["hls-stopped"],st),He.on($e["hls-state-changed"],jt),He.on($e["recording-state-changed"],vr),He.on($e["livestream-state-changed"],xt),He.on($e["meeting-state-changed"],cr),He.on($e["participant-mode-changed"],Jr),He.on($e["character-joined"],Ke),He.on($e["character-left"],dr),function(){He.off($e["meeting-state-changed"],cr),He.off($e["participant-joined"],fe),He.off($e["participant-left"],Pt),He.off($e["speaker-changed"],C),He.off($e["presenter-changed"],k),He.off($e["main-participant-changed"],d),He.off($e["entry-requested"],f),He.off($e["entry-responded"],c),He.off($e["recording-started"],g),He.off($e["recording-stopped"],v),He.off($e["chat-message"],b),He.off($e["meeting-joined"],m),He.off($e["meeting-left"],s),He.off($e["live-stream-started"],t),He.off($e["live-stream-stopped"],r),He.off($e["video-state-changed"],y),He.off($e["video-seeked"],O),He.off($e["webcam-requested"],j),He.off($e["mic-requested"],Q),He.off($e["pin-state-changed"],oe),He.off($e["connection-open"],ve),He.off($e["connection-close"],ce),He.off($e["switch-meeting"],ue),He.off($e.error,he),He.off($e["hls-started"],Ot),He.off($e["hls-stopped"],st),He.off($e["hls-state-changed"],jt),He.off($e["recording-state-changed"],vr),He.off($e["livestream-state-changed"],xt),He.off($e["participant-mode-changed"],Jr),He.off($e["character-joined"],Ke),He.off($e["character-left"],dr)}},[]),Dt.useContext(qo)},nd="0.2.1",ad=function(U){var J=U.children,se=U.config,fe=U.token,De=U.joinWithoutUserInteraction,Pt=U.reinitialiseMeetingOnConfigChange,G=U.deviceInfo,C=Dt.useState(null),l=C[0],k=C[1],S=Dt.useState(null),d=S[0],u=S[1],f=Dt.useState(null),o=f[0],c=f[1],e=Dt.useState(null),g=e[0],h=e[1],v=Dt.useState(null),_=v[0],b=v[1],p=Dt.useState(!1),m=p[0],E=p[1],s=Dt.useState(!1),i=s[0],t=s[1],n=Dt.useState(!1),r=n[0],a=n[1],y=Dt.useState(!1),P=y[0],O=y[1],M=Dt.useState([]),j=M[0],B=M[1],Q=Dt.useState(new Map),re=Q[0],oe=Q[1],le=Dt.useState(new Map),ve=le[0],ke=le[1],ce=Dt.useState(new Map),te=ce[0],ue=ce[1],pe=Dt.useState(!1),he=pe[0],Ze=pe[1],Ot=Dt.useState(new Map),Ht=Ot[0],st=Ot[1],_r=Dt.useState(!1),jt=_r[0],_t=_r[1],vr=Dt.useState(!1),ft=vr[0],xt=vr[1],$r=Dt.useState("RECORDING_STOPPED"),cr=$r[0],yr=$r[1],Jr=Dt.useState("LIVESTREAM_STOPPED"),Gt=Jr[0],Ke=Jr[1],Ct=Dt.useState("HLS_STOPPED"),dr=Ct[0],xe=Ct[1],Ye=Dt.useState({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),zt=Ye[0],pt=Ye[1],rr=Dt.useState("TRANSCRIPTION_STOPPED"),jr=rr[0],Hr=rr[1],vt=Dt.useRef(),zn=Dt.useRef(),oa=Dt.useRef(),ca=Dt.useRef(),pn=Dt.useRef(),ba=Dt.useRef(se),wt=Dt.useRef(fe),je=Dt.useRef(!1),Qe=Dt.useRef(),Ve=Dt.useMemo(function(){return Pt},[]);Dt.useEffect(function(){vt.current=l},[l]),Dt.useEffect(function(){zn.current=m},[m]),Dt.useEffect(function(){oa.current=i},[i]),Dt.useEffect(function(){ca.current=r},[r]),Dt.useEffect(function(){pn.current=P},[P]),Dt.useEffect(function(){ba.current=se},[se]),Dt.useEffect(function(){wt.current=fe},[fe]),Dt.useEffect(function(){Qe.current=ft},[ft]);var Ce=function(){k(null),u(null),c(null),h(null),b(null),E(!1),t(!1),a(!1),O(!1),B([]),Ze(!1),oe(new Map),ke(new Map),ue(new Map),st(new Map),_t(!1),xt(!1),yr("RECORDING_STOPPED"),Ke("LIVESTREAM_STOPPED"),xe("HLS_STOPPED"),Hr("TRANSCRIPTION_STOPPED"),pt({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null})},ur=function(H){oe(function(ze){ze.set(H.id,H);var Wt=new Map(ze);return Wt}),He.emit($e["participant-joined"],H)},we=function(H){oe(function(ze){ze.delete(H.id);var Wt=new Map(ze);return Wt}),He.emit($e["participant-left"],H)},er=function(H){var ze,Wt;b(H),a(H===(vt==null||(ze=vt.current)===null||ze===void 0||(Wt=ze.localParticipant)===null||Wt===void 0?void 0:Wt.id)),He.emit($e["presenter-changed"],H)},fr=function(H){c(H),He.emit($e["main-participant-changed"],H)},br=function(H){h(H),He.emit($e["speaker-changed"],H)},gr=function(H){B(function(ze){return[].concat(ze,[H])}),He.emit($e["chat-message"],H)},tn=function(H){He.emit($e["entry-requested"],H)},Ie=function(H,ze){He.emit($e["entry-responded"],H,ze)},yt=function(){O(!0),He.emit($e["recording-started"])},gt=function(){O(!1),He.emit($e["recording-stopped"])},ht=function(H){H.track.readyState==="live"&&(H.kind==="video"?t(!0):H.kind==="audio"&&E(!0))},Pr=function(H){H.kind==="video"?t(!1):H.kind==="audio"&&E(!1)},Cr=function(H){Ze(!0),He.emit($e["live-stream-started"],H)},Ar=function(){Ze(!1),He.emit($e["live-stream-stopped"])},Yt=function(H){xt(!0),He.emit($e["hls-started"],H)},ar=function(){xt(!1),He.emit($e["hls-stopped"])},Tr=function(H){He.emit($e["video-state-changed"],H)},kn=function(H){He.emit($e["video-seeked"],H)},rn=function(H){He.emit($e["webcam-requested"],H)},na=function(H){He.emit($e["mic-requested"],H)},Aa=function(H){je.current=!0,B(function(ze){return[].concat(ze,H.messages)}),He.emit($e["meeting-joined"],H),_t(!0)},Gr=function(){He.emit($e["meeting-left"]);var H=vt.current;if(H){var ze;typeof(H==null?void 0:H.off)=="function"&&(H.off("meeting-state-changed",ja),H.off("participant-joined",ur),H.off("participant-left",we),H.off("presenter-changed",er),H.off("main-participant-changed",fr),H.off("speaker-changed",br),H.off("entry-requested",tn),H.off("entry-responded",Ie),H.off("chat-message",gr),H.off("recording-started",yt),H.off("recording-stopped",gt),H.off("meeting-joined",Aa),H.off("meeting-left",Gr),H.off("livestream-started",Cr),H.off("livestream-stopped",Ar),H.off("video-state-changed",Tr),H.off("video-seeked",kn),H.off("webcam-requested",rn),H.off("mic-requested",na),H.off("pin-state-changed",Pe),H.off("connection-open",La),H.off("connection-close",Da),H.off("switch-meeting",Ua),H.off("error",Na),H.off("hls-started",Yt),H.off("hls-stopped",ar),H.off("recording-state-changed",gs),H.off("livestream-state-changed",ss),H.off("hls-state-changed",Se),H.off("participant-mode-changed",ir),H.off("whiteboard-stopped",rt),H.off("whiteboard-started",Me),H.off("transcription-state-changed",ge),H.off("character-joined",Lt),H.off("character-left",Bt)),typeof(H==null||(ze=H.localParticipant)===null||ze===void 0?void 0:ze.off)=="function"&&(H.localParticipant.off("stream-enabled",ht),H.localParticipant.off("stream-disabled",Pr)),Ce()}},Pe=function(H){var ze=H.participantId,Wt=H.state,Pn=H.pinnedBy;ue(function(Ln){!Wt.cam&&!Wt.share?Ln.delete(ze):Ln.set(ze,Wt);var nr=new Map(Ln);return nr}),He.emit($e["pin-state-changed"],{participantId:ze,state:Wt,pinnedBy:Pn})},La=function(H){st(function(ze){ze.set(H.id,H);var Wt=new Map(ze);return Wt}),He.emit($e["connection-open"],H)},Da=function(H){st(function(ze){ze.delete(H);var Wt=new Map(ze);return Wt}),He.emit($e["connection-close"],H)},Ua=function(H){He.emit($e["switch-meeting"],H)},Na=function(H){He.emit($e.error,H)},gs=function(H){yr(H==null?void 0:H.status),He.emit($e["recording-state-changed"],H)},ss=function(H){Ke(H==null?void 0:H.status),He.emit($e["livestream-state-changed"],H)},Se=function(H){xe(H==null?void 0:H.status),(H==null?void 0:H.status)=="HLS_PLAYABLE"?pt({downstreamUrl:H==null?void 0:H.downstreamUrl,playbackHlsUrl:H==null?void 0:H.playbackHlsUrl,livestreamUrl:H==null?void 0:H.livestreamUrl}):(H==null?void 0:H.status)=="HLS_STOPPED"&&pt({downstreamUrl:null,playbackHlsUrl:null,livestreamUrl:null}),He.emit($e["hls-state-changed"],H)},ja=function(H){He.emit($e["meeting-state-changed"],H)},ge=function(H){Hr(H==null?void 0:H.status),He.emit($e["transcription-state-changed"],H)},Oe=function(H){He.emit($e["transcription-text"],H)},Me=function(H){He.emit($e["whiteboard-started"],H)},rt=function(H){He.emit($e["whiteboard-stopped"],H)},Lt=function(H){ke(function(ze){ze.set(H.id,H);var Wt=new Map(ze);return Wt}),He.emit($e["character-joined"],H)},Bt=function(H){ke(function(ze){ze.delete(H.id);var Wt=new Map(ze);return Wt}),He.emit($e["character-left"],H)},ir=function(H){var ze,Wt;oe(function(Pn){var Ln=Pn.get(H.participantId);Ln.mode=H.mode,Pn.set(Ln.id,Ln);var nr=new Map(Pn);return nr}),H.participantId===(vt==null||(ze=vt.current)===null||ze===void 0||(Wt=ze.localParticipant)===null||Wt===void 0?void 0:Wt.id)&&u(function(Pn){return Pn.mode=H.mode,Pn}),He.emit($e["participant-mode-changed"],H)},Qt=function(){var H=Is.VideoSDK&&Is.VideoSDK.initMeeting(ba.current);k(H);var ze=H.localParticipant,Wt=H.participants,Pn=H.characters;Wt.set(ze.id,ze),oe(Wt),ke(Pn),u(ze),H.on("meeting-state-changed",ja),H.on("participant-joined",ur),H.on("participant-left",we),H.on("presenter-changed",er),H.on("main-participant-changed",fr),H.on("speaker-changed",br),H.on("entry-requested",tn),H.on("entry-responded",Ie),H.on("chat-message",gr),H.on("recording-started",yt),H.on("recording-stopped",gt),H.on("meeting-joined",Aa),H.on("meeting-left",Gr),H.on("livestream-started",Cr),H.on("livestream-stopped",Ar),H.on("video-state-changed",Tr),H.on("video-seeked",kn),H.on("webcam-requested",rn),H.on("mic-requested",na),H.on("pin-state-changed",Pe),H.on("connection-open",La),H.on("connection-close",Da),H.on("switch-meeting",Ua),H.on("error",Na),H.on("hls-started",Yt),H.on("hls-stopped",ar),H.on("recording-state-changed",gs),H.on("livestream-state-changed",ss),H.on("hls-state-changed",Se),H.on("participant-mode-changed",ir),H.on("transcription-state-changed",ge),H.on("transcription-text",Oe),H.on("whiteboard-started",Me),H.on("whiteboard-stopped",rt),H.on("character-joined",Lt),H.on("character-left",Bt),H.localParticipant.on("stream-enabled",ht),H.localParticipant.on("stream-disabled",Pr),H.join()},Tt=function(){var H=vt.current;H&&H.leave()},wr=function(){var H=vt.current;H&&H.end()},It=function(H,ze,Wt,Pn){var Ln=vt.current;Ln&&Ln.startRecording(H,ze,Wt,Pn)},lr=function(){var H=vt.current;if(H){var ze=pn.current;ze&&H.stopRecording()}},Or=function(H){H===void 0&&(H=void 0);var ze=vt.current;ze&&ze.unmuteMic(H)},Lr=function(){var H=vt.current;H&&H.muteMic()},Yr=function(H){H===void 0&&(H=void 0);var ze=zn.current;ze?Lr():Or(H)},Qr=function(){var H=vt.current;H&&H.disableWebcam()},Mn=function(H){H===void 0&&(H=void 0);var ze=vt.current;ze&&ze.enableWebcam(H)},An=function(H){H===void 0&&(H=void 0);var ze=oa.current;ze?Qr():Mn(H)},Vn=function(){var H=vt.current;H&&H.disableScreenShare()},$n=function(H){H===void 0&&(H=void 0);var ze=vt.current;ze&&ze.enableScreenShare(H)},da=function(H){H===void 0&&(H=void 0);var ze=ca.current;ze?Vn():$n(H)},ma=function(H){var ze=vt.current;ze&&ze.changeMode(H)},aa=function(H){var ze=vt.current;ze&&ze.sendChatMessage(H)},wa=function(H,ze){var Wt=vt.current;Wt&&Wt.respondEntry(H,ze)},Ea=function(){try{var H=vt.current;return Promise.resolve(function(){if(H)return Promise.resolve(H.getMics())}())}catch(ze){return Promise.reject(ze)}},Wa=function(){try{var H=vt.current;return Promise.resolve(function(){if(H)return Promise.resolve(H.getWebcams())}())}catch(ze){return Promise.reject(ze)}},Va=function(H){var ze=vt.current;ze&&ze.changeWebcam(H)},qa=function(H){var ze=vt.current;ze&&ze.replaceWebcamStream(H)},Ha=function(H){var ze=vt.current;ze&&ze.changeMic(H)},za=function(H){var ze=H.link,Wt=vt.current;Wt&&Wt.startVideo({link:ze})},$a=function(){var H=vt.current;H&&H.stopVideo()},Ga=function(){var H=vt.current;H&&H.resumeVideo()},Ka=function(H){var ze=H.currentTime,Wt=vt.current;Wt&&Wt.pauseVideo({currentTime:ze})},Ja=function(H){var ze=H.currentTime,Wt=vt.current;Wt&&Wt.seekVideo({currentTime:ze})},Ya=function(H,ze){var Wt=vt.current;Wt&&Wt.startLivestream(H,ze)},Qa=function(){var H=vt.current;H&&H.stopLivestream()},Xa=function(H){var ze=H.meetingId,Wt=H.payload;try{var Pn=vt.current,Ln=function(){if(Pn)return Promise.resolve(Pn.connectTo({meetingId:ze,payload:Wt})).then(function(){})}();return Promise.resolve(Ln&&Ln.then?Ln.then(function(){}):void 0)}catch(nr){return Promise.reject(nr)}},Za=function(H,ze){var Wt=vt.current;Wt&&Wt.startHls(H,ze)},es=function(){var H=vt.current;H&&H.stopHls()},xa=function(){Is.VideoSDK.config(wt.current),G?Is.VideoSDK.analytics(G):Is.VideoSDK.analytics({sdkType:"react-web",sdkVersion:nd}),De&&Qt()};return Dt.useEffect(function(){xa()},[]),Dt.useEffect(function(){Ve&&je.current&&(Tt(),xa(),!De&&Qt())},[se.meetingId,fe,Ve]),Mc.createElement(qo.Provider,{value:{meetingId:l==null?void 0:l.id,meeting:l,baseUrl:l==null?void 0:l.baseUrl,localParticipant:d,mainParticipant:o,activeSpeakerId:g,participants:re,characters:ve,presenterId:_,localMicOn:m,localWebcamOn:i,localScreenShareOn:r,messages:j,isRecording:P,isLiveStreaming:he,pinnedParticipants:te,connections:Ht,isHls:ft,recordingState:cr,livestreamState:Gt,hlsState:dr,hlsUrls:zt,transcriptionState:jr,isMeetingJoined:jt,selectedCameraDevice:l==null?void 0:l.selectedCameraDevice,selectedMicrophoneDevice:l==null?void 0:l.selectedMicrophoneDevice,join:Qt,leave:Tt,end:wr,startRecording:It,stopRecording:lr,sendChatMessage:aa,respondEntry:wa,muteMic:Lr,unmuteMic:Or,toggleMic:Yr,disableWebcam:Qr,enableWebcam:Mn,toggleWebcam:An,disableScreenShare:Vn,enableScreenShare:$n,toggleScreenShare:da,getMics:Ea,getWebcams:Wa,changeWebcam:Va,replaceWebcamStream:qa,changeMic:Ha,changeMode:ma,startVideo:za,stopVideo:$a,resumeVideo:Ga,pauseVideo:Ka,seekVideo:Ja,startLivestream:Ya,stopLivestream:Qa,connectTo:Xa,startHls:Za,stopHls:es}},J)},sd=function(U,J){var se={},fe=se.onStreamEnabled,De=fe===void 0?function(){}:fe,Pt=se.onStreamDisabled,G=Pt===void 0?function(){}:Pt,C=se.onMediaStatusChanged,l=C===void 0?function(){}:C,k=se.onVideoQualityChanged,S=k===void 0?function(){}:k,d=Dt.useState(null),u=d[0],f=d[1],o=Dt.useState(null),c=o[0],e=o[1],g=Dt.useState(null),h=g[0],v=g[1],_=Dt.useState(null),b=_[0],p=_[1],m=Ho(),E=Dt.useMemo(function(){var xe,Ye=m==null?void 0:m.participants,zt=m==null?void 0:m.localParticipant,pt=m==null?void 0:m.activeSpeakerId,rr=m==null?void 0:m.mainParticipant,jr=(m==null||(xe=m.pinnedParticipants)===null||xe===void 0?void 0:xe.get(U))||{cam:!1,share:!1};return{participants:Ye,localParticipant:zt,activeSpeakerId:pt,mainParticipant:rr,pinState:jr}},[m]),s=E.participants,i=E.localParticipant,t=E.activeSpeakerId,n=E.mainParticipant,r=E.pinState,a=s==null?void 0:s.get(U),y=Dt.useState(a==null?void 0:a.webcamOn),P=y[0],O=y[1],M=Dt.useState(a==null?void 0:a.micOn),j=M[0],B=M[1],Q=Dt.useState(a==null?void 0:a.mode),re=Q[0],oe=Q[1],le=function(Ye){if(Ye.track.readyState==="live")switch(Ye.kind){case"video":u!=null&&f(null),f(Ye);break;case"audio":c!=null&&e(null),e(Ye);break;case"share":h!=null&&v(null),v(Ye);break;case"shareAudio":b!=null&&p(null),p(Ye);break}},ve=function(Ye){switch(Ye.kind){case"video":f(null);break;case"audio":e(null);break;case"share":v(null);break;case"shareAudio":p(null);break}},ke=function(Ye){le(Ye),De(Ye)},ce=function(Ye){U===Ye.participantId&&oe(Ye.mode)},te=function(Ye){ve(Ye),G(Ye)},ue=function(Ye){var zt=Ye.peerId,pt=Ye.prevQuality,rr=Ye.currentQuality;S({peerId:zt,prevQuality:pt,currentQuality:rr})},pe=function(Ye){var zt=Ye.kind,pt=Ye.peerId,rr=Ye.newStatus;zt=="audio"?B(rr):zt=="video"&&O(rr),l({kind:zt,peerId:pt,newStatus:rr})},he=function(Ye){a==null||a.setQuality(Ye)},Ze=function(Ye,zt){a==null||a.setViewPort(Ye,zt)},Ot=function(){a==null||a.enableMic()},Ht=function(){a==null||a.disableMic()},st=function(){a==null||a.enableWebcam()},_r=function(){a==null||a.disableWebcam()},jt=function(Ye){a==null||a.pin(Ye)},_t=function(Ye){a==null||a.unpin(Ye)},vr=function(){a==null||a.remove()},ft=function(Ye){var zt=Ye===void 0?{}:Ye,pt=zt.height,rr=zt.width;return Promise.resolve(a==null?void 0:a.captureImage({height:pt,width:rr}))},xt=function(){return Promise.resolve(a==null?void 0:a.getAudioStats())},$r=function(){return Promise.resolve(a==null?void 0:a.getVideoStats())},cr=function(){return Promise.resolve(a==null?void 0:a.getShareStats())},yr=function(){return Promise.resolve(a==null?void 0:a.getShareAudioStats())},Jr=function(){a==null||a.consumeWebcamStreams()},Gt=function(){a==null||a.consumeMicStreams()},Ke=function(){a==null||a.stopConsumingWebcamStreams()},Ct=function(){a==null||a.stopConsumingMicStreams()},dr=function(Ye){return Promise.resolve(a==null?void 0:a.switchTo(Ye)).then(function(){})};return Dt.useEffect(function(){var xe=a==null?void 0:a.streams;return xe&&xe.forEach(function(Ye){le(Ye)}),a!=null&&a.micOn&&B(j),a!=null&&a.webcamOn&&O(P),a==null||a.on("stream-enabled",ke),a==null||a.on("stream-disabled",te),a==null||a.on("media-status-changed",pe),a==null||a.on("video-quality-changed",ue),He.on($e["participant-mode-changed"],ce),function(){a==null||a.off("stream-enabled",ke),a==null||a.off("stream-disabled",te),a==null||a.off("media-status-changed",pe),a==null||a.off("video-quality-changed",ue),He.off($e["participant-mode-changed"],ce)}},[a]),{displayName:a==null?void 0:a.displayName,participant:a,webcamStream:u,micStream:c,screenShareStream:h,screenShareAudioStream:b,webcamOn:P||!!u,micOn:j||!!c,mode:re,metaData:a==null?void 0:a.metaData,screenShareOn:!!h,isLocal:(i==null?void 0:i.id)===U,isActiveSpeaker:t===U,isMainParticipant:(n==null?void 0:n.id)===U,pinState:r,consumeMicStreams:Gt,consumeWebcamStreams:Jr,stopConsumingMicStreams:Ct,stopConsumingWebcamStreams:Ke,setQuality:he,setViewPort:Ze,enableMic:Ot,disableMic:Ht,enableWebcam:st,disableWebcam:_r,captureImage:ft,pin:jt,unpin:_t,remove:vr,switchTo:dr,getAudioStats:xt,getVideoStats:$r,getShareStats:cr,getShareAudioStats:yr}};typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));typeof Symbol<"u"&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));Is.VideoSDK.Constants;var id=function(U,J,se){var fe=document.head||document.getElementsByTagName("head")[0],De=document.createElement("script");typeof J=="function"&&(se=J,J={}),J=J||{},se=se||function(){},De.type=J.type||"text/javascript",De.charset=J.charset||"utf8",De.async="async"in J?!!J.async:!0,De.src=U,J.attrs&&od(De,J.attrs),J.text&&(De.text=""+J.text);var Pt="onload"in De?Eo:cd;Pt(De,se),De.onload||Eo(De,se),fe.appendChild(De)};function od(N,U){for(var J in U)N.setAttribute(J,U[J])}function Eo(N,U){N.onload=function(){this.onerror=this.onload=null,U(null,N)},N.onerror=function(){this.onerror=this.onload=null,U(new Error("Failed to load "+this.src),N)}}function cd(N,U){N.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,U(null,N))}}var dd=Object.create,Wi=Object.defineProperty,ud=Object.getOwnPropertyDescriptor,ld=Object.getOwnPropertyNames,pd=Object.getPrototypeOf,hd=Object.prototype.hasOwnProperty,md=(N,U)=>{for(var J in U)Wi(N,J,{get:U[J],enumerable:!0})},zo=(N,U,J,se)=>{if(U&&typeof U=="object"||typeof U=="function")for(let fe of ld(U))!hd.call(N,fe)&&fe!==J&&Wi(N,fe,{get:()=>U[fe],enumerable:!(se=ud(U,fe))||se.enumerable});return N},ao=(N,U,J)=>(J=N!=null?dd(pd(N)):{},zo(!N||!N.__esModule?Wi(J,"default",{value:N,enumerable:!0}):J,N)),fd=N=>zo(Wi({},"__esModule",{value:!0}),N),$o={};md($o,{callPlayer:()=>xd,getConfig:()=>Od,getSDK:()=>Td,isBlobUrl:()=>Md,isMediaStream:()=>Id,lazy:()=>yd,omit:()=>Dd,parseEndTime:()=>kd,parseStartTime:()=>Ed,queryString:()=>Cd,randomString:()=>Pd,supportsWebKitPresentationMode:()=>Ad});var Vi=fd($o),gd=ao(Dt),_d=ao(id),vd=ao(xo);const yd=N=>gd.default.lazy(async()=>{const U=await N();return typeof U.default=="function"?U:U.default}),bd=/[?&#](?:start|t)=([0-9hms]+)/,wd=/[?&#]end=([0-9hms]+)/,Zi=/(\d+)(h|m|s)/g,Sd=/^\d+$/;function Go(N,U){if(N instanceof Array)return;const J=N.match(U);if(J){const se=J[1];if(se.match(Zi))return Rd(se);if(Sd.test(se))return parseInt(se)}}function Rd(N){let U=0,J=Zi.exec(N);for(;J!==null;){const[,se,fe]=J;fe==="h"&&(U+=parseInt(se,10)*60*60),fe==="m"&&(U+=parseInt(se,10)*60),fe==="s"&&(U+=parseInt(se,10)),J=Zi.exec(N)}return U}function Ed(N){return Go(N,bd)}function kd(N){return Go(N,wd)}function Pd(){return Math.random().toString(36).substr(2,5)}function Cd(N){return Object.keys(N).map(U=>`${U}=${N[U]}`).join("&")}function Yi(N){return window[N]?window[N]:window.exports&&window.exports[N]?window.exports[N]:window.module&&window.module.exports&&window.module.exports[N]?window.module.exports[N]:null}const Ds={},Td=function(U,J,se=null,fe=()=>!0,De=_d.default){const Pt=Yi(J);return Pt&&fe(Pt)?Promise.resolve(Pt):new Promise((G,C)=>{if(Ds[U]){Ds[U].push({resolve:G,reject:C});return}Ds[U]=[{resolve:G,reject:C}];const l=k=>{Ds[U].forEach(S=>S.resolve(k))};if(se){const k=window[se];window[se]=function(){k&&k(),l(Yi(J))}}De(U,k=>{k?(Ds[U].forEach(S=>S.reject(k)),Ds[U]=null):se||l(Yi(J))})})};function Od(N,U){return(0,vd.default)(U.config,N.config)}function Dd(N,...U){const J=[].concat(...U),se={},fe=Object.keys(N);for(const De of fe)J.indexOf(De)===-1&&(se[De]=N[De]);return se}function xd(N,...U){if(!this.player||!this.player[N]){let J=`ReactPlayer: ${this.constructor.displayName} player could not call %c${N}%c – `;return this.player?this.player[N]||(J+="The method was not available"):J+="The player was not available",console.warn(J,"font-weight: bold",""),null}return this.player[N](...U)}function Id(N){return typeof window<"u"&&typeof window.MediaStream<"u"&&N instanceof window.MediaStream}function Md(N){return/^blob:/.test(N)}function Ad(N=document.createElement("video")){const U=/iPhone|iPod/.test(navigator.userAgent)===!1;return N.webkitSupportsPresentationMode&&typeof N.webkitSetPresentationMode=="function"&&U}var so=Object.defineProperty,Ld=Object.getOwnPropertyDescriptor,Nd=Object.getOwnPropertyNames,jd=Object.prototype.hasOwnProperty,Bd=(N,U)=>{for(var J in U)so(N,J,{get:U[J],enumerable:!0})},Fd=(N,U,J,se)=>{if(U&&typeof U=="object"||typeof U=="function")for(let fe of Nd(U))!jd.call(N,fe)&&fe!==J&&so(N,fe,{get:()=>U[fe],enumerable:!(se=Ld(U,fe))||se.enumerable});return N},Ud=N=>Fd(so({},"__esModule",{value:!0}),N),Ko={};Bd(Ko,{AUDIO_EXTENSIONS:()=>io,DASH_EXTENSIONS:()=>cc,FLV_EXTENSIONS:()=>dc,HLS_EXTENSIONS:()=>co,MATCH_URL_DAILYMOTION:()=>ac,MATCH_URL_FACEBOOK:()=>Xo,MATCH_URL_FACEBOOK_WATCH:()=>Zo,MATCH_URL_KALTURA:()=>oc,MATCH_URL_MIXCLOUD:()=>sc,MATCH_URL_MUX:()=>Qo,MATCH_URL_SOUNDCLOUD:()=>Jo,MATCH_URL_STREAMABLE:()=>ec,MATCH_URL_TWITCH_CHANNEL:()=>nc,MATCH_URL_TWITCH_VIDEO:()=>rc,MATCH_URL_VIDYARD:()=>ic,MATCH_URL_VIMEO:()=>Yo,MATCH_URL_WISTIA:()=>tc,MATCH_URL_YOUTUBE:()=>eo,VIDEO_EXTENSIONS:()=>oo,canPlay:()=>Vd});var Wd=Ud(Ko),ko=Vi;const eo=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,Jo=/(?:soundcloud\.com|snd\.sc)\/[^.]+$/,Yo=/vimeo\.com\/(?!progressive_redirect).+/,Qo=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,Xo=/^https?:\/\/(www\.)?facebook\.com.*\/(video(s)?|watch|story)(\.php?|\/).+$/,Zo=/^https?:\/\/fb\.watch\/.+$/,ec=/streamable\.com\/([a-z0-9]+)$/,tc=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,rc=/(?:www\.|go\.)?twitch\.tv\/videos\/(\d+)($|\?)/,nc=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+)($|\?)/,ac=/^(?:(?:https?):)?(?:\/\/)?(?:www\.)?(?:(?:dailymotion\.com(?:\/embed)?\/video)|dai\.ly)\/([a-zA-Z0-9]+)(?:_[\w_-]+)?(?:[\w.#_-]+)?/,sc=/mixcloud\.com\/([^/]+\/[^/]+)/,ic=/vidyard.com\/(?:watch\/)?([a-zA-Z0-9-_]+)/,oc=/^https?:\/\/[a-zA-Z]+\.kaltura.(com|org)\/p\/([0-9]+)\/sp\/([0-9]+)00\/embedIframeJs\/uiconf_id\/([0-9]+)\/partner_id\/([0-9]+)(.*)entry_id.([a-zA-Z0-9-_].*)$/,io=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,oo=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,co=/\.(m3u8)($|\?)/i,cc=/\.(mpd)($|\?)/i,dc=/\.(flv)($|\?)/i,to=N=>{if(N instanceof Array){for(const U of N)if(typeof U=="string"&&to(U)||to(U.src))return!0;return!1}return(0,ko.isMediaStream)(N)||(0,ko.isBlobUrl)(N)?!0:io.test(N)||oo.test(N)||co.test(N)||cc.test(N)||dc.test(N)},Vd={youtube:N=>N instanceof Array?N.every(U=>eo.test(U)):eo.test(N),soundcloud:N=>Jo.test(N)&&!io.test(N),vimeo:N=>Yo.test(N)&&!oo.test(N)&&!co.test(N),mux:N=>Qo.test(N),facebook:N=>Xo.test(N)||Zo.test(N),streamable:N=>ec.test(N),wistia:N=>tc.test(N),twitch:N=>rc.test(N)||nc.test(N),dailymotion:N=>ac.test(N),mixcloud:N=>sc.test(N),vidyard:N=>ic.test(N),kaltura:N=>oc.test(N),file:to};var uo=Object.defineProperty,qd=Object.getOwnPropertyDescriptor,Hd=Object.getOwnPropertyNames,zd=Object.prototype.hasOwnProperty,$d=(N,U)=>{for(var J in U)uo(N,J,{get:U[J],enumerable:!0})},Gd=(N,U,J,se)=>{if(U&&typeof U=="object"||typeof U=="function")for(let fe of Hd(U))!zd.call(N,fe)&&fe!==J&&uo(N,fe,{get:()=>U[fe],enumerable:!(se=qd(U,fe))||se.enumerable});return N},Kd=N=>Gd(uo({},"__esModule",{value:!0}),N),uc={};$d(uc,{default:()=>Yd});var Jd=Kd(uc),pa=Vi,sa=Wd,Yd=[{key:"youtube",name:"YouTube",canPlay:sa.canPlay.youtube,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./YouTube-a-iDKmwF.js").then(N=>N.Y),__vite__mapDeps([0,1,2])))},{key:"soundcloud",name:"SoundCloud",canPlay:sa.canPlay.soundcloud,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./SoundCloud-D5cgOI83.js").then(N=>N.S),__vite__mapDeps([3,1,2])))},{key:"vimeo",name:"Vimeo",canPlay:sa.canPlay.vimeo,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Vimeo-tFmzsaND.js").then(N=>N.V),__vite__mapDeps([4,1,2])))},{key:"mux",name:"Mux",canPlay:sa.canPlay.mux,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Mux-BbhaNBzS.js").then(N=>N.M),__vite__mapDeps([5,1,2])))},{key:"facebook",name:"Facebook",canPlay:sa.canPlay.facebook,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Facebook-CZdm6hlR.js").then(N=>N.F),__vite__mapDeps([6,1,2])))},{key:"streamable",name:"Streamable",canPlay:sa.canPlay.streamable,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Streamable-DaeD0XHf.js").then(N=>N.S),__vite__mapDeps([7,1,2])))},{key:"wistia",name:"Wistia",canPlay:sa.canPlay.wistia,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Wistia-DWa24UNs.js").then(N=>N.W),__vite__mapDeps([8,1,2])))},{key:"twitch",name:"Twitch",canPlay:sa.canPlay.twitch,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Twitch-CvDXnEh-.js").then(N=>N.T),__vite__mapDeps([9,1,2])))},{key:"dailymotion",name:"DailyMotion",canPlay:sa.canPlay.dailymotion,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./DailyMotion-J0XSTiQc.js").then(N=>N.D),__vite__mapDeps([10,1,2])))},{key:"mixcloud",name:"Mixcloud",canPlay:sa.canPlay.mixcloud,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Mixcloud-DA2Nz_g4.js").then(N=>N.M),__vite__mapDeps([11,1,2])))},{key:"vidyard",name:"Vidyard",canPlay:sa.canPlay.vidyard,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Vidyard-kp68x3Yc.js").then(N=>N.V),__vite__mapDeps([12,1,2])))},{key:"kaltura",name:"Kaltura",canPlay:sa.canPlay.kaltura,lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./Kaltura-2FqlPxlO.js").then(N=>N.K),__vite__mapDeps([13,1,2])))},{key:"file",name:"FilePlayer",canPlay:sa.canPlay.file,canEnablePIP:N=>sa.canPlay.file(N)&&(document.pictureInPictureEnabled||(0,pa.supportsWebKitPresentationMode)())&&!sa.AUDIO_EXTENSIONS.test(N),lazyPlayer:(0,pa.lazy)(()=>ha(()=>import("./FilePlayer-B2gAAkE-.js").then(N=>N.F),__vite__mapDeps([14,1,2])))}],Po=Number.isNaN||function(U){return typeof U=="number"&&U!==U};function Qd(N,U){return!!(N===U||Po(N)&&Po(U))}function Xd(N,U){if(N.length!==U.length)return!1;for(var J=0;J<N.length;J++)if(!Qd(N[J],U[J]))return!1;return!0}function Zd(N,U){U===void 0&&(U=Xd);var J,se=[],fe,De=!1;function Pt(){for(var G=[],C=0;C<arguments.length;C++)G[C]=arguments[C];return De&&J===this&&U(G,se)||(fe=N.apply(this,G),De=!0,J=this,se=G),fe}return Pt}const eu=Object.freeze(Object.defineProperty({__proto__:null,default:Zd},Symbol.toStringTag,{value:"Module"})),tu=Ac(eu);var ru=typeof Element<"u",nu=typeof Map=="function",au=typeof Set=="function",su=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function Fi(N,U){if(N===U)return!0;if(N&&U&&typeof N=="object"&&typeof U=="object"){if(N.constructor!==U.constructor)return!1;var J,se,fe;if(Array.isArray(N)){if(J=N.length,J!=U.length)return!1;for(se=J;se--!==0;)if(!Fi(N[se],U[se]))return!1;return!0}var De;if(nu&&N instanceof Map&&U instanceof Map){if(N.size!==U.size)return!1;for(De=N.entries();!(se=De.next()).done;)if(!U.has(se.value[0]))return!1;for(De=N.entries();!(se=De.next()).done;)if(!Fi(se.value[1],U.get(se.value[0])))return!1;return!0}if(au&&N instanceof Set&&U instanceof Set){if(N.size!==U.size)return!1;for(De=N.entries();!(se=De.next()).done;)if(!U.has(se.value[0]))return!1;return!0}if(su&&ArrayBuffer.isView(N)&&ArrayBuffer.isView(U)){if(J=N.length,J!=U.length)return!1;for(se=J;se--!==0;)if(N[se]!==U[se])return!1;return!0}if(N.constructor===RegExp)return N.source===U.source&&N.flags===U.flags;if(N.valueOf!==Object.prototype.valueOf&&typeof N.valueOf=="function"&&typeof U.valueOf=="function")return N.valueOf()===U.valueOf();if(N.toString!==Object.prototype.toString&&typeof N.toString=="function"&&typeof U.toString=="function")return N.toString()===U.toString();if(fe=Object.keys(N),J=fe.length,J!==Object.keys(U).length)return!1;for(se=J;se--!==0;)if(!Object.prototype.hasOwnProperty.call(U,fe[se]))return!1;if(ru&&N instanceof Element)return!1;for(se=J;se--!==0;)if(!((fe[se]==="_owner"||fe[se]==="__v"||fe[se]==="__o")&&N.$$typeof)&&!Fi(N[fe[se]],U[fe[se]]))return!1;return!0}return N!==N&&U!==U}var lc=function(U,J){try{return Fi(U,J)}catch(se){if((se.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw se}},iu=Object.create,qi=Object.defineProperty,ou=Object.getOwnPropertyDescriptor,cu=Object.getOwnPropertyNames,du=Object.getPrototypeOf,uu=Object.prototype.hasOwnProperty,lu=(N,U)=>{for(var J in U)qi(N,J,{get:U[J],enumerable:!0})},pc=(N,U,J,se)=>{if(U&&typeof U=="object"||typeof U=="function")for(let fe of cu(U))!uu.call(N,fe)&&fe!==J&&qi(N,fe,{get:()=>U[fe],enumerable:!(se=ou(U,fe))||se.enumerable});return N},pu=(N,U,J)=>(J=N!=null?iu(du(N)):{},pc(!N||!N.__esModule?qi(J,"default",{value:N,enumerable:!0}):J,N)),hu=N=>pc(qi({},"__esModule",{value:!0}),N),hc={};lu(hc,{defaultProps:()=>gu,propTypes:()=>fu});var mc=hu(hc),mu=pu(Hc);const{string:Qn,bool:ia,number:xs,array:Qi,oneOfType:ni,shape:ya,object:ra,func:Wn,node:Co}=mu.default,fu={url:ni([Qn,Qi,ra]),playing:ia,loop:ia,controls:ia,volume:xs,muted:ia,playbackRate:xs,width:ni([Qn,xs]),height:ni([Qn,xs]),style:ra,progressInterval:xs,playsinline:ia,pip:ia,stopOnUnmount:ia,light:ni([ia,Qn,ra]),playIcon:Co,previewTabIndex:xs,previewAriaLabel:Qn,fallback:Co,oEmbedUrl:Qn,wrapper:ni([Qn,Wn,ya({render:Wn.isRequired})]),config:ya({soundcloud:ya({options:ra}),youtube:ya({playerVars:ra,embedOptions:ra,onUnstarted:Wn}),facebook:ya({appId:Qn,version:Qn,playerId:Qn,attributes:ra}),dailymotion:ya({params:ra}),vimeo:ya({playerOptions:ra,title:Qn}),mux:ya({attributes:ra,version:Qn}),file:ya({attributes:ra,tracks:Qi,forceVideo:ia,forceAudio:ia,forceHLS:ia,forceSafariHLS:ia,forceDisableHls:ia,forceDASH:ia,forceFLV:ia,hlsOptions:ra,hlsVersion:Qn,dashVersion:Qn,flvVersion:Qn}),wistia:ya({options:ra,playerId:Qn,customControls:Qi}),mixcloud:ya({options:ra}),twitch:ya({options:ra,playerId:Qn}),vidyard:ya({options:ra})}),onReady:Wn,onStart:Wn,onPlay:Wn,onPause:Wn,onBuffer:Wn,onBufferEnd:Wn,onEnded:Wn,onError:Wn,onDuration:Wn,onSeek:Wn,onPlaybackRateChange:Wn,onPlaybackQualityChange:Wn,onProgress:Wn,onClickPreview:Wn,onEnablePIP:Wn,onDisablePIP:Wn},Xn=()=>{},gu={playing:!1,loop:!1,controls:!1,volume:null,muted:!1,playbackRate:1,width:"640px",height:"360px",style:{},progressInterval:1e3,playsinline:!1,pip:!1,stopOnUnmount:!0,light:!1,fallback:null,wrapper:"div",previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}",config:{soundcloud:{options:{visual:!0,buying:!1,liking:!1,download:!1,sharing:!1,show_comments:!1,show_playcount:!1}},youtube:{playerVars:{playsinline:1,showinfo:0,rel:0,iv_load_policy:3,modestbranding:1},embedOptions:{},onUnstarted:Xn},facebook:{appId:"1309697205772819",version:"v3.3",playerId:null,attributes:{}},dailymotion:{params:{api:1,"endscreen-enable":!1}},vimeo:{playerOptions:{autopause:!1,byline:!1,portrait:!1,title:!1},title:null},mux:{attributes:{},version:"2"},file:{attributes:{},tracks:[],forceVideo:!1,forceAudio:!1,forceHLS:!1,forceDASH:!1,forceFLV:!1,hlsOptions:{},hlsVersion:"1.1.4",dashVersion:"3.1.3",flvVersion:"1.5.0",forceDisableHls:!1},wistia:{options:{},playerId:null,customControls:null},mixcloud:{options:{hide_cover:1}},twitch:{options:{},playerId:null},vidyard:{options:{}}},onReady:Xn,onStart:Xn,onPlay:Xn,onPause:Xn,onBuffer:Xn,onBufferEnd:Xn,onEnded:Xn,onError:Xn,onDuration:Xn,onSeek:Xn,onPlaybackRateChange:Xn,onPlaybackQualityChange:Xn,onProgress:Xn,onClickPreview:Xn,onEnablePIP:Xn,onDisablePIP:Xn};var _u=Object.create,ii=Object.defineProperty,vu=Object.getOwnPropertyDescriptor,yu=Object.getOwnPropertyNames,bu=Object.getPrototypeOf,wu=Object.prototype.hasOwnProperty,Su=(N,U,J)=>U in N?ii(N,U,{enumerable:!0,configurable:!0,writable:!0,value:J}):N[U]=J,Ru=(N,U)=>{for(var J in U)ii(N,J,{get:U[J],enumerable:!0})},fc=(N,U,J,se)=>{if(U&&typeof U=="object"||typeof U=="function")for(let fe of yu(U))!wu.call(N,fe)&&fe!==J&&ii(N,fe,{get:()=>U[fe],enumerable:!(se=vu(U,fe))||se.enumerable});return N},gc=(N,U,J)=>(J=N!=null?_u(bu(N)):{},fc(!N||!N.__esModule?ii(J,"default",{value:N,enumerable:!0}):J,N)),Eu=N=>fc(ii({},"__esModule",{value:!0}),N),En=(N,U,J)=>(Su(N,typeof U!="symbol"?U+"":U,J),J),_c={};Ru(_c,{default:()=>Hi});var ku=Eu(_c),To=gc(Dt),Pu=gc(lc),vc=mc,Cu=Vi;const Tu=5e3;class Hi extends To.Component{constructor(){super(...arguments),En(this,"mounted",!1),En(this,"isReady",!1),En(this,"isPlaying",!1),En(this,"isLoading",!0),En(this,"loadOnReady",null),En(this,"startOnPlay",!0),En(this,"seekOnPlay",null),En(this,"onDurationCalled",!1),En(this,"handlePlayerMount",U=>{if(this.player){this.progress();return}this.player=U,this.player.load(this.props.url),this.progress()}),En(this,"getInternalPlayer",U=>this.player?this.player[U]:null),En(this,"progress",()=>{if(this.props.url&&this.player&&this.isReady){const U=this.getCurrentTime()||0,J=this.getSecondsLoaded(),se=this.getDuration();if(se){const fe={playedSeconds:U,played:U/se};J!==null&&(fe.loadedSeconds=J,fe.loaded=J/se),(fe.playedSeconds!==this.prevPlayed||fe.loadedSeconds!==this.prevLoaded)&&this.props.onProgress(fe),this.prevPlayed=fe.playedSeconds,this.prevLoaded=fe.loadedSeconds}}this.progressTimeout=setTimeout(this.progress,this.props.progressFrequency||this.props.progressInterval)}),En(this,"handleReady",()=>{if(!this.mounted)return;this.isReady=!0,this.isLoading=!1;const{onReady:U,playing:J,volume:se,muted:fe}=this.props;U(),!fe&&se!==null&&this.player.setVolume(se),this.loadOnReady?(this.player.load(this.loadOnReady,!0),this.loadOnReady=null):J&&this.player.play(),this.handleDurationCheck()}),En(this,"handlePlay",()=>{this.isPlaying=!0,this.isLoading=!1;const{onStart:U,onPlay:J,playbackRate:se}=this.props;this.startOnPlay&&(this.player.setPlaybackRate&&se!==1&&this.player.setPlaybackRate(se),U(),this.startOnPlay=!1),J(),this.seekOnPlay&&(this.seekTo(this.seekOnPlay),this.seekOnPlay=null),this.handleDurationCheck()}),En(this,"handlePause",U=>{this.isPlaying=!1,this.isLoading||this.props.onPause(U)}),En(this,"handleEnded",()=>{const{activePlayer:U,loop:J,onEnded:se}=this.props;U.loopOnEnded&&J&&this.seekTo(0),J||(this.isPlaying=!1,se())}),En(this,"handleError",(...U)=>{this.isLoading=!1,this.props.onError(...U)}),En(this,"handleDurationCheck",()=>{clearTimeout(this.durationCheckTimeout);const U=this.getDuration();U?this.onDurationCalled||(this.props.onDuration(U),this.onDurationCalled=!0):this.durationCheckTimeout=setTimeout(this.handleDurationCheck,100)}),En(this,"handleLoaded",()=>{this.isLoading=!1})}componentDidMount(){this.mounted=!0}componentWillUnmount(){clearTimeout(this.progressTimeout),clearTimeout(this.durationCheckTimeout),this.isReady&&this.props.stopOnUnmount&&(this.player.stop(),this.player.disablePIP&&this.player.disablePIP()),this.mounted=!1}componentDidUpdate(U){if(!this.player)return;const{url:J,playing:se,volume:fe,muted:De,playbackRate:Pt,pip:G,loop:C,activePlayer:l,disableDeferredLoading:k}=this.props;if(!(0,Pu.default)(U.url,J)){if(this.isLoading&&!l.forceLoad&&!k&&!(0,Cu.isMediaStream)(J)){console.warn(`ReactPlayer: the attempt to load ${J} is being deferred until the player has loaded`),this.loadOnReady=J;return}this.isLoading=!0,this.startOnPlay=!0,this.onDurationCalled=!1,this.player.load(J,this.isReady)}!U.playing&&se&&!this.isPlaying&&this.player.play(),U.playing&&!se&&this.isPlaying&&this.player.pause(),!U.pip&&G&&this.player.enablePIP&&this.player.enablePIP(),U.pip&&!G&&this.player.disablePIP&&this.player.disablePIP(),U.volume!==fe&&fe!==null&&this.player.setVolume(fe),U.muted!==De&&(De?this.player.mute():(this.player.unmute(),fe!==null&&setTimeout(()=>this.player.setVolume(fe)))),U.playbackRate!==Pt&&this.player.setPlaybackRate&&this.player.setPlaybackRate(Pt),U.loop!==C&&this.player.setLoop&&this.player.setLoop(C)}getDuration(){return this.isReady?this.player.getDuration():null}getCurrentTime(){return this.isReady?this.player.getCurrentTime():null}getSecondsLoaded(){return this.isReady?this.player.getSecondsLoaded():null}seekTo(U,J,se){if(!this.isReady){U!==0&&(this.seekOnPlay=U,setTimeout(()=>{this.seekOnPlay=null},Tu));return}if(J?J==="fraction":U>0&&U<1){const De=this.player.getDuration();if(!De){console.warn("ReactPlayer: could not seek using fraction – duration not yet available");return}this.player.seekTo(De*U,se);return}this.player.seekTo(U,se)}render(){const U=this.props.activePlayer;return U?To.default.createElement(U,{...this.props,onMount:this.handlePlayerMount,onReady:this.handleReady,onPlay:this.handlePlay,onPause:this.handlePause,onEnded:this.handleEnded,onLoaded:this.handleLoaded,onError:this.handleError}):null}}En(Hi,"displayName","Player");En(Hi,"propTypes",vc.propTypes);En(Hi,"defaultProps",vc.defaultProps);var Ou=Object.create,oi=Object.defineProperty,Du=Object.getOwnPropertyDescriptor,xu=Object.getOwnPropertyNames,Iu=Object.getPrototypeOf,Mu=Object.prototype.hasOwnProperty,Au=(N,U,J)=>U in N?oi(N,U,{enumerable:!0,configurable:!0,writable:!0,value:J}):N[U]=J,Lu=(N,U)=>{for(var J in U)oi(N,J,{get:U[J],enumerable:!0})},yc=(N,U,J,se)=>{if(U&&typeof U=="object"||typeof U=="function")for(let fe of xu(U))!Mu.call(N,fe)&&fe!==J&&oi(N,fe,{get:()=>U[fe],enumerable:!(se=Du(U,fe))||se.enumerable});return N},ci=(N,U,J)=>(J=N!=null?Ou(Iu(N)):{},yc(!N||!N.__esModule?oi(J,"default",{value:N,enumerable:!0}):J,N)),Nu=N=>yc(oi({},"__esModule",{value:!0}),N),Rn=(N,U,J)=>(Au(N,typeof U!="symbol"?U+"":U,J),J),bc={};Lu(bc,{createReactPlayer:()=>zu});var ju=Nu(bc),Ms=ci(Dt),Bu=ci(xo),Xi=ci(tu),Oo=ci(lc),si=mc,wc=Vi,Fu=ci(ku);const Uu=(0,wc.lazy)(()=>ha(()=>import("./Preview-bWhTgdhE.js").then(N=>N.P),__vite__mapDeps([15,1,2]))),Wu=typeof window<"u"&&window.document&&typeof document<"u",Vu=typeof Ji<"u"&&Ji.window&&Ji.window.document,qu=Object.keys(si.propTypes),Hu=Wu||Vu?Ms.Suspense:()=>null,ai=[],zu=(N,U)=>{var J;return J=class extends Ms.Component{constructor(){super(...arguments),Rn(this,"state",{showPreview:!!this.props.light}),Rn(this,"references",{wrapper:se=>{this.wrapper=se},player:se=>{this.player=se}}),Rn(this,"handleClickPreview",se=>{this.setState({showPreview:!1}),this.props.onClickPreview(se)}),Rn(this,"showPreview",()=>{this.setState({showPreview:!0})}),Rn(this,"getDuration",()=>this.player?this.player.getDuration():null),Rn(this,"getCurrentTime",()=>this.player?this.player.getCurrentTime():null),Rn(this,"getSecondsLoaded",()=>this.player?this.player.getSecondsLoaded():null),Rn(this,"getInternalPlayer",(se="player")=>this.player?this.player.getInternalPlayer(se):null),Rn(this,"seekTo",(se,fe,De)=>{if(!this.player)return null;this.player.seekTo(se,fe,De)}),Rn(this,"handleReady",()=>{this.props.onReady(this)}),Rn(this,"getActivePlayer",(0,Xi.default)(se=>{for(const fe of[...ai,...N])if(fe.canPlay(se))return fe;return U||null})),Rn(this,"getConfig",(0,Xi.default)((se,fe)=>{const{config:De}=this.props;return Bu.default.all([si.defaultProps.config,si.defaultProps.config[fe]||{},De,De[fe]||{}])})),Rn(this,"getAttributes",(0,Xi.default)(se=>(0,wc.omit)(this.props,qu))),Rn(this,"renderActivePlayer",se=>{if(!se)return null;const fe=this.getActivePlayer(se);if(!fe)return null;const De=this.getConfig(se,fe.key);return Ms.default.createElement(Fu.default,{...this.props,key:fe.key,ref:this.references.player,config:De,activePlayer:fe.lazyPlayer||fe,onReady:this.handleReady})})}shouldComponentUpdate(se,fe){return!(0,Oo.default)(this.props,se)||!(0,Oo.default)(this.state,fe)}componentDidUpdate(se){const{light:fe}=this.props;!se.light&&fe&&this.setState({showPreview:!0}),se.light&&!fe&&this.setState({showPreview:!1})}renderPreview(se){if(!se)return null;const{light:fe,playIcon:De,previewTabIndex:Pt,oEmbedUrl:G,previewAriaLabel:C}=this.props;return Ms.default.createElement(Uu,{url:se,light:fe,playIcon:De,previewTabIndex:Pt,previewAriaLabel:C,oEmbedUrl:G,onClick:this.handleClickPreview})}render(){const{url:se,style:fe,width:De,height:Pt,fallback:G,wrapper:C}=this.props,{showPreview:l}=this.state,k=this.getAttributes(se),S=typeof C=="string"?this.references.wrapper:void 0;return Ms.default.createElement(C,{ref:S,style:{...fe,width:De,height:Pt},...k},Ms.default.createElement(Hu,{fallback:G},l?this.renderPreview(se):this.renderActivePlayer(se)))}},Rn(J,"displayName","ReactPlayer"),Rn(J,"propTypes",si.propTypes),Rn(J,"defaultProps",si.defaultProps),Rn(J,"addCustomPlayer",se=>{ai.push(se)}),Rn(J,"removeCustomPlayers",()=>{ai.length=0}),Rn(J,"canPlay",se=>{for(const fe of[...ai,...N])if(fe.canPlay(se))return!0;return!1}),Rn(J,"canEnablePIP",se=>{for(const fe of[...ai,...N])if(fe.canEnablePIP&&fe.canEnablePIP(se))return!0;return!1}),J};var $u=Object.create,zi=Object.defineProperty,Gu=Object.getOwnPropertyDescriptor,Ku=Object.getOwnPropertyNames,Ju=Object.getPrototypeOf,Yu=Object.prototype.hasOwnProperty,Qu=(N,U)=>{for(var J in U)zi(N,J,{get:U[J],enumerable:!0})},Sc=(N,U,J,se)=>{if(U&&typeof U=="object"||typeof U=="function")for(let fe of Ku(U))!Yu.call(N,fe)&&fe!==J&&zi(N,fe,{get:()=>U[fe],enumerable:!(se=Gu(U,fe))||se.enumerable});return N},Xu=(N,U,J)=>(J=N!=null?$u(Ju(N)):{},Sc(!N||!N.__esModule?zi(J,"default",{value:N,enumerable:!0}):J,N)),Zu=N=>Sc(zi({},"__esModule",{value:!0}),N),Rc={};Qu(Rc,{default:()=>nl});var el=Zu(Rc),ro=Xu(Jd),tl=ju;const rl=ro.default[ro.default.length-1];var nl=(0,tl.createReactPlayer)(ro.default,rl);const al=Do(el);function sl(N){const U=Dt.useRef(null),{webcamStream:J,micStream:se,webcamOn:fe,micOn:De,isLocal:Pt,displayName:G}=sd(N.participantId),C=Dt.useMemo(()=>{if(fe&&J){const l=new MediaStream;return l.addTrack(J.track),l}},[J,fe]);return Dt.useEffect(()=>{if(U.current)if(De&&se){const l=new MediaStream;l.addTrack(se.track),U.current.srcObject=l,U.current.play().catch(k=>console.error("videoElem.current.play() failed",k))}else U.current.srcObject=null},[se,De]),tr.jsxs("div",{children:[tr.jsx("audio",{ref:U,autoPlay:!0,playsInline:!0,muted:Pt}),fe&&tr.jsx(al,{playsinline:!0,pip:!1,light:!1,controls:!1,muted:!0,playing:!0,url:C,height:"auto",width:"100%",onError:l=>{console.log(l,"participant video error")}})]})}function il(){const[N,U]=Dt.useState(null),{join:J,participants:se}=Ho({onMeetingJoined:()=>{U("JOINED")}}),fe=()=>{U("JOINING"),J()};return tr.jsx("div",{className:"container",children:N&&N=="JOINED"?tr.jsx("div",{children:[...se.keys()].map(De=>tr.jsx(sl,{participantId:De},De))}):tr.jsx(Mo,{loading:N&&N=="JOINING",onClick:fe,disabled:N&&N=="JOINING",className:"ml-auto btn-indigo w-full mt-4",children:N&&N=="JOINING"?"Joining the meeting...":"Join the meeting"})})}const ol=()=>tr.jsx(ad,{config:{meetingId:"aw18-zd7c-njdv",micEnabled:!0,webcamEnabled:!0,name:"ZeRa's Org"},token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcGlrZXkiOiIyM2Y0MDRiNC00MmM4LTQ3NGUtYTViNC1jMGI0OTE2NmZiNGMiLCJwZXJtaXNzaW9ucyI6WyJhbGxvd19qb2luIl0sImlhdCI6MTc0MjU2ODI0OSwiZXhwIjoxNzQyNjU0NjQ5fQ.zY5cmzSzjO47-IrYUiiitp544usNDpz9CATrKVM5FzE",children:tr.jsx(il,{})}),Ec=()=>{const{document:N}=yo().props,{data:U,setData:J,errors:se,post:fe,processing:De}=Lc({document_name:N.document_name||"",document_unique_name:"",_method:"put"});Dt.useEffect(()=>{U.document_unique_name&&typeof U.document_unique_name=="object"&&"name"in U.document_unique_name&&J("document_name",U.document_unique_name.name)},[U.document_unique_name]);function Pt(o){o.preventDefault(),!(!U.document_unique_name||U.document_unique_name==="")&&fe(route("documents.update",N.id))}function G(){confirm("Are you sure you want to delete this document?")&&bo.delete(route("documents.destroy",N.id))}function C(){confirm("Are you sure you want to restore this document?")&&bo.put(route("documents.restore",N.id))}const k=N.document_unique_name.split(".").pop()||"",d=(o=>o==="pdf"?"pdf":o==="doc"||o==="docx"?"word":"image")(k),{auth:u}=yo().props,f=u.user;return tr.jsx(tr.Fragment,{children:tr.jsxs(zc,{children:[tr.jsx(wo,{md:4,children:tr.jsxs("div",{children:[tr.jsx(Nc,{title:N.document_name}),tr.jsxs("h1",{className:"mb-8 text-3xl font-bold",children:[tr.jsx(jc,{href:route("documents"),className:"text-indigo-600 hover:text-indigo-700",children:"Documents"}),tr.jsx("span",{className:"mx-2 font-medium text-indigo-600",children:"/"}),N.document_name]}),N.deleted_at&&tr.jsx(Fc,{message:"This document has been deleted. It will be permanently removed after 30 days.",onRestore:C}),!N.deleted_at&&tr.jsxs(tr.Fragment,{children:[tr.jsx("div",{className:"video-call-box py-4",children:tr.jsx(ol,{})}),tr.jsx("div",{className:"max-w-3xl overflow-hidden bg-white rounded shadow",children:tr.jsxs("form",{onSubmit:Pt,children:[tr.jsx("div",{className:"grid gap-8 p-8",children:tr.jsx(Vc,{label:"Document File(images, .pdf, .doc, .docx)",name:"document_unique_name",error:se.document_unique_name,children:tr.jsx(qc,{name:"document_unique_name",accept:"image/*,.pdf,.doc,.docx",required:!0,error:se.document_unique_name,value:U.document_unique_name,className:"w-full",onChange:o=>{if(o&&o.target&&o.target.files&&o.target.files.length>0){const c=o.target.files[0];J("document_name",c.name),J("document_unique_name",c)}else o&&o.name&&(J("document_name",o.name),J("document_unique_name",o))}})})}),tr.jsxs("div",{className:"flex items-center px-8 py-4 bg-gray-100 border-t border-gray-200",children:[!N.deleted_at&&tr.jsx(Uc,{onDelete:G,className:"text-white bg-gradient-to-r from-red-400 via-red-500 to-red-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:tr.jsx($c,{})}),f.owner&&tr.jsx(Mo,{loading:De,type:"submit",title:"Upload notirized document",className:"text-white bg-gradient-to-r from-blue-500 via-blue-600 to-blue-700 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",disabled:!U.document_unique_name||U.document_unique_name==="",children:tr.jsx(Kc,{})}),N.updated_at&&tr.jsx("a",{href:N.document_unique_name,download:!0,className:"text-white bg-gradient-to-r from-green-400 via-green-500 to-green-600 hover:bg-gradient-to-br focus:ring-4 focus:outline-none focus:ring-green-300 dark:focus:ring-green-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",title:"Download",children:tr.jsx(Gc,{})})]})]})})]})]})}),!N.deleted_at&&tr.jsx(tr.Fragment,{children:tr.jsxs(wo,{md:8,children:[tr.jsx("div",{className:"bg-white rounded shadow",children:tr.jsxs("div",{className:"p-8",children:[d==="pdf"&&tr.jsx("embed",{src:N.document_unique_name,className:"w-full",type:"application/pdf",style:{height:"600px"}}),d==="word"&&tr.jsx("iframe",{src:`https://view.officeapps.live.com/op/embed.aspx?src=${N.document_unique_name}`,width:"100%",height:"600"}),d==="image"&&tr.jsx("img",{src:N.document_unique_name,alt:N.document_name,className:"w-full rounded"})]})}),tr.jsxs("div",{className:"updates-box",children:[tr.jsx("h2",{className:"mt-12 mb-6 text-2xl font-bold",children:"Updates"}),tr.jsx(Wc,{columns:[{label:"Date",name:"created_at",renderCell:o=>(e=>{const g=new Date,h=new Date(e),v=Math.floor((g.getTime()-h.getTime())/1e3);if(v<60)return`${v} seconds ago`;const _=Math.floor(v/60);if(_<60)return`${_} minutes ago`;const b=Math.floor(_/60);return b<24?`${b} hours ago`:`${Math.floor(b/24)} days ago`})(o.created_at)+"("+new Date(o.created_at).toLocaleTimeString()+"  "+new Date(o.created_at).toLocaleDateString()+")"},{label:"Status",name:"status"},{label:"Message",name:"message"}],rows:N.updates})]})]})})]})})};Ec.layout=N=>tr.jsx(Bc,{children:N});const _l=Object.freeze(Object.defineProperty({__proto__:null,default:Ec},Symbol.toStringTag,{value:"Module"}));export{_l as E,Wd as p,Vi as u};
